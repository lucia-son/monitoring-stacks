"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2461,4286],{65007:(le,U,a)=>{a.r(U),a.d(U,{AlertRuleListUnconnected:()=>Re,default:()=>Se});var n=a(66111),e=a(67948),D=a(37932),B=a(35645),T=a(14747),H=a(8581),S=a(31403),j=a(52081),ee=a(18271),L=a(8412),J=a(45984),X=a(35029);function C({onDismiss:f}){return n.createElement(X.u,{title:"Adding an Alert",isOpen:!0,onDismiss:f,onClickBackdrop:f},n.createElement(j.wc,{spacing:"sm"},n.createElement("img",{src:"public/img/alert_howto_new.png",alt:""}),n.createElement("p",null,"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."),n.createElement("p",null,"Remember to save the dashboard to persist your alert rule changes.")))}var P=a(55271),F=a.n(P),k=a(72948),me=a(39904);const Ae=({rule:f,search:x,onTogglePause:Q})=>{const ie=`${f.url}?editPanel=${f.panelId}&tab=alert`,_=(0,n.useCallback)(ge=>n.createElement(F(),{key:ge,highlightClassName:"highlight-search-match",textToHighlight:ge,searchWords:[x]}),[x]);return n.createElement(k.Z,null,n.createElement(k.Z.Heading,null,_(f.name)),n.createElement(k.Z.Figure,null,n.createElement(me.J,{size:"xl",name:f.stateIcon,className:`alert-rule-item__icon ${f.stateClass}`})),n.createElement(k.Z.Meta,null,n.createElement("span",{key:"state"},n.createElement("span",{key:"text",className:`${f.stateClass}`},_(f.stateText)," "),"for ",f.stateAge),f.info?_(f.info):null),n.createElement(k.Z.Actions,null,n.createElement(S.zx,{key:"play",variant:"secondary",icon:f.state==="paused"?"play":"pause",onClick:Q},f.state==="paused"?"Resume":"Pause"),n.createElement(S.Qj,{key:"edit",variant:"secondary",href:ie,icon:"cog"},"Edit alert")))};var Te=a(45253);const Ge="grafana.legacyalerting.unifiedalertingpromo",de=()=>n.createElement(Te.b,{severity:"warning",title:"Grafana legacy alerting is deprecated and will be removed in a future release."},n.createElement("p",null,"You are using Grafana legacy alerting, which has been deprecated since Grafana 9.0. The codebase is now staying as is and will be removed in Grafana 11.0.",n.createElement("br",null),"We recommend upgrading to Grafana Alerting as soon as possible."),n.createElement("p",null,"See"," ",n.createElement("a",{href:"https://grafana.com/docs/grafana/latest/alerting/migrating-alerts/"},"how to upgrade to Grafana Alerting")," ","to learn more."));var ye=a(69119),Ie=a(11626);const ce=f=>f.searchQuery,q=f=>{const x=new RegExp(f.alertRules.searchQuery,"i");return f.alertRules.items.filter(Q=>x.test(Q.name)||x.test(Q.stateText)||x.test(Q.info))},M=(f,x)=>f.notificationChannel.id===x?f.notificationChannel:null;function te(f){return{alertRules:q(f),search:ce(f.alertRules),isLoading:f.alertRules.isLoading}}const z={getAlertRulesAsync:ye.Au,setSearchQuery:Ie.ql,togglePauseAlertRule:ye.en},Le=(0,e.connect)(te,z);class Re extends n.PureComponent{constructor(){super(...arguments),this.stateFilters=[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}],this.onStateFilterChanged=x=>{D.E1.partial({state:x.value})},this.onOpenHowTo=()=>{ee.Z.publish(new J.Dn({component:C}))},this.onSearchQueryChange=x=>{this.props.setSearchQuery(x)},this.onTogglePause=x=>{this.props.togglePauseAlertRule(x.id,{paused:x.state!=="paused"})},this.alertStateFilterOption=({text:x,value:Q})=>n.createElement("option",{key:Q,value:Q},x)}componentDidMount(){this.fetchRules()}componentDidUpdate(x){x.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){return this.props.queryParams.state??"all"}render(){const{alertRules:x,search:Q,isLoading:ie}=this.props;return n.createElement(L.T,{navId:"alert-list"},n.createElement(L.T.Contents,{isLoading:ie},n.createElement("div",{className:"page-action-bar"},n.createElement("div",{className:"gf-form gf-form--grow"},n.createElement(T.H,{placeholder:"Search alerts",value:Q,onChange:this.onSearchQueryChange})),n.createElement("div",{className:"gf-form"},n.createElement("label",{className:"gf-form-label",htmlFor:"alert-state-filter"},"States"),n.createElement("div",{className:"width-13"},n.createElement(H.Ph,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()}))),n.createElement("div",{className:"page-action-bar__spacer"}),B.v.unifiedAlertingEnabled&&n.createElement(S.Qj,{variant:"primary",href:"alerting/ng/new"},"Add NG Alert"),n.createElement(S.zx,{variant:"secondary",onClick:this.onOpenHowTo},"How to add an alert")),n.createElement(de,null),n.createElement(j.wc,{spacing:"none"},x.map(_=>n.createElement(Ae,{rule:_,key:_.id,search:Q,onTogglePause:()=>this.onTogglePause(_)})))))}}const Se=Le(Re)},69119:(le,U,a)=>{a.d(U,{Au:()=>H,C2:()=>j,c1:()=>L,en:()=>S,fA:()=>J,fg:()=>ee,tk:()=>X});var n=a(54899),e=a(37932),D=a(659),B=a(60499),T=a(11626);function H(C){return async P=>{P((0,T.gz)());const F=await(0,n.i)().get("/api/alerts",C);P((0,T.Oc)(F))}}function S(C,P){return async F=>{await(0,n.i)().post(`/api/alerts/${C}/pause`,P);const k=e.E1.getSearchObject().state||"all";F(H({state:k.toString()}))}}function j(C){return async P=>{try{await(0,n.i)().post("/api/alert-notifications",C),P((0,D.$l)((0,B.AT)("Notification created"))),e.E1.push("/alerting/notifications")}catch(F){(0,n.kW)(F)&&P((0,D.$l)((0,B.t_)(F.data.error)))}}}function ee(C){return async P=>{try{await(0,n.i)().put(`/api/alert-notifications/${C.id}`,C),P((0,D.$l)((0,B.AT)("Notification updated")))}catch(F){(0,n.kW)(F)&&P((0,D.$l)((0,B.t_)(F.data.error)))}}}function L(C){return async(P,F)=>{const k=F().notificationChannel.notificationChannel;await(0,n.i)().post("/api/alert-notifications/test",{id:k.id,...C})}}function J(){return async C=>{const F=(await(0,n.i)().get("/api/alert-notifiers")).sort((k,me)=>k.name>me.name?1:-1);C((0,T.T2)(F))}}function X(C){return async P=>{await P(J());const F=await(0,n.i)().get(`/api/alert-notifications/${C}`);P((0,T.K)(F))}}},36291:(le,U,a)=>{a.r(U),a.d(U,{default:()=>kt});var n=a(9892),e=a(66111),D=a(56895),B=a(13821),T=a(49371),H=a(49187),S=a(26418),j=a(54408),ee=a(53546),L=a(72648),J=a(31403),X=a(96044),C=a(27876),P=a(41904),F=a(45524),k=a(97097),me=a(69142),ve=a(39910);const Ae=()=>{const{canCreateGrafanaRules:t,canCreateCloudRules:r}=(0,ve.B)();return t||r?e.createElement(me.Z,{title:"You haven`t created any alert rules yet",buttonIcon:"bell",buttonLink:"alerting/new",buttonTitle:"Create alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,j.PN)(P.z7.alertRuleFromScratch)}):e.createElement(k._,{message:"No rules exist yet.",callToActionElement:e.createElement("div",null)})};var Te=a(89149),Ge=a(64681),de=a.n(Ge),ye=a(23934),Ie=a(45253),ce=a(61860),q=a(69945),M=a(45849),te=a(10505),z=a(79662);function Le(){const[t,r]=(0,e.useState)(!1),[s,m]=(0,ye.Z)("grafana.unifiedalerting.hideErrors",!1),l=(0,q._)(u=>u.dataSources),o=(0,q._)(u=>u.promRules),i=(0,q._)(u=>u.rulerRules),c=(0,L.wW)(Se),d=(0,e.useMemo)(()=>{const[u,h,v]=[l,o,i].map(E=>(0,M.Eu)().reduce((p,O)=>{const w=E[O.name]?.error;return E[O.name]&&w&&!(0,z.m$)(E[O.name])?[...p,{dataSource:O,error:w}]:p},[])),R=o[M.GC]?.error,y=i[M.GC]?.error,N=[];return R&&N.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules state: ",R.message||"Unknown error.")),y&&N.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules config: ",y.message||"Unknown error.")),u.forEach(({dataSource:E,error:p})=>{N.push(e.createElement(e.Fragment,null,"Failed to load the data source configuration for"," ",e.createElement("a",{href:(0,te.__)(E),className:c.dsLink},E.name),": ",p.message||"Unknown error."))}),h.forEach(({dataSource:E,error:p})=>N.push(e.createElement(e.Fragment,null,"Failed to load rules state from"," ",e.createElement("a",{href:(0,te.__)(E),className:c.dsLink},E.name),": ",p.message||"Unknown error."))),v.forEach(({dataSource:E,error:p})=>N.push(e.createElement(e.Fragment,null,"Failed to load rules config from"," ",e.createElement("a",{href:(0,te.__)(E),className:c.dsLink},E.name),": ",p.message||"Unknown error."))),N},[l,o,i,c.dsLink]);return e.createElement(e.Fragment,null,!!d.length&&s&&e.createElement(Re,{count:d.length,onClick:()=>m(u=>!u)}),!!d.length&&!s&&e.createElement(Ie.b,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>m(!0)},t&&d.map((u,h)=>e.createElement("div",{key:h},u)),!t&&e.createElement(e.Fragment,null,e.createElement("div",null,d[0]),d.length>=2&&e.createElement(J.zx,{className:c.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>r(!0)},d.length-1," more ",de()("error",d.length-1)))))}const Re=({count:t,onClick:r})=>{const s=(0,L.wW)(Se);return e.createElement("div",{className:s.floatRight},e.createElement(ce.u,{content:"Show all errors",placement:"bottom"},e.createElement(J.zx,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:r},t>1?e.createElement(e.Fragment,null,t," errors"):e.createElement(e.Fragment,null,"1 error"))))},Se=t=>({moreButton:n.css`
    padding: 0;
  `,floatRight:n.css`
    display: flex;
    justify-content: flex-end;
  `,dsLink:n.css`
    font-weight: ${t.typography.fontWeightBold};
  `});var f=a(51981),x=a(61744),Q=a(67487),ie=a(78889),_=a(84952),ge=a(25724),We=a(1562),Ce=a(46818),Ue=a(52081),se=a(39904),De=a(19985),et=a(98102),tt=a(55485),at=a(8055),xe=a(72004),Be=a(33950),He=a(29721),oe=a(65750),nt=a(61068),rt=a(9085),ze=a.n(rt),Ne=a(82897),Fe=a(36826),lt=a(35029),st=a(3153),ot=a(60048),ct=a(45608);const it=t=>{const{group:r,namespace:s,onClose:m}=t,[l,o]=(0,e.useState)(!1),[i,c]=(0,e.useState)(r.rules),d=(0,L.wW)(be),u=(0,e.useCallback)(v=>{if(!v.destination||v.destination.index===v.source.index)return;const y=mt(i,v.source.index,v.destination.index);c(y);const N=(0,M.EG)(s.rulesSource),E=(0,Ne.compact)(y.map(p=>p.rulerRule));o(!0),(0,st.WI)((0,xe.tg)({namespaceName:s.name,groupName:r.name,rulesSourceName:N,newRules:E})).unwrap().finally(()=>{o(!1)})},[r.name,s.name,s.rulesSource,i]),h=i.map(v=>({...v,uid:String((0,ot.Om)(v.rulerRule))}));return e.createElement(lt.u,{className:d.modal,isOpen:!0,title:e.createElement(ut,{namespace:s,group:r}),onDismiss:m,onClickBackdrop:m},e.createElement(Fe.Z5,{onDragEnd:u},e.createElement(Fe.bK,{droppableId:"alert-list",mode:"standard",renderClone:(v,R,y)=>e.createElement(Ke,{provided:v,rule:h[y.source.index],isClone:!0})},v=>e.createElement("div",{ref:v.innerRef,className:ze()(d.listContainer,l&&d.disabled),...v.droppableProps},h.map((R,y)=>e.createElement(Fe._l,{key:R.uid,draggableId:R.uid,index:y,isDragDisabled:l},N=>e.createElement(Ke,{key:R.uid,provided:N,rule:R}))),v.placeholder))))},Ke=({provided:t,rule:r,isClone:s=!1,isDragging:m=!1})=>{const l=(0,L.wW)(be);return e.createElement("div",{className:ze()(l.listItem,s&&"isClone",m&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps},(0,z.x_)(r.promRule)&&e.createElement(ct.l,{state:r.promRule.state}),(0,z.OP)(r.promRule)&&e.createElement(De.C,{text:"Recording",color:"blue"}),e.createElement("div",{className:l.listItemName},r.name),e.createElement(se.J,{name:"draggabledots"}))},ut=({namespace:t,group:r})=>{const s=(0,L.wW)(be);return e.createElement("div",{className:s.header},e.createElement(se.J,{name:"folder"}),(0,M.jq)(t.rulesSource)&&e.createElement(ce.u,{content:t.rulesSource.name,placement:"top"},e.createElement("img",{alt:t.rulesSource.meta.name,className:s.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})),e.createElement("span",null,t.name),e.createElement(se.J,{name:"angle-right"}),e.createElement("span",null,r.name))},be=t=>({modal:n.css`
    max-width: 640px;
    max-height: 80%;
    overflow: hidden;
  `,listItem:n.css`
    display: flex;
    flex-direction: row;
    align-items: center;

    gap: ${t.spacing()};

    background: ${t.colors.background.primary};
    color: ${t.colors.text.secondary};

    border-bottom: solid 1px ${t.colors.border.medium};
    padding: ${t.spacing(1)} ${t.spacing(2)};

    &:last-child {
      border-bottom: none;
    }

    &.isClone {
      border: solid 1px ${t.colors.primary.shade};
    }
  `,listContainer:n.css`
    user-select: none;
    border: solid 1px ${t.colors.border.medium};
  `,disabled:n.css`
    opacity: 0.5;
    pointer-events: none;
  `,listItemName:n.css`
    flex: 1;

    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  `,header:n.css`
    display: flex;
    align-items: center;

    gap: ${t.spacing(1)};
  `,dataSourceIcon:n.css`
    width: ${t.spacing(2)};
    height: ${t.spacing(2)};
  `});function mt(t,r,s){const m=Array.from(t),[l]=m.splice(r,1);return m.splice(s,0,l),m}var Qe=a(46253),je=a(8347);const Me=e.memo(({group:t,namespace:r,expandAll:s,viewMode:m})=>{const{rulesSource:l}=r,o=(0,C.useDispatch)(),i=(0,L.wW)(dt),[c,d]=(0,e.useState)(!1),[u,h]=(0,e.useState)(!1),[v,R]=(0,e.useState)(!1),[y,N]=(0,e.useState)(!s),{canEditRules:E}=(0,ve.B)();(0,e.useEffect)(()=>{N(!s)},[s]);const{hasRuler:p,rulerRulesLoaded:O}=(0,at.h)(),w=t.rules[0]?.rulerRule,A=w&&(0,z.Pc)(w)&&w.grafana_alert.namespace_uid||void 0,{folder:b}=(0,tt.W)(A),V=p(l)&&O(l)&&!t.rules.find(K=>!!K.rulerRule),Z=(0,z.Jq)(t),G=t.rules.some(K=>(0,z.Pc)(K.rulerRule)&&K.rulerRule.grafana_alert.provenance),I=m==="list",ne=m==="grouped",re=()=>{o((0,xe.oE)(r,t)),h(!1)},g=[];if(V)g.push(e.createElement(Ue.Lh,{key:"is-deleting"},e.createElement(Q.$,null),"deleting"));else if(l===M.GC){if(A){const K=(0,te.HV)(A);b?.canSave&&(ne&&!G&&(g.push(e.createElement(oe.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>d(!0)})),g.push(e.createElement(oe.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>R(!0)}))),I&&g.push(e.createElement(oe.A,{"aria-label":"go to folder",key:"goto",icon:"folder-open",tooltip:"go to folder",to:K,target:"__blank"}))),b?.canAdmin&&I&&g.push(e.createElement(oe.A,{"aria-label":"manage permissions",key:"manage-perms",icon:"lock",tooltip:"manage permissions",to:K+"/permissions",target:"__blank"}))}}else E(l.name)&&p(l)&&(Z||(g.push(e.createElement(oe.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>d(!0)})),g.push(e.createElement(oe.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"re-order rules",className:i.rotate90,onClick:()=>R(!0)}))),g.push(e.createElement(oe.A,{"aria-label":"delete rule group","data-testid":"delete-group",key:"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>h(!0)})));const W=I?e.createElement(He.V,{namespace:r.name}):e.createElement(He.V,{namespace:r.name,group:t.name}),he=(K=!1)=>{K||(0,j.PN)(P.z7.leavingRuleGroupEdit),d(!1)};return e.createElement("div",{className:i.wrapper,"data-testid":"rule-group"},e.createElement("div",{className:i.header,"data-testid":"rule-group-header"},e.createElement(Be.U,{size:"sm",className:i.collapseToggle,isCollapsed:y,onToggle:N,"data-testid":"group-collapse-toggle"}),e.createElement(se.J,{name:y?"folder":"folder-open"}),(0,M.jq)(l)&&e.createElement(ce.u,{content:l.name,placement:"top"},e.createElement("img",{alt:l.meta.name,className:i.dataSourceIcon,src:l.meta.info.logos.small})),e.createElement("div",{className:i.groupName,onClick:()=>N(!y)},Z&&e.createElement(De.C,{color:"purple",text:"Federated"})," ",W),e.createElement("div",{className:i.spacer}),e.createElement("div",{className:i.headerStats},e.createElement(Qe.Pb,{group:t})),G&&e.createElement(e.Fragment,null,e.createElement("div",{className:i.actionsSeparator},"|"),e.createElement("div",{className:i.actionIcons},e.createElement(De.C,{color:"purple",text:"Provisioned"}))),!!g.length&&e.createElement(e.Fragment,null,e.createElement("div",{className:i.actionsSeparator},"|"),e.createElement("div",{className:i.actionIcons},e.createElement(S.Stack,{gap:.5},g)))),!y&&e.createElement(je.i,{showSummaryColumn:!0,className:i.rulesTable,showGuidelines:!0,showNextEvaluationColumn:Boolean(t.interval),rules:t.rules}),c&&e.createElement(nt.vq,{namespace:r,group:t,onClose:()=>he(),folderUrl:b?.canEdit?(0,te.aH)(b):void 0}),v&&e.createElement(it,{group:t,namespace:r,onClose:()=>R(!1)}),e.createElement(et.s,{isOpen:u,title:"Delete group",body:e.createElement("div",null,"Deleting this group will permanently remove the group",e.createElement("br",null),"and ",t.rules.length," alert ",de()("rule",t.rules.length)," belonging to it.",e.createElement("br",null),"Are you sure you want to delete this group?"),onConfirm:re,onDismiss:()=>h(!1),confirmText:"Delete"}))});Me.displayName="RulesGroup";const dt=t=>({wrapper:n.css``,header:n.css`
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: ${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0;
      flex-wrap: nowrap;
      border-bottom: 1px solid ${t.colors.border.weak};
      &:hover {
        background-color: ${t.components.table.rowHoverBackground};
      }
    `,headerStats:n.css`
      flex-shrink: 0;

      span {
        vertical-align: middle;
      }

      ${t.breakpoints.down("sm")} {
        order: 2;
        width: 100%;
        padding-left: ${t.spacing(1)};
      }
    `,groupName:n.css`
      margin-left: ${t.spacing(1)};
      margin-bottom: 0;
      cursor: pointer;

      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    `,spacer:n.css`
      flex: 1;
    `,collapseToggle:n.css`
      background: none;
      border: none;
      margin-top: -${t.spacing(1)};
      margin-bottom: -${t.spacing(1)};

      svg {
        margin-bottom: 0;
      }
    `,dataSourceIcon:n.css`
      width: ${t.spacing(2)};
      height: ${t.spacing(2)};
      margin-left: ${t.spacing(2)};
    `,dataSourceOrigin:n.css`
      margin-right: 1em;
      color: ${t.colors.text.disabled};
    `,actionsSeparator:n.css`
      margin: 0 ${t.spacing(2)};
    `,actionIcons:n.css`
      width: 80px;
      align-items: center;

      flex-shrink: 0;
    `,rulesTable:n.css`
      margin: ${t.spacing(2,0)};
    `,rotate90:n.css`
      transform: rotate(90deg);
    `});function we(t){return(0,e.useMemo)(()=>t.flatMap(r=>r.groups.map(s=>({namespace:r,group:s}))),[t])}const gt=({namespaces:t,expandAll:r})=>{const s=(0,L.wW)(pt),m=(0,q._)(p=>p.dataSources),l=(0,q._)(p=>p.promRules),o=(0,e.useMemo)(M.Eu,[]),i=we(t),c=(0,e.useMemo)(()=>o.filter(p=>(0,Ce.op)(l[p.name])||(0,Ce.op)(m[p.name])),[l,m,o]),d=o.some(p=>l[p.name]?.result?.length??0>0),u=o.length>0,h=c.length>0,v=t.length>0,{numberOfPages:R,onPageChange:y,page:N,pageItems:E}=(0,ge.h)(i,1,_.gN);return e.createElement("section",{className:s.wrapper},e.createElement("div",{className:s.sectionHeader},e.createElement("h5",null,"Mimir / Cortex / Loki"),c.length?e.createElement(x.u,{className:s.loader,text:`Loading rules from ${c.length} ${de()("source",c.length)}`}):e.createElement("div",null)),E.map(({group:p,namespace:O})=>e.createElement(Me,{group:p,key:`${(0,M.v_)(O.rulesSource)}-${O.name}-${p.name}`,namespace:O,expandAll:r,viewMode:"grouped"})),!u&&e.createElement("p",null,"There are no Prometheus or Loki data sources configured."),u&&!h&&!v&&e.createElement("p",null,"No rules found."),!d&&h&&e.createElement(Q.$,{size:24,className:s.spinner}),e.createElement(ie.t,{className:s.pagination,currentPage:N,numberOfPages:R,onNavigate:y,hideWhenSinglePage:!0}))},pt=t=>({loader:n.css`
    margin-bottom: 0;
  `,sectionHeader:n.css`
    display: flex;
    justify-content: space-between;
  `,wrapper:n.css`
    margin-bottom: ${t.spacing(4)};
  `,spinner:n.css`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,We.Z)(t)});var pe=a(61627);const ft=({namespaces:t,expandAll:r})=>{const s=(0,L.wW)(Et),[m]=(0,X.K)(),{prom:l,ruler:o}=(0,q._)(E=>({prom:E.promRules[M.GC]||Ce.oq,ruler:E.rulerRules[M.GC]||Ce.oq})),i=l.loading||o.loading,c=!!l.result||!!o.result,d=m.view==="list",u=d?(0,pe.Kd)(t):t,h=we(u),{numberOfPages:v,onPageChange:R,page:y,pageItems:N}=(0,ge.h)(h,1,_.gN);return e.createElement("section",{className:s.wrapper},e.createElement("div",{className:s.sectionHeader},e.createElement("h5",null,"Grafana"),i?e.createElement(x.u,{className:s.loader,text:"Loading..."}):e.createElement("div",null)),N.map(({group:E,namespace:p})=>e.createElement(Me,{group:E,key:`${p.name}-${E.name}`,namespace:p,expandAll:r,viewMode:d?"list":"grouped"})),c&&u?.length===0&&e.createElement("p",null,"No rules found."),!c&&i&&e.createElement(Q.$,{size:24,className:s.spinner}),e.createElement(ie.t,{className:s.pagination,currentPage:y,numberOfPages:v,onNavigate:R,hideWhenSinglePage:!0}))},Et=t=>({loader:n.css`
    margin-bottom: 0;
  `,sectionHeader:n.css`
    display: flex;
    justify-content: space-between;
    margin-bottom: ${t.spacing(1)};
  `,wrapper:n.css`
    margin-bottom: ${t.spacing(4)};
  `,spinner:n.css`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,We.Z)(t)}),ht=({namespaces:t,expandAll:r})=>{const[s,m]=(0,e.useMemo)(()=>{const l=t.map(o=>({...o,groups:o.groups.sort((i,c)=>i.name.localeCompare(c.name))})).sort((o,i)=>o.name.localeCompare(i.name));return[l.filter(o=>(0,M.HY)(o.rulesSource)),l.filter(o=>(0,M.jq)(o.rulesSource))]},[t]);return(0,e.useEffect)(()=>{(0,j.PN)(P.z7.loadedList)},[]),e.createElement(e.Fragment,null,e.createElement(f.q,{actions:[C.AccessControlAction.AlertingRuleRead]},e.createElement(ft,{namespaces:s,expandAll:r})),e.createElement(f.q,{actions:[C.AccessControlAction.AlertingRuleExternalRead]},e.createElement(gt,{namespaces:m,expandAll:r})))};var $=a(46063);const $e=({rules:t,state:r,defaultCollapsed:s=!1})=>{const[m,l]=(0,e.useState)(s),o=(0,L.wW)(vt);return e.createElement(e.Fragment,null,e.createElement("h4",{className:o.header},e.createElement(Be.U,{className:o.collapseToggle,size:"xxl",isCollapsed:m,onToggle:()=>l(!m)}),(0,z.SS)(r)," (",t.length,")"),!m&&e.createElement(je.i,{className:o.rulesTable,rules:t,showGroupColumn:!0}))},vt=t=>({collapseToggle:n.css`
    vertical-align: middle;
  `,header:n.css`
    margin-top: ${t.spacing(2)};
  `,rulesTable:n.css`
    margin-top: ${t.spacing(3)};
  `}),yt=({namespaces:t})=>{const r=(0,te.lC)((0,X.K)()[0]),s=(0,e.useMemo)(()=>{const m={[$.x_.Firing]:[],[$.x_.Inactive]:[],[$.x_.Pending]:[]};return t.forEach(l=>l.groups.forEach(o=>o.rules.forEach(i=>{i.promRule&&(0,z.x_)(i.promRule)&&m[i.promRule.state].push(i)}))),Object.values(m).forEach(l=>l.sort((o,i)=>o.name.localeCompare(i.name))),m},[t]);return e.createElement(e.Fragment,null,(!r.alertState||r.alertState===$.x_.Firing)&&e.createElement($e,{state:$.x_.Firing,rules:s[$.x_.Firing]}),(!r.alertState||r.alertState===$.x_.Pending)&&e.createElement($e,{state:$.x_.Pending,rules:s[$.x_.Pending]}),(!r.alertState||r.alertState===$.x_.Inactive)&&e.createElement($e,{defaultCollapsed:r.alertState!==$.x_.Inactive,state:$.x_.Inactive,rules:s[$.x_.Inactive]}))};var Rt=a(66698),Ve=a(24799),ue=a(64353),Pe=a(2594),St=a(46967),Ct=a(22759),xt=a(39493),Ze=a(86647),fe=a(734),Ee=a(20194),Nt=a(31808);function Je(){const[t,r]=(0,Nt.j)(),s=t.get("search")??"",m=(0,e.useMemo)(()=>(0,fe.ug)(s),[s]),l=(0,e.useMemo)(()=>Object.values(m).some(c=>!(0,Ne.isEmpty)(c)),[m]),o=(0,e.useCallback)(c=>{const d=(0,fe.HY)(s,c);r({search:d})},[s,r]),i=(0,e.useCallback)(c=>{r({search:c})},[r]);return(0,e.useEffect)(()=>{const c={dataSource:t.get("dataSource")??void 0,alertState:t.get("alertState")??void 0,ruleType:t.get("ruleType")??void 0,labels:(0,Ee.Zh)(t.get("queryString")??"").map(Ee.cm)};Object.values(c).some(u=>!(0,Ne.isEmpty)(u))&&(r({dataSource:void 0,alertState:void 0,ruleType:void 0,queryString:void 0}),o((0,xt.ZP)(m,u=>{if(u.dataSourceNames??=c.dataSource?[c.dataSource]:[],c.alertState&&(0,$.I9)(c.alertState)&&(u.ruleState??=c.alertState),c.ruleType&&(0,z.Wd)(c.ruleType)&&(u.ruleType??=c.ruleType),u.labels.length===0&&c.labels.length>0){const h=c.labels.map(({name:v,operator:R,value:y})=>`${v}${R}${y}`);u.labels.push(...h)}})))},[t,o,m,r]),{filterState:m,hasActiveFilters:l,searchQuery:s,setSearchQuery:i,updateFilters:o}}const Pt=(t,r)=>(0,e.useMemo)(()=>{const s=At(t,r);return s.forEach(m=>{m.groups.forEach(l=>{l.rules.forEach(o=>{(0,z.x_)(o.promRule)&&(o.instanceTotals=(0,pe.Fm)(o.promRule),o.filteredInstanceTotals=(0,pe.ZP)(o.promRule))}),l.totals=(0,pe.DD)({rules:l.rules.map(o=>o.promRule).filter(o=>!!o)})})}),s},[t,r]),Oe=new Ct.Z({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1}),At=(t,r={dataSourceNames:[],labels:[],freeFormWords:[]})=>{let s=t;const m=r.dataSourceNames;m.length&&(s=s.filter(({rulesSource:o})=>(0,M.jq)(o)?m.includes(o.name):!0));const l=r.namespace;if(l){const o=s.map(u=>u.name),[i,c,d]=Oe.search(o,l);c&&d?s=d.map(u=>s[c.idx[u]]):i&&(s=i.map(u=>s[u]))}return s.reduce(Tt(r),[])},Tt=t=>(r,s)=>{const m=t.groupName;let l=s.groups;if(m){const o=l.map(u=>u.name),[i,c,d]=Oe.search(o,m);c&&d?l=d.map(u=>l[c.idx[u]]):i&&(l=i.map(u=>l[u]))}return l=l.reduce(It(t),[]),l.length&&r.push({...s,groups:l}),r},It=t=>{const r=t.ruleName??t.freeFormWords.join(" ");return(s,m)=>{let l=m.rules;if(r){const o=l.map(u=>u.name),[i,c,d]=Oe.search(o,r);c&&d?l=d.map(u=>l[c.idx[u]]):i&&(l=i.map(u=>l[u]))}return l=l.filter(o=>{if(t.ruleType&&t.ruleType!==o.promRule?.type)return!1;const i=(0,z.Pc)(o.rulerRule)&&!Dt(o.rulerRule,t);if(t.dataSourceNames?.length&&i)return!1;if(t.ruleHealth&&o.promRule){const c=(0,z.vU)(o.promRule.health);return t.ruleHealth===c}if(t.labels.length>0){const c=(0,Ne.compact)(t.labels.map(Lt)),d=c.length>0&&(0,Ee.eD)(o.labels,c),u=c.length>0&&o.promRule&&o.promRule.type===$.pz.Alerting&&o.promRule.alerts&&o.promRule.alerts.some(h=>(0,Ee.eD)(h.labels,c));if(!(d||u))return!1}return!(t.ruleState&&!(o.promRule&&(0,z.x_)(o.promRule)&&o.promRule.state===t.ruleState))}),l.length&&s.push({...m,rules:l}),s}};function Lt(t){try{return(0,Ee.tC)(t)}catch{return{name:t,value:"",isRegex:!0,isEqual:!0}}}const Dt=(t,r)=>r.dataSourceNames?.length?!!t.grafana_alert.data.find(s=>{if(!s.datasourceUid)return!1;const m=(0,Ze.F)().getInstanceSettings(s.datasourceUid);return m?.name&&r?.dataSourceNames?.includes(m.name)}):!0;var Ft=a(42042),bt=a(73446),Mt=a(53940),ke=a(68183),Ye=a(22069),$t=a(8581),Ot=a(51613);const Gt=t=>{const r=(0,Ze.F)(),[s,m]=(0,e.useState)(),l=(A,b)=>{if(b.action==="clear"&&t.onClear){t.onClear();return}const V=A[A.length-1];let Z,G;b.action==="pop-value"||b.action==="remove-value"?(Z=b.removedValue?.value,G="remove"):(Z=V.value,G="add");const I=r.getInstanceSettings(Z);I&&(t.onChange(I,G),m({error:void 0}))},o=()=>{const{current:A,hideTextValue:b,noDefault:V}=t;if(!(!A&&V))return A?.map(Z=>{const G=r.getInstanceSettings(Z);if(G)return{label:G.name.slice(0,37),value:G.name,imgUrl:G.meta.info.logos.small,hideText:b,meta:G.meta};const I=(0,bt.BT)(Z);return I===Ye.hr.uid||I===Ye.hr.name?{label:I,value:I,hideText:b}:{label:(I??"no name")+" - not found",value:I??void 0,imgUrl:"",hideText:b}})},i=()=>{const{alerting:A,tracing:b,metrics:V,mixed:Z,dashboard:G,variables:I,annotations:ne,pluginId:re,type:g,filter:W,logs:he}=t,K=r.getList({alerting:A,tracing:b,metrics:V,logs:he,dashboard:G,mixed:Z,variables:I,annotations:ne,pluginId:re,filter:W,type:g}),Yt=K.filter(M.G_).map(Y=>({value:Y.name,label:`${Y.name}${Y.isDefault?" (default)":""}`,imgUrl:Y.meta.info.logos.small,meta:Y.meta})),Xt=K.filter(Y=>!(0,M.G_)(Y)).map(Y=>({value:Y.name,label:`${Y.name}${Y.isDefault?" (default)":""}`,imgUrl:Y.meta.info.logos.small,meta:Y.meta}));return[{label:"Data sources with configured alert rules",options:Yt,expanded:!0},{label:"Other data sources",options:Xt,expanded:!0}]},{autoFocus:c,onBlur:d,onClear:u,openMenuOnFocus:h,placeholder:v,width:R,inputId:y,disabled:N=!1,isLoading:E=!1}=t,p=i(),O=o(),w=typeof u=="function";return e.createElement("div",{"data-testid":ke.wl.components.DataSourcePicker.container},e.createElement($t.NU,{isLoading:E,disabled:N,"data-testid":ke.wl.components.DataSourcePicker.inputV2,inputId:y||"data-source-picker",className:"ds-picker select-container",isClearable:w,backspaceRemovesValue:!0,onChange:l,options:p,autoFocus:c,onBlur:d,width:R,openMenuOnFocus:h,maxMenuHeight:500,placeholder:v,noOptionsMessage:"No datasources found",value:O??[],invalid:Boolean(s?.error)||Boolean(t.invalid),getOptionLabel:A=>A.meta&&(0,Mt.x)(A.meta.signature)&&A!==O?e.createElement(Ue.Lh,{align:"center",justify:"space-between",height:"auto"},e.createElement("span",null,A.label)," ",e.createElement(Ot.o,{status:A.meta.signature})):A.label||""}))},Xe=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],Wt=[{label:"Alert ",value:$.pz.Alerting},{label:"Recording ",value:$.pz.Recording}],Ut=[{label:"Ok",value:fe.VG.Ok},{label:"No Data",value:fe.VG.NoData},{label:"Error",value:fe.VG.Error}],Bt=Object.entries($.x_).map(([t,r])=>({label:(0,z.SS)(r),value:r})),Ht=({onFilterCleared:t=()=>{}})=>{const r=(0,L.wW)(zt),[s,m]=(0,X.K)(),{filterState:l,hasActiveFilters:o,searchQuery:i,setSearchQuery:c,updateFilters:d}=Je(),[u,h]=(0,e.useState)(Math.floor(Math.random()*100)),v=`dataSource-${u}`,R=`queryString-${u}`,y=(0,e.useRef)(null),{handleSubmit:N,register:E,setValue:p}=(0,Rt.cI)({defaultValues:{searchQuery:i}}),{ref:O,...w}=E("searchQuery");(0,e.useEffect)(()=>{p("searchQuery",i)},[i,p]);const A=(g,W)=>{const he=W==="add"?[...l.dataSourceNames].concat([g.name]):l.dataSourceNames.filter(K=>K!==g.name);d({...l,dataSourceNames:he}),h(K=>K+1)},b=()=>{d({...l,dataSourceNames:[]}),h(g=>g+1)},V=g=>{(0,j.PN)(P.z7.clickingAlertStateFilters),d({...l,ruleState:g}),h(W=>W+1)},Z=g=>{m({view:g})},G=g=>{d({...l,ruleType:g}),h(W=>W+1)},I=g=>{d({...l,ruleHealth:g}),h(W=>W+1)},ne=()=>{c(void 0),t(),setTimeout(()=>h(u+1),100)},re=e.createElement(se.J,{name:"search"});return e.createElement("div",{className:r.container},e.createElement(S.Stack,{direction:"column",gap:1},e.createElement(S.Stack,{direction:"row",gap:1},e.createElement(Ve.g,{className:r.dsPickerContainer,label:e.createElement(ue._,{htmlFor:"data-source-picker"},e.createElement(S.Stack,{gap:.5},e.createElement("span",null,"Search by data sources"),e.createElement(ce.u,{content:e.createElement("div",null,e.createElement("p",null,"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."),e.createElement("p",null,"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."))},e.createElement(se.J,{name:"info-circle",size:"sm"}))))},e.createElement(Gt,{key:v,alerting:!0,noDefault:!0,placeholder:"All data sources",current:l.dataSourceNames,onChange:A,onClear:b})),e.createElement("div",null,e.createElement(ue._,null,"State"),e.createElement(Pe.S,{options:Bt,value:l.ruleState,onChange:V})),e.createElement("div",null,e.createElement(ue._,null,"Rule type"),e.createElement(Pe.S,{options:Wt,value:l.ruleType,onChange:G})),e.createElement("div",null,e.createElement(ue._,null,"Health"),e.createElement(Pe.S,{options:Ut,value:l.ruleHealth,onChange:I}))),e.createElement(S.Stack,{direction:"column",gap:1},e.createElement(S.Stack,{direction:"row",gap:1},e.createElement("form",{className:r.searchInput,onSubmit:N(g=>{c(g.searchQuery),y.current?.blur()})},e.createElement(Ve.g,{label:e.createElement(ue._,{htmlFor:"rulesSearchInput"},e.createElement(S.Stack,{gap:.5},e.createElement("span",null,"Search"),e.createElement(Ft.z,{content:e.createElement(Kt,null)},e.createElement(se.J,{name:"info-circle",size:"sm"}))))},e.createElement(St.I,{id:"rulesSearchInput",key:R,prefix:re,ref:g=>{O(g),y.current=g},...w,placeholder:"Search","data-testid":"search-query-input"})),e.createElement("input",{type:"submit",hidden:!0})),e.createElement("div",null,e.createElement(ue._,null,"View as"),e.createElement(Pe.S,{options:Xe,value:String(s.view??Xe[0].value),onChange:Z}))),o&&e.createElement("div",null,e.createElement(J.zx,{fullWidth:!1,icon:"times",variant:"secondary",onClick:ne},"Clear filters")))))},zt=t=>({container:n.css`
      margin-bottom: ${t.spacing(1)};
    `,dsPickerContainer:n.css`
      width: 550px;
      flex-grow: 0;
      margin: 0;
    `,searchInput:n.css`
      flex: 1;
      margin: 0;
    `});function Kt(){const t=(0,L.wW)(qe);return e.createElement("div",null,e.createElement("div",null,"Search syntax allows to query alert rules by the parameters defined below."),e.createElement("hr",null),e.createElement("div",{className:t.grid},e.createElement("div",null,"Filter type"),e.createElement("div",null,"Expression"),e.createElement(ae,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),e.createElement(ae,{title:"Folder/Namespace",expr:"namespace:global"}),e.createElement(ae,{title:"Group",expr:"group:cpu-usage"}),e.createElement(ae,{title:"Rule",expr:'rule:"cpu 80%"'}),e.createElement(ae,{title:"Labels",expr:"label:team=A label:cluster=a1"}),e.createElement(ae,{title:"State",expr:"state:firing|normal|pending"}),e.createElement(ae,{title:"Type",expr:"type:alerting|recording"}),e.createElement(ae,{title:"Health",expr:"health:ok|nodata|error"})))}function ae({title:t,expr:r}){const s=(0,L.wW)(qe);return e.createElement(e.Fragment,null,e.createElement("div",null,t),e.createElement("code",{className:s.code},r))}const qe=t=>({grid:n.css`
    display: grid;
    grid-template-columns: max-content auto;
    gap: ${t.spacing(1)};
    align-items: center;
  `,code:n.css`
    display: block;
    text-align: center;
  `}),Qt=Ht;var jt=a(37190),wt=a(93411);const _e={groups:ht,state:yt},Vt=Te.gr+1,Zt=(0,ee.Pf)(()=>{const t=(0,C.useDispatch)(),r=(0,L.wW)(Jt),s=(0,e.useMemo)(M.mA,[]),m=(0,D.TH)(),[l,o]=(0,e.useState)(!1),i=(0,e.useCallback)(()=>o(!1),[]),[c]=(0,X.K)(),{filterState:d,hasActiveFilters:u}=Je(),{canCreateGrafanaRules:h,canCreateCloudRules:v,canReadProvisioning:R}=(0,ve.B)(),y=_e[c.view]?c.view:"groups",N=_e[y],E=(0,q._)(g=>g.promRules),p=(0,q._)(g=>g.rulerRules),O=s.some(g=>E[g]?.loading||p[g]?.loading),w=Object.entries(E),A=w.every(([g,W])=>W.dispatched&&(W?.result!==void 0||W?.error!==void 0)),b=w.every(([g,W])=>W.dispatched&&W?.result?.length===0),V=u?void 0:Vt,[Z,G]=(0,B.Z)(async()=>{O||await t((0,xe.ei)(!1,{limitAlerts:V}))},[O,V,t]);(0,e.useEffect)(()=>{t((0,xe.ei)(!1,{limitAlerts:V}))},[t,V]),(0,T.Z)(G,jt.p4);const I=A&&b&&w.length>0,ne=(0,pe.Zo)(),re=Pt(ne,d);return e.createElement(F.J,{pageId:"alert-list",isLoading:!1},e.createElement(Le,null),e.createElement(Qt,{onFilterCleared:i}),!I&&e.createElement(e.Fragment,null,e.createElement("div",{className:r.break}),e.createElement("div",{className:r.buttonsContainer},e.createElement("div",{className:r.statsContainer},y==="groups"&&u&&e.createElement(J.zx,{className:r.expandAllButton,icon:l?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>o(!l)},l?"Collapse all":"Expand all"),e.createElement(Qe.WN,{namespaces:re})),e.createElement(S.Stack,{direction:"row",gap:.5},R&&e.createElement(J.Qj,{variant:"secondary",href:(0,wt.u)("/api/v1/provisioning/alert-rules/export",{download:"true",format:"yaml"}),icon:"download-alt",target:"_blank",rel:"noopener"},"Export"),(h||v)&&e.createElement(J.Qj,{href:H.Cj.renderUrl("alerting/new",{returnTo:m.pathname+m.search}),icon:"plus",onClick:()=>(0,j.PN)(P.z7.alertRuleFromScratch)},"Create alert rule")))),I&&e.createElement(Ae,null),!I&&e.createElement(N,{expandAll:l,namespaces:re}))},{style:"page"}),Jt=t=>({break:n.css`
    width: 100%;
    height: 0;
    margin-bottom: ${t.spacing(2)};
    border-bottom: solid 1px ${t.colors.border.medium};
  `,buttonsContainer:n.css`
    margin-bottom: ${t.spacing(2)};
    display: flex;
    justify-content: space-between;
  `,statsContainer:n.css`
    display: flex;
    flex-direction: row;
    align-items: center;
  `,expandAllButton:n.css`
    margin-right: ${t.spacing(1)};
  `}),kt=Zt},51981:(le,U,a)=>{a.d(U,{q:()=>D});var n=a(66111),e=a(82002);const D=({actions:B,children:T,fallback:H=!0})=>B.some(S=>e.Vt.hasAccess(S,H))?n.createElement(n.Fragment,null,T):null},65750:(le,U,a)=>{a.d(U,{A:()=>B});var n=a(66111),e=a(61860),D=a(31403);const B=({tooltip:T,icon:H,to:S,target:j,onClick:ee,className:L,tooltipPlacement:J="top",...X})=>{const C=typeof T=="string"?T:void 0;return n.createElement(e.u,{content:T,placement:J},S?n.createElement(D.Qj,{variant:"secondary",fill:"text",icon:H,href:S,size:"sm",target:j,...X,"aria-label":C}):n.createElement(D.zx,{className:L,variant:"secondary",fill:"text",size:"sm",icon:H,type:"button",onClick:ee,...X,"aria-label":C}))}},31808:(le,U,a)=>{a.d(U,{j:()=>B});var n=a(66111),e=a(56895),D=a(37932);function B(){const{search:T}=(0,e.TH)(),H=(0,n.useMemo)(()=>new URLSearchParams(T),[T]),S=(0,n.useCallback)((j,ee)=>{D.E1.partial(j,ee)},[]);return[H,S]}},39910:(le,U,a)=>{a.d(U,{B:()=>D});var n=a(66111),e=a(97953);function D(){return(0,n.useMemo)(()=>(0,e.Rv)(),[])}},49371:(le,U,a)=>{a.d(U,{Z:()=>D});var n=a(66111),e=function(B,T){var H=(0,n.useRef)(function(){});(0,n.useEffect)(function(){H.current=B}),(0,n.useEffect)(function(){if(T!==null){var S=setInterval(function(){return H.current()},T||0);return function(){return clearInterval(S)}}},[T])};const D=e}}]);

//# sourceMappingURL=AlertRuleListIndex.ab818c7f7fffca23e4d1.js.map