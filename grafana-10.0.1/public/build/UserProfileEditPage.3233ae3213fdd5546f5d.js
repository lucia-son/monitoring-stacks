"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{18885:(j,O,t)=>{t.d(O,{Z:()=>k,v:()=>z});var e=t(9892),a=t(66111),b=t(206),U=t(68183),I=t(35645),R=t(41818),S=t(94270),T=t(13393),h=t(24799),s=t(2594),g=t(64353),i=t(52566),x=t(80124),N=t(26338),C=t(8581),L=t(31403),F=t(7804),K=t(99661),c=t(35287),A=t(19719),Z=t(42454);function n(){const H=A.a2.map(o=>({value:o.code,label:o.name}));return[{value:"",label:(0,c.t)("common.locale.default","Default")},...H]}const r=Boolean(I.v.featureToggles.internationalization);class z extends a.PureComponent{constructor(d){super(d),this.onSubmitForm=async()=>{if(this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:V,theme:y,timezone:_,weekStart:w,language:B,queryHistory:M}=this.state;await this.service.update({homeDashboardUID:V,theme:y,timezone:_,weekStart:w,language:B,queryHistory:M}),window.location.reload()}},this.onThemeChanged=o=>{this.setState({theme:o})},this.onTimeZoneChanged=o=>{o&&this.setState({timezone:o})},this.onWeekStartChanged=o=>{this.setState({weekStart:o})},this.onHomeDashboardChanged=o=>{this.setState({homeDashboardUID:o})},this.onLanguageChanged=o=>{this.setState({language:o}),(0,R.ff)("grafana_preferences_language_changed",{toLanguage:o,preferenceType:this.props.preferenceType})},this.service=new Z.y(d.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=[{value:"",label:(0,c.t)("shared-preferences.theme.default-label","Default")},{value:"dark",label:(0,c.t)("shared-preferences.theme.dark-label","Dark")},{value:"light",label:(0,c.t)("shared-preferences.theme.light-label","Light")},{value:"system",label:(0,c.t)("shared-preferences.theme.system-label","System")}]}async componentDidMount(){const d=await this.service.load();this.setState({homeDashboardUID:d.homeDashboardUID,theme:d.theme,timezone:d.timezone,weekStart:d.weekStart,language:d.language,queryHistory:d.queryHistory})}render(){const{theme:d,timezone:o,weekStart:V,homeDashboardUID:y,language:_}=this.state,{disabled:w}=this.props,B=J(),M=n();let $=this.themeOptions[0].value;return d?.length&&($=this.themeOptions.find(l=>l.value===d)?.value),a.createElement(S.l,{onSubmit:this.onSubmitForm},()=>a.createElement(T.C,{label:a.createElement(c.cC,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:w},a.createElement(h.g,{label:(0,c.t)("shared-preferences.fields.theme-label","UI Theme")},a.createElement(s.S,{options:this.themeOptions,value:$,onChange:this.onThemeChanged})),a.createElement(h.g,{label:a.createElement(g._,{htmlFor:"home-dashboard-select"},a.createElement("span",{className:B.labelText},a.createElement(c.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},a.createElement(K.o,{value:y,onChange:l=>this.onHomeDashboardChanged(l?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,c.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),a.createElement(h.g,{label:(0,c.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":U.wl.components.TimeZonePicker.containerV2},a.createElement(i.O,{includeInternal:!0,value:o,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),a.createElement(h.g,{label:(0,c.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":U.wl.components.WeekStartPicker.containerV2},a.createElement(x.z,{value:V||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),r?a.createElement(h.g,{label:a.createElement(g._,{htmlFor:"locale-select"},a.createElement("span",{className:B.labelText},a.createElement(c.cC,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),a.createElement(N.a,{featureState:b.CQ.beta})),"data-testid":"User preferences language drop down"},a.createElement(C.Ph,{value:M.find(l=>l.value===_),onChange:l=>this.onLanguageChanged(l.value??""),options:M,placeholder:(0,c.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"})):null,a.createElement("div",{className:"gf-form-button-row"},a.createElement(L.zx,{type:"submit",variant:"primary","data-testid":U.wl.components.UserProfile.preferencesSaveButton},a.createElement(c.cC,{i18nKey:"common.save"},"Save")))))}}const k=z,J=(0,F.B)(()=>({labelText:e.css`
      margin-right: 6px;
    `}))},87807:(j,O,t)=>{t.r(O),t.d(O,{UserProfileEditPage:()=>M,default:()=>$});var e=t(66111),a=t(67948),b=t(68324),U=t(52081),I=t(8412),R=t(18885),S=t(68183),T=t(61744),h=t(31403),s=t(35287);class g extends e.PureComponent{render(){const{isLoading:p,orgs:E,user:f}=this.props;return p?e.createElement(T.u,{text:"Loading organizations..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(s.cC,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","data-testid":S.wl.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,E.map((u,m)=>e.createElement("tr",{key:m},e.createElement("td",null,u.name),e.createElement("td",null,u.role),e.createElement("td",{className:"text-right"},u.orgId===f?.orgId?e.createElement(h.zx,{variant:"secondary",size:"sm",disabled:!0},e.createElement(s.cC,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(h.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(u)}},e.createElement(s.cC,{i18nKey:"user-orgs.select-org-button"},"Select organisation")))))))))}}const i=g;var x=t(94270),N=t(13393),C=t(24799),L=t(46967),F=t(61860),K=t(39904),c=t(47694);const{disableLoginForm:A}=c.ZP,n=({user:l,isSavingUser:p,updateProfile:E})=>{const f=v=>{E(v)},u=(l&&l.isExternal)??!1,m=u&&l&&l.authLabels?l.authLabels[0]:"",P=m?` (Synced via ${m})`:"",D=A||u;return e.createElement(x.l,{onSubmit:f,validateOn:"onBlur"},({register:v,errors:W})=>e.createElement(N.C,null,e.createElement(C.g,{label:(0,s.t)("user-profile.fields.name-label","Name")+P,invalid:!!W.name,error:e.createElement(s.cC,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:D},e.createElement(L.I,{...v("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,s.t)("user-profile.fields.name-label","Name"),defaultValue:l?.name??"",suffix:e.createElement(r,null)})),e.createElement(C.g,{label:(0,s.t)("user-profile.fields.email-label","Email")+P,invalid:!!W.email,error:e.createElement(s.cC,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:D},e.createElement(L.I,{...v("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,s.t)("user-profile.fields.email-label","Email"),defaultValue:l?.email??"",suffix:e.createElement(r,null)})),e.createElement(C.g,{label:(0,s.t)("user-profile.fields.username-label","Username")+P,disabled:D},e.createElement(L.I,{...v("login"),id:"edit-user-profile-username",defaultValue:l?.login??"",placeholder:(0,s.t)("user-profile.fields.username-label","Username")+P,suffix:e.createElement(r,null)})),e.createElement("div",{className:"gf-form-button-row"},e.createElement(h.zx,{variant:"primary",disabled:p||D,"data-testid":S.wl.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(s.cC,{i18nKey:"common.save"},"Save")))))},r=()=>A?e.createElement(F.u,{content:"Login details locked because they are managed in another system."},e.createElement(K.J,{name:"lock"})):null;var z=t(9892),k=t(97925);class J extends e.PureComponent{render(){const{isLoading:p,sessions:E,revokeUserSession:f}=this.props,u=H();return p?e.createElement(T.u,{text:e.createElement(s.cC,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:u.wrapper},E.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("div",{className:(0,z.cx)("gf-form-group",u.table)},e.createElement("table",{className:"filter-table form-inline","data-testid":S.wl.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,E.map((m,P)=>e.createElement("tr",{key:P},m.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,m.seenAt),e.createElement("td",null,(0,s.$q)(m.createdAt,{dateStyle:"long"})),e.createElement("td",null,m.clientIp),e.createElement("td",null,m.browser," on ",m.os," ",m.osVersion),e.createElement("td",null,e.createElement(h.zx,{size:"sm",variant:"destructive",onClick:()=>f(m.id),"aria-label":(0,k.t)("user-session.revoke","Revoke user session")},e.createElement(K.J,{name:"power"}))))))))))}}const H=()=>({wrapper:(0,z.css)({maxWidth:"100%"}),table:(0,z.css)({overflow:"auto"})}),d=J;class o extends e.PureComponent{render(){const{isLoading:p,teams:E}=this.props;return p?e.createElement(T.u,{text:"Loading teams..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,E.map((f,u)=>e.createElement("tr",{key:u},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:f.avatarUrl,alt:""})),e.createElement("td",null,f.name),e.createElement("td",null,f.email),e.createElement("td",null,f.memberCount)))))))}}const V=null;var y=t(47280);function _(l){const p=l.user,{user:E,teams:f,orgs:u,sessions:m,teamsAreLoading:P,orgsAreLoading:D,sessionsAreLoading:v,isUpdating:W}=p;return{orgsAreLoading:D,sessionsAreLoading:v,teamsAreLoading:P,orgs:u,sessions:m,teams:f,isUpdating:W,user:E}}const w={initUserProfilePage:y.PA,revokeUserSession:y.cc,changeUserOrg:y.hz,updateUserProfile:y.Lj},B=(0,a.connect)(_,w);function M({orgsAreLoading:l,sessionsAreLoading:p,teamsAreLoading:E,initUserProfilePage:f,orgs:u,sessions:m,teams:P,isUpdating:D,user:v,revokeUserSession:W,changeUserOrg:X,updateUserProfile:Q}){return(0,b.Z)(()=>f()),e.createElement(I.T,{navId:"profile/settings"},e.createElement(I.T.Contents,{isLoading:!v},e.createElement(U.wc,{spacing:"md"},e.createElement(n,{updateProfile:Q,isSavingUser:D,user:v}),e.createElement(R.Z,{resourceUri:"user",preferenceType:"user"}),e.createElement(o,{isLoading:E,teams:P}),e.createElement(i,{isLoading:l,setUserOrg:X,orgs:u,user:v}),e.createElement(d,{isLoading:p,revokeUserSession:W,sessions:m}))))}const $=B(M)},47280:(j,O,t)=>{t.d(O,{Cp:()=>x,hz:()=>A,PA:()=>N,II:()=>C,cc:()=>c,Lj:()=>Z});var e=t(35645),a=t(54899);async function b(n){try{await(0,a.i)().put("/api/user/password",n)}catch(r){console.error(r)}}function U(){return(0,a.i)().get("/api/user")}function I(){return(0,a.i)().get("/api/user/teams")}function R(){return(0,a.i)().get("/api/user/orgs")}function S(){return(0,a.i)().get("/api/user/auth-tokens")}async function T(n){await(0,a.i)().post("/api/user/revoke-auth-token",{authTokenId:n})}async function h(n){await(0,a.i)().post("/api/user/using/"+n.orgId,{})}async function s(n){try{await(0,a.i)().put("/api/user",n)}catch(r){console.error(r)}}const g={changePassword:b,revokeUserSession:T,loadUser:U,loadSessions:S,loadOrgs:R,loadTeams:I,setUserOrg:h,updateUserProfile:s};var i=t(54294);function x(n){return async function(r){r((0,i.zc)({updating:!0})),await g.changePassword(n),r((0,i.zc)({updating:!1}))}}function N(){return async function(n){await n(C()),n(L()),n(F()),n(K())}}function C(){return async function(n){const r=await g.loadUser();n((0,i.aw)({user:r}))}}function L(){return async function(n){n((0,i.qD)());const r=await g.loadTeams();n((0,i.PL)({teams:r}))}}function F(){return async function(n){n((0,i.$S)());const r=await g.loadOrgs();n((0,i.Ns)({orgs:r}))}}function K(){return async function(n){n((0,i.Uk)());const r=await g.loadSessions();n((0,i.z0)({sessions:r}))}}function c(n){return async function(r){r((0,i.zc)({updating:!0})),await g.revokeUserSession(n),r((0,i.p$)({tokenId:n}))}}function A(n){return async function(r){r((0,i.zc)({updating:!0})),await g.setUserOrg(n),window.location.href=e.v.appSubUrl+"/profile"}}function Z(n){return async function(r){r((0,i.zc)({updating:!0})),await g.updateUserProfile(n),await r(C()),r((0,i.zc)({updating:!1}))}}},68324:(j,O,t)=>{t.d(O,{Z:()=>b});var e=t(49380),a=function(U){(0,e.Z)(function(){U()})};const b=a}}]);

//# sourceMappingURL=UserProfileEditPage.3233ae3213fdd5546f5d.js.map