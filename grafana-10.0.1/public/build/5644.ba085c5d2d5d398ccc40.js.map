{"version":3,"file":"5644.ba085c5d2d5d398ccc40.js","mappings":"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","sources":["webpack://grafana/./public/app/core/components/NodeGraphSettings.tsx","webpack://grafana/./public/app/core/components/TraceToMetrics/TraceToMetricsSettings.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldLazy.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldWrapper.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryField.tsx","webpack://grafana/./public/app/plugins/datasource/loki/languageUtils.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/RawQuery.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/CheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/dataquery.gen.ts","webpack://grafana/./public/app/plugins/datasource/tempo/traceql/traceql.ts","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/utils.ts","webpack://grafana/./public/app/plugins/datasource/tempo/language_provider.ts","webpack://grafana/./public/app/plugins/datasource/tempo/datasource.ts","webpack://grafana/./public/app/plugins/datasource/tempo/traceql/TempoQueryBuilderOptions.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/DurationInput.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/InlineSearchField.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/SearchField.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/TagsInput.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/SearchTraceQLEditor/TraceQLSearch.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/types.ts","webpack://grafana/./public/app/plugins/datasource/tempo/traceql/autocomplete.ts","webpack://grafana/./public/app/plugins/datasource/tempo/traceql/TraceQLEditor.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/traceql/QueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/TagsField/autocomplete.ts","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/TagsField/syntax.ts","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/TagsField/TagsField.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/NativeSearch.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/utils.ts","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/ServiceGraphSection.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/QueryEditor/QueryField.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/QuerySettings.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/LokiSearchSettings.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/SearchSettings.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/ServiceGraphSettings.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/TraceQLSearchTags.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/TraceQLSearchSettings.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/configuration/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/tempo/tracking.ts","webpack://grafana/./public/app/plugins/datasource/tempo/module.ts","webpack://grafana/./.yarn/__virtual__/react-use-virtual-dd7926f458/3/opt/drone/yarncache/react-use-npm-17.4.0-0ef4521544-0889da919b.zip/node_modules/react-use/lib/useAsync.js"],"sourcesContent":["import { css } from '@emotion/css';\nimport React from 'react';\n\nimport {\n  DataSourceJsonData,\n  DataSourcePluginOptionsEditorProps,\n  GrafanaTheme2,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { InlineField, InlineFieldRow, InlineSwitch, useStyles2 } from '@grafana/ui';\n\nimport { DocsLinkButton } from './DocsLinkButton';\n\nexport interface NodeGraphOptions {\n  enabled?: boolean;\n}\n\nexport interface NodeGraphData extends DataSourceJsonData {\n  nodeGraph?: NodeGraphOptions;\n}\n\ninterface Props extends DataSourcePluginOptionsEditorProps<NodeGraphData> {}\n\nexport function NodeGraphSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">Node graph</h3>\n\n      <div className={styles.infoText}>\n        {`Show or hide the node graph visualization`}\n        <DocsLinkButton hrefSuffix={`${options.type}/#node-graph`} />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField\n          tooltip=\"Displays the node graph above the trace view. Default: disabled\"\n          label=\"Enable node graph\"\n          labelWidth={26}\n        >\n          <InlineSwitch\n            id=\"enableNodeGraph\"\n            value={options.jsonData.nodeGraph?.enabled}\n            onChange={(event: React.SyntheticEvent<HTMLInputElement>) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'nodeGraph', {\n                ...options.jsonData.nodeGraph,\n                enabled: event.currentTarget.checked,\n              })\n            }\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoText: css`\n    label: infoText;\n    padding-bottom: ${theme.spacing(2)};\n    color: ${theme.colors.text.secondary};\n  `,\n  container: css`\n    label: container;\n    width: 100%;\n  `,\n  row: css`\n    label: row;\n    align-items: baseline;\n  `,\n});\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport {\n  DataSourceJsonData,\n  DataSourcePluginOptionsEditorProps,\n  GrafanaTheme2,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { Button, InlineField, InlineFieldRow, Input, useStyles2 } from '@grafana/ui';\n\nimport { DocsLinkButton } from '../DocsLinkButton';\nimport { TagMappingInput } from '../TraceToLogs/TagMappingInput';\n\nexport interface TraceToMetricsOptions {\n  datasourceUid?: string;\n  tags?: Array<{ key: string; value: string }>;\n  queries: TraceToMetricQuery[];\n  spanStartTimeShift?: string;\n  spanEndTimeShift?: string;\n}\n\nexport interface TraceToMetricQuery {\n  name?: string;\n  query?: string;\n}\n\nexport interface TraceToMetricsData extends DataSourceJsonData {\n  tracesToMetrics?: TraceToMetricsOptions;\n}\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TraceToMetricsData> {}\n\nexport function TraceToMetricsSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={css({ width: '100%' })}>\n      <h3 className=\"page-heading\">Trace to metrics</h3>\n\n      <div className={styles.infoText}>\n        Navigate from a trace span to the selected data source&apos;s metrics\n        <DocsLinkButton hrefSuffix={`${options.type}/#trace-to-metrics`} />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField\n          tooltip=\"The Prometheus data source the trace is going to navigate to\"\n          label=\"Data source\"\n          labelWidth={26}\n        >\n          <DataSourcePicker\n            inputId=\"trace-to-metrics-data-source-picker\"\n            pluginId=\"prometheus\"\n            current={options.jsonData.tracesToMetrics?.datasourceUid}\n            noDefault={true}\n            width={40}\n            onChange={(ds) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                datasourceUid: ds.uid,\n              })\n            }\n          />\n        </InlineField>\n        {options.jsonData.tracesToMetrics?.datasourceUid ? (\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            size=\"sm\"\n            fill=\"text\"\n            onClick={() => {\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                datasourceUid: undefined,\n              });\n            }}\n          >\n            Clear\n          </Button>\n        ) : null}\n      </InlineFieldRow>\n\n      <InlineFieldRow>\n        <InlineField\n          label=\"Span start time shift\"\n          labelWidth={26}\n          grow\n          tooltip=\"Shifts the start time of the span. Default: 0 (Time units can be used here, for example: 5s, -1m, 3h)\"\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"0\"\n            width={40}\n            onChange={(v) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                spanStartTimeShift: v.currentTarget.value,\n              })\n            }\n            value={options.jsonData.tracesToMetrics?.spanStartTimeShift || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      <InlineFieldRow>\n        <InlineField\n          label=\"Span end time shift\"\n          labelWidth={26}\n          grow\n          tooltip=\"Shifts the end time of the span. Default: 0 (Time units can be used here, for example: 5s, -1m, 3h)\"\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"0\"\n            width={40}\n            onChange={(v) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                spanEndTimeShift: v.currentTarget.value,\n              })\n            }\n            value={options.jsonData.tracesToMetrics?.spanEndTimeShift || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      <InlineFieldRow>\n        <InlineField tooltip=\"Tags that will be used in the metrics query\" label=\"Tags\" labelWidth={26}>\n          <TagMappingInput\n            values={options.jsonData.tracesToMetrics?.tags ?? []}\n            onChange={(v) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                tags: v,\n              })\n            }\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      {options.jsonData.tracesToMetrics?.queries?.map((query, i) => (\n        <div key={i} className={styles.queryRow}>\n          <InlineField label=\"Link Label\" labelWidth={26} tooltip=\"Descriptive label for the linked query\">\n            <Input\n              label=\"Link Label\"\n              type=\"text\"\n              allowFullScreen\n              value={query.name}\n              width={40}\n              onChange={(e) => {\n                let newQueries = options.jsonData.tracesToMetrics?.queries.slice() ?? [];\n                newQueries[i].name = e.currentTarget.value;\n                updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                  ...options.jsonData.tracesToMetrics,\n                  queries: newQueries,\n                });\n              }}\n            />\n          </InlineField>\n          <InlineField\n            label=\"Query\"\n            labelWidth={10}\n            tooltip=\"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword\"\n            grow\n          >\n            <Input\n              label=\"Query\"\n              type=\"text\"\n              allowFullScreen\n              value={query.query}\n              onChange={(e) => {\n                let newQueries = options.jsonData.tracesToMetrics?.queries.slice() ?? [];\n                newQueries[i].query = e.currentTarget.value;\n                updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                  ...options.jsonData.tracesToMetrics,\n                  queries: newQueries,\n                });\n              }}\n            />\n          </InlineField>\n\n          <Button\n            variant=\"destructive\"\n            title=\"Remove query\"\n            icon=\"times\"\n            type=\"button\"\n            onClick={() => {\n              let newQueries = options.jsonData.tracesToMetrics?.queries.slice();\n              newQueries?.splice(i, 1);\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n                ...options.jsonData.tracesToMetrics,\n                queries: newQueries,\n              });\n            }}\n          />\n        </div>\n      ))}\n\n      <Button\n        variant=\"secondary\"\n        title=\"Add query\"\n        icon=\"plus\"\n        type=\"button\"\n        onClick={() => {\n          updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'tracesToMetrics', {\n            ...options.jsonData.tracesToMetrics,\n            queries: [...(options.jsonData.tracesToMetrics?.queries ?? []), { query: '' }],\n          });\n        }}\n      >\n        Add query\n      </Button>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoText: css`\n    padding-bottom: ${theme.spacing(2)};\n    color: ${theme.colors.text.secondary};\n  `,\n  row: css`\n    label: row;\n    align-items: baseline;\n  `,\n  queryRow: css`\n    display: flex;\n  `,\n});\n","import React, { Suspense } from 'react';\n\nimport { Props } from './MonacoQueryFieldProps';\n\nconst Field = React.lazy(() => import(/* webpackChunkName: \"loki-query-field\" */ './MonacoQueryField'));\n\nexport const MonacoQueryFieldLazy = (props: Props) => {\n  return (\n    <Suspense fallback={null}>\n      <Field {...props} />\n    </Suspense>\n  );\n};\n","import React, { useRef } from 'react';\n\nimport { MonacoQueryFieldLazy } from './MonacoQueryFieldLazy';\nimport { Props as MonacoProps } from './MonacoQueryFieldProps';\n\nexport type Props = Omit<MonacoProps, 'onRunQuery' | 'onBlur'> & {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n  onQueryType?: (query: string) => void;\n};\n\nexport const MonacoQueryFieldWrapper = (props: Props) => {\n  const lastRunValueRef = useRef<string | null>(null);\n  const { onRunQuery, onChange, ...rest } = props;\n\n  const handleRunQuery = (value: string) => {\n    lastRunValueRef.current = value;\n    onChange(value);\n    onRunQuery();\n  };\n\n  const handleBlur = (value: string) => {\n    onChange(value);\n  };\n\n  return <MonacoQueryFieldLazy onRunQuery={handleRunQuery} onBlur={handleBlur} {...rest} />;\n};\n","import React, { ReactNode } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\n\nimport { LokiDatasource } from '../datasource';\nimport { shouldRefreshLabels } from '../languageUtils';\nimport { LokiQuery, LokiOptions } from '../types';\n\nimport { MonacoQueryFieldWrapper } from './monaco-query-field/MonacoQueryFieldWrapper';\n\nexport interface LokiQueryFieldProps extends QueryEditorProps<LokiDatasource, LokiQuery, LokiOptions> {\n  ExtraFieldElement?: ReactNode;\n  placeholder?: string;\n  'data-testid'?: string;\n  onQueryType?: (query: string) => void;\n}\n\ninterface LokiQueryFieldState {\n  labelsLoaded: boolean;\n}\n\nexport class LokiQueryField extends React.PureComponent<LokiQueryFieldProps, LokiQueryFieldState> {\n  _isMounted = false;\n\n  constructor(props: LokiQueryFieldProps) {\n    super(props);\n\n    this.state = { labelsLoaded: false };\n  }\n\n  async componentDidMount() {\n    this._isMounted = true;\n    await this.props.datasource.languageProvider.start();\n    if (this._isMounted) {\n      this.setState({ labelsLoaded: true });\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  componentDidUpdate(prevProps: LokiQueryFieldProps) {\n    const {\n      range,\n      datasource: { languageProvider },\n    } = this.props;\n    const refreshLabels = shouldRefreshLabels(range, prevProps.range);\n    // We want to refresh labels when range changes (we round up intervals to a minute)\n    if (refreshLabels) {\n      languageProvider.fetchLabels();\n    }\n  }\n\n  onChangeQuery = (value: string, override?: boolean) => {\n    // Send text change to parent\n    const { query, onChange, onRunQuery } = this.props;\n    if (onChange) {\n      const nextQuery = { ...query, expr: value };\n      onChange(nextQuery);\n\n      if (override && onRunQuery) {\n        onRunQuery();\n      }\n    }\n  };\n\n  render() {\n    const { ExtraFieldElement, query, datasource, history, onRunQuery, onQueryType } = this.props;\n    const placeholder = this.props.placeholder ?? 'Enter a Loki query (run with Shift+Enter)';\n\n    return (\n      <>\n        <div\n          className=\"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1\"\n          data-testid={this.props['data-testid']}\n        >\n          <div className=\"gf-form gf-form--grow flex-shrink-1 min-width-15\">\n            <MonacoQueryFieldWrapper\n              datasource={datasource}\n              history={history ?? []}\n              onChange={this.onChangeQuery}\n              onRunQuery={onRunQuery}\n              initialValue={query.expr ?? ''}\n              placeholder={placeholder}\n              onQueryType={onQueryType}\n            />\n          </div>\n        </div>\n        {ExtraFieldElement}\n      </>\n    );\n  }\n}\n","import { TimeRange } from '@grafana/data';\n\nfunction roundMsToMin(milliseconds: number): number {\n  return roundSecToMin(milliseconds / 1000);\n}\n\nfunction roundSecToMin(seconds: number): number {\n  return Math.floor(seconds / 60);\n}\n\nexport function shouldRefreshLabels(range?: TimeRange, prevRange?: TimeRange): boolean {\n  if (range && prevRange) {\n    const sameMinuteFrom = roundMsToMin(range.from.valueOf()) === roundMsToMin(prevRange.from.valueOf());\n    const sameMinuteTo = roundMsToMin(range.to.valueOf()) === roundMsToMin(prevRange.to.valueOf());\n    // If both are same, don't need to refresh\n    return !(sameMinuteFrom && sameMinuteTo);\n  }\n  return false;\n}\n\n// Loki regular-expressions use the RE2 syntax (https://github.com/google/re2/wiki/Syntax),\n// so every character that matches something in that list has to be escaped.\n// the list of meta characters is: *+?()|\\.[]{}^$\n// we make a javascript regular expression that matches those characters:\nconst RE2_METACHARACTERS = /[*+?()|\\\\.\\[\\]{}^$]/g;\nfunction escapeLokiRegexp(value: string): string {\n  return value.replace(RE2_METACHARACTERS, '\\\\$&');\n}\n\n// based on the openmetrics-documentation, the 3 symbols we have to handle are:\n// - \\n ... the newline character\n// - \\  ... the backslash character\n// - \"  ... the double-quote character\nexport function escapeLabelValueInExactSelector(labelValue: string): string {\n  return labelValue.replace(/\\\\/g, '\\\\\\\\').replace(/\\n/g, '\\\\n').replace(/\"/g, '\\\\\"');\n}\n\nexport function unescapeLabelValue(labelValue: string): string {\n  return labelValue.replace(/\\\\n/g, '\\n').replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\');\n}\n\nexport function escapeLabelValueInRegexSelector(labelValue: string): string {\n  return escapeLabelValueInExactSelector(escapeLokiRegexp(labelValue));\n}\n\nexport function escapeLabelValueInSelector(labelValue: string, selector?: string): string {\n  return isRegexSelector(selector)\n    ? escapeLabelValueInRegexSelector(labelValue)\n    : escapeLabelValueInExactSelector(labelValue);\n}\n\nexport function isRegexSelector(selector?: string) {\n  if (selector && (selector.includes('=~') || selector.includes('!~'))) {\n    return true;\n  }\n  return false;\n}\n\nexport function isBytesString(string: string) {\n  const BYTES_KEYWORDS = [\n    'b',\n    'kib',\n    'Kib',\n    'kb',\n    'KB',\n    'mib',\n    'Mib',\n    'mb',\n    'MB',\n    'gib',\n    'Gib',\n    'gb',\n    'GB',\n    'tib',\n    'Tib',\n    'tb',\n    'TB',\n    'pib',\n    'Pib',\n    'pb',\n    'PB',\n    'eib',\n    'Eib',\n    'eb',\n    'EB',\n  ];\n  const regex = new RegExp(`^(?:-?\\\\d+(?:\\\\.\\\\d+)?)(?:${BYTES_KEYWORDS.join('|')})$`);\n  const match = string.match(regex);\n  return !!match;\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\nimport { useToggle } from 'react-use';\n\nimport { getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { Stack } from '@grafana/experimental';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport { QueryStats } from 'app/plugins/datasource/loki/types';\n\nexport interface Props {\n  title: string;\n  collapsedInfo: string[];\n  queryStats?: QueryStats | null;\n  children: React.ReactNode;\n}\n\nexport function QueryOptionGroup({ title, children, collapsedInfo, queryStats }: Props) {\n  const [isOpen, toggleOpen] = useToggle(false);\n  const styles = useStyles2(getStyles);\n\n  const convertUnits = (): string => {\n    const { text, suffix } = getValueFormat('bytes')(queryStats!.bytes, 1);\n    return text + suffix;\n  };\n\n  return (\n    <div className={styles.wrapper}>\n      <Stack gap={0} direction=\"column\">\n        <div className={styles.header} onClick={toggleOpen} title=\"Click to edit options\">\n          <div className={styles.toggle}>\n            <Icon name={isOpen ? 'angle-down' : 'angle-right'} />\n          </div>\n          <h6 className={styles.title}>{title}</h6>\n          {!isOpen && (\n            <div className={styles.description}>\n              {collapsedInfo.map((x, i) => (\n                <span key={i}>{x}</span>\n              ))}\n            </div>\n          )}\n        </div>\n        {isOpen && <div className={styles.body}>{children}</div>}\n      </Stack>\n      {queryStats && <p className={styles.stats}>This query will process approximately {convertUnits()}.</p>}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      width: '100%',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'baseline',\n    }),\n    switchLabel: css({\n      color: theme.colors.text.secondary,\n      cursor: 'pointer',\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n    header: css({\n      display: 'flex',\n      cursor: 'pointer',\n      alignItems: 'baseline',\n      color: theme.colors.text.primary,\n      '&:hover': {\n        background: theme.colors.emphasize(theme.colors.background.primary, 0.03),\n      },\n    }),\n    title: css({\n      flexGrow: 1,\n      overflow: 'hidden',\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      margin: 0,\n    }),\n    description: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      paddingLeft: theme.spacing(2),\n      gap: theme.spacing(2),\n      display: 'flex',\n    }),\n    body: css({\n      display: 'flex',\n      paddingTop: theme.spacing(2),\n      gap: theme.spacing(2),\n      flexWrap: 'wrap',\n    }),\n    toggle: css({\n      color: theme.colors.text.secondary,\n      marginRight: `${theme.spacing(1)}`,\n    }),\n    stats: css({\n      margin: '0px',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport Prism, { Grammar } from 'prismjs';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data/src';\nimport { useTheme2 } from '@grafana/ui/src';\n\nexport interface Props {\n  query: string;\n  lang: {\n    grammar: Grammar;\n    name: string;\n  };\n  className?: string;\n}\nexport function RawQuery({ query, lang, className }: Props) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const highlighted = Prism.highlight(query, lang.grammar, lang.name);\n\n  return (\n    <div\n      className={cx(styles.editorField, 'prism-syntax-highlight', className)}\n      aria-label=\"selector\"\n      dangerouslySetInnerHTML={{ __html: highlighted }}\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    editorField: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n","import React from 'react';\n\nimport { config, reportInteraction } from '@grafana/runtime';\n\nexport default function CheatSheet() {\n  reportInteraction('grafana_traces_cheatsheet_clicked', {\n    datasourceType: 'tempo',\n    grafana_version: config.buildInfo.version,\n  });\n\n  return (\n    <div>\n      <h2 id=\"tempo-cheat-sheet\">Tempo Cheat Sheet</h2>\n      <p>\n        Tempo is a trace id lookup store. Enter a trace id in the above field and hit Run Query to retrieve your\n        trace. Tempo is generally paired with other datasources such as Loki or Prometheus to find traces.\n      </p>\n      <p>\n        Here are some{' '}\n        <a href=\"https://grafana.com/docs/tempo/latest/guides/instrumentation/\" target=\"blank\">\n          instrumentation examples\n        </a>{' '}\n        to get you started with trace discovery through logs and metrics (exemplars).\n      </p>\n    </div>\n  );\n}\n","// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTSTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as common from '@grafana/schema';\n\nexport const DataQueryModelVersion = Object.freeze([0, 0]);\n\nexport interface TempoQuery extends common.DataQuery {\n  filters: Array<TraceqlFilter>;\n  /**\n   * Defines the maximum number of traces that are returned from Tempo\n   */\n  limit?: number;\n  /**\n   * Define the maximum duration to select traces. Use duration format, for example: 1.2s, 100ms\n   */\n  maxDuration?: string;\n  /**\n   * Define the minimum duration to select traces. Use duration format, for example: 1.2s, 100ms\n   */\n  minDuration?: string;\n  /**\n   * TraceQL query or trace ID\n   */\n  query: string;\n  /**\n   * Logfmt query to filter traces by their tags. Example: http.status_code=200 error=true\n   */\n  search?: string;\n  /**\n   * Filters to be included in a PromQL query to select data for the service graph. Example: {client=\"app\",service=\"app\"}\n   */\n  serviceMapQuery?: string;\n  /**\n   * Query traces by service name\n   */\n  serviceName?: string;\n  /**\n   * Query traces by span name\n   */\n  spanName?: string;\n}\n\nexport const defaultTempoQuery: Partial<TempoQuery> = {\n  filters: [],\n};\n\n/**\n * search = Loki search, nativeSearch = Tempo search for backwards compatibility\n */\nexport type TempoQueryType = ('traceql' | 'traceqlSearch' | 'search' | 'serviceMap' | 'upload' | 'nativeSearch' | 'clear');\n\n/**\n * static fields are pre-set in the UI, dynamic fields are added by the user\n */\nexport enum TraceqlSearchScope {\n  Resource = 'resource',\n  Span = 'span',\n  Unscoped = 'unscoped',\n}\n\nexport interface TraceqlFilter {\n  /**\n   * Uniquely identify the filter, will not be used in the query generation\n   */\n  id: string;\n  /**\n   * The operator that connects the tag to the value, for example: =, >, !=, =~\n   */\n  operator?: string;\n  /**\n   * The scope of the filter, can either be unscoped/all scopes, resource or span\n   */\n  scope?: TraceqlSearchScope;\n  /**\n   * The tag for the search filter, for example: .http.status_code, .service.name, status\n   */\n  tag?: string;\n  /**\n   * The value for the search filter\n   */\n  value?: (string | Array<string>);\n  /**\n   * The type of the value, used for example to check whether we need to wrap the value in quotes when generating the query\n   */\n  valueType?: string;\n}\n\nexport interface Tempo {}\n","import { Grammar } from 'prismjs';\n\nexport const languageConfiguration = {\n  // the default separators except `@$`\n  wordPattern: /(-?\\d*\\.\\d\\w*)|([^`~!#%^&*()\\-=+\\[{\\]}\\\\|;:'\",.<>\\/?\\s]+)/g,\n  brackets: [\n    ['{', '}'],\n    ['(', ')'],\n  ],\n  autoClosingPairs: [\n    { open: '{', close: '}' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  surroundingPairs: [\n    { open: '{', close: '}' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  folding: {},\n};\n\nexport const operators = ['=', '!=', '>', '<', '>=', '<=', '=~'];\nexport const stringOperators = ['=', '!=', '=~'];\nexport const numberOperators = ['=', '!=', '>', '<', '>=', '<='];\n\nexport const intrinsics = ['duration', 'kind', 'name', 'status'];\n\nexport const scopes: string[] = ['resource', 'span'];\n\nconst keywords = intrinsics.concat(scopes);\n\nconst statusValues = ['ok', 'unset', 'error', 'false', 'true'];\n\nexport const language = {\n  ignoreCase: false,\n  defaultToken: '',\n  tokenPostfix: '.traceql',\n\n  keywords,\n  operators,\n  statusValues,\n\n  // we include these common regular expressions\n  symbols: /[=><!~?:&|+\\-*\\/^%]+/,\n  escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n  digits: /\\d+(_+\\d+)*/,\n  octaldigits: /[0-7]+(_+[0-7]+)*/,\n  binarydigits: /[0-1]+(_+[0-1]+)*/,\n\n  tokenizer: {\n    root: [\n      // labels\n      [/[a-z_.][\\w./_-]*(?=\\s*(=|!=|>|<|>=|<=|=~|!~))/, 'tag'],\n      [/[a-z_.][\\w./_-]*/, 'tag'],\n\n      // durations\n      [/[0-9.]+(s|ms|ns|m)/, 'number'],\n\n      // trace ID\n      [/^\\s*[0-9A-Fa-f]+\\s*$/, 'tag'],\n\n      // all keywords have the same color\n      [\n        /[a-zA-Z_.]\\w*/,\n        {\n          cases: {\n            '@keywords': 'type',\n            '@statusValues': 'type.identifier',\n            '@default': 'identifier',\n          },\n        },\n      ],\n\n      // strings\n      [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n      [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n      [/\"/, 'string', '@string_double'],\n      [/'/, 'string', '@string_single'],\n\n      // whitespace\n      { include: '@whitespace' },\n\n      // delimiters and operators\n      [/[{}()\\[\\]]/, '@brackets'],\n      [/[<>](?!@symbols)/, '@brackets'],\n      [\n        /@symbols/,\n        {\n          cases: {\n            '@operators': 'delimiter',\n            '@default': '',\n          },\n        },\n      ],\n\n      // numbers\n      [/(@digits)[eE]([\\-+]?(@digits))?[fFdD]?/, 'number.float'],\n      [/(@digits)\\.(@digits)([eE][\\-+]?(@digits))?[fFdD]?/, 'number.float'],\n      [/0(@octaldigits)[Ll]?/, 'number.octal'],\n      [/0[bB](@binarydigits)[Ll]?/, 'number.binary'],\n      [/(@digits)[fFdD]/, 'number.float'],\n      [/(@digits)[lL]?/, 'number'],\n    ],\n\n    string_double: [\n      [/[^\\\\\"]+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/\"/, 'string', '@pop'],\n    ],\n\n    string_single: [\n      [/[^\\\\']+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/'/, 'string', '@pop'],\n    ],\n\n    clauses: [\n      [/[^(,)]/, 'tag'],\n      [/\\)/, 'identifier', '@pop'],\n    ],\n\n    whitespace: [[/[ \\t\\r\\n]+/, 'white']],\n  },\n};\n\nexport const languageDefinition = {\n  id: 'traceql',\n  extensions: ['.traceql'],\n  aliases: ['tempo', 'traceql'],\n  mimetypes: [],\n  def: {\n    language,\n    languageConfiguration,\n  },\n};\n\nexport const traceqlGrammar: Grammar = {\n  comment: {\n    pattern: /#.*/,\n  },\n  'span-set': {\n    pattern: /\\{[^}]*}/,\n    inside: {\n      filter: {\n        pattern: /([\\w.\\/-]+)?(\\s*)(([!=+\\-<>~]+)\\s*(\"([^\"\\n&]+)?\"?|([^\"\\n\\s&|}]+))?)/g,\n        inside: {\n          comment: {\n            pattern: /#.*/,\n          },\n          'label-key': {\n            pattern: /[a-z_.][\\w./_-]*(?=\\s*(=|!=|>|<|>=|<=|=~|!~))/,\n            alias: 'attr-name',\n          },\n          'label-value': {\n            pattern: /(\"(?:\\\\.|[^\\\\\"])*\")|(\\w+)/,\n            alias: 'attr-value',\n          },\n        },\n      },\n      punctuation: /[}{&|]/,\n    },\n  },\n  number: /\\b-?\\d+((\\.\\d*)?([eE][+-]?\\d+)?)?\\b/,\n  operator: new RegExp(`/[-+*/=%^~]|&&?|\\\\|?\\\\||!=?|<(?:=>?|<|>)?|>[>=]?|`, 'i'),\n  punctuation: /[{};()`,.]/,\n};\n","import { startCase } from 'lodash';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { TraceqlFilter, TraceqlSearchScope } from '../dataquery.gen';\nimport { intrinsics } from '../traceql/traceql';\n\nexport const generateQueryFromFilters = (filters: TraceqlFilter[]) => {\n  return `{${filters\n    .filter((f) => f.tag && f.operator && f.value?.length)\n    .map((f) => `${scopeHelper(f)}${f.tag}${f.operator}${valueHelper(f)}`)\n    .join(' && ')}}`;\n};\n\nconst valueHelper = (f: TraceqlFilter) => {\n  if (Array.isArray(f.value) && f.value.length > 1) {\n    return `\"${f.value.join('|')}\"`;\n  }\n  if (f.valueType === 'string') {\n    return `\"${f.value}\"`;\n  }\n  return f.value;\n};\nconst scopeHelper = (f: TraceqlFilter) => {\n  // Intrinsic fields don't have a scope\n  if (intrinsics.find((t) => t === f.tag)) {\n    return '';\n  }\n  return (\n    (f.scope === TraceqlSearchScope.Resource || f.scope === TraceqlSearchScope.Span ? f.scope?.toLowerCase() : '') + '.'\n  );\n};\n\nexport const filterScopedTag = (f: TraceqlFilter) => {\n  return scopeHelper(f) + f.tag;\n};\n\nexport const filterTitle = (f: TraceqlFilter) => {\n  // Special case for the intrinsic \"name\" since a label called \"Name\" isn't explicit\n  if (f.tag === 'name') {\n    return 'Span Name';\n  }\n  return startCase(filterScopedTag(f));\n};\n\nexport function replaceAt<T>(array: T[], index: number, value: T) {\n  const ret = array.slice(0);\n  ret[index] = value;\n  return ret;\n}\n\nexport const operatorSelectableValue = (op: string) => {\n  const result: SelectableValue = { label: op, value: op };\n  switch (op) {\n    case '=':\n      result.description = 'Equals';\n      break;\n    case '!=':\n      result.description = 'Not equals';\n      break;\n    case '>':\n      result.description = 'Greater';\n      break;\n    case '>=':\n      result.description = 'Greater or Equal';\n      break;\n    case '<':\n      result.description = 'Less';\n      break;\n    case '<=':\n      result.description = 'Less or Equal';\n      break;\n    case '=~':\n      result.description = 'Matches regex';\n      break;\n    case '!~':\n      result.description = 'Does not match regex';\n      break;\n  }\n  return result;\n};\n","import { Value } from 'slate';\n\nimport { LanguageProvider, SelectableValue } from '@grafana/data';\nimport { CompletionItemGroup, TypeaheadInput, TypeaheadOutput } from '@grafana/ui';\n\nimport { TempoDatasource } from './datasource';\n\nexport default class TempoLanguageProvider extends LanguageProvider {\n  datasource: TempoDatasource;\n  tags?: string[];\n  constructor(datasource: TempoDatasource, initialValues?: any) {\n    super();\n\n    this.datasource = datasource;\n    Object.assign(this, initialValues);\n  }\n\n  request = async (url: string, params = {}) => {\n    const res = await this.datasource.metadataRequest(url, params);\n    return res?.data;\n  };\n\n  start = async () => {\n    if (!this.startTask) {\n      this.startTask = this.fetchTags().then(() => {\n        return [];\n      });\n    }\n\n    return this.startTask;\n  };\n\n  async fetchTags() {\n    const response = await this.request('/api/search/tags', []);\n    this.tags = response.tagNames;\n  }\n\n  getTags = () => {\n    return this.tags;\n  };\n\n  provideCompletionItems = async ({ text, value }: TypeaheadInput): Promise<TypeaheadOutput> => {\n    const emptyResult: TypeaheadOutput = { suggestions: [] };\n\n    if (!value) {\n      return emptyResult;\n    }\n\n    const query = value.endText.getText();\n    const isValue = query[query.indexOf(text) - 1] === '=';\n    if (isValue || text === '=') {\n      return this.getTagValueCompletionItems(value);\n    }\n    return this.getTagsCompletionItems();\n  };\n\n  getTagsCompletionItems = (): TypeaheadOutput => {\n    const { tags } = this;\n    const suggestions: CompletionItemGroup[] = [];\n\n    if (tags?.length) {\n      suggestions.push({\n        label: `Tag`,\n        items: tags.map((tag) => ({ label: tag })),\n      });\n    }\n\n    return { suggestions };\n  };\n\n  async getTagValueCompletionItems(value: Value) {\n    const tags = value.endText.getText().split(' ');\n\n    let tagName = tags[tags.length - 1] ?? '';\n    tagName = tagName.split('=')[0];\n\n    const response = await this.request(`/api/v2/search/tag/${tagName}/values`, []);\n\n    const suggestions: CompletionItemGroup[] = [];\n\n    if (response && response.tagValues) {\n      suggestions.push({\n        label: `Tag Values`,\n        items: response.tagValues.map((tagValue: string) => ({ label: tagValue, insertText: `\"${tagValue}\"` })),\n      });\n    }\n    return { suggestions };\n  }\n\n  async getOptionsV1(tag: string): Promise<Array<SelectableValue<string>>> {\n    const response = await this.request(`/api/search/tag/${tag}/values`);\n    let options: Array<SelectableValue<string>> = [];\n    if (response && response.tagValues) {\n      options = response.tagValues.map((v: string) => ({\n        value: v,\n        label: v,\n      }));\n    }\n    return options;\n  }\n\n  async getOptionsV2(tag: string): Promise<Array<SelectableValue<string>>> {\n    const response = await this.request(`/api/v2/search/tag/${tag}/values`);\n    let options: Array<SelectableValue<string>> = [];\n    if (response && response.tagValues) {\n      options = response.tagValues.map((v: { type: string; value: string }) => ({\n        type: v.type,\n        value: v.value,\n        label: v.value,\n      }));\n    }\n    return options;\n  }\n}\n","import { identity, pick, pickBy, groupBy, startCase } from 'lodash';\nimport { EMPTY, from, lastValueFrom, merge, Observable, of, throwError } from 'rxjs';\nimport { catchError, concatMap, map, mergeMap, toArray } from 'rxjs/operators';\n\nimport {\n  CoreApp,\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataQueryResponseData,\n  DataSourceApi,\n  DataSourceInstanceSettings,\n  dateTime,\n  FieldType,\n  isValidGoDuration,\n  LoadingState,\n  rangeUtil,\n  ScopedVars,\n} from '@grafana/data';\nimport {\n  config,\n  BackendSrvRequest,\n  DataSourceWithBackend,\n  getBackendSrv,\n  reportInteraction,\n  TemplateSrv,\n  getTemplateSrv,\n} from '@grafana/runtime';\nimport { BarGaugeDisplayMode, TableCellDisplayMode, VariableFormatID } from '@grafana/schema';\nimport { NodeGraphOptions } from 'app/core/components/NodeGraphSettings';\nimport { TraceToLogsOptions } from 'app/core/components/TraceToLogs/TraceToLogsSettings';\nimport { serializeParams } from 'app/core/utils/fetch';\nimport { SpanBarOptions } from 'app/features/explore/TraceView/components';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\n\nimport { LokiOptions } from '../loki/types';\nimport { PrometheusDatasource } from '../prometheus/datasource';\nimport { PromQuery } from '../prometheus/types';\n\nimport { generateQueryFromFilters } from './SearchTraceQLEditor/utils';\nimport { TraceqlFilter, TraceqlSearchScope } from './dataquery.gen';\nimport {\n  failedMetric,\n  histogramMetric,\n  mapPromMetricsToServiceMap,\n  serviceMapMetrics,\n  totalsMetric,\n  rateMetric,\n  durationMetric,\n  errorRateMetric,\n  defaultTableFilter,\n} from './graphTransform';\nimport TempoLanguageProvider from './language_provider';\nimport {\n  transformTrace,\n  transformTraceList,\n  transformFromOTLP as transformFromOTEL,\n  createTableFrameFromSearch,\n  createTableFrameFromTraceQlQuery,\n} from './resultTransformer';\nimport { SearchQueryParams, TempoQuery, TempoJsonData } from './types';\n\nexport const DEFAULT_LIMIT = 20;\n\nexport class TempoDatasource extends DataSourceWithBackend<TempoQuery, TempoJsonData> {\n  tracesToLogs?: TraceToLogsOptions;\n  serviceMap?: {\n    datasourceUid?: string;\n  };\n  search?: {\n    hide?: boolean;\n    filters?: TraceqlFilter[];\n  };\n  nodeGraph?: NodeGraphOptions;\n  lokiSearch?: {\n    datasourceUid?: string;\n  };\n  traceQuery?: {\n    timeShiftEnabled?: boolean;\n    spanStartTimeShift?: string;\n    spanEndTimeShift?: string;\n  };\n  uploadedJson?: string | ArrayBuffer | null = null;\n  spanBar?: SpanBarOptions;\n  languageProvider: TempoLanguageProvider;\n\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<TempoJsonData>,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n    this.tracesToLogs = instanceSettings.jsonData.tracesToLogs;\n    this.serviceMap = instanceSettings.jsonData.serviceMap;\n    this.search = instanceSettings.jsonData.search;\n    this.nodeGraph = instanceSettings.jsonData.nodeGraph;\n    this.lokiSearch = instanceSettings.jsonData.lokiSearch;\n    this.traceQuery = instanceSettings.jsonData.traceQuery;\n    this.languageProvider = new TempoLanguageProvider(this);\n    if (!this.search?.filters) {\n      this.search = {\n        ...this.search,\n        filters: [\n          {\n            id: 'service-name',\n            tag: 'service.name',\n            operator: '=',\n            scope: TraceqlSearchScope.Resource,\n          },\n          { id: 'span-name', tag: 'name', operator: '=', scope: TraceqlSearchScope.Span },\n        ],\n      };\n    }\n  }\n\n  query(options: DataQueryRequest<TempoQuery>): Observable<DataQueryResponse> {\n    const subQueries: Array<Observable<DataQueryResponse>> = [];\n    const filteredTargets = options.targets.filter((target) => !target.hide);\n    const targets: { [type: string]: TempoQuery[] } = groupBy(filteredTargets, (t) => t.queryType || 'traceql');\n\n    if (targets.clear) {\n      return of({ data: [], state: LoadingState.Done });\n    }\n\n    const logsDatasourceUid = this.getLokiSearchDS();\n\n    // Run search queries on linked datasource\n    if (logsDatasourceUid && targets.search?.length > 0) {\n      reportInteraction('grafana_traces_loki_search_queried', {\n        datasourceType: 'tempo',\n        app: options.app ?? '',\n        grafana_version: config.buildInfo.version,\n        hasLinkedQueryExpr:\n          targets.search[0].linkedQuery?.expr && targets.search[0].linkedQuery?.expr !== '' ? true : false,\n      });\n\n      const dsSrv = getDatasourceSrv();\n      subQueries.push(\n        from(dsSrv.get(logsDatasourceUid)).pipe(\n          mergeMap((linkedDatasource: DataSourceApi) => {\n            // Wrap linked query into a data request based on original request\n            const linkedRequest: DataQueryRequest = { ...options, targets: targets.search.map((t) => t.linkedQuery!) };\n            // Find trace matchers in derived fields of the linked datasource that's identical to this datasource\n            const settings: DataSourceInstanceSettings<LokiOptions> = (linkedDatasource as any).instanceSettings;\n            const traceLinkMatcher: string[] =\n              settings.jsonData.derivedFields\n                ?.filter((field) => field.datasourceUid === this.uid && field.matcherRegex)\n                .map((field) => field.matcherRegex) || [];\n\n            if (!traceLinkMatcher || traceLinkMatcher.length === 0) {\n              return throwError(\n                () =>\n                  new Error(\n                    'No Loki datasource configured for search. Set up Derived Fields for traces in a Loki datasource settings and link it to this Tempo datasource.'\n                  )\n              );\n            } else {\n              return (linkedDatasource.query(linkedRequest) as Observable<DataQueryResponse>).pipe(\n                map((response) =>\n                  response.error ? response : transformTraceList(response, this.uid, this.name, traceLinkMatcher)\n                )\n              );\n            }\n          })\n        )\n      );\n    }\n\n    if (targets.nativeSearch?.length) {\n      try {\n        reportInteraction('grafana_traces_search_queried', {\n          datasourceType: 'tempo',\n          app: options.app ?? '',\n          grafana_version: config.buildInfo.version,\n          hasServiceName: targets.nativeSearch[0].serviceName ? true : false,\n          hasSpanName: targets.nativeSearch[0].spanName ? true : false,\n          resultLimit: targets.nativeSearch[0].limit ?? '',\n          hasSearch: targets.nativeSearch[0].search ? true : false,\n          minDuration: targets.nativeSearch[0].minDuration ?? '',\n          maxDuration: targets.nativeSearch[0].maxDuration ?? '',\n        });\n\n        const timeRange = { startTime: options.range.from.unix(), endTime: options.range.to.unix() };\n        const query = this.applyVariables(targets.nativeSearch[0], options.scopedVars);\n        const searchQuery = this.buildSearchQuery(query, timeRange);\n        subQueries.push(\n          this._request('/api/search', searchQuery).pipe(\n            map((response) => {\n              return {\n                data: [createTableFrameFromSearch(response.data.traces, this.instanceSettings)],\n              };\n            }),\n            catchError((error) => {\n              return of({ error: { message: error.data.message }, data: [] });\n            })\n          )\n        );\n      } catch (error) {\n        return of({ error: { message: error instanceof Error ? error.message : 'Unknown error occurred' }, data: [] });\n      }\n    }\n    if (targets.traceql?.length) {\n      try {\n        const appliedQuery = this.applyVariables(targets.traceql[0], options.scopedVars);\n        const queryValue = appliedQuery?.query || '';\n        const hexOnlyRegex = /^[0-9A-Fa-f]*$/;\n        // Check whether this is a trace ID or traceQL query by checking if it only contains hex characters\n        if (queryValue.trim().match(hexOnlyRegex)) {\n          // There's only hex characters so let's assume that this is a trace ID\n          reportInteraction('grafana_traces_traceID_queried', {\n            datasourceType: 'tempo',\n            app: options.app ?? '',\n            grafana_version: config.buildInfo.version,\n            hasQuery: queryValue !== '' ? true : false,\n          });\n\n          subQueries.push(this.handleTraceIdQuery(options, targets.traceql));\n        } else {\n          reportInteraction('grafana_traces_traceql_queried', {\n            datasourceType: 'tempo',\n            app: options.app ?? '',\n            grafana_version: config.buildInfo.version,\n            query: queryValue ?? '',\n          });\n          subQueries.push(\n            this._request('/api/search', {\n              q: queryValue,\n              limit: options.targets[0].limit ?? DEFAULT_LIMIT,\n              start: options.range.from.unix(),\n              end: options.range.to.unix(),\n            }).pipe(\n              map((response) => {\n                return {\n                  data: createTableFrameFromTraceQlQuery(response.data.traces, this.instanceSettings),\n                };\n              }),\n              catchError((error) => {\n                return of({ error: { message: error.data.message }, data: [] });\n              })\n            )\n          );\n        }\n      } catch (error) {\n        return of({ error: { message: error instanceof Error ? error.message : 'Unknown error occurred' }, data: [] });\n      }\n    }\n    if (targets.traceqlSearch?.length) {\n      try {\n        const queryValue = generateQueryFromFilters(targets.traceqlSearch[0].filters);\n        reportInteraction('grafana_traces_traceql_search_queried', {\n          datasourceType: 'tempo',\n          app: options.app ?? '',\n          grafana_version: config.buildInfo.version,\n          query: queryValue ?? '',\n        });\n        subQueries.push(\n          this._request('/api/search', {\n            q: queryValue,\n            limit: options.targets[0].limit ?? DEFAULT_LIMIT,\n            start: options.range.from.unix(),\n            end: options.range.to.unix(),\n          }).pipe(\n            map((response) => {\n              return {\n                data: createTableFrameFromTraceQlQuery(response.data.traces, this.instanceSettings),\n              };\n            }),\n            catchError((error) => {\n              return of({ error: { message: error.data.message }, data: [] });\n            })\n          )\n        );\n      } catch (error) {\n        return of({ error: { message: error instanceof Error ? error.message : 'Unknown error occurred' }, data: [] });\n      }\n    }\n\n    if (targets.upload?.length) {\n      if (this.uploadedJson) {\n        reportInteraction('grafana_traces_json_file_uploaded', {\n          datasourceType: 'tempo',\n          app: options.app ?? '',\n          grafana_version: config.buildInfo.version,\n        });\n\n        const jsonData = JSON.parse(this.uploadedJson as string);\n        const isTraceData = jsonData.batches;\n        const isServiceGraphData =\n          Array.isArray(jsonData) && jsonData.some((df) => df?.meta?.preferredVisualisationType === 'nodeGraph');\n\n        if (isTraceData) {\n          subQueries.push(of(transformFromOTEL(jsonData.batches, this.nodeGraph?.enabled)));\n        } else if (isServiceGraphData) {\n          subQueries.push(of({ data: jsonData, state: LoadingState.Done }));\n        } else {\n          subQueries.push(of({ error: { message: 'Unable to parse uploaded data.' }, data: [] }));\n        }\n      } else {\n        subQueries.push(of({ data: [], state: LoadingState.Done }));\n      }\n    }\n\n    if (this.serviceMap?.datasourceUid && targets.serviceMap?.length > 0) {\n      reportInteraction('grafana_traces_service_graph_queried', {\n        datasourceType: 'tempo',\n        app: options.app ?? '',\n        grafana_version: config.buildInfo.version,\n        hasServiceMapQuery: targets.serviceMap[0].serviceMapQuery ? true : false,\n      });\n\n      const dsId = this.serviceMap.datasourceUid;\n      const tempoDsUid = this.uid;\n      subQueries.push(\n        serviceMapQuery(options, dsId, tempoDsUid).pipe(\n          concatMap((result) =>\n            rateQuery(options, result, dsId).pipe(\n              concatMap((result) => errorAndDurationQuery(options, result, dsId, tempoDsUid))\n            )\n          )\n        )\n      );\n    }\n\n    return merge(...subQueries);\n  }\n\n  applyTemplateVariables(query: TempoQuery, scopedVars: ScopedVars): Record<string, any> {\n    return this.applyVariables(query, scopedVars);\n  }\n\n  interpolateVariablesInQueries(queries: TempoQuery[], scopedVars: ScopedVars): TempoQuery[] {\n    if (!queries || queries.length === 0) {\n      return [];\n    }\n\n    return queries.map((query) => {\n      return {\n        ...query,\n        datasource: this.getRef(),\n        ...this.applyVariables(query, scopedVars),\n      };\n    });\n  }\n\n  applyVariables(query: TempoQuery, scopedVars: ScopedVars) {\n    const expandedQuery = { ...query };\n\n    if (query.linkedQuery) {\n      expandedQuery.linkedQuery = {\n        ...query.linkedQuery,\n        expr: this.templateSrv.replace(query.linkedQuery?.expr ?? '', scopedVars),\n      };\n    }\n\n    return {\n      ...expandedQuery,\n      query: this.templateSrv.replace(query.query ?? '', scopedVars, VariableFormatID.Pipe),\n      serviceName: this.templateSrv.replace(query.serviceName ?? '', scopedVars),\n      spanName: this.templateSrv.replace(query.spanName ?? '', scopedVars),\n      search: this.templateSrv.replace(query.search ?? '', scopedVars),\n      minDuration: this.templateSrv.replace(query.minDuration ?? '', scopedVars),\n      maxDuration: this.templateSrv.replace(query.maxDuration ?? '', scopedVars),\n    };\n  }\n\n  /**\n   * Handles the simplest of the queries where we have just a trace id and return trace data for it.\n   * @param options\n   * @param targets\n   * @private\n   */\n  handleTraceIdQuery(options: DataQueryRequest<TempoQuery>, targets: TempoQuery[]): Observable<DataQueryResponse> {\n    const validTargets = targets.filter((t) => t.query).map((t) => ({ ...t, query: t.query.trim() }));\n    if (!validTargets.length) {\n      return EMPTY;\n    }\n\n    const traceRequest = this.traceIdQueryRequest(options, validTargets);\n\n    return super.query(traceRequest).pipe(\n      map((response) => {\n        if (response.error) {\n          return response;\n        }\n        return transformTrace(response, this.nodeGraph?.enabled);\n      })\n    );\n  }\n\n  traceIdQueryRequest(options: DataQueryRequest<TempoQuery>, targets: TempoQuery[]): DataQueryRequest<TempoQuery> {\n    const request = {\n      ...options,\n      targets,\n    };\n\n    if (this.traceQuery?.timeShiftEnabled) {\n      request.range = options.range && {\n        ...options.range,\n        from: options.range.from.subtract(\n          rangeUtil.intervalToMs(this.traceQuery?.spanStartTimeShift || '30m'),\n          'milliseconds'\n        ),\n        to: options.range.to.add(rangeUtil.intervalToMs(this.traceQuery?.spanEndTimeShift || '30m'), 'milliseconds'),\n      };\n    } else {\n      request.range = { from: dateTime(0), to: dateTime(0), raw: { from: dateTime(0), to: dateTime(0) } };\n    }\n\n    return request;\n  }\n\n  async metadataRequest(url: string, params = {}) {\n    return await lastValueFrom(this._request(url, params, { method: 'GET', hideFromInspector: true }));\n  }\n\n  private _request(apiUrl: string, data?: any, options?: Partial<BackendSrvRequest>): Observable<Record<string, any>> {\n    const params = data ? serializeParams(data) : '';\n    const url = `${this.instanceSettings.url}${apiUrl}${params.length ? `?${params}` : ''}`;\n    const req = { ...options, url };\n\n    return getBackendSrv().fetch(req);\n  }\n\n  async testDatasource(): Promise<any> {\n    const options: BackendSrvRequest = {\n      headers: {},\n      method: 'GET',\n      url: `${this.instanceSettings.url}/api/echo`,\n    };\n    const response = await lastValueFrom(getBackendSrv().fetch(options));\n\n    if (response?.ok) {\n      return { status: 'success', message: 'Data source is working' };\n    }\n  }\n\n  getQueryDisplayText(query: TempoQuery) {\n    if (query.queryType === 'nativeSearch') {\n      let result = [];\n      for (const key of ['serviceName', 'spanName', 'search', 'minDuration', 'maxDuration', 'limit']) {\n        if (query.hasOwnProperty(key) && query[key as keyof TempoQuery]) {\n          result.push(`${startCase(key)}: ${query[key as keyof TempoQuery]}`);\n        }\n      }\n      return result.join(', ');\n    }\n    return query.query;\n  }\n\n  buildSearchQuery(query: TempoQuery, timeRange?: { startTime: number; endTime?: number }): SearchQueryParams {\n    let tags = query.search ?? '';\n\n    let tempoQuery = pick(query, ['minDuration', 'maxDuration', 'limit']);\n    // Remove empty properties\n    tempoQuery = pickBy(tempoQuery, identity);\n\n    if (query.serviceName) {\n      tags += ` service.name=\"${query.serviceName}\"`;\n    }\n    if (query.spanName) {\n      tags += ` name=\"${query.spanName}\"`;\n    }\n\n    // Set default limit\n    if (!tempoQuery.limit) {\n      tempoQuery.limit = DEFAULT_LIMIT;\n    }\n\n    // Validate query inputs and remove spaces if valid\n    if (tempoQuery.minDuration) {\n      tempoQuery.minDuration = this.templateSrv.replace(tempoQuery.minDuration ?? '');\n      if (!isValidGoDuration(tempoQuery.minDuration)) {\n        throw new Error('Please enter a valid min duration.');\n      }\n      tempoQuery.minDuration = tempoQuery.minDuration.replace(/\\s/g, '');\n    }\n    if (tempoQuery.maxDuration) {\n      tempoQuery.maxDuration = this.templateSrv.replace(tempoQuery.maxDuration ?? '');\n      if (!isValidGoDuration(tempoQuery.maxDuration)) {\n        throw new Error('Please enter a valid max duration.');\n      }\n      tempoQuery.maxDuration = tempoQuery.maxDuration.replace(/\\s/g, '');\n    }\n\n    if (!Number.isInteger(tempoQuery.limit) || tempoQuery.limit <= 0) {\n      throw new Error('Please enter a valid limit.');\n    }\n\n    let searchQuery: SearchQueryParams = { tags, ...tempoQuery };\n\n    if (timeRange) {\n      searchQuery.start = timeRange.startTime;\n      searchQuery.end = timeRange.endTime;\n    }\n\n    return searchQuery;\n  }\n\n  // Get linked loki search datasource. Fall back to legacy loki search/trace to logs config\n  getLokiSearchDS = (): string | undefined => {\n    const legacyLogsDatasourceUid =\n      this.tracesToLogs?.lokiSearch !== false && this.lokiSearch === undefined\n        ? this.tracesToLogs?.datasourceUid\n        : undefined;\n    return this.lokiSearch?.datasourceUid ?? legacyLogsDatasourceUid;\n  };\n}\n\nfunction queryPrometheus(request: DataQueryRequest<PromQuery>, datasourceUid: string) {\n  return from(getDatasourceSrv().get(datasourceUid)).pipe(\n    mergeMap((ds) => {\n      return (ds as PrometheusDatasource).query(request);\n    })\n  );\n}\n\nfunction serviceMapQuery(request: DataQueryRequest<TempoQuery>, datasourceUid: string, tempoDatasourceUid: string) {\n  const serviceMapRequest = makePromServiceMapRequest(request);\n\n  return queryPrometheus(serviceMapRequest, datasourceUid).pipe(\n    // Just collect all the responses first before processing into node graph data\n    toArray(),\n    map((responses: DataQueryResponse[]) => {\n      const errorRes = responses.find((res) => !!res.error);\n      if (errorRes) {\n        throw new Error(errorRes.error!.message);\n      }\n\n      const { nodes, edges } = mapPromMetricsToServiceMap(responses, request.range);\n      if (nodes.fields.length > 0 && edges.fields.length > 0) {\n        const nodeLength = nodes.fields[0].values.length;\n        const edgeLength = edges.fields[0].values.length;\n\n        reportInteraction('grafana_traces_service_graph_size', {\n          datasourceType: 'tempo',\n          grafana_version: config.buildInfo.version,\n          nodeLength,\n          edgeLength,\n        });\n      }\n\n      // No handling of multiple targets assume just one. NodeGraph does not support it anyway, but still should be\n      // fixed at some point.\n      nodes.refId = request.targets[0].refId;\n      edges.refId = request.targets[0].refId;\n\n      nodes.fields[0].config = getFieldConfig(\n        datasourceUid,\n        tempoDatasourceUid,\n        '__data.fields.id',\n        '__data.fields[0]'\n      );\n      edges.fields[0].config = getFieldConfig(\n        datasourceUid,\n        tempoDatasourceUid,\n        '__data.fields.target',\n        '__data.fields.target',\n        '__data.fields.source'\n      );\n\n      return {\n        data: [nodes, edges],\n        state: LoadingState.Done,\n      };\n    })\n  );\n}\n\nfunction rateQuery(\n  request: DataQueryRequest<TempoQuery>,\n  serviceMapResponse: DataQueryResponse,\n  datasourceUid: string\n) {\n  const serviceMapRequest = makePromServiceMapRequest(request);\n  serviceMapRequest.targets = makeServiceGraphViewRequest([buildExpr(rateMetric, defaultTableFilter, request)]);\n\n  return queryPrometheus(serviceMapRequest, datasourceUid).pipe(\n    toArray(),\n    map((responses: DataQueryResponse[]) => {\n      const errorRes = responses.find((res) => !!res.error);\n      if (errorRes) {\n        throw new Error(errorRes.error!.message);\n      }\n      return {\n        data: [responses[0]?.data ?? [], serviceMapResponse.data[0], serviceMapResponse.data[1]],\n        state: LoadingState.Done,\n      };\n    })\n  );\n}\n\n// we need the response from the rate query to get the rate span_name(s),\n// -> which determine the errorRate/duration span_name(s) we need to query\nfunction errorAndDurationQuery(\n  request: DataQueryRequest<TempoQuery>,\n  rateResponse: DataQueryResponse,\n  datasourceUid: string,\n  tempoDatasourceUid: string\n) {\n  let serviceGraphViewMetrics = [];\n  let errorRateBySpanName = '';\n  let durationsBySpanName: string[] = [];\n\n  let labels = [];\n  if (request.app === CoreApp.Explore) {\n    if (rateResponse.data[0][0]?.fields[1]?.values) {\n      labels = rateResponse.data[0][0]?.fields[1]?.values;\n    }\n  } else if (rateResponse.data[0]) {\n    rateResponse.data[0].map((df: DataFrame) => {\n      if (df.fields[1]?.labels && df.fields[1]?.labels['span_name']) {\n        labels.push(df.fields[1]?.labels['span_name']);\n      }\n    });\n  }\n  const spanNames = getEscapedSpanNames(labels);\n\n  if (spanNames.length > 0) {\n    errorRateBySpanName = buildExpr(errorRateMetric, 'span_name=~\"' + spanNames.join('|') + '\"', request);\n    serviceGraphViewMetrics.push(errorRateBySpanName);\n    spanNames.map((name: string) => {\n      const metric = buildExpr(durationMetric, 'span_name=~\"' + name + '\"', request);\n      durationsBySpanName.push(metric);\n      serviceGraphViewMetrics.push(metric);\n    });\n  }\n\n  const serviceMapRequest = makePromServiceMapRequest(request);\n  serviceMapRequest.targets = makeServiceGraphViewRequest(serviceGraphViewMetrics);\n\n  return queryPrometheus(serviceMapRequest, datasourceUid).pipe(\n    // Just collect all the responses first before processing into node graph data\n    toArray(),\n    map((errorAndDurationResponse: DataQueryResponse[]) => {\n      const errorRes = errorAndDurationResponse.find((res) => !!res.error);\n      if (errorRes) {\n        throw new Error(errorRes.error!.message);\n      }\n\n      const serviceGraphView = getServiceGraphView(\n        request,\n        rateResponse,\n        errorAndDurationResponse[0],\n        errorRateBySpanName,\n        durationsBySpanName,\n        datasourceUid,\n        tempoDatasourceUid\n      );\n\n      if (serviceGraphView.fields.length === 0) {\n        return {\n          data: [rateResponse.data[1], rateResponse.data[2]],\n          state: LoadingState.Done,\n        };\n      }\n\n      return {\n        data: [serviceGraphView, rateResponse.data[1], rateResponse.data[2]],\n        state: LoadingState.Done,\n      };\n    })\n  );\n}\n\nfunction makePromLink(title: string, expr: string, datasourceUid: string, instant: boolean) {\n  return {\n    url: '',\n    title,\n    internal: {\n      query: {\n        expr: expr,\n        range: !instant,\n        exemplar: !instant,\n        instant: instant,\n      } as PromQuery,\n      datasourceUid,\n      datasourceName: getDatasourceSrv().getDataSourceSettingsByUid(datasourceUid)?.name ?? '',\n    },\n  };\n}\n\nexport function getEscapedSpanNames(values: string[]) {\n  return values.map((value: string) => value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\\\\\$&'));\n}\n\nexport function getFieldConfig(\n  datasourceUid: string,\n  tempoDatasourceUid: string,\n  targetField: string,\n  tempoField: string,\n  sourceField?: string\n) {\n  sourceField = sourceField ? `client=\"\\${${sourceField}}\",` : '';\n  return {\n    links: [\n      makePromLink(\n        'Request rate',\n        `sum by (client, server)(rate(${totalsMetric}{${sourceField}server=\"\\${${targetField}}\"}[$__rate_interval]))`,\n        datasourceUid,\n        false\n      ),\n      makePromLink(\n        'Request histogram',\n        `histogram_quantile(0.9, sum(rate(${histogramMetric}{${sourceField}server=\"\\${${targetField}}\"}[$__rate_interval])) by (le, client, server))`,\n        datasourceUid,\n        false\n      ),\n      makePromLink(\n        'Failed request rate',\n        `sum by (client, server)(rate(${failedMetric}{${sourceField}server=\"\\${${targetField}}\"}[$__rate_interval]))`,\n        datasourceUid,\n        false\n      ),\n      makeTempoLink('View traces', `\\${${tempoField}}`, '', tempoDatasourceUid),\n    ],\n  };\n}\n\nexport function makeTempoLink(title: string, serviceName: string, spanName: string, datasourceUid: string) {\n  let query = { queryType: 'nativeSearch' } as TempoQuery;\n  if (serviceName !== '') {\n    query.serviceName = serviceName;\n  }\n  if (spanName !== '') {\n    query.spanName = spanName;\n  }\n\n  return {\n    url: '',\n    title,\n    internal: {\n      query,\n      datasourceUid,\n      datasourceName: getDatasourceSrv().getDataSourceSettingsByUid(datasourceUid)?.name ?? '',\n    },\n  };\n}\n\nfunction makePromServiceMapRequest(options: DataQueryRequest<TempoQuery>): DataQueryRequest<PromQuery> {\n  return {\n    ...options,\n    targets: serviceMapMetrics.map((metric) => {\n      return {\n        format: 'table',\n        refId: metric,\n        // options.targets[0] is not correct here, but not sure what should happen if you have multiple queries for\n        // service map at the same time anyway\n        expr: `sum by (client, server) (rate(${metric}${options.targets[0].serviceMapQuery || ''}[$__range]))`,\n        instant: true,\n      };\n    }),\n  };\n}\n\nfunction getServiceGraphView(\n  request: DataQueryRequest<TempoQuery>,\n  rateResponse: DataQueryResponse,\n  secondResponse: DataQueryResponse,\n  errorRateBySpanName: string,\n  durationsBySpanName: string[],\n  datasourceUid: string,\n  tempoDatasourceUid: string\n) {\n  let df: any = { fields: [] };\n  const rate = rateResponse.data[0]?.filter((x: { refId: string }) => {\n    return x.refId === buildExpr(rateMetric, defaultTableFilter, request);\n  });\n  const errorRate = secondResponse.data.filter((x) => {\n    return x.refId === errorRateBySpanName;\n  });\n  const duration = secondResponse.data.filter((x) => {\n    return durationsBySpanName.includes(x.refId);\n  });\n\n  if (rate.length > 0 && rate[0].fields?.length > 2) {\n    df.fields.push({\n      ...rate[0].fields[1],\n      name: 'Name',\n      config: {\n        filterable: false,\n      },\n    });\n\n    df.fields.push({\n      ...rate[0].fields[2],\n      name: 'Rate',\n      config: {\n        links: [\n          makePromLink(\n            'Rate',\n            buildLinkExpr(buildExpr(rateMetric, 'span_name=\"${__data.fields[0]}\"', request)),\n            datasourceUid,\n            false\n          ),\n        ],\n        decimals: 2,\n      },\n    });\n\n    df.fields.push({\n      ...rate[0].fields[2],\n      name: '  ',\n      labels: null,\n      config: {\n        color: {\n          mode: 'continuous-BlPu',\n        },\n        custom: {\n          cellOptions: {\n            mode: BarGaugeDisplayMode.Lcd,\n            type: TableCellDisplayMode.Gauge,\n          },\n        },\n        decimals: 3,\n      },\n    });\n  }\n\n  if (errorRate.length > 0 && errorRate[0].fields?.length > 2) {\n    const errorRateNames = errorRate[0].fields[1]?.values ?? [];\n    const errorRateValues = errorRate[0].fields[2]?.values ?? [];\n    let errorRateObj: any = {};\n    errorRateNames.map((name: string, index: number) => {\n      errorRateObj[name] = { value: errorRateValues[index] };\n    });\n\n    const values = getRateAlignedValues({ ...rate }, errorRateObj);\n\n    df.fields.push({\n      ...errorRate[0].fields[2],\n      name: 'Error Rate',\n      values: values,\n      config: {\n        links: [\n          makePromLink(\n            'Error Rate',\n            buildLinkExpr(buildExpr(errorRateMetric, 'span_name=\"${__data.fields[0]}\"', request)),\n            datasourceUid,\n            false\n          ),\n        ],\n        decimals: 2,\n      },\n    });\n\n    df.fields.push({\n      ...errorRate[0].fields[2],\n      name: '   ',\n      values: values,\n      labels: null,\n      config: {\n        color: {\n          mode: 'continuous-RdYlGr',\n        },\n        custom: {\n          cellOptions: {\n            mode: BarGaugeDisplayMode.Lcd,\n            type: TableCellDisplayMode.Gauge,\n          },\n        },\n        decimals: 3,\n      },\n    });\n  }\n\n  if (duration.length > 0 && duration[0].fields?.length > 1) {\n    let durationObj: any = {};\n    duration.map((d) => {\n      const delimiter = d.refId?.includes('span_name=~\"') ? 'span_name=~\"' : 'span_name=\"';\n      const name = d.refId?.split(delimiter)[1].split('\"}')[0];\n      durationObj[name] = { value: d.fields[1].values[0] };\n    });\n\n    df.fields.push({\n      ...duration[0].fields[1],\n      name: 'Duration (p90)',\n      values: getRateAlignedValues({ ...rate }, durationObj),\n      config: {\n        links: [\n          makePromLink(\n            'Duration',\n            buildLinkExpr(buildExpr(durationMetric, 'span_name=\"${__data.fields[0]}\"', request)),\n            datasourceUid,\n            false\n          ),\n        ],\n        unit: 's',\n      },\n    });\n  }\n\n  if (df.fields.length > 0 && df.fields[0].values) {\n    df.fields.push({\n      name: 'Links',\n      type: FieldType.string,\n      values: df.fields[0].values.map(() => {\n        return 'Tempo';\n      }),\n      config: {\n        links: [makeTempoLink('Tempo', '', `\\${__data.fields[0]}`, tempoDatasourceUid)],\n      },\n    });\n  }\n\n  return df;\n}\n\nexport function buildExpr(\n  metric: { expr: string; params: string[] },\n  extraParams: string,\n  request: DataQueryRequest<TempoQuery>\n) {\n  let serviceMapQuery = request.targets[0]?.serviceMapQuery ?? '';\n  const serviceMapQueryMatch = serviceMapQuery.match(/^{(.*)}$/);\n  if (serviceMapQueryMatch?.length) {\n    serviceMapQuery = serviceMapQueryMatch[1];\n  }\n  // map serviceGraph metric tags to serviceGraphView metric tags\n  serviceMapQuery = serviceMapQuery.replace('client', 'service').replace('server', 'service');\n  const metricParams = serviceMapQuery.includes('span_name')\n    ? metric.params.concat(serviceMapQuery)\n    : metric.params\n        .concat(serviceMapQuery)\n        .concat(extraParams)\n        .filter((item: string) => item);\n  return metric.expr.replace('{}', '{' + metricParams.join(',') + '}');\n}\n\nexport function buildLinkExpr(expr: string) {\n  // don't want top 5 or by span name in links\n  expr = expr.replace('topk(5, ', '').replace(' by (span_name))', '');\n  return expr.replace('__range', '__rate_interval');\n}\n\n// query result frames can come back in any order\n// here we align the table col values to the same row name (rateName) across the table\nexport function getRateAlignedValues(\n  rateResp: DataQueryResponseData[],\n  objToAlign: { [x: string]: { value: string } }\n) {\n  const rateNames = rateResp[0]?.fields[1]?.values ?? [];\n  let values: string[] = [];\n\n  for (let i = 0; i < rateNames.length; i++) {\n    if (Object.keys(objToAlign).includes(rateNames[i])) {\n      values.push(objToAlign[rateNames[i]].value);\n    } else {\n      values.push('0');\n    }\n  }\n\n  return values;\n}\n\nexport function makeServiceGraphViewRequest(metrics: any[]) {\n  return metrics.map((metric) => {\n    return {\n      refId: metric,\n      expr: metric,\n      instant: true,\n    };\n  });\n}\n","import React from 'react';\n\nimport { EditorField, EditorRow } from '@grafana/experimental';\nimport { AutoSizeInput } from '@grafana/ui';\nimport { QueryOptionGroup } from 'app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup';\n\nimport { DEFAULT_LIMIT } from '../datasource';\nimport { TempoQuery } from '../types';\n\ninterface Props {\n  onChange: (value: TempoQuery) => void;\n  query: Partial<TempoQuery> & TempoQuery;\n}\n\nexport const TempoQueryBuilderOptions = React.memo<Props>(({ onChange, query }) => {\n  if (!query.hasOwnProperty('limit')) {\n    query.limit = DEFAULT_LIMIT;\n  }\n\n  const onLimitChange = (e: React.FormEvent<HTMLInputElement>) => {\n    onChange({ ...query, limit: parseInt(e.currentTarget.value, 10) });\n  };\n\n  return (\n    <>\n      <EditorRow>\n        <QueryOptionGroup title=\"Options\" collapsedInfo={[`Limit: ${query.limit || DEFAULT_LIMIT}`]}>\n          <EditorField label=\"Limit\" tooltip=\"Maximum number of traces to return.\">\n            <AutoSizeInput\n              className=\"width-4\"\n              placeholder=\"auto\"\n              type=\"number\"\n              min={1}\n              defaultValue={query.limit || DEFAULT_LIMIT}\n              onCommitChange={onLimitChange}\n              value={query.limit}\n            />\n          </EditorField>\n        </QueryOptionGroup>\n      </EditorRow>\n    </>\n  );\n});\n\nTempoQueryBuilderOptions.displayName = 'TempoQueryBuilderOptions';\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { Select, HorizontalGroup, Input, useStyles2 } from '@grafana/ui';\n\nimport { TraceqlFilter } from '../dataquery.gen';\n\nimport { operatorSelectableValue } from './utils';\n\ninterface Props {\n  filter: TraceqlFilter;\n  updateFilter: (f: TraceqlFilter) => void;\n  isTagsLoading?: boolean;\n  operators: string[];\n}\n\nconst validationRegex = /^\\d+(?:\\.\\d)?\\d*(?:us|s|ns|ms|s|m|h)$/;\n\nconst getStyles = () => ({\n  noBoxShadow: css`\n    box-shadow: none;\n    *:focus {\n      box-shadow: none;\n    }\n  `,\n});\n\nconst DurationInput = ({ filter, operators, updateFilter }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  let invalid = false;\n  if (typeof filter.value === 'string') {\n    invalid = filter.value ? !validationRegex.test(filter.value.concat('')) : false;\n  }\n\n  return (\n    <HorizontalGroup spacing={'none'}>\n      <Select\n        className={styles.noBoxShadow}\n        inputId={`${filter.id}-operator`}\n        options={operators.map(operatorSelectableValue)}\n        value={filter.operator}\n        onChange={(v) => {\n          updateFilter({ ...filter, operator: v?.value });\n        }}\n        isClearable={false}\n        aria-label={`select ${filter.id} operator`}\n        allowCustomValue={true}\n        width={8}\n      />\n      <Input\n        className={styles.noBoxShadow}\n        value={filter.value}\n        onChange={(v) => {\n          updateFilter({ ...filter, value: v.currentTarget.value });\n        }}\n        placeholder=\"e.g. 100ms, 1.2s\"\n        aria-label={`select ${filter.id} value`}\n        invalid={invalid}\n        width={18}\n      />\n    </HorizontalGroup>\n  );\n};\n\nexport default DurationInput;\n","import React from 'react';\n\nimport { InlineFieldRow, InlineField } from '@grafana/ui';\n\ninterface Props {\n  label: string;\n  tooltip?: string;\n  children: React.ReactElement;\n}\nconst SearchField = ({ label, tooltip, children }: Props) => {\n  return (\n    <InlineFieldRow>\n      <InlineField label={label} labelWidth={28} grow tooltip={tooltip}>\n        {children}\n      </InlineField>\n    </InlineFieldRow>\n  );\n};\n\nexport default SearchField;\n","import { css } from '@emotion/css';\nimport { uniq } from 'lodash';\nimport React, { useState, useEffect, useMemo } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { AccessoryButton } from '@grafana/experimental';\nimport { FetchError, isFetchError } from '@grafana/runtime';\nimport { Select, HorizontalGroup, useStyles2 } from '@grafana/ui';\n\nimport { createErrorNotification } from '../../../../core/copy/appNotification';\nimport { notifyApp } from '../../../../core/reducers/appNotification';\nimport { dispatch } from '../../../../store/store';\nimport { TraceqlFilter, TraceqlSearchScope } from '../dataquery.gen';\nimport { TempoDatasource } from '../datasource';\nimport TempoLanguageProvider from '../language_provider';\nimport { operators as allOperators, stringOperators, numberOperators } from '../traceql/traceql';\n\nimport { filterScopedTag, operatorSelectableValue } from './utils';\n\nconst getStyles = () => ({\n  dropdown: css`\n    box-shadow: none;\n  `,\n});\n\ninterface Props {\n  filter: TraceqlFilter;\n  datasource: TempoDatasource;\n  updateFilter: (f: TraceqlFilter) => void;\n  deleteFilter?: (f: TraceqlFilter) => void;\n  setError: (error: FetchError) => void;\n  isTagsLoading?: boolean;\n  tags: string[];\n  hideScope?: boolean;\n  hideTag?: boolean;\n  hideValue?: boolean;\n  allowDelete?: boolean;\n}\nconst SearchField = ({\n  filter,\n  datasource,\n  updateFilter,\n  deleteFilter,\n  isTagsLoading,\n  tags,\n  setError,\n  hideScope,\n  hideTag,\n  hideValue,\n  allowDelete,\n}: Props) => {\n  const styles = useStyles2(getStyles);\n  const languageProvider = useMemo(() => new TempoLanguageProvider(datasource), [datasource]);\n  const scopedTag = useMemo(() => filterScopedTag(filter), [filter]);\n  // We automatically change the operator to the regex op when users select 2 or more values\n  // However, they expect this to be automatically rolled back to the previous operator once\n  // there's only one value selected, so we store the previous operator and value\n  const [prevOperator, setPrevOperator] = useState(filter.operator);\n  const [prevValue, setPrevValue] = useState(filter.value);\n\n  const updateOptions = async () => {\n    try {\n      return await languageProvider.getOptionsV2(scopedTag);\n    } catch (error) {\n      // Display message if Tempo is connected but search 404's\n      if (isFetchError(error) && error?.status === 404) {\n        setError(error);\n      } else if (error instanceof Error) {\n        dispatch(notifyApp(createErrorNotification('Error', error)));\n      }\n    }\n    return [];\n  };\n\n  const { loading: isLoadingValues, value: options } = useAsync(updateOptions, [scopedTag, languageProvider, setError]);\n\n  useEffect(() => {\n    if (Array.isArray(filter.value) && filter.value.length > 1 && filter.operator !== '=~') {\n      setPrevOperator(filter.operator);\n      updateFilter({ ...filter, operator: '=~' });\n    }\n    if (Array.isArray(filter.value) && filter.value.length <= 1 && (prevValue?.length || 0) > 1) {\n      updateFilter({ ...filter, operator: prevOperator, value: filter.value[0] });\n    }\n  }, [prevValue, prevOperator, updateFilter, filter]);\n\n  useEffect(() => {\n    setPrevValue(filter.value);\n  }, [filter.value]);\n\n  const scopeOptions = Object.values(TraceqlSearchScope).map((t) => ({ label: t, value: t }));\n\n  // If all values have type string or int/float use a focused list of operators instead of all operators\n  const optionsOfFirstType = options?.filter((o) => o.type === options[0]?.type);\n  const uniqueOptionType = options?.length === optionsOfFirstType?.length ? options?.[0]?.type : undefined;\n  let operatorList = allOperators;\n  switch (uniqueOptionType) {\n    case 'string':\n      operatorList = stringOperators;\n      break;\n    case 'int':\n    case 'float':\n      operatorList = numberOperators;\n  }\n\n  return (\n    <HorizontalGroup spacing={'none'} width={'auto'}>\n      {!hideScope && (\n        <Select\n          className={styles.dropdown}\n          inputId={`${filter.id}-scope`}\n          options={scopeOptions}\n          value={filter.scope}\n          onChange={(v) => {\n            updateFilter({ ...filter, scope: v?.value });\n          }}\n          placeholder=\"Select scope\"\n          aria-label={`select ${filter.id} scope`}\n        />\n      )}\n      {!hideTag && (\n        <Select\n          className={styles.dropdown}\n          inputId={`${filter.id}-tag`}\n          isLoading={isTagsLoading}\n          // Add the current tag to the list if it doesn't exist in the tags prop, otherwise the field will be empty even though the state has a value\n          options={(filter.tag !== undefined ? uniq([filter.tag, ...tags]) : tags).map((t) => ({\n            label: t,\n            value: t,\n          }))}\n          value={filter.tag}\n          onChange={(v) => {\n            updateFilter({ ...filter, tag: v?.value });\n          }}\n          placeholder=\"Select tag\"\n          isClearable\n          aria-label={`select ${filter.id} tag`}\n          allowCustomValue={true}\n        />\n      )}\n      <Select\n        className={styles.dropdown}\n        inputId={`${filter.id}-operator`}\n        options={operatorList.map(operatorSelectableValue)}\n        value={filter.operator}\n        onChange={(v) => {\n          updateFilter({ ...filter, operator: v?.value });\n        }}\n        isClearable={false}\n        aria-label={`select ${filter.id} operator`}\n        allowCustomValue={true}\n        width={8}\n      />\n      {!hideValue && (\n        <Select\n          className={styles.dropdown}\n          inputId={`${filter.id}-value`}\n          isLoading={isLoadingValues}\n          options={options}\n          value={filter.value}\n          onChange={(val) => {\n            if (Array.isArray(val)) {\n              updateFilter({ ...filter, value: val.map((v) => v.value), valueType: val[0]?.type });\n            } else {\n              updateFilter({ ...filter, value: val?.value, valueType: val?.type });\n            }\n          }}\n          placeholder=\"Select value\"\n          isClearable={false}\n          aria-label={`select ${filter.id} value`}\n          allowCustomValue={true}\n          isMulti\n          allowCreateWhileLoading\n        />\n      )}\n      {allowDelete && (\n        <AccessoryButton\n          variant={'secondary'}\n          icon={'times'}\n          onClick={() => deleteFilter?.(filter)}\n          tooltip={'Remove tag'}\n          aria-label={`remove tag with ID ${filter.id}`}\n        />\n      )}\n    </HorizontalGroup>\n  );\n};\n\nexport default SearchField;\n","import { css } from '@emotion/css';\nimport React, { useCallback, useEffect } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { AccessoryButton } from '@grafana/experimental';\nimport { FetchError } from '@grafana/runtime';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { TraceqlFilter, TraceqlSearchScope } from '../dataquery.gen';\nimport { TempoDatasource } from '../datasource';\n\nimport SearchField from './SearchField';\n\nconst getStyles = () => ({\n  vertical: css`\n    display: flex;\n    flex-direction: column;\n    gap: 0.25rem;\n  `,\n  horizontal: css`\n    display: flex;\n    flex-direction: row;\n    gap: 1rem;\n  `,\n});\n\ninterface Props {\n  updateFilter: (f: TraceqlFilter) => void;\n  deleteFilter: (f: TraceqlFilter) => void;\n  filters: TraceqlFilter[];\n  datasource: TempoDatasource;\n  setError: (error: FetchError) => void;\n  tags: string[];\n  isTagsLoading: boolean;\n  hideValues?: boolean;\n}\nconst TagsInput = ({\n  updateFilter,\n  deleteFilter,\n  filters,\n  datasource,\n  setError,\n  tags,\n  isTagsLoading,\n  hideValues,\n}: Props) => {\n  const styles = useStyles2(getStyles);\n  const generateId = () => uuidv4().slice(0, 8);\n  const handleOnAdd = useCallback(\n    () => updateFilter({ id: generateId(), operator: '=', scope: TraceqlSearchScope.Span }),\n    [updateFilter]\n  );\n\n  useEffect(() => {\n    if (!filters?.length) {\n      handleOnAdd();\n    }\n  }, [filters, handleOnAdd]);\n\n  return (\n    <div className={styles.vertical}>\n      {filters?.map((f, i) => (\n        <div className={styles.horizontal} key={f.id}>\n          <SearchField\n            filter={f}\n            datasource={datasource}\n            setError={setError}\n            updateFilter={updateFilter}\n            tags={tags}\n            isTagsLoading={isTagsLoading}\n            deleteFilter={deleteFilter}\n            allowDelete={true}\n            hideValue={hideValues}\n          />\n          {i === filters.length - 1 && (\n            <AccessoryButton variant={'secondary'} icon={'plus'} onClick={handleOnAdd} title={'Add tag'} />\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default TagsInput;\n","import { css } from '@emotion/css';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { EditorRow } from '@grafana/experimental';\nimport { FetchError } from '@grafana/runtime';\nimport { Alert, HorizontalGroup, useStyles2 } from '@grafana/ui';\n\nimport { createErrorNotification } from '../../../../core/copy/appNotification';\nimport { notifyApp } from '../../../../core/reducers/appNotification';\nimport { dispatch } from '../../../../store/store';\nimport { RawQuery } from '../../prometheus/querybuilder/shared/RawQuery';\nimport { TraceqlFilter } from '../dataquery.gen';\nimport { TempoDatasource } from '../datasource';\nimport { TempoQueryBuilderOptions } from '../traceql/TempoQueryBuilderOptions';\nimport { intrinsics, traceqlGrammar } from '../traceql/traceql';\nimport { TempoQuery } from '../types';\n\nimport DurationInput from './DurationInput';\nimport InlineSearchField from './InlineSearchField';\nimport SearchField from './SearchField';\nimport TagsInput from './TagsInput';\nimport { filterScopedTag, filterTitle, generateQueryFromFilters, replaceAt } from './utils';\n\ninterface Props {\n  datasource: TempoDatasource;\n  query: TempoQuery;\n  onChange: (value: TempoQuery) => void;\n  onBlur?: () => void;\n}\n\nconst TraceQLSearch = ({ datasource, query, onChange }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [error, setError] = useState<Error | FetchError | null>(null);\n\n  const [tags, setTags] = useState<string[]>([]);\n  const [isTagsLoading, setIsTagsLoading] = useState(true);\n  const [traceQlQuery, setTraceQlQuery] = useState<string>('');\n\n  const updateFilter = useCallback(\n    (s: TraceqlFilter) => {\n      const copy = { ...query };\n      copy.filters ||= [];\n      const indexOfFilter = copy.filters.findIndex((f) => f.id === s.id);\n      if (indexOfFilter >= 0) {\n        // update in place if the filter already exists, for consistency and to avoid UI bugs\n        copy.filters = replaceAt(copy.filters, indexOfFilter, s);\n      } else {\n        copy.filters.push(s);\n      }\n      onChange(copy);\n    },\n    [onChange, query]\n  );\n\n  const deleteFilter = (s: TraceqlFilter) => {\n    onChange({ ...query, filters: query.filters.filter((f) => f.id !== s.id) });\n  };\n\n  useEffect(() => {\n    setTraceQlQuery(generateQueryFromFilters(query.filters || []));\n  }, [query]);\n\n  const findFilter = useCallback((id: string) => query.filters?.find((f) => f.id === id), [query.filters]);\n\n  useEffect(() => {\n    const fetchTags = async () => {\n      try {\n        await datasource.languageProvider.start();\n        const tags = datasource.languageProvider.getTags();\n\n        if (tags) {\n          // This is needed because the /api/v2/search/tag/${tag}/values API expects \"status\" and the v1 API expects \"status.code\"\n          // so Tempo doesn't send anything and we inject it here for the autocomplete\n          if (!tags.find((t) => t === 'status')) {\n            tags.push('status');\n          }\n          setTags(tags);\n          setIsTagsLoading(false);\n        }\n      } catch (error) {\n        if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n      }\n    };\n    fetchTags();\n  }, [datasource]);\n\n  useEffect(() => {\n    // Initialize state with configured static filters that already have a value from the config\n    datasource.search?.filters\n      ?.filter((f) => f.value)\n      .forEach((f) => {\n        if (!findFilter(f.id)) {\n          updateFilter(f);\n        }\n      });\n  }, [datasource.search?.filters, findFilter, updateFilter]);\n\n  // filter out tags that already exist in the static fields\n  const staticTags = datasource.search?.filters?.map((f) => f.tag) || [];\n  staticTags.push('duration');\n  const filteredTags = [...intrinsics, ...tags].filter((t) => !staticTags.includes(t));\n\n  // Dynamic filters are all filters that don't match the ID of a filter in the datasource configuration\n  // The duration tag is a special case since its selector is hard-coded\n  const dynamicFilters = (query.filters || []).filter(\n    (f) => f.tag !== 'duration' && (datasource.search?.filters?.findIndex((sf) => sf.id === f.id) || 0) === -1\n  );\n\n  return (\n    <>\n      <div className={styles.container}>\n        <div>\n          {datasource.search?.filters?.map((f) => (\n            <InlineSearchField\n              key={f.id}\n              label={filterTitle(f)}\n              tooltip={`Filter your search by ${filterScopedTag(\n                f\n              )}. To modify the default filters shown for search visit the Tempo datasource configuration page.`}\n            >\n              <SearchField\n                filter={findFilter(f.id) || f}\n                datasource={datasource}\n                setError={setError}\n                updateFilter={updateFilter}\n                tags={[]}\n                hideScope={true}\n                hideTag={true}\n              />\n            </InlineSearchField>\n          ))}\n          <InlineSearchField\n            label={'Duration'}\n            tooltip=\"The span duration, i.e.\tend - start time of the span. Accepted units are ns, ms, s, m, h\"\n          >\n            <HorizontalGroup spacing={'sm'}>\n              <DurationInput\n                filter={\n                  findFilter('min-duration') || {\n                    id: 'min-duration',\n                    tag: 'duration',\n                    operator: '>',\n                    valueType: 'duration',\n                  }\n                }\n                operators={['>', '>=']}\n                updateFilter={updateFilter}\n              />\n              <DurationInput\n                filter={\n                  findFilter('max-duration') || {\n                    id: 'max-duration',\n                    tag: 'duration',\n                    operator: '<',\n                    valueType: 'duration',\n                  }\n                }\n                operators={['<', '<=']}\n                updateFilter={updateFilter}\n              />\n            </HorizontalGroup>\n          </InlineSearchField>\n          <InlineSearchField label={'Tags'}>\n            <TagsInput\n              filters={dynamicFilters}\n              datasource={datasource}\n              setError={setError}\n              updateFilter={updateFilter}\n              deleteFilter={deleteFilter}\n              tags={filteredTags}\n              isTagsLoading={isTagsLoading}\n            />\n          </InlineSearchField>\n        </div>\n        <EditorRow>\n          <RawQuery query={traceQlQuery} lang={{ grammar: traceqlGrammar, name: 'traceql' }} />\n        </EditorRow>\n        <TempoQueryBuilderOptions onChange={onChange} query={query} />\n      </div>\n      {error ? (\n        <Alert title=\"Unable to connect to Tempo search\" severity=\"info\" className={styles.alert}>\n          Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can\n          configure it in the <a href={`/datasources/edit/${datasource.uid}`}>datasource settings</a>.\n        </Alert>\n      ) : null}\n    </>\n  );\n};\n\nexport default TraceQLSearch;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  alert: css`\n    max-width: 75ch;\n    margin-top: ${theme.spacing(2)};\n  `,\n  container: css`\n    display: flex;\n    gap: 4px;\n    flex-wrap: wrap;\n    flex-direction: column;\n  `,\n});\n","import { DataSourceJsonData, KeyValue } from '@grafana/data/src';\nimport { NodeGraphOptions } from 'app/core/components/NodeGraphSettings';\nimport { TraceToLogsOptions } from 'app/core/components/TraceToLogs/TraceToLogsSettings';\n\nimport { LokiQuery } from '../loki/types';\n\nimport { TempoQuery as TempoBase, TempoQueryType, TraceqlFilter } from './dataquery.gen';\n\nexport interface SearchQueryParams {\n  minDuration?: string;\n  maxDuration?: string;\n  limit?: number;\n  tags?: string;\n  start?: number;\n  end?: number;\n}\n\nexport interface TempoJsonData extends DataSourceJsonData {\n  tracesToLogs?: TraceToLogsOptions;\n  serviceMap?: {\n    datasourceUid?: string;\n  };\n  search?: {\n    hide?: boolean;\n    filters?: TraceqlFilter[];\n  };\n  nodeGraph?: NodeGraphOptions;\n  lokiSearch?: {\n    datasourceUid?: string;\n  };\n  spanBar?: {\n    tag: string;\n  };\n  traceQuery?: {\n    timeShiftEnabled?: boolean;\n    spanStartTimeShift?: string;\n    spanEndTimeShift?: string;\n  };\n}\n\nexport interface TempoQuery extends TempoBase {\n  // Query to find list of traces, e.g., via Loki\n  // TODO change this field to the schema type when LokiQuery exists in the schema\n  linkedQuery?: LokiQuery;\n  queryType: TempoQueryType;\n}\n\nexport interface MyDataSourceOptions extends DataSourceJsonData {}\n\nexport const defaultQuery: Partial<TempoQuery> = {};\n\nexport type TraceSearchMetadata = {\n  traceID: string;\n  rootServiceName: string;\n  rootTraceName: string;\n  startTimeUnixNano?: string;\n  durationMs?: number;\n  spanSet?: { spans: Span[] };\n};\n\nexport type SearchMetrics = {\n  inspectedTraces?: number;\n  inspectedBytes?: number;\n  inspectedBlocks?: number;\n  skippedBlocks?: number;\n  skippedTraces?: number;\n  totalBlockBytes?: number;\n  spanSets?: Spanset[];\n};\n\nexport enum SpanKind {\n  UNSPECIFIED,\n  INTERNAL,\n  SERVER,\n  CLIENT,\n  PRODUCER,\n  CONSUMER,\n}\n\nexport type Span = {\n  durationNanos: string;\n  traceId?: string;\n  spanID: string;\n  traceState?: string;\n  parentSpanId?: string;\n  name?: string;\n  kind?: SpanKind;\n  startTimeUnixNano: string;\n  endTimeUnixNano?: string;\n  attributes?: Array<{\n    key: string;\n    value: { stringValue?: string; intValue?: string; boolValue?: boolean; doubleValue?: string };\n  }>;\n  dropped_attributes_count?: number;\n};\n\nexport type Spanset = {\n  attributes: KeyValue[];\n  spans: Span[];\n};\n\nexport type SearchResponse = {\n  traces: TraceSearchMetadata[];\n  metrics: SearchMetrics;\n};\n","import { SelectableValue } from '@grafana/data';\nimport { isFetchError } from '@grafana/runtime';\nimport type { Monaco, monacoTypes } from '@grafana/ui';\n\nimport { createErrorNotification } from '../../../../core/copy/appNotification';\nimport { notifyApp } from '../../../../core/reducers/appNotification';\nimport { dispatch } from '../../../../store/store';\nimport TempoLanguageProvider from '../language_provider';\n\nimport { intrinsics, scopes } from './traceql';\n\ninterface Props {\n  languageProvider: TempoLanguageProvider;\n}\n\n/**\n * Class that implements CompletionItemProvider interface and allows us to provide suggestion for the Monaco\n * autocomplete system.\n */\nexport class CompletionProvider implements monacoTypes.languages.CompletionItemProvider {\n  languageProvider: TempoLanguageProvider;\n  registerInteractionCommandId: string | null;\n\n  constructor(props: Props) {\n    this.languageProvider = props.languageProvider;\n    this.registerInteractionCommandId = null;\n  }\n\n  triggerCharacters = ['{', '.', '[', '(', '=', '~', ' ', '\"'];\n  static readonly operators: string[] = ['=', '-', '+', '<', '>', '>=', '<=', '=~'];\n  static readonly logicalOps: string[] = ['&&', '||'];\n\n  // We set these directly and ae required for the provider to function.\n  monaco: Monaco | undefined;\n  editor: monacoTypes.editor.IStandaloneCodeEditor | undefined;\n\n  private tags: { [tag: string]: Set<string> } = {};\n  private cachedValues: { [key: string]: Array<SelectableValue<string>> } = {};\n\n  provideCompletionItems(\n    model: monacoTypes.editor.ITextModel,\n    position: monacoTypes.Position\n  ): monacoTypes.languages.ProviderResult<monacoTypes.languages.CompletionList> {\n    // Should not happen, this should not be called before it is initialized\n    if (!(this.monaco && this.editor)) {\n      throw new Error('provideCompletionItems called before CompletionProvider was initialized');\n    }\n\n    // if the model-id does not match, then this call is from a different editor-instance,\n    // not \"our instance\", so return nothing\n    if (this.editor.getModel()?.id !== model.id) {\n      return { suggestions: [] };\n    }\n\n    const { range, offset } = getRangeAndOffset(this.monaco, model, position);\n    const situation = this.getSituation(model.getValue(), offset);\n    const completionItems = this.getCompletions(situation);\n\n    return completionItems.then((items) => {\n      // monaco by-default alphabetically orders the items.\n      // to stop it, we use a number-as-string sortkey,\n      // so that monaco keeps the order we use\n      const maxIndexDigits = items.length.toString().length;\n      const suggestions: monacoTypes.languages.CompletionItem[] = items.map((item, index) => {\n        const suggestion: monacoTypes.languages.CompletionItem = {\n          kind: getMonacoCompletionItemKind(item.type, this.monaco!),\n          label: item.label,\n          insertText: item.insertText,\n          sortText: index.toString().padStart(maxIndexDigits, '0'), // to force the order we have\n          range,\n          command: {\n            id: this.registerInteractionCommandId || 'noOp',\n            title: 'Report Interaction',\n            arguments: [item.label, item.type],\n          },\n        };\n        fixSuggestion(suggestion, item.type, model, offset);\n        return suggestion;\n      });\n      return { suggestions };\n    });\n  }\n\n  /**\n   * We expect the tags list data directly from the request and assign it an empty set here.\n   */\n  setTags(tags: string[]) {\n    tags.forEach((t) => (this.tags[t] = new Set<string>()));\n  }\n\n  /**\n   * Set the ID for the registerInteraction command, to be used to keep track of how many completions are used by the users\n   */\n  setRegisterInteractionCommandId(id: string | null) {\n    this.registerInteractionCommandId = id;\n  }\n\n  private async getTagValues(tagName: string): Promise<Array<SelectableValue<string>>> {\n    let tagValues: Array<SelectableValue<string>>;\n\n    if (this.cachedValues.hasOwnProperty(tagName)) {\n      tagValues = this.cachedValues[tagName];\n    } else {\n      tagValues = await this.languageProvider.getOptionsV2(tagName);\n      this.cachedValues[tagName] = tagValues;\n    }\n    return tagValues;\n  }\n\n  /**\n   * Get suggestion based on the situation we are in like whether we should suggest tag names or values.\n   * @param situation\n   * @private\n   */\n  private async getCompletions(situation: Situation): Promise<Completion[]> {\n    if (!Object.keys(this.tags).length) {\n      return [];\n    }\n    switch (situation.type) {\n      // Not really sure what would make sense to suggest in this case so just leave it\n      case 'UNKNOWN': {\n        return [];\n      }\n      case 'EMPTY': {\n        return this.getScopesCompletions('{ ')\n          .concat(this.getIntrinsicsCompletions('{ '))\n          .concat(this.getTagsCompletions('{ .'));\n      }\n      case 'SPANSET_EMPTY':\n        return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions('.'));\n      case 'SPANSET_ONLY_DOT': {\n        return this.getTagsCompletions();\n      }\n      case 'SPANSET_IN_NAME':\n        return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions());\n      case 'SPANSET_IN_NAME_SCOPE':\n        return this.getTagsCompletions();\n      case 'SPANSET_AFTER_NAME':\n        return CompletionProvider.operators.map((key) => ({\n          label: key,\n          insertText: key,\n          type: 'OPERATOR',\n        }));\n      case 'SPANSET_IN_VALUE':\n        let tagValues;\n        try {\n          tagValues = await this.getTagValues(situation.tagName);\n        } catch (error) {\n          if (isFetchError(error)) {\n            dispatch(notifyApp(createErrorNotification(error.data.error, new Error(error.data.message))));\n          } else if (error instanceof Error) {\n            dispatch(notifyApp(createErrorNotification('Error', error)));\n          }\n        }\n\n        const items: Completion[] = [];\n\n        const getInsertionText = (val: SelectableValue<string>): string => {\n          if (situation.betweenQuotes) {\n            return val.label!;\n          }\n          return val.type === 'string' ? `\"${val.label}\"` : val.label!;\n        };\n\n        tagValues?.forEach((val) => {\n          if (val?.label) {\n            items.push({\n              label: val.label,\n              insertText: getInsertionText(val),\n              type: 'TAG_VALUE',\n            });\n          }\n        });\n        return items;\n      case 'SPANSET_AFTER_VALUE':\n        return CompletionProvider.logicalOps.concat('}').map((key) => ({\n          label: key,\n          insertText: key,\n          type: 'OPERATOR',\n        }));\n      default:\n        throw new Error(`Unexpected situation ${situation}`);\n    }\n  }\n\n  private getTagsCompletions(prepend?: string): Completion[] {\n    return Object.keys(this.tags)\n      .sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'accent' }))\n      .map((key) => ({\n        label: key,\n        insertText: (prepend || '') + key,\n        type: 'TAG_NAME',\n      }));\n  }\n\n  private getIntrinsicsCompletions(prepend?: string): Completion[] {\n    return intrinsics.map((key) => ({\n      label: key,\n      insertText: (prepend || '') + key,\n      type: 'KEYWORD',\n    }));\n  }\n\n  private getScopesCompletions(prepend?: string): Completion[] {\n    return scopes.map((key) => ({\n      label: key,\n      insertText: (prepend || '') + key,\n      type: 'SCOPE',\n    }));\n  }\n\n  private getSituationInSpanSet(textUntilCaret: string): Situation {\n    const nameRegex = /(?<name>[\\w./-]+)?/;\n    const opRegex = /(?<op>[!=+\\-<>]+)/;\n    // only allow spaces in the value if it's enclosed by quotes\n    const valueRegex = /(?<value>(?<open_quote>\")([^\"\\n&|]+)?(?<close_quote>\")?|([^\"\\n\\s&|]+))?/;\n\n    // prettier-ignore\n    const fullRegex = new RegExp(\n      '([\\\\s{])' +      // Space(s) or initial opening bracket {\n      '(' +                   // Open full set group\n      nameRegex.source +\n      '(?<space1>\\\\s*)' +     // Optional space(s) between name and operator\n      '(' +                   // Open operator + value group\n      opRegex.source +\n      '(?<space2>\\\\s*)' +     // Optional space(s) between operator and value\n      valueRegex.source +\n      ')?' +                  // Close operator + value group\n      ')' +                   // Close full set group\n      '(?<space3>\\\\s*)$'      // Optional space(s) at the end of the set\n    );\n\n    const matched = textUntilCaret.match(fullRegex);\n\n    if (matched) {\n      const nameFull = matched.groups?.name;\n      const op = matched.groups?.op;\n\n      if (!nameFull) {\n        return {\n          type: 'SPANSET_EMPTY',\n        };\n      }\n\n      if (nameFull === '.') {\n        return {\n          type: 'SPANSET_ONLY_DOT',\n        };\n      }\n\n      const nameMatched = nameFull.match(/^(?<pre_dot>\\.)?(?<word>\\w[\\w./-]*\\w)(?<post_dot>\\.)?$/);\n\n      // We already have a (potentially partial) tag name so let's check if there's an operator declared\n      // { .tag_name|\n      if (!op) {\n        // There's no operator so we check if the name is one of the known scopes\n        // { resource.|\n        if (scopes.filter((w) => w === nameMatched?.groups?.word) && nameMatched?.groups?.post_dot) {\n          return {\n            type: 'SPANSET_IN_NAME_SCOPE',\n          };\n        }\n        // It's not one of the scopes, so we now check if we're after the name (there's a space after the word) or if we still have to autocomplete the rest of the name\n        // In case there's a space we start autocompleting the operators { .http.method |\n        // Otherwise we keep showing the tags/intrinsics/scopes list { .http.met|\n        return {\n          type: matched.groups?.space1 ? 'SPANSET_AFTER_NAME' : 'SPANSET_IN_NAME',\n        };\n      }\n\n      // In case there's a space after the full [name + operator + value] group we can start autocompleting logical operators or close the spanset\n      // To avoid triggering this situation when we are writing a space inside a string we check the state of the open and close quotes\n      // { .http.method = \"GET\" |\n      if (matched.groups?.space3 && matched.groups.open_quote === matched.groups.close_quote) {\n        return {\n          type: 'SPANSET_AFTER_VALUE',\n        };\n      }\n\n      // We already have an operator and know that the set isn't complete so let's autocomplete the possible values for the tag name\n      // { .http.method = |\n      return {\n        type: 'SPANSET_IN_VALUE',\n        tagName: nameFull,\n        betweenQuotes: !!matched.groups?.open_quote,\n      };\n    }\n\n    return {\n      type: 'EMPTY',\n    };\n  }\n\n  /**\n   * Figure out where is the cursor and what kind of suggestions are appropriate.\n   * @param text\n   * @param offset\n   */\n  private getSituation(text: string, offset: number): Situation {\n    if (text === '' || offset === 0) {\n      return {\n        type: 'EMPTY',\n      };\n    }\n\n    const textUntilCaret = text.substring(0, offset);\n\n    // Check if we're inside a span set\n    let isInSpanSet = textUntilCaret.lastIndexOf('{') > textUntilCaret.lastIndexOf('}');\n    if (isInSpanSet) {\n      return this.getSituationInSpanSet(textUntilCaret);\n    }\n\n    // Will happen only if user writes something that isn't really a tag selector\n    return {\n      type: 'UNKNOWN',\n    };\n  }\n}\n\n/**\n * Get item kind which is used for icon next to the suggestion.\n * @param type\n * @param monaco\n */\nfunction getMonacoCompletionItemKind(type: CompletionType, monaco: Monaco): monacoTypes.languages.CompletionItemKind {\n  switch (type) {\n    case 'TAG_NAME':\n      return monaco.languages.CompletionItemKind.Enum;\n    case 'KEYWORD':\n      return monaco.languages.CompletionItemKind.Keyword;\n    case 'OPERATOR':\n      return monaco.languages.CompletionItemKind.Operator;\n    case 'TAG_VALUE':\n      return monaco.languages.CompletionItemKind.EnumMember;\n    case 'SCOPE':\n      return monaco.languages.CompletionItemKind.Class;\n    default:\n      throw new Error(`Unexpected CompletionType: ${type}`);\n  }\n}\n\nexport type CompletionType = 'TAG_NAME' | 'TAG_VALUE' | 'KEYWORD' | 'OPERATOR' | 'SCOPE';\ntype Completion = {\n  type: CompletionType;\n  label: string;\n  insertText: string;\n};\n\nexport type Tag = {\n  name: string;\n  value: string;\n};\n\nexport type Situation =\n  | {\n      type: 'UNKNOWN';\n    }\n  | {\n      type: 'EMPTY';\n    }\n  | {\n      type: 'SPANSET_EMPTY';\n    }\n  | {\n      type: 'SPANSET_ONLY_DOT';\n    }\n  | {\n      type: 'SPANSET_AFTER_NAME';\n    }\n  | {\n      type: 'SPANSET_IN_NAME';\n    }\n  | {\n      type: 'SPANSET_IN_NAME_SCOPE';\n    }\n  | {\n      type: 'SPANSET_IN_VALUE';\n      tagName: string;\n      betweenQuotes: boolean;\n    }\n  | {\n      type: 'SPANSET_AFTER_VALUE';\n    };\n\nfunction getRangeAndOffset(monaco: Monaco, model: monacoTypes.editor.ITextModel, position: monacoTypes.Position) {\n  const word = model.getWordAtPosition(position);\n  const range =\n    word != null\n      ? monaco.Range.lift({\n          startLineNumber: position.lineNumber,\n          endLineNumber: position.lineNumber,\n          startColumn: word.startColumn,\n          endColumn: word.endColumn,\n        })\n      : monaco.Range.fromPositions(position);\n\n  // documentation says `position` will be \"adjusted\" in `getOffsetAt` so we clone it here just for sure.\n  const positionClone = {\n    column: position.column,\n    lineNumber: position.lineNumber,\n  };\n\n  const offset = model.getOffsetAt(positionClone);\n  return { offset, range };\n}\n\n/**\n * Fix the suggestions range and insert text. For the range we have to adjust because monaco by default replaces just\n * the last word which stops at dot while traceQL tags contain dots themselves and we want to replace the whole tag\n * name when suggesting. The insert text needs to be adjusted for scope (leading dot) if scope is currently missing.\n * This may be doable also when creating the suggestions but for a particular situation this seems to be easier to do\n * here.\n */\nfunction fixSuggestion(\n  suggestion: monacoTypes.languages.CompletionItem,\n  itemType: CompletionType,\n  model: monacoTypes.editor.ITextModel,\n  offset: number\n) {\n  if (itemType === 'TAG_NAME') {\n    const match = model\n      .getValue()\n      .substring(0, offset)\n      .match(/(span\\.|resource\\.|\\.)?([\\w./-]*)$/);\n\n    if (match) {\n      const scope = match[1];\n      const tag = match[2];\n\n      if (tag) {\n        // Add the default scope if needed.\n        if (!scope && suggestion.insertText[0] !== '.') {\n          suggestion.insertText = '.' + suggestion.insertText;\n        }\n\n        // Adjust the range, so that we will replace the whole tag.\n        suggestion.range = {\n          ...suggestion.range,\n          startColumn: offset - tag.length + 1,\n        };\n      }\n    }\n  }\n}\n","import { css } from '@emotion/css';\nimport type { languages } from 'monaco-editor';\nimport React, { useEffect, useRef } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { CodeEditor, Monaco, monacoTypes, useTheme2 } from '@grafana/ui';\n\nimport { createErrorNotification } from '../../../../core/copy/appNotification';\nimport { notifyApp } from '../../../../core/reducers/appNotification';\nimport { dispatch } from '../../../../store/store';\nimport { TempoDatasource } from '../datasource';\n\nimport { CompletionProvider, CompletionType } from './autocomplete';\nimport { languageDefinition } from './traceql';\n\ninterface Props {\n  placeholder: string;\n  value: string;\n  onChange: (val: string) => void;\n  onRunQuery: () => void;\n  datasource: TempoDatasource;\n  readOnly?: boolean;\n}\n\nexport function TraceQLEditor(props: Props) {\n  const { onChange, onRunQuery, placeholder } = props;\n  const setupAutocompleteFn = useAutocomplete(props.datasource);\n  const theme = useTheme2();\n  const styles = getStyles(theme, placeholder);\n\n  return (\n    <CodeEditor\n      value={props.value}\n      language={langId}\n      onBlur={onChange}\n      onChange={onChange}\n      containerStyles={styles.queryField}\n      readOnly={props.readOnly}\n      monacoOptions={{\n        folding: false,\n        fontSize: 14,\n        lineNumbers: 'off',\n        overviewRulerLanes: 0,\n        renderLineHighlight: 'none',\n        scrollbar: {\n          vertical: 'hidden',\n          verticalScrollbarSize: 8, // used as \"padding-right\"\n          horizontal: 'hidden',\n          horizontalScrollbarSize: 0,\n        },\n        scrollBeyondLastLine: false,\n        wordWrap: 'on',\n      }}\n      onBeforeEditorMount={ensureTraceQL}\n      onEditorDidMount={(editor, monaco) => {\n        if (!props.readOnly) {\n          setupAutocompleteFn(editor, monaco, setupRegisterInteractionCommand(editor));\n          setupActions(editor, monaco, onRunQuery);\n          setupPlaceholder(editor, monaco, styles);\n        }\n        setupAutoSize(editor);\n      }}\n    />\n  );\n}\n\nfunction setupPlaceholder(editor: monacoTypes.editor.IStandaloneCodeEditor, monaco: Monaco, styles: EditorStyles) {\n  const placeholderDecorators = [\n    {\n      range: new monaco.Range(1, 1, 1, 1),\n      options: {\n        className: styles.placeholder, // The placeholder text is in styles.placeholder\n        isWholeLine: true,\n      },\n    },\n  ];\n\n  let decorators: string[] = [];\n\n  const checkDecorators = (): void => {\n    const model = editor.getModel();\n\n    if (!model) {\n      return;\n    }\n\n    const newDecorators = model.getValueLength() === 0 ? placeholderDecorators : [];\n    decorators = model.deltaDecorations(decorators, newDecorators);\n  };\n\n  checkDecorators();\n  editor.onDidChangeModelContent(checkDecorators);\n}\n\nfunction setupActions(editor: monacoTypes.editor.IStandaloneCodeEditor, monaco: Monaco, onRunQuery: () => void) {\n  editor.addAction({\n    id: 'run-query',\n    label: 'Run Query',\n    keybindings: [monaco.KeyMod.Shift | monaco.KeyCode.Enter],\n    contextMenuGroupId: 'navigation',\n    contextMenuOrder: 1.5,\n    run: function () {\n      onRunQuery();\n    },\n  });\n}\n\nfunction setupRegisterInteractionCommand(editor: monacoTypes.editor.IStandaloneCodeEditor): string | null {\n  return editor.addCommand(0, function (_, label, type: CompletionType) {\n    const properties: Record<string, unknown> = { datasourceType: 'tempo', type };\n    // Filter out the label for TAG_VALUE completions to avoid potentially exposing sensitive data\n    if (type !== 'TAG_VALUE') {\n      properties.label = label;\n    }\n    reportInteraction('grafana_traces_traceql_completion', properties);\n  });\n}\n\nfunction setupAutoSize(editor: monacoTypes.editor.IStandaloneCodeEditor) {\n  const container = editor.getDomNode();\n  const updateHeight = () => {\n    if (container) {\n      const contentHeight = Math.min(1000, editor.getContentHeight());\n      const width = parseInt(container.style.width, 10);\n      container.style.width = `${width}px`;\n      container.style.height = `${contentHeight}px`;\n      editor.layout({ width, height: contentHeight });\n    }\n  };\n  editor.onDidContentSizeChange(updateHeight);\n  updateHeight();\n}\n\n/**\n * Hook that returns function that will set up monaco autocomplete for the label selector\n * @param datasource\n */\nfunction useAutocomplete(datasource: TempoDatasource) {\n  // We need the provider ref so we can pass it the label/values data later. This is because we run the call for the\n  // values here but there is additional setup needed for the provider later on. We could run the getSeries() in the\n  // returned function but that is run after the monaco is mounted so would delay the request a bit when it does not\n  // need to.\n  const providerRef = useRef<CompletionProvider>(\n    new CompletionProvider({ languageProvider: datasource.languageProvider })\n  );\n\n  useEffect(() => {\n    const fetchTags = async () => {\n      try {\n        await datasource.languageProvider.start();\n        const tags = datasource.languageProvider.getTags();\n\n        if (tags) {\n          // This is needed because the /api/v2/search/tag/${tag}/values API expects \"status\" and the v1 API expects \"status.code\"\n          // so Tempo doesn't send anything and we inject it here for the autocomplete\n          if (!tags.find((t) => t === 'status')) {\n            tags.push('status');\n          }\n          providerRef.current.setTags(tags);\n        }\n      } catch (error) {\n        if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n      }\n    };\n    fetchTags();\n  }, [datasource]);\n\n  const autocompleteDisposeFun = useRef<(() => void) | null>(null);\n  useEffect(() => {\n    // when we unmount, we unregister the autocomplete-function, if it was registered\n    return () => {\n      autocompleteDisposeFun.current?.();\n    };\n  }, []);\n\n  // This should be run in monaco onEditorDidMount\n  return (\n    editor: monacoTypes.editor.IStandaloneCodeEditor,\n    monaco: Monaco,\n    registerInteractionCommandId: string | null\n  ) => {\n    providerRef.current.editor = editor;\n    providerRef.current.monaco = monaco;\n    providerRef.current.setRegisterInteractionCommandId(registerInteractionCommandId);\n\n    const { dispose } = monaco.languages.registerCompletionItemProvider(langId, providerRef.current);\n    autocompleteDisposeFun.current = dispose;\n  };\n}\n\n// we must only run the setup code once\nlet traceqlSetupDone = false;\nconst langId = 'traceql';\n\nfunction ensureTraceQL(monaco: Monaco) {\n  if (!traceqlSetupDone) {\n    traceqlSetupDone = true;\n    const { aliases, extensions, mimetypes, def } = languageDefinition;\n    monaco.languages.register({ id: langId, aliases, extensions, mimetypes });\n    monaco.languages.setMonarchTokensProvider(langId, def.language as languages.IMonarchLanguage);\n    monaco.languages.setLanguageConfiguration(langId, def.languageConfiguration as languages.LanguageConfiguration);\n  }\n}\n\ninterface EditorStyles {\n  placeholder: string;\n  queryField: string;\n}\n\nconst getStyles = (theme: GrafanaTheme2, placeholder: string): EditorStyles => {\n  return {\n    queryField: css`\n      border-radius: ${theme.shape.borderRadius()};\n      border: 1px solid ${theme.components.input.borderColor};\n      flex: 1;\n    `,\n    placeholder: css`\n      ::after {\n        content: '${placeholder}';\n        font-family: ${theme.typography.fontFamilyMonospace};\n        opacity: 0.3;\n      }\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport { defaults } from 'lodash';\nimport React from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { InlineLabel, useStyles2 } from '@grafana/ui';\n\nimport { TempoDatasource } from '../datasource';\nimport { defaultQuery, MyDataSourceOptions, TempoQuery } from '../types';\n\nimport { TempoQueryBuilderOptions } from './TempoQueryBuilderOptions';\nimport { TraceQLEditor } from './TraceQLEditor';\n\ntype Props = QueryEditorProps<TempoDatasource, TempoQuery, MyDataSourceOptions>;\n\nexport function QueryEditor(props: Props) {\n  const styles = useStyles2(getStyles);\n  const query = defaults(props.query, defaultQuery);\n\n  const onEditorChange = (value: string) => {\n    props.onChange({ ...query, query: value });\n  };\n\n  return (\n    <>\n      <InlineLabel>\n        Build complex queries using TraceQL to select a list of traces.{' '}\n        <a rel=\"noreferrer\" target=\"_blank\" href=\"https://grafana.com/docs/tempo/latest/traceql/\">\n          Documentation\n        </a>\n      </InlineLabel>\n      <TraceQLEditor\n        placeholder=\"Enter a TraceQL query or trace ID (run with Shift+Enter)\"\n        value={query.query}\n        onChange={onEditorChange}\n        datasource={props.datasource}\n        onRunQuery={props.onRunQuery}\n      />\n      <div className={styles.optionsContainer}>\n        <TempoQueryBuilderOptions query={query} onChange={props.onChange} />\n      </div>\n    </>\n  );\n}\n\nconst getStyles = () => ({\n  optionsContainer: css`\n    margin-top: 10px;\n  `,\n});\n","import { SelectableValue } from '@grafana/data';\nimport type { Monaco, monacoTypes } from '@grafana/ui';\n\nimport TempoLanguageProvider from '../../language_provider';\n\ninterface Props {\n  languageProvider: TempoLanguageProvider;\n}\n\n/**\n * Class that implements CompletionItemProvider interface and allows us to provide suggestion for the Monaco\n * autocomplete system.\n */\nexport class CompletionProvider implements monacoTypes.languages.CompletionItemProvider {\n  languageProvider: TempoLanguageProvider;\n\n  constructor(props: Props) {\n    this.languageProvider = props.languageProvider;\n  }\n\n  triggerCharacters = ['=', ' '];\n\n  // We set these directly and ae required for the provider to function.\n  monaco: Monaco | undefined;\n  editor: monacoTypes.editor.IStandaloneCodeEditor | undefined;\n\n  private tags: { [tag: string]: Set<string> } = {};\n  private cachedValues: { [key: string]: Array<SelectableValue<string>> } = {};\n\n  provideCompletionItems(\n    model: monacoTypes.editor.ITextModel,\n    position: monacoTypes.Position\n  ): monacoTypes.languages.ProviderResult<monacoTypes.languages.CompletionList> {\n    // Should not happen, this should not be called before it is initialized\n    if (!(this.monaco && this.editor)) {\n      throw new Error('provideCompletionItems called before CompletionProvider was initialized');\n    }\n\n    // if the model-id does not match, then this call is from a different editor-instance,\n    // not \"our instance\", so return nothing\n    if (this.editor.getModel()?.id !== model.id) {\n      return { suggestions: [] };\n    }\n\n    const { range, offset } = getRangeAndOffset(this.monaco, model, position);\n    const situation = this.getSituation(model.getValue(), offset);\n    const completionItems = this.getCompletions(situation);\n\n    return completionItems.then((items) => {\n      // monaco by-default alphabetically orders the items.\n      // to stop it, we use a number-as-string sortkey,\n      // so that monaco keeps the order we use\n      const maxIndexDigits = items.length.toString().length;\n      const suggestions: monacoTypes.languages.CompletionItem[] = items.map((item, index) => {\n        const suggestion: monacoTypes.languages.CompletionItem = {\n          kind: getMonacoCompletionItemKind(item.type, this.monaco!),\n          label: item.label,\n          insertText: item.insertText,\n          sortText: index.toString().padStart(maxIndexDigits, '0'), // to force the order we have\n          range,\n        };\n        return suggestion;\n      });\n      return { suggestions };\n    });\n  }\n\n  /**\n   * We expect the tags list data directly from the request and assign it an empty set here.\n   */\n  setTags(tags: string[]) {\n    tags.forEach((t) => (this.tags[t] = new Set<string>()));\n  }\n\n  private async getTagValues(tagName: string): Promise<Array<SelectableValue<string>>> {\n    let tagValues: Array<SelectableValue<string>>;\n\n    if (this.cachedValues.hasOwnProperty(tagName)) {\n      tagValues = this.cachedValues[tagName];\n    } else {\n      tagValues = await this.languageProvider.getOptionsV1(tagName);\n      this.cachedValues[tagName] = tagValues;\n    }\n    return tagValues;\n  }\n\n  /**\n   * Get suggestion based on the situation we are in like whether we should suggest tag names or values.\n   * @param situation\n   * @private\n   */\n  private async getCompletions(situation: Situation): Promise<Completion[]> {\n    if (!Object.keys(this.tags).length) {\n      return [];\n    }\n    switch (situation.type) {\n      // Not really sure what would make sense to suggest in this case so just leave it\n      case 'UNKNOWN': {\n        return [];\n      }\n      case 'EMPTY': {\n        return this.getTagsCompletions();\n      }\n      case 'IN_NAME':\n        return this.getTagsCompletions();\n      case 'IN_VALUE':\n        const tagValues = await this.getTagValues(situation.tagName);\n        const items: Completion[] = [];\n\n        const getInsertionText = (val: SelectableValue<string>): string => `\"${val.label}\"`;\n\n        tagValues.forEach((val) => {\n          if (val?.label) {\n            items.push({\n              label: val.label,\n              insertText: getInsertionText(val),\n              type: 'TAG_VALUE',\n            });\n          }\n        });\n        return items;\n      default:\n        throw new Error(`Unexpected situation ${situation}`);\n    }\n  }\n\n  private getTagsCompletions(): Completion[] {\n    return Object.keys(this.tags)\n      .sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'accent' }))\n      .map((key) => ({\n        label: key,\n        insertText: key,\n        type: 'TAG_NAME',\n      }));\n  }\n\n  /**\n   * Figure out where is the cursor and what kind of suggestions are appropriate.\n   * @param text\n   * @param offset\n   */\n  private getSituation(text: string, offset: number): Situation {\n    if (text === '' || offset === 0 || text[text.length - 1] === ' ') {\n      return {\n        type: 'EMPTY',\n      };\n    }\n\n    const textUntilCaret = text.substring(0, offset);\n\n    const regex = /(?<key>[^= ]+)(?<equals>=)?(?<value>([^ \"]+)|\"([^\"]*)\")?/;\n    const matches = textUntilCaret.match(new RegExp(regex, 'g'));\n\n    if (matches?.length) {\n      const last = matches[matches.length - 1];\n      const lastMatched = last.match(regex);\n      if (lastMatched) {\n        const key = lastMatched.groups?.key;\n        const equals = lastMatched.groups?.equals;\n\n        if (!key) {\n          return {\n            type: 'EMPTY',\n          };\n        }\n\n        if (!equals) {\n          return {\n            type: 'IN_NAME',\n          };\n        }\n\n        return {\n          type: 'IN_VALUE',\n          tagName: key,\n        };\n      }\n    }\n\n    return {\n      type: 'EMPTY',\n    };\n  }\n}\n\n/**\n * Get item kind which is used for icon next to the suggestion.\n * @param type\n * @param monaco\n */\nfunction getMonacoCompletionItemKind(type: CompletionType, monaco: Monaco): monacoTypes.languages.CompletionItemKind {\n  switch (type) {\n    case 'TAG_NAME':\n      return monaco.languages.CompletionItemKind.Enum;\n    case 'KEYWORD':\n      return monaco.languages.CompletionItemKind.Keyword;\n    case 'OPERATOR':\n      return monaco.languages.CompletionItemKind.Operator;\n    case 'TAG_VALUE':\n      return monaco.languages.CompletionItemKind.EnumMember;\n    case 'SCOPE':\n      return monaco.languages.CompletionItemKind.Class;\n    default:\n      throw new Error(`Unexpected CompletionType: ${type}`);\n  }\n}\n\nexport type CompletionType = 'TAG_NAME' | 'TAG_VALUE' | 'KEYWORD' | 'OPERATOR' | 'SCOPE';\ntype Completion = {\n  type: CompletionType;\n  label: string;\n  insertText: string;\n};\n\nexport type Tag = {\n  name: string;\n  value: string;\n};\n\nexport type Situation =\n  | {\n      type: 'UNKNOWN';\n    }\n  | {\n      type: 'EMPTY';\n    }\n  | {\n      type: 'IN_NAME';\n    }\n  | {\n      type: 'IN_VALUE';\n      tagName: string;\n    };\n\nfunction getRangeAndOffset(monaco: Monaco, model: monacoTypes.editor.ITextModel, position: monacoTypes.Position) {\n  const word = model.getWordAtPosition(position);\n  const range =\n    word != null\n      ? monaco.Range.lift({\n          startLineNumber: position.lineNumber,\n          endLineNumber: position.lineNumber,\n          startColumn: word.startColumn,\n          endColumn: word.endColumn,\n        })\n      : monaco.Range.fromPositions(position);\n\n  // documentation says `position` will be \"adjusted\" in `getOffsetAt` so we clone it here just for sure.\n  const positionClone = {\n    column: position.column,\n    lineNumber: position.lineNumber,\n  };\n\n  const offset = model.getOffsetAt(positionClone);\n  return { offset, range };\n}\n","import type { languages } from 'monaco-editor';\n\nexport const languageConfiguration: languages.LanguageConfiguration = {\n  // the default separators except `@$`\n  wordPattern: /(-?\\d*\\.\\d\\w*)|([^`~!#%^&*()\\-=+\\[{\\]}\\\\|;:'\",.<>\\/?\\s]+)/g,\n  brackets: [\n    ['{', '}'],\n    ['(', ')'],\n  ],\n  autoClosingPairs: [\n    { open: '{', close: '}' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  surroundingPairs: [\n    { open: '{', close: '}' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  folding: {},\n};\n\nconst operators = ['='];\n\nexport const language: languages.IMonarchLanguage = {\n  ignoreCase: false,\n  defaultToken: '',\n  tokenPostfix: '.tagsfield',\n\n  operators,\n\n  // we include these common regular expressions\n  symbols: /[=><!~?:&|+\\-*\\/^%]+/,\n  escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n  digits: /\\d+(_+\\d+)*/,\n  octaldigits: /[0-7]+(_+[0-7]+)*/,\n  binarydigits: /[0-1]+(_+[0-1]+)*/,\n  hexdigits: /[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,\n  integersuffix: /(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,\n  floatsuffix: /[fFlL]?/,\n\n  tokenizer: {\n    root: [\n      // labels\n      [/[a-z_.][\\w./_-]*(?=\\s*(=|!=|>|<|>=|<=|=~|!~))/, 'tag'],\n\n      // all keywords have the same color\n      [\n        /[a-zA-Z_.]\\w*/,\n        {\n          cases: {\n            '@default': 'identifier',\n          },\n        },\n      ],\n\n      // strings\n      [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n      [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n      [/\"/, 'string', '@string_double'],\n      [/'/, 'string', '@string_single'],\n\n      // whitespace\n      { include: '@whitespace' },\n\n      // delimiters and operators\n      [/[{}()\\[\\]]/, '@brackets'],\n      [/[<>](?!@symbols)/, '@brackets'],\n      [\n        /@symbols/,\n        {\n          cases: {\n            '@operators': 'delimiter',\n            '@default': '',\n          },\n        },\n      ],\n\n      // numbers\n      [/\\d+/, 'number'],\n      [/\\d*\\d+[eE]([\\-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/\\d*\\.\\d+([eE][\\-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/, 'number.hex'],\n      [/0[0-7']*[0-7](@integersuffix)/, 'number.octal'],\n      [/0[bB][0-1']*[0-1](@integersuffix)/, 'number.binary'],\n      [/\\d[\\d']*\\d(@integersuffix)/, 'number'],\n      [/\\d(@integersuffix)/, 'number'],\n    ],\n\n    string_double: [\n      [/[^\\\\\"]+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/\"/, 'string', '@pop'],\n    ],\n\n    string_single: [\n      [/[^\\\\']+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/'/, 'string', '@pop'],\n    ],\n\n    clauses: [\n      [/[^(,)]/, 'tag'],\n      [/\\)/, 'identifier', '@pop'],\n    ],\n\n    whitespace: [[/[ \\t\\r\\n]+/, 'white']],\n  },\n};\n\nexport const languageDefinition = {\n  id: 'tagsfield',\n  extensions: ['.tagsfield'],\n  aliases: ['tagsfield'],\n  mimetypes: [],\n  def: {\n    language,\n    languageConfiguration,\n  },\n};\n","import { css } from '@emotion/css';\nimport React, { useEffect, useRef } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { CodeEditor, Monaco, monacoTypes, useTheme2 } from '@grafana/ui';\n\nimport { createErrorNotification } from '../../../../../core/copy/appNotification';\nimport { notifyApp } from '../../../../../core/reducers/appNotification';\nimport { dispatch } from '../../../../../store/store';\nimport { TempoDatasource } from '../../datasource';\n\nimport { CompletionProvider } from './autocomplete';\nimport { languageDefinition } from './syntax';\n\ninterface Props {\n  placeholder: string;\n  value: string;\n  onChange: (val: string) => void;\n  onBlur?: () => void;\n  datasource: TempoDatasource;\n}\n\nexport function TagsField(props: Props) {\n  const { onChange, onBlur, placeholder } = props;\n  const setupAutocompleteFn = useAutocomplete(props.datasource);\n  const theme = useTheme2();\n  const styles = getStyles(theme, placeholder);\n\n  return (\n    <CodeEditor\n      value={props.value}\n      language={langId}\n      onBlur={onBlur}\n      onChange={onChange}\n      containerStyles={styles.queryField}\n      monacoOptions={{\n        folding: false,\n        fontSize: 14,\n        lineNumbers: 'off',\n        overviewRulerLanes: 0,\n        renderLineHighlight: 'none',\n        scrollbar: {\n          vertical: 'hidden',\n          verticalScrollbarSize: 8, // used as \"padding-right\"\n          horizontal: 'hidden',\n          horizontalScrollbarSize: 0,\n        },\n        scrollBeyondLastLine: false,\n        wordWrap: 'on',\n      }}\n      onBeforeEditorMount={ensureTraceQL}\n      onEditorDidMount={(editor, monaco) => {\n        setupAutocompleteFn(editor, monaco);\n        setupPlaceholder(editor, monaco, styles);\n        setupAutoSize(editor);\n      }}\n    />\n  );\n}\n\nfunction setupPlaceholder(editor: monacoTypes.editor.IStandaloneCodeEditor, monaco: Monaco, styles: EditorStyles) {\n  const placeholderDecorators = [\n    {\n      range: new monaco.Range(1, 1, 1, 1),\n      options: {\n        className: styles.placeholder, // The placeholder text is in styles.placeholder\n        isWholeLine: true,\n      },\n    },\n  ];\n\n  let decorators: string[] = [];\n\n  const checkDecorators = (): void => {\n    const model = editor.getModel();\n\n    if (!model) {\n      return;\n    }\n\n    const newDecorators = model.getValueLength() === 0 ? placeholderDecorators : [];\n    decorators = model.deltaDecorations(decorators, newDecorators);\n  };\n\n  checkDecorators();\n  editor.onDidChangeModelContent(checkDecorators);\n}\n\nfunction setupAutoSize(editor: monacoTypes.editor.IStandaloneCodeEditor) {\n  const container = editor.getDomNode();\n  const updateHeight = () => {\n    if (container) {\n      const contentHeight = Math.min(1000, editor.getContentHeight());\n      const width = parseInt(container.style.width, 10);\n      container.style.width = `${width}px`;\n      container.style.height = `${contentHeight}px`;\n      editor.layout({ width, height: contentHeight });\n    }\n  };\n  editor.onDidContentSizeChange(updateHeight);\n  updateHeight();\n}\n\n/**\n * Hook that returns function that will set up monaco autocomplete for the label selector\n * @param datasource\n */\nfunction useAutocomplete(datasource: TempoDatasource) {\n  // We need the provider ref so we can pass it the label/values data later. This is because we run the call for the\n  // values here but there is additional setup needed for the provider later on. We could run the getSeries() in the\n  // returned function but that is run after the monaco is mounted so would delay the request a bit when it does not\n  // need to.\n  const providerRef = useRef<CompletionProvider>(\n    new CompletionProvider({ languageProvider: datasource.languageProvider })\n  );\n\n  useEffect(() => {\n    const fetchTags = async () => {\n      try {\n        await datasource.languageProvider.start();\n        const tags = datasource.languageProvider.getTags();\n\n        if (tags) {\n          // This is needed because the /api/search/tag/${tag}/values API expects \"status.code\" and the v2 API expects \"status\"\n          // so Tempo doesn't send anything and we inject it here for the autocomplete\n          if (!tags.find((t) => t === 'status.code')) {\n            tags.push('status.code');\n          }\n          providerRef.current.setTags(tags);\n        }\n      } catch (error) {\n        if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n      }\n    };\n    fetchTags();\n  }, [datasource]);\n\n  const autocompleteDisposeFun = useRef<(() => void) | null>(null);\n  useEffect(() => {\n    // when we unmount, we unregister the autocomplete-function, if it was registered\n    return () => {\n      autocompleteDisposeFun.current?.();\n    };\n  }, []);\n\n  // This should be run in monaco onEditorDidMount\n  return (editor: monacoTypes.editor.IStandaloneCodeEditor, monaco: Monaco) => {\n    providerRef.current.editor = editor;\n    providerRef.current.monaco = monaco;\n\n    const { dispose } = monaco.languages.registerCompletionItemProvider(langId, providerRef.current);\n    autocompleteDisposeFun.current = dispose;\n  };\n}\n\n// we must only run the setup code once\nlet setupDone = false;\nconst langId = 'tagsfield';\n\nfunction ensureTraceQL(monaco: Monaco) {\n  if (!setupDone) {\n    setupDone = true;\n    const { aliases, extensions, mimetypes, def } = languageDefinition;\n    monaco.languages.register({ id: langId, aliases, extensions, mimetypes });\n    monaco.languages.setMonarchTokensProvider(langId, def.language);\n    monaco.languages.setLanguageConfiguration(langId, def.languageConfiguration);\n  }\n}\n\ninterface EditorStyles {\n  placeholder: string;\n  queryField: string;\n}\n\nconst getStyles = (theme: GrafanaTheme2, placeholder: string): EditorStyles => {\n  return {\n    queryField: css`\n      border-radius: ${theme.shape.borderRadius()};\n      border: 1px solid ${theme.components.input.borderColor};\n      flex: 1;\n    `,\n    placeholder: css`\n      ::after {\n        content: '${placeholder}';\n        font-family: ${theme.typography.fontFamilyMonospace};\n        opacity: 0.3;\n      }\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useCallback, useState, useEffect, useMemo } from 'react';\n\nimport { GrafanaTheme2, isValidGoDuration, SelectableValue, toOption } from '@grafana/data';\nimport { FetchError, getTemplateSrv, isFetchError, TemplateSrv } from '@grafana/runtime';\nimport { InlineFieldRow, InlineField, Input, Alert, useStyles2, fuzzyMatch, Select } from '@grafana/ui';\nimport { notifyApp } from 'app/core/actions';\nimport { createErrorNotification } from 'app/core/copy/appNotification';\nimport { dispatch } from 'app/store/store';\n\nimport { DEFAULT_LIMIT, TempoDatasource } from '../datasource';\nimport TempoLanguageProvider from '../language_provider';\nimport { TempoQuery } from '../types';\n\nimport { TagsField } from './TagsField/TagsField';\n\ninterface Props {\n  datasource: TempoDatasource;\n  query: TempoQuery;\n  onChange: (value: TempoQuery) => void;\n  onBlur?: () => void;\n  onRunQuery: () => void;\n}\n\nconst durationPlaceholder = 'e.g. 1.2s, 100ms';\n\nconst NativeSearch = ({ datasource, query, onChange, onBlur, onRunQuery }: Props) => {\n  const styles = useStyles2(getStyles);\n  const languageProvider = useMemo(() => new TempoLanguageProvider(datasource), [datasource]);\n  const [serviceOptions, setServiceOptions] = useState<Array<SelectableValue<string>>>();\n  const [spanOptions, setSpanOptions] = useState<Array<SelectableValue<string>>>();\n  const [error, setError] = useState<Error | FetchError | null>(null);\n  const [inputErrors, setInputErrors] = useState<{ [key: string]: boolean }>({});\n  const [isLoading, setIsLoading] = useState<{\n    serviceName: boolean;\n    spanName: boolean;\n  }>({\n    serviceName: false,\n    spanName: false,\n  });\n\n  const loadOptions = useCallback(\n    async (name: string, query = '') => {\n      const lpName = name === 'serviceName' ? 'service.name' : 'name';\n      setIsLoading((prevValue) => ({ ...prevValue, [name]: true }));\n\n      try {\n        const options = await languageProvider.getOptionsV1(lpName);\n        const filteredOptions = options.filter((item) => (item.value ? fuzzyMatch(item.value, query).found : false));\n        return filteredOptions;\n      } catch (error) {\n        if (isFetchError(error) && error?.status === 404) {\n          setError(error);\n        } else if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n        return [];\n      } finally {\n        setIsLoading((prevValue) => ({ ...prevValue, [name]: false }));\n      }\n    },\n    [languageProvider]\n  );\n\n  useEffect(() => {\n    const fetchOptions = async () => {\n      try {\n        const [services, spans] = await Promise.all([loadOptions('serviceName'), loadOptions('spanName')]);\n        if (query.serviceName && getTemplateSrv().containsTemplate(query.serviceName)) {\n          services.push(toOption(query.serviceName));\n        }\n        setServiceOptions(services);\n        if (query.spanName && getTemplateSrv().containsTemplate(query.spanName)) {\n          spans.push(toOption(query.spanName));\n        }\n        setSpanOptions(spans);\n      } catch (error) {\n        // Display message if Tempo is connected but search 404's\n        if (isFetchError(error) && error?.status === 404) {\n          setError(error);\n        } else if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n      }\n    };\n    fetchOptions();\n  }, [languageProvider, loadOptions, query.serviceName, query.spanName]);\n\n  const onKeyDown = (keyEvent: React.KeyboardEvent) => {\n    if (keyEvent.key === 'Enter' && (keyEvent.shiftKey || keyEvent.ctrlKey)) {\n      onRunQuery();\n    }\n  };\n\n  const handleOnChange = useCallback(\n    (value: string) => {\n      onChange({\n        ...query,\n        search: value,\n      });\n    },\n    [onChange, query]\n  );\n\n  const templateSrv: TemplateSrv = getTemplateSrv();\n\n  return (\n    <>\n      <div className={styles.container}>\n        <InlineFieldRow>\n          <InlineField label=\"Service Name\" labelWidth={14} grow>\n            <Select\n              inputId=\"service\"\n              options={serviceOptions}\n              onOpenMenu={() => {\n                loadOptions('serviceName');\n              }}\n              isLoading={isLoading.serviceName}\n              value={serviceOptions?.find((v) => v?.value === query.serviceName) || query.serviceName}\n              onChange={(v) => {\n                onChange({\n                  ...query,\n                  serviceName: v?.value,\n                });\n              }}\n              placeholder=\"Select a service\"\n              isClearable\n              onKeyDown={onKeyDown}\n              aria-label={'select-service-name'}\n              allowCustomValue={true}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Span Name\" labelWidth={14} grow>\n            <Select\n              inputId=\"spanName\"\n              options={spanOptions}\n              onOpenMenu={() => {\n                loadOptions('spanName');\n              }}\n              isLoading={isLoading.spanName}\n              value={spanOptions?.find((v) => v?.value === query.spanName) || query.spanName}\n              onChange={(v) => {\n                onChange({\n                  ...query,\n                  spanName: v?.value,\n                });\n              }}\n              placeholder=\"Select a span\"\n              isClearable\n              onKeyDown={onKeyDown}\n              aria-label={'select-span-name'}\n              allowCustomValue={true}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Tags\" labelWidth={14} grow tooltip=\"Values should be in logfmt.\">\n            <TagsField\n              placeholder=\"http.status_code=200 error=true\"\n              value={query.search || ''}\n              onChange={handleOnChange}\n              onBlur={onBlur}\n              datasource={datasource}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Min Duration\" invalid={!!inputErrors.minDuration} labelWidth={14} grow>\n            <Input\n              id=\"minDuration\"\n              value={query.minDuration || ''}\n              placeholder={durationPlaceholder}\n              onBlur={() => {\n                const templatedMinDuration = templateSrv.replace(query.minDuration ?? '');\n                if (query.minDuration && !isValidGoDuration(templatedMinDuration)) {\n                  setInputErrors({ ...inputErrors, minDuration: true });\n                } else {\n                  setInputErrors({ ...inputErrors, minDuration: false });\n                }\n              }}\n              onChange={(v) =>\n                onChange({\n                  ...query,\n                  minDuration: v.currentTarget.value,\n                })\n              }\n              onKeyDown={onKeyDown}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Max Duration\" invalid={!!inputErrors.maxDuration} labelWidth={14} grow>\n            <Input\n              id=\"maxDuration\"\n              value={query.maxDuration || ''}\n              placeholder={durationPlaceholder}\n              onBlur={() => {\n                const templatedMaxDuration = templateSrv.replace(query.maxDuration ?? '');\n                if (query.maxDuration && !isValidGoDuration(templatedMaxDuration)) {\n                  setInputErrors({ ...inputErrors, maxDuration: true });\n                } else {\n                  setInputErrors({ ...inputErrors, maxDuration: false });\n                }\n              }}\n              onChange={(v) =>\n                onChange({\n                  ...query,\n                  maxDuration: v.currentTarget.value,\n                })\n              }\n              onKeyDown={onKeyDown}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField\n            label=\"Limit\"\n            invalid={!!inputErrors.limit}\n            labelWidth={14}\n            grow\n            tooltip=\"Maximum number of returned results\"\n          >\n            <Input\n              id=\"limit\"\n              value={query.limit || ''}\n              placeholder={`Default: ${DEFAULT_LIMIT}`}\n              type=\"number\"\n              onChange={(v) => {\n                let limit = v.currentTarget.value ? parseInt(v.currentTarget.value, 10) : undefined;\n                if (limit && (!Number.isInteger(limit) || limit <= 0)) {\n                  setInputErrors({ ...inputErrors, limit: true });\n                } else {\n                  setInputErrors({ ...inputErrors, limit: false });\n                }\n\n                onChange({\n                  ...query,\n                  limit: v.currentTarget.value ? parseInt(v.currentTarget.value, 10) : undefined,\n                });\n              }}\n              onKeyDown={onKeyDown}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </div>\n      {error ? (\n        <Alert title=\"Unable to connect to Tempo search\" severity=\"info\" className={styles.alert}>\n          Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can\n          configure it in the <a href={`/datasources/edit/${datasource.uid}`}>datasource settings</a>.\n        </Alert>\n      ) : null}\n    </>\n  );\n};\n\nexport default NativeSearch;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    max-width: 500px;\n  `,\n  alert: css`\n    max-width: 75ch;\n    margin-top: ${theme.spacing(2)};\n  `,\n});\n","import { DataSourceApi } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\n\nexport async function getDS(uid?: string): Promise<DataSourceApi | undefined> {\n  if (!uid) {\n    return undefined;\n  }\n\n  const dsSrv = getDataSourceSrv();\n  try {\n    return await dsSrv.get(uid);\n  } catch (error) {\n    console.error('Failed to load data source', error);\n    return undefined;\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, InlineField, InlineFieldRow, useStyles2 } from '@grafana/ui';\n\nimport { AdHocFilter } from '../../../../features/variables/adhoc/picker/AdHocFilter';\nimport { AdHocVariableFilter } from '../../../../features/variables/types';\nimport { PrometheusDatasource } from '../../prometheus/datasource';\nimport { TempoQuery } from '../types';\n\nimport { getDS } from './utils';\n\nexport function ServiceGraphSection({\n  graphDatasourceUid,\n  query,\n  onChange,\n}: {\n  graphDatasourceUid?: string;\n  query: TempoQuery;\n  onChange: (value: TempoQuery) => void;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const dsState = useAsync(() => getDS(graphDatasourceUid), [graphDatasourceUid]);\n\n  // Check if service graph metrics are being collected. If not, displays a warning\n  const [hasKeys, setHasKeys] = useState<boolean | undefined>(undefined);\n  useEffect(() => {\n    async function fn(ds: PrometheusDatasource) {\n      const keys = await ds.getTagKeys({\n        series: [\n          'traces_service_graph_request_server_seconds_sum',\n          'traces_service_graph_request_total',\n          'traces_service_graph_request_failed_total',\n        ],\n      });\n      setHasKeys(Boolean(keys.length));\n    }\n    if (!dsState.loading && dsState.value) {\n      fn(dsState.value as PrometheusDatasource);\n    }\n  }, [dsState]);\n\n  if (dsState.loading) {\n    return null;\n  }\n\n  const ds = dsState.value as PrometheusDatasource;\n\n  if (!graphDatasourceUid) {\n    return <div className=\"text-warning\">Please set up a service graph datasource in the datasource settings.</div>;\n  }\n\n  if (graphDatasourceUid && !ds) {\n    return (\n      <div className=\"text-warning\">\n        Service graph datasource is configured but the data source no longer exists. Please configure existing data\n        source to use the service graph functionality.\n      </div>\n    );\n  }\n  const filters = queryToFilter(query.serviceMapQuery || '');\n\n  return (\n    <div>\n      <InlineFieldRow>\n        <InlineField label=\"Filter\" labelWidth={14} grow>\n          <AdHocFilter\n            datasource={{ uid: graphDatasourceUid }}\n            filters={filters}\n            getTagKeysOptions={{\n              series: ['traces_service_graph_request_total', 'traces_spanmetrics_calls_total'],\n            }}\n            addFilter={(filter: AdHocVariableFilter) => {\n              onChange({\n                ...query,\n                serviceMapQuery: filtersToQuery([...filters, filter]),\n              });\n            }}\n            removeFilter={(index: number) => {\n              const newFilters = [...filters];\n              newFilters.splice(index, 1);\n              onChange({ ...query, serviceMapQuery: filtersToQuery(newFilters) });\n            }}\n            changeFilter={(index: number, filter: AdHocVariableFilter) => {\n              const newFilters = [...filters];\n              newFilters.splice(index, 1, filter);\n              onChange({ ...query, serviceMapQuery: filtersToQuery(newFilters) });\n            }}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      {hasKeys === false ? (\n        <Alert title=\"No service graph data found\" severity=\"info\" className={styles.alert}>\n          Please ensure that service graph metrics are set up correctly according to the{' '}\n          <a\n            target=\"_blank\"\n            rel=\"noreferrer noopener\"\n            href=\"https://grafana.com/docs/tempo/next/grafana-agent/service-graphs/\"\n          >\n            Tempo documentation\n          </a>\n          .\n        </Alert>\n      ) : null}\n    </div>\n  );\n}\n\nfunction queryToFilter(query: string): AdHocVariableFilter[] {\n  let match;\n  let filters: AdHocVariableFilter[] = [];\n  const re = /([\\w_]+)(=|!=|<|>|=~|!~)\"(.*?)\"/g;\n  while ((match = re.exec(query)) !== null) {\n    filters.push({\n      key: match[1],\n      operator: match[2],\n      value: match[3],\n      condition: '',\n    });\n  }\n  return filters;\n}\n\nfunction filtersToQuery(filters: AdHocVariableFilter[]): string {\n  return `{${filters.map((f) => `${f.key}${f.operator}\"${f.value}\"`).join(',')}}`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  alert: css`\n    max-width: 75ch;\n    margin-top: ${theme.spacing(2)};\n  `,\n});\n","import { css } from '@emotion/css';\nimport React from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { QueryEditorProps, SelectableValue } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport {\n  FileDropzone,\n  InlineField,\n  InlineFieldRow,\n  InlineLabel,\n  RadioButtonGroup,\n  Themeable2,\n  withTheme2,\n} from '@grafana/ui';\n\nimport { LokiQueryField } from '../../loki/components/LokiQueryField';\nimport { LokiDatasource } from '../../loki/datasource';\nimport { LokiQuery } from '../../loki/types';\nimport TraceQLSearch from '../SearchTraceQLEditor/TraceQLSearch';\nimport { TempoQueryType } from '../dataquery.gen';\nimport { TempoDatasource } from '../datasource';\nimport { QueryEditor } from '../traceql/QueryEditor';\nimport { TempoQuery } from '../types';\n\nimport NativeSearch from './NativeSearch';\nimport { ServiceGraphSection } from './ServiceGraphSection';\nimport { getDS } from './utils';\n\ninterface Props extends QueryEditorProps<TempoDatasource, TempoQuery>, Themeable2 {}\n\nconst DEFAULT_QUERY_TYPE: TempoQueryType = config.featureToggles.traceqlSearch ? 'traceqlSearch' : 'traceql';\n\nclass TempoQueryFieldComponent extends React.PureComponent<Props> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  // Set the default query type when the component mounts.\n  // Also do this if queryType is 'clear' (which is the case when the user changes the query type)\n  // otherwise if the user changes the query type and refreshes the page, no query type will be selected\n  // which is inconsistent with how the UI was originally when they selected the Tempo data source.\n  async componentDidMount() {\n    if (!this.props.query.queryType || this.props.query.queryType === 'clear') {\n      this.props.onChange({\n        ...this.props.query,\n        queryType: DEFAULT_QUERY_TYPE,\n      });\n    }\n  }\n\n  onChangeLinkedQuery = (value: LokiQuery) => {\n    const { query, onChange } = this.props;\n    onChange({\n      ...query,\n      linkedQuery: { ...value, refId: 'linked' },\n    });\n  };\n\n  onRunLinkedQuery = () => {\n    this.props.onRunQuery();\n  };\n\n  onClearResults = () => {\n    // Run clear query to clear results\n    const { onChange, query, onRunQuery } = this.props;\n    onChange({\n      ...query,\n      queryType: 'clear',\n    });\n    onRunQuery();\n  };\n\n  render() {\n    const { query, onChange, datasource, app } = this.props;\n\n    const logsDatasourceUid = datasource.getLokiSearchDS();\n\n    const graphDatasourceUid = datasource.serviceMap?.datasourceUid;\n\n    let queryTypeOptions: Array<SelectableValue<TempoQueryType>> = [\n      { value: 'traceql', label: 'TraceQL' },\n      { value: 'upload', label: 'JSON File' },\n      { value: 'serviceMap', label: 'Service Graph' },\n    ];\n\n    if (config.featureToggles.traceqlSearch) {\n      queryTypeOptions.unshift({ value: 'traceqlSearch', label: 'Search' });\n    }\n\n    if (!config.featureToggles.traceqlSearch && !datasource?.search?.hide) {\n      queryTypeOptions.unshift({ value: 'nativeSearch', label: 'Search' });\n    }\n\n    if (logsDatasourceUid) {\n      if (datasource?.search?.hide) {\n        // Place at beginning as Search if no native search\n        queryTypeOptions.unshift({ value: 'search', label: 'Search' });\n      } else {\n        // Place at end as Loki Search if native search is enabled\n        queryTypeOptions.push({ value: 'search', label: 'Loki Search' });\n      }\n    }\n\n    return (\n      <>\n        <InlineFieldRow>\n          <InlineField label=\"Query type\">\n            <RadioButtonGroup<TempoQueryType>\n              options={queryTypeOptions}\n              value={query.queryType}\n              onChange={(v) => {\n                reportInteraction('grafana_traces_query_type_changed', {\n                  datasourceType: 'tempo',\n                  app: app ?? '',\n                  grafana_version: config.buildInfo.version,\n                  newQueryType: v,\n                  previousQueryType: query.queryType ?? '',\n                });\n\n                this.onClearResults();\n\n                onChange({\n                  ...query,\n                  queryType: v,\n                });\n              }}\n              size=\"md\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n        {query.queryType === 'search' && (\n          <SearchSection\n            logsDatasourceUid={logsDatasourceUid}\n            query={query}\n            onRunQuery={this.onRunLinkedQuery}\n            onChange={this.onChangeLinkedQuery}\n          />\n        )}\n        {query.queryType === 'nativeSearch' && (\n          <NativeSearch\n            datasource={this.props.datasource}\n            query={query}\n            onChange={onChange}\n            onBlur={this.props.onBlur}\n            onRunQuery={this.props.onRunQuery}\n          />\n        )}\n        {query.queryType === 'traceqlSearch' && (\n          <TraceQLSearch\n            datasource={this.props.datasource}\n            query={query}\n            onChange={onChange}\n            onBlur={this.props.onBlur}\n          />\n        )}\n        {query.queryType === 'upload' && (\n          <div className={css({ padding: this.props.theme.spacing(2) })}>\n            <FileDropzone\n              options={{ multiple: false }}\n              onLoad={(result) => {\n                this.props.datasource.uploadedJson = result;\n                this.props.onRunQuery();\n              }}\n            />\n          </div>\n        )}\n        {query.queryType === 'serviceMap' && (\n          <ServiceGraphSection graphDatasourceUid={graphDatasourceUid} query={query} onChange={onChange} />\n        )}\n        {query.queryType === 'traceql' && (\n          <QueryEditor\n            datasource={this.props.datasource}\n            query={query}\n            onRunQuery={this.props.onRunQuery}\n            onChange={onChange}\n          />\n        )}\n      </>\n    );\n  }\n}\n\ninterface SearchSectionProps {\n  logsDatasourceUid?: string;\n  onChange: (value: LokiQuery) => void;\n  onRunQuery: () => void;\n  query: TempoQuery;\n}\nfunction SearchSection({ logsDatasourceUid, onChange, onRunQuery, query }: SearchSectionProps) {\n  const dsState = useAsync(() => getDS(logsDatasourceUid), [logsDatasourceUid]);\n  if (dsState.loading) {\n    return null;\n  }\n\n  const ds = dsState.value as LokiDatasource;\n\n  if (ds) {\n    return (\n      <>\n        <InlineLabel>Tempo uses {ds.name} to find traces.</InlineLabel>\n        <LokiQueryField\n          datasource={ds}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          query={query.linkedQuery ?? ({ refId: 'linked' } as LokiQuery)}\n          history={[]}\n        />\n      </>\n    );\n  }\n\n  if (!logsDatasourceUid) {\n    return <div className=\"text-warning\">Please set up a Loki search datasource in the datasource settings.</div>;\n  }\n\n  if (logsDatasourceUid && !ds) {\n    return (\n      <div className=\"text-warning\">\n        Loki search datasource is configured but the data source no longer exists. Please configure existing data source\n        to use the search.\n      </div>\n    );\n  }\n\n  return null;\n}\n\nexport const TempoQueryField = withTheme2(TempoQueryFieldComponent);\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps, GrafanaTheme2, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { InlineField, InlineFieldRow, InlineSwitch, Input, useStyles2 } from '@grafana/ui';\nimport { DocsLinkButton } from 'app/core/components/DocsLinkButton';\n\nimport { TempoJsonData } from '../types';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {}\n\nexport function QuerySettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">TraceID query</h3>\n\n      <div className={styles.infoText}>\n        Modify how TraceID queries are run\n        <DocsLinkButton hrefSuffix=\"tempo/#traceid-query\" />\n      </div>\n\n      <InlineField\n        label=\"Use time range in query\"\n        tooltip=\"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled\"\n        labelWidth={26}\n      >\n        <InlineSwitch\n          id=\"enable-time-shift\"\n          value={options.jsonData.traceQuery?.timeShiftEnabled || false}\n          onChange={(event) => {\n            updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'traceQuery', {\n              ...options.jsonData.traceQuery,\n              timeShiftEnabled: event.currentTarget.checked,\n            });\n          }}\n        />\n      </InlineField>\n      <InlineFieldRow>\n        <InlineField\n          label=\"Time shift for start of search\"\n          labelWidth={26}\n          disabled={!options.jsonData.traceQuery?.timeShiftEnabled}\n          grow\n          tooltip=\"Shifts the start of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h)\"\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"30m\"\n            width={40}\n            onChange={(v) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'traceQuery', {\n                ...options.jsonData.traceQuery,\n                spanStartTimeShift: v.currentTarget.value,\n              })\n            }\n            value={options.jsonData.traceQuery?.spanStartTimeShift || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField\n          label=\"Time shift for end of search\"\n          labelWidth={26}\n          disabled={!options.jsonData.traceQuery?.timeShiftEnabled}\n          grow\n          tooltip=\"Shifts the end of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h)\"\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"30m\"\n            width={40}\n            onChange={(v) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'traceQuery', {\n                ...options.jsonData.traceQuery,\n                spanEndTimeShift: v.currentTarget.value,\n              })\n            }\n            value={options.jsonData.traceQuery?.spanEndTimeShift || ''}\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </div>\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  infoText: css`\n    padding-bottom: ${theme.spacing(2)};\n    color: ${theme.colors.text.secondary};\n  `,\n  container: css`\n    width: 100%;\n  `,\n  row: css`\n    align-items: baseline;\n  `,\n});\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { Button, InlineField, InlineFieldRow, useStyles2 } from '@grafana/ui';\nimport { DocsLinkButton } from 'app/core/components/DocsLinkButton';\n\nimport { TempoJsonData } from '../types';\n\nimport { getStyles } from './QuerySettings';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {}\n\nexport function LokiSearchSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  // Default to the trace to logs datasource if configured and loki search was enabled\n  // but only if jsonData.lokiSearch hasn't been set\n  const legacyDatasource =\n    options.jsonData.tracesToLogs?.lokiSearch !== false ? options.jsonData.tracesToLogs?.datasourceUid : undefined;\n  if (legacyDatasource && options.jsonData.lokiSearch === undefined) {\n    updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'lokiSearch', {\n      datasourceUid: legacyDatasource,\n    });\n  }\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">Loki search</h3>\n\n      <div className={styles.infoText}>\n        Select a Loki data source to search for traces. Derived fields must be configured in the Loki data source\n        <DocsLinkButton hrefSuffix=\"tempo/#loki-search\" />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField tooltip=\"The Loki data source with the service graph data\" label=\"Data source\" labelWidth={26}>\n          <DataSourcePicker\n            inputId=\"loki-search-data-source-picker\"\n            pluginId=\"loki\"\n            current={options.jsonData.lokiSearch?.datasourceUid}\n            noDefault={true}\n            width={40}\n            onChange={(ds) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'lokiSearch', {\n                datasourceUid: ds.uid,\n              })\n            }\n          />\n        </InlineField>\n        {options.jsonData.lokiSearch?.datasourceUid ? (\n          <Button\n            type={'button'}\n            variant={'secondary'}\n            size={'sm'}\n            fill={'text'}\n            onClick={() => {\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'lokiSearch', {\n                datasourceUid: undefined,\n              });\n            }}\n          >\n            Clear\n          </Button>\n        ) : null}\n      </InlineFieldRow>\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { InlineField, InlineFieldRow, InlineSwitch, useStyles2 } from '@grafana/ui';\nimport { DocsLinkButton } from 'app/core/components/DocsLinkButton';\n\nimport { TempoJsonData } from '../types';\n\nimport { getStyles } from './QuerySettings';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {}\n\nexport function SearchSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">Tempo search</h3>\n\n      <div className={styles.infoText}>\n        Modify how traces are searched\n        <DocsLinkButton hrefSuffix=\"tempo/#tempo-search\" />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField tooltip=\"Removes the search tab from the query editor\" label=\"Hide search\" labelWidth={26}>\n          <InlineSwitch\n            id=\"hideSearch\"\n            value={options.jsonData.search?.hide}\n            onChange={(event: React.SyntheticEvent<HTMLInputElement>) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'search', {\n                ...options.jsonData.search,\n                hide: event.currentTarget.checked,\n              })\n            }\n          />\n        </InlineField>\n      </InlineFieldRow>\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { Button, InlineField, InlineFieldRow, useStyles2 } from '@grafana/ui';\nimport { DocsLinkButton } from 'app/core/components/DocsLinkButton';\n\nimport { TempoJsonData } from '../types';\n\nimport { getStyles } from './QuerySettings';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {}\n\nexport function ServiceGraphSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">Service graph</h3>\n\n      <div className={styles.infoText}>\n        Select a Prometheus data source that contains the service graph data\n        <DocsLinkButton hrefSuffix=\"tempo/#service-graph\" />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField\n          tooltip=\"The Prometheus data source with the service graph data\"\n          label=\"Data source\"\n          labelWidth={26}\n        >\n          <DataSourcePicker\n            inputId=\"service-graph-data-source-picker\"\n            pluginId=\"prometheus\"\n            current={options.jsonData.serviceMap?.datasourceUid}\n            noDefault={true}\n            width={40}\n            onChange={(ds) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'serviceMap', {\n                datasourceUid: ds.uid,\n              })\n            }\n          />\n        </InlineField>\n        {options.jsonData.serviceMap?.datasourceUid ? (\n          <Button\n            type={'button'}\n            variant={'secondary'}\n            size={'sm'}\n            fill={'text'}\n            onClick={() => {\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'serviceMap', {\n                datasourceUid: undefined,\n              });\n            }}\n          >\n            Clear\n          </Button>\n        ) : null}\n      </InlineFieldRow>\n    </div>\n  );\n}\n","import React, { useCallback, useEffect } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { DataSourcePluginOptionsEditorProps, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { Alert } from '@grafana/ui';\n\nimport TagsInput from '../SearchTraceQLEditor/TagsInput';\nimport { replaceAt } from '../SearchTraceQLEditor/utils';\nimport { TraceqlFilter, TraceqlSearchScope } from '../dataquery.gen';\nimport { TempoDatasource } from '../datasource';\nimport { intrinsics } from '../traceql/traceql';\nimport { TempoJsonData } from '../types';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {\n  datasource?: TempoDatasource;\n}\n\nexport function TraceQLSearchTags({ options, onOptionsChange, datasource }: Props) {\n  const fetchTags = async () => {\n    if (!datasource) {\n      throw new Error('Unable to retrieve datasource');\n    }\n\n    try {\n      await datasource.languageProvider.start();\n      const tags = datasource.languageProvider.getTags();\n\n      if (tags) {\n        // This is needed because the /api/v2/search/tag/${tag}/values API expects \"status\" and the v1 API expects \"status.code\"\n        // so Tempo doesn't send anything and we inject it here for the autocomplete\n        if (!tags.find((t) => t === 'status')) {\n          tags.push('status');\n        }\n        return tags;\n      }\n    } catch (e) {\n      // @ts-ignore\n      throw new Error(`${e.statusText}: ${e.data.error}`);\n    }\n    return [];\n  };\n\n  const { error, loading, value: tags } = useAsync(fetchTags, [datasource, options]);\n\n  const updateFilter = useCallback(\n    (s: TraceqlFilter) => {\n      let copy = options.jsonData.search?.filters;\n      copy ||= [];\n      const indexOfFilter = copy.findIndex((f) => f.id === s.id);\n      if (indexOfFilter >= 0) {\n        // update in place if the filter already exists, for consistency and to avoid UI bugs\n        copy = replaceAt(copy, indexOfFilter, s);\n      } else {\n        copy.push(s);\n      }\n      updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'search', {\n        ...options.jsonData.search,\n        filters: copy,\n      });\n    },\n    [onOptionsChange, options]\n  );\n\n  const deleteFilter = (s: TraceqlFilter) => {\n    updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'search', {\n      ...options.jsonData.search,\n      filters: options.jsonData.search?.filters?.filter((f) => f.id !== s.id),\n    });\n  };\n\n  useEffect(() => {\n    if (!options.jsonData.search?.filters) {\n      updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'search', {\n        ...options.jsonData.search,\n        filters: [\n          {\n            id: 'service-name',\n            tag: 'service.name',\n            operator: '=',\n            scope: TraceqlSearchScope.Resource,\n          },\n          { id: 'span-name', tag: 'name', operator: '=', scope: TraceqlSearchScope.Span },\n        ],\n      });\n    }\n  }, [onOptionsChange, options]);\n\n  return (\n    <>\n      {datasource ? (\n        <TagsInput\n          updateFilter={updateFilter}\n          deleteFilter={deleteFilter}\n          filters={options.jsonData.search?.filters || []}\n          datasource={datasource}\n          setError={() => {}}\n          tags={[...intrinsics, ...(tags || [])]}\n          isTagsLoading={loading}\n          hideValues={true}\n        />\n      ) : (\n        <div>Invalid data source, please create a valid data source and try again</div>\n      )}\n      {error && (\n        <Alert title={'Unable to fetch TraceQL tags'} severity={'error'} topSpacing={1}>\n          {error.message}\n        </Alert>\n      )}\n    </>\n  );\n}\n","import React from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nimport { DataSourcePluginOptionsEditorProps, updateDatasourcePluginJsonDataOption } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { InlineField, InlineFieldRow, InlineSwitch, useStyles2 } from '@grafana/ui';\nimport { DocsLinkButton } from 'app/core/components/DocsLinkButton';\n\nimport { TempoDatasource } from '../datasource';\nimport { TempoJsonData } from '../types';\n\nimport { getStyles } from './QuerySettings';\nimport { TraceQLSearchTags } from './TraceQLSearchTags';\n\ninterface Props extends DataSourcePluginOptionsEditorProps<TempoJsonData> {}\n\nexport function TraceQLSearchSettings({ options, onOptionsChange }: Props) {\n  const styles = useStyles2(getStyles);\n  const dataSourceSrv = getDataSourceSrv();\n  const fetchDatasource = async () => {\n    return (await dataSourceSrv.get({ type: options.type, uid: options.uid })) as TempoDatasource;\n  };\n\n  const { value: datasource } = useAsync(fetchDatasource, [dataSourceSrv, options]);\n\n  return (\n    <div className={styles.container}>\n      <h3 className=\"page-heading\">Tempo search</h3>\n\n      <div className={styles.infoText}>\n        Modify how traces are searched\n        <DocsLinkButton hrefSuffix=\"tempo/#tempo-search\" />\n      </div>\n\n      <InlineFieldRow className={styles.row}>\n        <InlineField tooltip=\"Removes the search tab from the query editor\" label=\"Hide search\" labelWidth={26}>\n          <InlineSwitch\n            id=\"hideSearch\"\n            value={options.jsonData.search?.hide}\n            onChange={(event: React.SyntheticEvent<HTMLInputElement>) =>\n              updateDatasourcePluginJsonDataOption({ onOptionsChange, options }, 'search', {\n                ...options.jsonData.search,\n                hide: event.currentTarget.checked,\n              })\n            }\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow className={styles.row}>\n        <InlineField tooltip=\"Configures which fields are available in the UI\" label=\"Static filters\" labelWidth={26}>\n          <TraceQLSearchTags datasource={datasource} options={options} onOptionsChange={onOptionsChange} />\n        </InlineField>\n      </InlineFieldRow>\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { DataSourceHttpSettings } from '@grafana/ui';\nimport { NodeGraphSettings } from 'app/core/components/NodeGraphSettings';\nimport { TraceToLogsSettings } from 'app/core/components/TraceToLogs/TraceToLogsSettings';\nimport { TraceToMetricsSettings } from 'app/core/components/TraceToMetrics/TraceToMetricsSettings';\nimport { SpanBarSettings } from 'app/features/explore/TraceView/components';\n\nimport { LokiSearchSettings } from './LokiSearchSettings';\nimport { QuerySettings } from './QuerySettings';\nimport { SearchSettings } from './SearchSettings';\nimport { ServiceGraphSettings } from './ServiceGraphSettings';\nimport { TraceQLSearchSettings } from './TraceQLSearchSettings';\n\nexport type Props = DataSourcePluginOptionsEditorProps;\n\nexport const ConfigEditor = ({ options, onOptionsChange }: Props) => {\n  return (\n    <>\n      <DataSourceHttpSettings\n        defaultUrl=\"http://tempo\"\n        dataSourceConfig={options}\n        showAccessOptions={false}\n        onChange={onOptionsChange}\n        secureSocksDSProxyEnabled={config.secureSocksDSProxyEnabled}\n      />\n\n      <div className=\"gf-form-group\">\n        <TraceToLogsSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      {config.featureToggles.traceToMetrics ? (\n        <div className=\"gf-form-group\">\n          <TraceToMetricsSettings options={options} onOptionsChange={onOptionsChange} />\n        </div>\n      ) : null}\n\n      <div className=\"gf-form-group\">\n        <ServiceGraphSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      <div className=\"gf-form-group\">\n        <NodeGraphSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      <div className=\"gf-form-group\">\n        {config.featureToggles.traceqlSearch ? (\n          <TraceQLSearchSettings options={options} onOptionsChange={onOptionsChange} />\n        ) : (\n          <SearchSettings options={options} onOptionsChange={onOptionsChange} />\n        )}\n      </div>\n\n      <div className=\"gf-form-group\">\n        <LokiSearchSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      <div className=\"gf-form-group\">\n        <QuerySettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      <div className=\"gf-form-group\">\n        <SpanBarSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n    </>\n  );\n};\n","import { DashboardLoadedEvent } from '@grafana/data';\nimport { getTemplateSrv, reportInteraction } from '@grafana/runtime';\n\nimport pluginJson from './plugin.json';\nimport { TempoQuery } from './types';\n\ntype TempoOnDashboardLoadedTrackingEvent = {\n  grafana_version?: string;\n  dashboard_id?: string;\n  org_id?: number;\n  native_search_query_count: number;\n  search_query_count: number;\n  service_map_query_count: number;\n  traceql_query_count: number;\n  upload_query_count: number;\n  native_search_queries_with_template_variables_count: number;\n  search_queries_with_template_variables_count: number;\n  service_map_queries_with_template_variables_count: number;\n  traceql_queries_with_template_variables_count: number;\n};\n\nexport const onDashboardLoadedHandler = ({\n  payload: { dashboardId, orgId, grafanaVersion, queries },\n}: DashboardLoadedEvent<TempoQuery>) => {\n  try {\n    const tempoQueries = queries[pluginJson.id];\n\n    if (!tempoQueries?.length) {\n      return;\n    }\n\n    let stats: TempoOnDashboardLoadedTrackingEvent = {\n      grafana_version: grafanaVersion,\n      dashboard_id: dashboardId,\n      org_id: orgId,\n      native_search_query_count: 0,\n      search_query_count: 0,\n      service_map_query_count: 0,\n      traceql_query_count: 0,\n      upload_query_count: 0,\n      native_search_queries_with_template_variables_count: 0,\n      search_queries_with_template_variables_count: 0,\n      service_map_queries_with_template_variables_count: 0,\n      traceql_queries_with_template_variables_count: 0,\n    };\n\n    for (const query of tempoQueries) {\n      if (query.hide) {\n        continue;\n      }\n\n      if (query.queryType === 'nativeSearch') {\n        stats.native_search_query_count++;\n        if (\n          (query.serviceName && hasTemplateVariables(query.serviceName)) ||\n          (query.spanName && hasTemplateVariables(query.spanName)) ||\n          (query.search && hasTemplateVariables(query.search)) ||\n          (query.minDuration && hasTemplateVariables(query.minDuration)) ||\n          (query.maxDuration && hasTemplateVariables(query.maxDuration))\n        ) {\n          stats.native_search_queries_with_template_variables_count++;\n        }\n      } else if (query.queryType === 'search') {\n        stats.search_query_count++;\n        if (query.linkedQuery && query.linkedQuery.expr && hasTemplateVariables(query.linkedQuery.expr)) {\n          stats.search_queries_with_template_variables_count++;\n        }\n      } else if (query.queryType === 'serviceMap') {\n        stats.service_map_query_count++;\n        if (query.serviceMapQuery && hasTemplateVariables(query.serviceMapQuery)) {\n          stats.service_map_queries_with_template_variables_count++;\n        }\n      } else if (query.queryType === 'traceql') {\n        stats.traceql_query_count++;\n        if (hasTemplateVariables(query.query)) {\n          stats.traceql_queries_with_template_variables_count++;\n        }\n      } else if (query.queryType === 'upload') {\n        stats.upload_query_count++;\n      }\n    }\n\n    reportInteraction('grafana_tempo_dashboard_loaded', stats);\n  } catch (error) {\n    console.error('error in tempo tracking handler', error);\n  }\n};\n\nconst hasTemplateVariables = (val: string): boolean => {\n  return getTemplateSrv().containsTemplate(val);\n};\n","import { DataSourcePlugin, DashboardLoadedEvent } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport CheatSheet from './CheatSheet';\nimport { TempoQueryField } from './QueryEditor/QueryField';\nimport { ConfigEditor } from './configuration/ConfigEditor';\nimport { TempoDatasource } from './datasource';\nimport { onDashboardLoadedHandler } from './tracking';\nimport { TempoQuery } from './types';\n\nexport const plugin = new DataSourcePlugin(TempoDatasource)\n  .setQueryEditor(TempoQueryField)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditorHelp(CheatSheet);\n\n// Subscribe to on dashboard loaded event so that we can track plugin adoption\ngetAppEvents().subscribe<DashboardLoadedEvent<TempoQuery>>(DashboardLoadedEvent, onDashboardLoadedHandler);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = require(\"react\");\nvar useAsyncFn_1 = tslib_1.__importDefault(require(\"./useAsyncFn\"));\nfunction useAsync(fn, deps) {\n    if (deps === void 0) { deps = []; }\n    var _a = useAsyncFn_1.default(fn, deps, {\n        loading: true,\n    }), state = _a[0], callback = _a[1];\n    react_1.useEffect(function () {\n        callback();\n    }, [callback]);\n    return state;\n}\nexports.default = useAsync;\n"],"names":["NodeGraphSettings","options","onOptionsChange","styles","getStyles","event","theme","TraceToMetricsSettings","ds","v","query","i","e","newQueries","Field","MonacoQueryFieldLazy","props","MonacoQueryFieldWrapper","lastRunValueRef","onRunQuery","onChange","rest","handleRunQuery","value","handleBlur","LokiQueryField","override","nextQuery","prevProps","range","languageProvider","ExtraFieldElement","datasource","history","onQueryType","placeholder","roundMsToMin","milliseconds","roundSecToMin","seconds","shouldRefreshLabels","prevRange","sameMinuteFrom","sameMinuteTo","RE2_METACHARACTERS","escapeLokiRegexp","escapeLabelValueInExactSelector","labelValue","unescapeLabelValue","escapeLabelValueInRegexSelector","escapeLabelValueInSelector","selector","isRegexSelector","isBytesString","string","BYTES_KEYWORDS","regex","QueryOptionGroup","title","children","collapsedInfo","queryStats","isOpen","toggleOpen","convertUnits","text","suffix","x","RawQuery","lang","className","highlighted","CheatSheet","config","DataQueryModelVersion","defaultTempoQuery","TraceqlSearchScope","languageConfiguration","operators","stringOperators","numberOperators","intrinsics","scopes","language","languageDefinition","traceqlGrammar","generateQueryFromFilters","filters","f","scopeHelper","valueHelper","t","filterScopedTag","filterTitle","replaceAt","array","index","ret","operatorSelectableValue","op","result","TempoLanguageProvider","initialValues","url","params","emptyResult","tags","suggestions","tag","response","tagName","tagValue","DEFAULT_LIMIT","TempoDatasource","DataSourceWithBackend","instanceSettings","templateSrv","legacyLogsDatasourceUid","subQueries","filteredTargets","target","targets","of","logsDatasourceUid","dsSrv","from","mergeMap","linkedDatasource","linkedRequest","traceLinkMatcher","field","throwError","map","timeRange","searchQuery","catchError","error","queryValue","hexOnlyRegex","jsonData","isTraceData","isServiceGraphData","df","dsId","tempoDsUid","serviceMapQuery","concatMap","rateQuery","errorAndDurationQuery","merge","scopedVars","queries","expandedQuery","validTargets","traceRequest","request","lastValueFrom","apiUrl","data","req","key","tempoQuery","queryPrometheus","datasourceUid","tempoDatasourceUid","serviceMapRequest","makePromServiceMapRequest","toArray","responses","errorRes","res","nodes","edges","nodeLength","edgeLength","getFieldConfig","serviceMapResponse","makeServiceGraphViewRequest","buildExpr","rateResponse","serviceGraphViewMetrics","errorRateBySpanName","durationsBySpanName","labels","spanNames","getEscapedSpanNames","name","metric","errorAndDurationResponse","serviceGraphView","getServiceGraphView","makePromLink","expr","instant","values","targetField","tempoField","sourceField","makeTempoLink","serviceName","spanName","secondResponse","rate","errorRate","duration","buildLinkExpr","errorRateNames","errorRateValues","errorRateObj","getRateAlignedValues","durationObj","d","delimiter","extraParams","serviceMapQueryMatch","metricParams","item","rateResp","objToAlign","rateNames","metrics","TempoQueryBuilderOptions","onLimitChange","AutoSizeInput","validationRegex","filter","updateFilter","invalid","Select","Input","label","tooltip","InlineFieldRow","InlineField","deleteFilter","isTagsLoading","setError","hideScope","hideTag","hideValue","allowDelete","scopedTag","prevOperator","setPrevOperator","prevValue","setPrevValue","updateOptions","isLoadingValues","useAsync","scopeOptions","optionsOfFirstType","o","uniqueOptionType","operatorList","val","hideValues","generateId","handleOnAdd","setTags","setIsTagsLoading","traceQlQuery","setTraceQlQuery","s","copy","indexOfFilter","findFilter","id","staticTags","filteredTags","dynamicFilters","sf","InlineSearchField","Alert","defaultQuery","SpanKind","model","position","offset","getRangeAndOffset","situation","items","maxIndexDigits","suggestion","getMonacoCompletionItemKind","fixSuggestion","tagValues","getInsertionText","prepend","a","b","textUntilCaret","nameRegex","opRegex","valueRegex","fullRegex","matched","nameFull","nameMatched","w","CompletionProvider","type","monaco","word","positionClone","itemType","match","scope","TraceQLEditor","setupAutocompleteFn","useAutocomplete","CodeEditor","langId","ensureTraceQL","editor","setupRegisterInteractionCommand","setupActions","setupPlaceholder","setupAutoSize","placeholderDecorators","decorators","checkDecorators","newDecorators","_","properties","container","updateHeight","contentHeight","width","providerRef","autocompleteDisposeFun","registerInteractionCommandId","dispose","traceqlSetupDone","aliases","extensions","mimetypes","def","QueryEditor","onEditorChange","InlineLabel","matches","lastMatched","equals","TagsField","onBlur","setupDone","durationPlaceholder","serviceOptions","setServiceOptions","spanOptions","setSpanOptions","inputErrors","setInputErrors","isLoading","setIsLoading","loadOptions","lpName","fuzzy","services","spans","onKeyDown","keyEvent","handleOnChange","templatedMinDuration","templatedMaxDuration","limit","getDS","uid","ServiceGraphSection","graphDatasourceUid","dsState","hasKeys","setHasKeys","fn","keys","queryToFilter","AdHocFilter","filtersToQuery","newFilters","re","DEFAULT_QUERY_TYPE","TempoQueryFieldComponent","app","queryTypeOptions","RadioButtonGroup","SearchSection","FileDropzone","TempoQueryField","QuerySettings","DocsLinkButton","LokiSearchSettings","legacyDatasource","DataSourcePicker","Button","SearchSettings","ServiceGraphSettings","TraceQLSearchTags","fetchTags","loading","TraceQLSearchSettings","dataSourceSrv","fetchDatasource","ConfigEditor","DataSourceHttpSettings","TraceToLogsSettings","onDashboardLoadedHandler","dashboardId","orgId","grafanaVersion","tempoQueries","stats","hasTemplateVariables","tslib_1","react_1","useAsyncFn_1","deps","_a","state","callback","exports"],"sourceRoot":""}