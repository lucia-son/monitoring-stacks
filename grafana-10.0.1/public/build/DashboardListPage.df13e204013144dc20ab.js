"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4074],{95509:(he,z,c)=>{c.d(z,{P:()=>w});var u=c(66111),t=c(59679),B=c(8581),V=c(39904),N=c(10216),$=c(82e3);const D=()=>(0,$.getGrafanaSearcher)().getSortOptions();function w({onChange:E,value:k,placeholder:x,filter:Z,getSortOptions:_,isClearable:me}){const K=(0,t.Z)(async()=>{const O=await(_??D)();return Z?O.filter(L=>Z.includes(L.value)):O},[_,Z]);if(K.loading)return null;const T=Boolean(k?.includes("desc")||k?.startsWith("-"));return u.createElement(B.Ph,{key:k,width:28,onChange:E,value:K.value?.find(O=>O.value===k)??null,options:K.value,"aria-label":"Sort",placeholder:x??`Sort (Default ${N.yw.label})`,prefix:u.createElement(V.J,{name:T?"sort-amount-down":"sort-amount-up"}),isClearable:me})}},38535:(he,z,c)=>{c.d(z,{b:()=>V});var u=c(66111),t=c(91017),B=c(32434);class V{constructor(D){this._subject=new t.x,this._state=D}useState(){return N(this)}get state(){return this._state}setState(D){this._state={...this._state,...D},this._subject.next(this._state)}subscribeToState(D){return this._subject.subscribe(D)}}function N($){const D=(0,B.N)();return(0,u.useEffect)(()=>{const w=$.subscribeToState({next:D});return()=>w.unsubscribe()},[$,D]),$.state}},32722:(he,z,c)=>{c.r(z),c.d(z,{DashboardListPageFeatureToggle:()=>Te,default:()=>ja});var u=c(9892),t=c(66111),B=c(59679),V=c(72196),N=c(35645),$=c(37932),D=c(8412),w=c(89050),E=c(72648),k=c(14747),x=c(27876),Z=c(60492),_=c(82897),me=c(38535),K=c(58379),T=c(10216),O=c(72809),L=c(82e3),I=c(1037);const Ja=e=>e?Boolean(e.query||e.tag?.length>0||e.starred||e.sort):!1,ft=(e="General")=>`${T.qi}.${e.toLowerCase()}`,pt=e=>{const a=Object.entries(e).reduce((s,[n,o])=>{if(o){if(n==="tag"&&!Array.isArray(o))return{...s,tag:[o]}}else return s;return{...s,[n]:o}},{});if(e.folder){const s=`folder:${e.folder}`;return{...a,query:`${s} ${(a.query??"").replace(s,"")}`}}return{...a}},Me={query:"",tag:[],starred:!1,layout:I.A.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},vt={sort:null,starred:null,query:null,tag:null,layout:null};class yt extends me.b{constructor(){super(...arguments),this.updateLocation=(0,_.debounce)(a=>$.E1.partial(a,!0),300),this.doSearchWithDebounce=(0,_.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...vt})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(s=>s!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const s=a.currentTarget.checked;this.setStateAndDoSearch({starred:s})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(T.qb,a):localStorage.removeItem(T.qb),this.state.layout===I.A.Folders?this.setStateAndDoSearch({sort:a,layout:I.A.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(T.rh,a),this.state.sort&&a===I.A.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),K.Z.set(T.to,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,L.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,O.OY)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,O.Qw)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,s=!0){const n=pt($.E1.getSearchObject());(n.query||n.datasource||n.panel_type)&&(n.layout=I.A.List),se.setState({...n,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),s&&this.doSearch()}setStateAndDoSearch(a){this.setState(a),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,O.Jy)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const s=(0,L.getGrafanaSearcher)(),n=Date.now();(this.state.starred?s.starred(this.lastQuery):s.search(this.lastQuery)).then(r=>{n>this.lastSearchTimestamp&&(this.setState({result:r,loading:!1}),this.lastSearchTimestamp=n)}).catch(r=>{(0,O.TP)(this.state.eventTrackingNamespace,{...a,error:r?.message}),this.setState({loading:!1})})}}let se;function ne(){if(!se){const a=localStorage.getItem(T.rh)??Me.layout,s=localStorage.getItem(T.qb)??void 0;let n=K.Z.getBool(T.to,!0);n&&(n=!1),se=new yt({...Me,layout:a,sort:s,includePanels:n})}return se}function re(){const e=ne();return[e.useState(),e]}var P=c(35287);function Ie(e=!1){return e?(0,P.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,P.t)("search.search-input.placeholder","Search for dashboards and folders")}function $e(){return(0,P.t)("search.dashboard-actions.new-dashboard","New Dashboard")}function Ne(){return(0,P.t)("search.dashboard-actions.new-folder","New Folder")}function Ae(){return(0,P.t)("search.dashboard-actions.import","Import")}function ke(){return(0,P.t)("search.dashboard-actions.new","New")}var oe=c(24290),M=c(31403),Le=c(18271),Re=c(45984),G=c(88612),H=c(3918),ge=c(90158);const Be=e=>e.browseDashboards.rootItems,fe=e=>e.browseDashboards.childrenByParentUID,St=e=>e.browseDashboards.openFolders,pe=e=>e.browseDashboards.selectedItems,Et=(0,ge.P1)(Be,fe,St,(e,a)=>a,(e,a,s,n)=>Ue(n,e??[],a,s)),bt=(0,ge.P1)(pe,e=>Object.values(e).some(a=>Object.values(a).some(s=>s))),Ct=(0,ge.P1)(pe,fe,(e,a)=>{const s={dashboard:{...e.dashboard},folder:{...e.folder}};for(const n of Object.keys(e.folder))if(e.folder[n]){const r=a[n];if(r)for(const l of r)l.kind==="dashboard"&&(s.dashboard[l.uid]=!1),l.kind==="folder"&&(s.folder[l.uid]=!1)}return s});function wt(e){return(0,x.useSelector)(a=>(e?a.browseDashboards.childrenByParentUID[e]:a.browseDashboards.rootItems)?"fulfilled":"pending")}function xt(e){return(0,x.useSelector)(a=>Et(a,e))}function Oe(){return(0,x.useSelector)(e=>bt(e))}function Dt(){return(0,x.useSelector)(pe)}function Pt(){return(0,x.useSelector)(e=>e.browseDashboards.childrenByParentUID)}function Ft(){return(0,x.useSelector)(e=>Ct(e))}function Ue(e,a,s,n,o=0){function r(d,h,m){const g=Ue(d.uid,a,s,n,m+1),v=Boolean(n[d.uid]),S=s[d.uid]?.length===0;return v&&S&&g.push({isOpen:!1,level:m+1,item:{kind:"ui-empty-folder",uid:d.uid+"-empty-folder"}}),[{item:d,parentUID:h,level:m,isOpen:v},...g]}const l=e&&n[e]||o===0;return(e?l&&s[e]||[]:a).flatMap(d=>r(d,e,o))}var le=c(29910),We=c(98102),Q=c(67487),ee=c(45253);function ze(e,a,s,n){const o=e+a+s+n,r=[];e&&r.push(`${e} ${e===1?"folder":"folders"}`),a&&r.push(`${a} ${a===1?"dashboard":"dashboards"}`),s&&r.push(`${s} ${s===1?"library panel":"library panels"}`),n&&r.push(`${n} ${n===1?"alert rule":"alert rules"}`);let l=`${o} ${o===1?"item":"items"}`;return r.length>0&&(l+=`: ${r.join(", ")}`),l}const Tt=({onConfirm:e,onDismiss:a,selectedItems:s,...n})=>{const o=(0,E.wW)(Mt),{data:r,isFetching:l,isLoading:i,error:d}=(0,oe.zs)(s),h=()=>{e(),a()};return t.createElement(We.s,{body:t.createElement("div",{className:o.modalBody},"This action will delete the following content:",t.createElement("div",{className:o.breakdown},t.createElement(t.Fragment,null,r&&ze(r.folder,r.dashboard,r.libraryPanel,r.alertRule),(l||i)&&t.createElement(Q.$,{size:12}),d&&t.createElement(ee.b,{severity:"error",title:"Unable to retrieve descendant information"})))),confirmationText:"Delete",confirmText:"Delete",onDismiss:a,onConfirm:h,title:"Delete Compute Resources",...n})},Mt=e=>({breakdown:(0,u.css)({...e.typography.bodySmall,color:e.colors.text.secondary,marginBottom:e.spacing(2)}),modalBody:(0,u.css)({...e.typography.body})});var ve=c(35029),It=c(24799),Ve=c(79658);const $t=({onConfirm:e,onDismiss:a,selectedItems:s,...n})=>{const[o,r]=(0,t.useState)(),l=(0,E.wW)(Nt),i=Object.keys(s.folder).filter(S=>s.folder[S]),{data:d,isFetching:h,isLoading:m,error:g}=(0,oe.zs)(s),v=()=>{o!==void 0&&e(o),a()};return t.createElement(ve.u,{title:"Move",onDismiss:a,...n},i.length>0&&t.createElement(ee.b,{severity:"warning",title:"Moving this item may change its permissions."}),"This action will move the following content:",t.createElement("div",{className:l.breakdown},t.createElement(t.Fragment,null,d&&ze(d.folder,d.dashboard,d.libraryPanel,d.alertRule),(h||m)&&t.createElement(Q.$,{size:12}),g&&t.createElement(ee.b,{severity:"error",title:"Unable to retrieve descendant information"}))),t.createElement(It.g,{label:"Folder name"},t.createElement(Ve.Es,{allowEmpty:!0,onChange:({uid:S})=>r(S)})),t.createElement(ve.u.ButtonRow,null,t.createElement(M.zx,{onClick:a,variant:"secondary"},"Cancel"),t.createElement(M.zx,{disabled:o===void 0,onClick:v,variant:"primary"},"Move")))},Nt=e=>({breakdown:(0,u.css)({...e.typography.bodySmall,color:e.colors.text.secondary,marginBottom:e.spacing(2)})});function At(){const e=(0,E.wW)(kt),a=Ft(),s=(0,x.useDispatch)(),n=Object.keys(a.dashboard).filter(f=>a.dashboard[f]),o=Object.keys(a.folder).filter(f=>a.folder[f]),r=(0,x.useSelector)(Be),l=(0,x.useSelector)(fe),[,i]=re(),d=i.hasSearchFilters(),h=f=>{if(s((0,G.u6)({isSelected:!1,folderUID:void 0})),d)i.doSearchWithDebounce();else for(const p of f)s((0,H.qs)(p))},m=async()=>{const f=new Set;for(const p of o){await s((0,H.Go)(p));const y=(0,le.i)(r??[],l,p);f.add(y?.parentUID)}for(const p of n){await s((0,H.iM)(p));const y=(0,le.i)(r??[],l,p);f.add(y?.parentUID)}h(f)},g=async f=>{const p=new Set;p.add(f);for(const y of o){await s((0,H.J1)({folderUID:y,destinationUID:f}));const b=(0,le.i)(r??[],l,y);p.add(b?.parentUID)}for(const y of n){await s((0,H.hn)({dashboardUID:y,destinationUID:f}));const b=(0,le.i)(r??[],l,y);p.add(b?.parentUID)}h(p)},v=()=>{Le.Z.publish(new Re.Dn({component:$t,props:{selectedItems:a,onConfirm:g}}))},S=()=>{Le.Z.publish(new Re.Dn({component:Tt,props:{selectedItems:a,onConfirm:m}}))};return t.createElement("div",{className:e.row,"data-testid":"manage-actions"},t.createElement(M.zx,{onClick:v,variant:"secondary"},"Move"),t.createElement(M.zx,{onClick:S,variant:"destructive"},"Delete"))}const kt=e=>({row:(0,u.css)({display:"flex",flexDirection:"row",gap:e.spacing(1),marginBottom:e.spacing(2)})});var te=c(52081),X=c(58255),Lt=c(2594),Rt=c(95509),Bt=c(24357);function Ot(){return[{value:I.A.Folders,icon:"folder",ariaLabel:(0,P.t)("search.actions.view-as-folders","View by folders")},{value:I.A.List,icon:"list-ul",ariaLabel:(0,P.t)("search.actions.view-as-list","View as list")}]}function Ze(e){const a=e.layout??I.A.Folders;return a===I.A.Folders&&(e.query||e.sort||e.starred||e.tag.length>0)?I.A.List:a}const ye=({onLayoutChange:e,onSortChange:a,onStarredFilterChange:s=()=>{},onTagFilterChange:n,getTagOptions:o,getSortOptions:r,sortPlaceholder:l,onDatasourceChange:i,onPanelTypeChange:d,onSetIncludePanels:h,state:m,showStarredFilter:g,hideLayout:v})=>{const S=(0,E.wW)(Ge),f=Ze(m),p=m.query||m.datasource||m.panel_type?[I.A.Folders]:[];return t.createElement("div",{className:S.actionRow},t.createElement(te.Lh,{spacing:"md",width:"auto"},t.createElement(Bt.D,{isClearable:!1,tags:m.tag,tagOptions:o,onChange:n}),N.v.featureToggles.panelTitleSearch&&t.createElement(X.X,{"data-testid":"include-panels",disabled:f===I.A.Folders,value:m.includePanels,onChange:()=>h(!m.includePanels),label:(0,P.t)("search.actions.include-panels","Include panels")}),g&&t.createElement("div",{className:S.checkboxWrapper},t.createElement(X.X,{label:(0,P.t)("search.actions.starred","Starred"),onChange:s,value:m.starred})),m.datasource&&t.createElement(M.zx,{icon:"times",variant:"secondary",onClick:()=>i(void 0)},t.createElement(P.cC,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:m.datasource})),m.panel_type&&t.createElement(M.zx,{icon:"times",variant:"secondary",onClick:()=>d(void 0)},"Panel: ",m.panel_type)),t.createElement(te.Lh,{spacing:"md",width:"auto"},!v&&t.createElement(Lt.S,{options:Ot(),disabledOptions:p,onChange:e,value:f}),t.createElement(Rt.P,{onChange:y=>a(y?.value),value:m.sort,getSortOptions:r,placeholder:l||(0,P.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};ye.displayName="ActionRow";const Ge=e=>({actionRow:u.css`
      display: none;

      ${e.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${e.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:u.css`
      label {
        line-height: 1.2;
      }
    `});function Ut(){const[e,a]=re();return t.createElement("div",null,t.createElement(ye,{hideLayout:!0,showStarredFilter:!0,state:e,getTagOptions:a.getTagOptions,getSortOptions:(0,L.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,L.getGrafanaSearcher)().sortPlaceholder,includePanels:e.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var He=c(69142);const Se="--dashboards-tree-indentation";var A=(e=>(e[e.Unselected=0]="Unselected",e[e.Selected=1]="Selected",e[e.Mixed=2]="Mixed",e))(A||{}),Wt=c(9827),Qe=c(32436),zt=c(52666),Y=c(68183);function Vt({row:{original:e},isSelected:a,onItemSelectionChange:s}){const n=e.item;if(n.kind==="ui-empty-folder"||!a)return null;const o=a(n);return t.createElement(X.X,{"data-testid":Y.wl.pages.BrowseDashbards.table.checkbox(n.uid),value:o===A.Selected,indeterminate:o===A.Mixed,onChange:r=>s?.(n,r.currentTarget.checked)})}function Zt({isSelected:e,onAllSelectionChange:a}){const s=e?.("$all")??A.Unselected;return t.createElement(X.X,{value:s===A.Selected,indeterminate:s===A.Mixed,onChange:n=>a?.(n.currentTarget.checked)})}var Ee=c(8180),Gt=c(29460),Ht=c(37532);function je({children:e,level:a}){const s=(0,E.l4)(),n=`var(${Se}, ${s.spacing(2)})`;return t.createElement("span",{style:{paddingLeft:`calc(${n} * ${a})`}},e)}function Qt({row:{original:e},onFolderClick:a}){const s=(0,E.wW)(jt),{item:n,level:o,isOpen:r}=e;if(n.kind==="ui-empty-folder")return t.createElement(t.Fragment,null,t.createElement(je,{level:o}),t.createElement("span",{className:s.folderButtonSpacer}),t.createElement("em",null,"Empty folder"));const l=r?"angle-down":"angle-right";return t.createElement(t.Fragment,null,t.createElement(je,{level:o}),n.kind==="folder"?t.createElement(Ee.h,{size:"md",onClick:()=>a(n.uid,!r),name:l,ariaLabel:r?"Collapse folder":"Expand folder"}):t.createElement("span",{className:s.folderButtonSpacer}),n.url?t.createElement(Gt.r,{href:n.url,className:s.link},n.title):n.title)}const jt=e=>({folderButtonSpacer:(0,u.css)({paddingLeft:`calc(${(0,Ht.B)("md")}px + ${e.spacing(.5)})`}),link:(0,u.css)({"&:hover":{textDecoration:"underline"}})});var Je=c(34807);function Jt({row:{original:e}}){const a=(0,E.wW)(Kt),s=e.item;return s.kind==="ui-empty-folder"||!s.tags?null:t.createElement(Je.P,{className:a.tagList,tags:s.tags})}function Kt(e){return{tagList:(0,u.css)({justifyContent:"flex-start"})}}var R=c(39904),q=c(28066);function Xt({row:{original:e}}){const a=(0,E.wW)(Yt),s=(0,q.J6)(e.item.kind);switch(e.item.kind){case"dashboard":return t.createElement("span",{className:a.text},t.createElement(R.J,{name:s})," Dashboard");case"folder":return t.createElement("span",{className:a.text},t.createElement(R.J,{name:s})," Folder");case"panel":return t.createElement("span",{className:a.text},t.createElement(R.J,{name:s})," Panel");default:return null}}function Yt(e){return{text:(0,u.css)({color:e.colors.text.secondary})}}function Ke(e){e.getRowProps.push(a=>[a,Ce()]),e.getHeaderGroupProps.push(a=>[a,Ce()]),e.getFooterGroupProps.push(a=>[a,Ce()]),e.getHeaderProps.push((a,{column:s})=>[a,be(s)]),e.getCellProps.push((a,{cell:s})=>[a,be(s.column)]),e.getFooterProps.push((a,{column:s})=>[a,be(s)])}Ke.pluginName="useCustomFlexLayout";function be(e){return{style:{flex:e.totalWidth===0?"0 0 auto":`${e.totalWidth} 0 0`}}}function Ce(){return{style:{display:"flex",flex:"1 0 auto"}}}const Xe=35,Ye=35;function qt({items:e,width:a,height:s,isSelected:n,onFolderClick:o,onAllSelectionChange:r,onItemSelectionChange:l,canSelect:i=!1}){const d=(0,E.wW)(qe),h=(0,t.useMemo)(()=>[i&&{id:"checkbox",width:0,Header:Zt,Cell:Vt},{id:"name",width:3,Header:t.createElement("span",{style:{paddingLeft:20}},"Name"),Cell:W=>t.createElement(Qt,{...W,onFolderClick:o})},{id:"type",width:1,Header:"Type",Cell:Xt},{id:"tags",width:2,Header:"Tags",Cell:Jt}].filter(zt.fQ),[o,i]),m=(0,Wt.useTable)({columns:h,data:e},Ke),{getTableProps:g,getTableBodyProps:v,headerGroups:S}=m,f=(0,t.useMemo)(()=>({table:m,isSelected:n,onAllSelectionChange:r,onItemSelectionChange:l}),[m,n,r,l,e]);return t.createElement("div",{...g(),className:d.tableRoot,role:"table"},S.map(p=>{const{key:y,...b}=p.getHeaderGroupProps({style:{width:a}});return t.createElement("div",{key:y,...b,className:(0,u.cx)(d.row,d.headerRow)},p.headers.map(C=>{const{key:F,...W}=C.getHeaderProps();return t.createElement("div",{key:F,...W,role:"columnheader",className:d.cell},C.render("Header",{isSelected:n,onAllSelectionChange:r}))}))}),t.createElement("div",{...v()},t.createElement(Qe.t7,{height:s-Xe,width:a,itemCount:e.length,itemData:f,itemSize:Ye},_t)))}function _t({index:e,style:a,data:s}){const n=(0,E.wW)(qe),{table:o,isSelected:r,onItemSelectionChange:l}=s,{rows:i,prepareRow:d}=o,h=i[e];return d(h),t.createElement("div",{...h.getRowProps({style:a}),className:(0,u.cx)(n.row,n.bodyRow),"data-testid":Y.wl.pages.BrowseDashbards.table.row(h.original.item.uid)},h.cells.map(m=>{const{key:g,...v}=m.getCellProps();return t.createElement("div",{key:g,...v,className:n.cell},m.render("Cell",{isSelected:r,onItemSelectionChange:l}))}))}const qe=e=>({tableRoot:(0,u.css)({[Se]:e.spacing(1),[e.breakpoints.up("md")]:{[Se]:e.spacing(3)}}),row:(0,u.css)({gap:e.spacing(1)}),headerRow:(0,u.css)({backgroundColor:e.colors.background.secondary,height:Xe}),bodyRow:(0,u.css)({height:Ye,"&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.03)}}),cell:(0,u.css)({padding:e.spacing(1),whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),link:(0,u.css)({"&:hover":{textDecoration:"underline"}})});function ea({folderUID:e,width:a,height:s,canSelect:n}){const o=wt(e),r=(0,x.useDispatch)(),l=xt(e),i=Dt(),d=Pt(),h=(0,t.useCallback)((v,S)=>{r((0,G.xm)({folderUID:v,isOpen:S})),S&&r((0,H.qs)(v))},[r]);(0,t.useEffect)(()=>{r((0,H.qs)(e))},[h,r,e]);const m=(0,t.useCallback)((v,S)=>{r((0,G.wk)({item:v,isSelected:S}))},[r]),g=(0,t.useCallback)(v=>{if(v==="$all"){if(i.$all)return A.Selected;for(const p of Object.values(i))if(typeof p!="boolean"){for(const y in p)if(p[y])return A.Mixed}return A.Unselected}return i[v.kind][v.uid]?A.Selected:_e(v,d,i)?A.Mixed:A.Unselected},[i,d]);return o==="pending"?t.createElement(Q.$,null):o==="fulfilled"&&l.length===0?t.createElement("div",{style:{width:a}},t.createElement(He.Z,{title:e?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:e?`dashboard/new?folderUid=${e}`:"dashboard/new",proTip:e&&"Add/move dashboards to your folder at ->",proTipLink:e&&"dashboards",proTipLinkTitle:e&&"Browse dashboards",proTipTarget:""})):t.createElement(qt,{canSelect:n,items:l,width:a,height:s,isSelected:g,onFolderClick:h,onAllSelectionChange:v=>r((0,G.u6)({isSelected:v,folderUID:e})),onItemSelectionChange:m})}function _e(e,a,s){const n=a[e.uid];return n?n.some(o=>{const r=s[o.kind][o.uid];return r||_e(o,a,s)}):!1}var ae=c(95130),we=c(42044),et=c(71698);function ta({inFolder:e,canCreateDashboard:a,canCreateFolder:s}){const n=t.createElement(ae.v,null,a&&t.createElement(we.s,{url:xe("/dashboard/new",e),label:$e()}),s&&t.createElement(we.s,{url:xe("/dashboards/folder/new",e),label:Ne()}),a&&t.createElement(we.s,{url:xe("/dashboard/import",e),label:Ae()}));return t.createElement(et.L,{overlay:n},t.createElement(M.zx,null,ke(),t.createElement(R.J,{name:"angle-down"})))}function xe(e,a){return a?e+"?folderUid="+a:e}var U=c(72948),ce=c(54350),tt=c(16526);function aa({width:e,height:a,canSelect:s}){const n=(0,x.useDispatch)(),o=(0,x.useSelector)(f=>f.browseDashboards.selectedItems),r=Oe(),{keyboardEvents:l}=(0,ce.A)(),[i,d]=re(),h=i.result,m=(0,t.useCallback)((f,p)=>f?f==="*"&&p==="*"?r:f==="*"?!1:o[at(f)][p]??!1:!1,[o,r]),g=(0,t.useCallback)(()=>{n((0,G.u6)({isSelected:!1,folderUID:void 0}))},[n]),v=(0,t.useCallback)((f,p)=>{const y=!m(f,p);n((0,G.wk)({item:{kind:at(f),uid:p},isSelected:y}))},[m,n]);if(!h)return t.createElement("div",{style:{width:e}},t.createElement(Q.$,null));if(h.totalRows===0)return t.createElement("div",{style:{width:e}},t.createElement(U.Z,null,t.createElement(U.Z.Heading,null,"No results found for your query."),t.createElement(U.Z.Actions,null,t.createElement(M.zx,{variant:"secondary",onClick:d.onClearSearchAndFilters},"Clear search and filters"))));const S={response:h,selection:s?m:void 0,selectionToggle:s?v:void 0,clearSelection:g,width:e,height:a,onTagSelected:d.onAddTag,keyboardEvents:l,onDatasourceChange:i.datasource?d.onDatasourceChange:void 0,onClickItem:d.onSearchItemClicked};return t.createElement(tt.Q,{...S})}function at(e){switch(e){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+e)}var ie=c(77582);function De(e,a,s){return s?ie.Vt.hasAccessInMetadata(e,s,a):ie.Vt.hasAccess(e,a)}function sa(e){const a=e?e.canSave:ie.Vt.hasEditPermissionInFolders,s=De(x.AccessControlAction.FoldersWrite,a,e),n=De(x.AccessControlAction.FoldersCreate,ie.Vt.isEditor),o=De(x.AccessControlAction.DashboardsCreate,a||!!e?.canSave);return{canEditInFolder:s,canCreateDashboards:o,canCreateFolder:n}}const st=(0,t.memo)(({match:e})=>{const{uid:a}=e.params,s=(0,x.useDispatch)(),n=(0,E.wW)(na),[o,r]=re(),l=r.hasSearchFilters();(0,t.useEffect)(()=>{r.initStateFromUrl(a),s((0,G.u6)({isSelected:!1,folderUID:void 0}))},[s,a,r]),(0,t.useEffect)(()=>{!l&&o.result&&r.setState({result:void 0,includePanels:void 0})},[l,o.result,r]);const{data:i}=(0,oe.t4)(a??oe.CN),d=(0,t.useMemo)(()=>{if(!i)return;const S=(0,Z.B1)(i),f=(0,Z.Pr)(i.uid),p=S.children?.find(y=>y.id===f);return p&&(p.active=!0),S},[i]),h=Oe(),{canEditInFolder:m,canCreateDashboards:g,canCreateFolder:v}=sa(i);return t.createElement(D.T,{navId:"dashboards/browse",pageNav:d,actions:(g||v)&&t.createElement(ta,{inFolder:a,canCreateDashboard:g,canCreateFolder:v})},t.createElement(D.T.Contents,{className:n.pageContents},t.createElement(k.H,{placeholder:Ie(o.includePanels),value:o.query,escapeRegex:!1,onChange:S=>r.onQueryChange(S)}),h?t.createElement(At,null):t.createElement(Ut,null),t.createElement("div",{className:n.subView},t.createElement(w.Z,null,({width:S,height:f})=>l?t.createElement(aa,{canSelect:m,width:S,height:f}):t.createElement(ea,{canSelect:m,width:S,height:f,folderUID:a})))))}),na=e=>({pageContents:(0,u.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:e.spacing(1)}),subView:(0,u.css)({height:"100%"})});st.displayName="BrowseDashboardsPage";const ra=st;var oa=c(29930);const la=e=>oa.ae.getFolderByUid(e,{withAccessControl:!0}).then(a=>{const s=(0,Z.B1)(a);return s.children[0].active=!0,{folder:a,folderNav:s}});var j=c(82002),ca=c(93006);function ia(){const e=new Map;return{items:e,isSelected:(s,n)=>Boolean(e.get(s)?.has(n))}}function da(e,a,s,n){const o=e.items;if(n.length){const r=o.get(s);if(r){for(const l of n)a?r.add(l):r.delete(l);r.size<1&&o.delete(s)}else a&&o.set(s,new Set(n))}return{items:o,isSelected:(r,l)=>{if(l==="*"){if(r==="*"){for(const i of o.keys())if(o.get(i)?.size)return!0;return!1}return Boolean(o.get(r)?.size)}return Boolean(o.get(r)?.has(l))}}}var ua=c(23934),ha=c(84559),ma=c(20941),de=c(47694),ga=c(56991);const nt=(0,t.memo)(({onClick:e,className:a,checked:s=!1,editable:n=!1,"aria-label":o})=>n?t.createElement(X.X,{onClick:e,className:a,value:s,"aria-label":o}):null);nt.displayName="SearchCheckbox";const fa=Y.wl.components.Search,pa=(e="")=>{const a=new Map([["errors","info-circle"],["views","eye"]]);return a.has(e)?a.get(e):"sort-amount-down"},rt=({item:e,isSelected:a,editable:s,onToggleChecked:n,onTagSelected:o,onClickItem:r})=>{const l=(0,E.wW)(ya),i=(0,t.useCallback)((m,g)=>{g.stopPropagation(),g.preventDefault(),o(m)},[o]),d=(0,t.useCallback)(m=>{m.stopPropagation(),n&&n(e)},[e,n]),h=N.v.featureToggles.nestedFolders?t.createElement(t.Fragment,null,t.createElement(R.J,{name:(0,q.J6)(e.kind),"aria-hidden":!0})," ",va(e.kind)):t.createElement(t.Fragment,null,t.createElement(R.J,{name:(0,q.J6)(e.parentKind??"folder"),"aria-hidden":!0})," ",e.parentTitle||"General");return t.createElement("div",{className:l.cardContainer},t.createElement(nt,{"aria-label":"Select dashboard",editable:s,checked:a,onClick:d}),t.createElement(U.Z,{className:l.card,"data-testid":fa.dashboardItem(e.title),href:e.url,style:{minHeight:T.CN},onClick:r},t.createElement(U.Z.Heading,null,e.title),t.createElement(U.Z.Meta,{separator:""},t.createElement("span",{className:l.metaContainer},h),e.sortMetaName&&t.createElement("span",{className:l.metaContainer},t.createElement(R.J,{name:pa(e.sortMetaName)}),e.sortMeta," ",e.sortMetaName)),t.createElement(U.Z.Tags,null,t.createElement(Je.P,{tags:e.tags??[],onClick:i,getAriaLabel:m=>`Filter by tag "${m}"`}))))};function va(e){switch(e){case"folder":return(0,P.t)("search.result-kind.folder","Folder");case"dashboard":return(0,P.t)("search.result-kind.dashboard","Dashboard");case"panel":return(0,P.t)("search.result-kind.panel","Panel")}}const ya=e=>({cardContainer:u.css`
      display: flex;
      align-items: center;
      margin-bottom: ${e.spacing(.75)};
    `,card:u.css`
      padding: ${e.spacing(1)} ${e.spacing(2)};
      margin-bottom: 0;
    `,metaContainer:u.css`
      display: flex;
      align-items: center;
      margin-right: ${e.spacing(1)};

      svg {
        margin-right: ${e.spacing(.5)};
      }
    `});var Sa=c(56895);function Ea(){const e=(0,Sa.TH)();return[new URLSearchParams(e.search),(n,o)=>{$.E1.partial(n,o)}]}var ba=c(29952),Ca=c(83962),ot=c(86922),lt=c(79288);const Pe=200;function wa({isOpen:e}){const a=(0,E.wW)(Da),s=(0,E.wW)(f=>xa(f,Pe)),n=ne(),o=n.useState(),r=(0,t.useRef)(null),l=(0,t.useRef)(null),[i,d]=(0,t.useState)(!1),{overlayProps:h,underlayProps:m}=(0,ot.Ir)({isOpen:e,onClose:n.onCloseSearch},r),{dialogProps:g}=(0,ba.R)({},r),{onKeyDown:v,keyboardEvents:S}=(0,ce.A)();return(0,t.useEffect)(()=>n.initStateFromUrl(),[n]),t.createElement(ot.Xj,null,t.createElement(lt.Z,{nodeRef:l,appear:!0,in:!0,timeout:Pe,classNames:s.underlay},t.createElement("div",{ref:l,onClick:n.onCloseSearch,className:a.underlay,...m})),t.createElement(lt.Z,{nodeRef:r,onEntered:()=>d(!0),appear:!0,in:!0,timeout:Pe,classNames:s.overlay},t.createElement("div",{ref:r,className:a.overlay,...h,...g},t.createElement(Ca.MT,{contain:!0,autoFocus:!0},t.createElement("div",{className:a.searchField},t.createElement("div",null,t.createElement("input",{type:"text",placeholder:o.includePanels?"Search dashboards and panels by name":"Search dashboards by name",value:o.query??"",onChange:f=>n.onQueryChange(f.currentTarget.value),onKeyDown:v,tabIndex:0,spellCheck:!1,className:a.input})),t.createElement("div",{className:a.closeBtn},t.createElement(Ee.h,{name:"times",onClick:n.onCloseSearch,size:"xl",tooltip:"Close search"}))),i&&t.createElement("div",{className:a.search},t.createElement(ht,{showManage:!1,keyboardEvents:S}))))))}const xa=(e,a)=>{const s={transitionDuration:`${a}ms`,transitionTimingFunction:e.transitions.easing.easeInOut},n={[e.breakpoints.up("md")]:{...s,transitionProperty:"opacity"}},o={[e.breakpoints.up("md")]:{opacity:0}},r={[e.breakpoints.up("md")]:{opacity:1}},l={[e.breakpoints.up("md")]:{...s,transitionProperty:"height, width",overflow:"hidden"}},i={height:"100%",width:"100%",[e.breakpoints.up("md")]:{height:"32px",width:"50%"}},d={height:"100%",width:"100%",[e.breakpoints.up("md")]:{height:"90%",width:"75%"}};return{overlay:{appear:(0,u.css)(i),appearActive:(0,u.css)(l,d),appearDone:(0,u.css)(d)},underlay:{appear:(0,u.css)(o),appearActive:(0,u.css)(n,r),appearDone:(0,u.css)(r)}}},Da=e=>({underlay:u.css`
      background-color: ${e.components.overlay.background};
      backdrop-filter: blur(1px);
      bottom: 0;
      left: 0;
      padding: 0;
      position: fixed;
      right: 0;
      top: 0;
      z-index: ${e.zIndex.modalBackdrop};
    `,overlay:u.css`
      background: ${e.colors.background.primary};
      border: 1px solid ${e.components.panel.borderColor};
      display: flex;
      flex-direction: column;
      margin: 0 auto;
      padding: ${e.spacing(1)};
      position: fixed;
      height: 100%;
      z-index: ${e.zIndex.modal};

      ${e.breakpoints.up("md")} {
        border-radius: ${e.shape.radius.default};
        box-shadow: ${e.shadows.z3};
        left: 0;
        margin: ${e.spacing(.5,"auto",0)};
        padding: ${e.spacing(1)};
        right: 0;
      }
    `,closeBtn:u.css`
      right: -5px;
      top: 0px;
      z-index: 1;
      position: absolute;
    `,searchField:u.css`
      position: relative;
    `,search:u.css`
      display: flex;
      flex-direction: column;
      overflow: hidden;
      height: 100%;
      padding: ${e.spacing(2,0,3,0)};
    `,input:u.css`
      box-sizing: border-box;
      outline: none;
      background-color: transparent;
      background: transparent;
      border-bottom: 1px solid ${e.colors.border.medium};
      font-size: 16px;
      line-height: 30px;
      width: 100%;

      &::placeholder {
        color: ${e.colors.text.disabled};
      }
    `}),Pa=(0,t.memo)(()=>{const[e]=Ea(),a=e.get("search")==="open";return a?t.createElement(wa,{isOpen:a}):null});Pa.displayName="SearchWrapper";var ct=c(55185);async function Fa(e,a){if(de.vc.featureToggles.nestedFolders)return(0,ct.o)(e.uid,e.title);const s=e.itemsUIDs?{uid:e.itemsUIDs}:{query:"*",kind:["dashboard"],location:e.uid,sort:"name_sort",limit:1e3},n=await(0,L.getGrafanaSearcher)().search({...s,tags:a});return n.view.map(o=>(0,q.f9)(o,n.view))}const it=({section:e,selectionToggle:a,onClickItem:s,onTagSelected:n,selection:o,renderStandaloneBody:r,tags:l})=>{const i=a!=null,d=(0,E.wW)((0,t.useCallback)(C=>Ta(C,i),[i])),[h,m]=(0,ua.Z)(ft(e.title),!1),g=(0,B.Z)(async()=>!h&&!r?Promise.resolve([]):Fa(e,l),[h,l]),v=()=>{m(!h)},S=C=>{if(C.preventDefault(),C.stopPropagation(),a&&o){const F=!o(e.kind,e.uid);a(e.kind,e.uid);const W=g.value??[];for(const J of W)o(J.kind,J.uid)!==F&&a(J.kind,J.uid)}},p=`section-header-label-${(0,ga.L)()}`;let y=(0,ha.iJ)(e.icon??"");y||(y=h?"folder-open":"folder");const b=()=>{if(g.value){if(g.value.length===0&&!g.loading)return t.createElement(U.Z,null,t.createElement(U.Z.Heading,null,"No results found"))}else return null;return g.value.map(C=>t.createElement(rt,{key:C.uid,item:C,onTagSelected:n,onToggleChecked:F=>a?.(F.kind,F.uid),editable:Boolean(o!=null),onClickItem:s,isSelected:o?.(C.kind,C.uid)}))};return r?t.createElement("div",{className:d.folderViewResults},!g.value?.length&&g.loading?t.createElement(Q.$,{className:d.spinner}):b()):t.createElement(ma.s,{headerDataTestId:Y.wl.components.Search.folderHeader(e.title),contentDataTestId:Y.wl.components.Search.folderContent(e.title),isOpen:h??!1,onToggle:v,className:d.wrapper,contentClassName:d.content,loading:g.loading,labelId:p,label:t.createElement(t.Fragment,null,a&&o&&t.createElement("div",{onClick:S},t.createElement(X.X,{value:o(e.kind,e.uid),"aria-label":(0,P.t)("search.folder-view.select-folder","Select folder")})),t.createElement("div",{className:d.icon},t.createElement(R.J,{name:y})),t.createElement("div",{className:d.text},t.createElement("span",{id:p},e.title),e.url&&e.uid!==T.YQ&&t.createElement("a",{href:e.url,className:d.link},t.createElement("span",{className:d.separator},"|")," ",t.createElement(R.J,{name:"folder-upload"})," ",(0,P.t)("search.folder-view.go-to-folder","Go to folder"))))},g.value&&t.createElement("ul",{className:d.sectionItems},b()))},Ta=(e,a)=>{const s=e.spacing(1);return{wrapper:u.css`
      align-items: center;
      font-size: ${e.typography.size.base};
      padding: 12px;
      border-bottom: none;
      color: ${e.colors.text.secondary};
      z-index: 1;

      &:hover,
      &.selected {
        color: ${e.colors.text};
      }

      &:hover,
      &:focus-visible,
      &:focus-within {
        a {
          opacity: 1;
        }
      }
    `,sectionItems:u.css`
      margin: 0 24px 0 32px;
    `,icon:u.css`
      padding: 0 ${s} 0 ${a?0:s};
    `,folderViewResults:u.css`
      overflow: auto;
    `,text:u.css`
      flex-grow: 1;
      line-height: 24px;
    `,link:u.css`
      padding: 2px 10px 0;
      color: ${e.colors.text.secondary};
      opacity: 0;
      transition: opacity 150ms ease-in-out;
    `,separator:u.css`
      margin-right: 6px;
    `,content:u.css`
      padding-top: 0px;
      padding-bottom: 0px;
    `,spinner:u.css`
      display: grid;
      place-content: center;
      padding-bottom: 1rem;
    `}};var ue=c(50946);const Ma=({results:e,onDeleteItems:a,onDismiss:s})=>{const n=(0,E.wW)(Ia),o=Array.from(e.get("dashboard")??[]),r=Array.from(e.get("folder")??[]),l=r.length,i=o.length;let d="Do you want to delete the ",h;const m=i===1?"":"s",g=l===1?"":"s";l>0&&i>0?(d+=`selected folder${g} and dashboard${m}?
`,h=`All dashboards and alerts of the selected folder${g} will also be deleted`):l>0?d+=`selected folder${g} and all ${l===1?"its":"their"} dashboards and alerts?`:d+=`${i} selected dashboard${m}?`;const v=()=>{(0,ue.Fd)(r,o).then(()=>{a(),s()})},S=de.vc.featureToggles.nestedFolders&&l>0;return t.createElement(We.s,{isOpen:!0,title:"Delete",body:t.createElement(t.Fragment,null,d," ",h&&t.createElement("div",{className:n.subtitle},h)),confirmText:"Delete",confirmationText:S?"delete":void 0,onConfirm:v,onDismiss:s})},Ia=e=>({subtitle:u.css`
    font-size: ${e.typography.fontSize}px;
    padding-top: ${e.spacing(2)};
  `});var $a=c(60499);const dt=({results:e,onMoveItems:a,onDismiss:s})=>{const[n,o]=(0,t.useState)(null),r=(0,E.wW)(Aa),l=(0,$a.iG)(),[i,d]=(0,t.useState)(!1),h=de.ZP.featureToggles.nestedFolders,m=Array.from(e.get("dashboard")??[]),g=h?Array.from(e.get("folder")??[]).filter(p=>p!==T.YQ):[],v=(0,t.useCallback)(p=>{o(p)},[o]),S=async()=>{if(n){if(h){d(!0);let p=0,y=0;if(m.length){const C=await(0,ue.ct)(m,n);p+=C.totalCount,y+=C.successCount}if(g.length){const C=await(0,ue.Jx)(g,n);p+=C.totalCount,y+=C.successCount}const b=n.title??"General";Na(l,b,{selectedDashboardsCount:m.length,selectedFoldersCount:g.length,totalCount:p,successCount:y}),a(),d(!1),s();return}if(m.length){const p=n.title??"General";d(!0),(0,ue.ct)(m,n).then(y=>{if(y.successCount>0){const b=y.successCount===1?"":"s",C=`Dashboard${b} Moved`,F=`${y.successCount} dashboard${b} moved to ${p}`;l.success(C,F)}y.totalCount===y.alreadyInFolderCount?l.error("Error",`Dashboard already belongs to folder ${p}`):a(),d(!1),s()})}}},f=[["folder","folders",g.length],["dashboard","dashboards",m.length]].filter(([p,y,b])=>b>0).map(([p,y,b])=>`${b.toLocaleString()} ${b===1?p:y}`).join(" and ");return t.createElement(ve.u,{isOpen:!0,className:r.modal,title:h?"Move":"Choose Dashboard Folder",icon:"folder-plus",onDismiss:s},t.createElement(t.Fragment,null,t.createElement("div",{className:r.content},h&&g.length>0&&t.createElement(ee.b,{severity:"warning",title:" Moving this item may change its permissions"}),t.createElement("p",null,"Move ",f," to:"),t.createElement(Ve.Es,{allowEmpty:!0,enableCreateNew:!1,onChange:v})),t.createElement(te.Lh,{justify:"flex-end"},t.createElement(M.zx,{icon:i?"fa fa-spinner":void 0,variant:"primary",onClick:S},"Move"),t.createElement(M.zx,{variant:"secondary",onClick:s},"Cancel"))))};function Na(e,a,{selectedDashboardsCount:s,selectedFoldersCount:n,totalCount:o,successCount:r}){let l;const i=r===1?"":"s",d=o-r;if(s&&n?l=`Item${i}`:s?l=`Dashboard${i}`:n&&(l=`Folder${i}`),l){const h=l?.toLocaleLowerCase();o===r?e.success(`${l} moved`,`Moved ${r} ${h} to ${a}`):r===0?e.error(`Failed to move ${h}`,`Could not move ${o} ${h} due to an error`):e.warning(`Partially moved ${h}`,`Failed to move ${d} ${h} to ${a}`)}}const Aa=e=>({modal:u.css`
      width: 500px;
    `,content:u.css`
      margin-bottom: ${e.spacing(3)};
    `});function ka({items:e,folder:a,onChange:s,clearSelection:n}){const o=(0,E.wW)(Ge),r=a?.canSave,l=a?r:j.Vt.hasEditPermissionInFolders,i=l,h=Array.from(e.get("folder")??[]).find(b=>b===T.YQ),m=l&&!h,[g,v]=(0,t.useState)(!1),[S,f]=(0,t.useState)(!1),p=()=>{v(!0)},y=()=>{f(!0)};return t.createElement("div",{className:o.actionRow,"data-testid":"manage-actions"},t.createElement(te.Lh,{spacing:"md",width:"auto"},t.createElement(Ee.h,{name:"check-square",onClick:n,title:"Uncheck everything"}),t.createElement(M.zx,{disabled:!i,onClick:p,icon:"exchange-alt",variant:"secondary"},"Move"),t.createElement(M.zx,{disabled:!m,onClick:y,icon:"trash-alt",variant:"destructive"},"Delete")),S&&t.createElement(Ma,{onDeleteItems:s,results:e,onDismiss:()=>f(!1)}),g&&t.createElement(dt,{onMoveItems:s,results:e,onDismiss:()=>v(!1)}))}var La=c(54899),Ra=c(13019);async function Ba(){if(de.ZP.featureToggles.nestedFolders)return(0,ct.o)();const e=(0,L.getGrafanaSearcher)(),a=await e.search({query:"*",kind:["folder"],sort:e.getFolderViewSort(),limit:1e3});return a.view.map(s=>(0,q.f9)(s,a.view))}const Oa=({selection:e,selectionToggle:a,onTagSelected:s,tags:n,hidePseudoFolders:o,onClickItem:r})=>{const l=(0,E.wW)(Ua),i=(0,B.Z)(async()=>{const h=await Ba();if(h.unshift({title:"General",url:"/dashboards",kind:"folder",uid:T.YQ}),!o){const m=await Ra.Z.getDashboardOpened();if(m.length&&h.unshift({title:"Recent",icon:"clock-nine",kind:"folder",uid:"__recent",itemsUIDs:m}),j.Vt.isSignedIn){const g=await(0,La.i)().get("api/user/stars");g.length>0&&h.unshift({title:"Starred",icon:"star",kind:"folder",uid:"__starred",itemsUIDs:g})}}return h},[]),d=()=>i.loading?t.createElement(Q.$,{className:l.spinner}):i.value?i.value.map(h=>t.createElement("div",{"data-testid":Y.wl.components.Search.sectionV2,className:l.section,key:h.title},h.title&&t.createElement(it,{selection:e,selectionToggle:a,onTagSelected:s,section:h,tags:n,onClickItem:r}))):t.createElement(ee.b,{className:l.error,title:i.error?i.error.message:"Something went wrong"});return t.createElement("div",{className:l.wrapper},d())},Ua=e=>({wrapper:u.css`
      display: flex;
      flex-direction: column;
      overflow: auto;

      > ul {
        list-style: none;
      }

      border: solid 1px ${e.v1.colors.border2};
    `,section:u.css`
      display: flex;
      flex-direction: column;
      background: ${e.v1.colors.panelBg};

      &:not(:last-child) {
        border-bottom: solid 1px ${e.v1.colors.border2};
      }
    `,spinner:u.css`
      align-items: center;
      display: flex;
      justify-content: center;
      min-height: 100px;
    `,error:u.css`
      margin: ${e.spacing(4)} auto;
    `});var Wa=c(47535);const ut=t.memo(({response:e,width:a,height:s,selection:n,selectionToggle:o,onTagSelected:r,keyboardEvents:l,onClickItem:i})=>{const d=(0,E.wW)(za),h=(0,t.useRef)(null),[m,g]=(0,t.useState)(null),v=(0,ce.v)(l,0,e);(0,t.useEffect)(()=>{h.current&&h.current.resetloadMoreItemsCache(),m&&m.scrollTo(0)},[e,m]);const S=(0,t.useCallback)(({index:f,style:p})=>{let y="";f===v.y&&(y+=" "+d.selectedRow);const b=e.view.get(f),C=(0,q.f9)(b,e.view),F=o&&n?.(C.kind,C.uid);return t.createElement("div",{style:p,key:b.uid,className:y,role:"row"},t.createElement(rt,{item:C,onTagSelected:r,onToggleChecked:W=>{o&&o("dashboard",W.uid)},editable:Boolean(n!=null),onClickItem:i,isSelected:F}))},[e.view,v,d,r,n,o,i]);return e.totalRows?t.createElement("div",{"aria-label":"Search results list",style:{width:a},role:"list"},t.createElement(Wa.Z,{ref:h,isItemLoaded:e.isItemLoaded,itemCount:e.totalRows,loadMoreItems:e.loadMoreItems},({onItemsRendered:f,ref:p})=>t.createElement(Qe.t7,{ref:y=>{p(y),g(y)},onItemsRendered:f,height:s,itemCount:e.totalRows,itemSize:72,width:"100%",style:{overflow:"hidden auto"}},S))):t.createElement("div",{className:d.noData,style:{width:a}},"No data")});ut.displayName="SearchResultsCards";const za=e=>({noData:u.css`
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    `,selectedRow:u.css`
      border-left: 3px solid ${e.colors.primary.border};
    `}),ht=({showManage:e,folderDTO:a,hidePseudoFolders:s,keyboardEvents:n})=>{const o=(0,E.wW)(Va),r=ne(),l=r.useState(),[i,d]=(0,t.useState)(ia()),h=Ze(l),m=h===I.A.Folders,[g,v]=(0,t.useState)(Date.now());(0,ca.Z)(r.onReportSearchUsage,1e3,[]);const S=(0,t.useCallback)(()=>{i.items.clear(),d({...i})},[i]),f=(0,t.useCallback)((b,C)=>{const F=i.isSelected(b,C);d(da(i,!F,b,[C]))},[i]),p=async()=>{S(),v(Date.now()),r.onQueryChange(l.query)},y=()=>{const b=l.result;if((!b||!b.totalRows)&&!m)return l.loading&&!b?t.createElement(Q.$,null):t.createElement("div",{className:o.noResults},t.createElement("div",null,"No results found for your query."),t.createElement("br",null),t.createElement(M.zx,{variant:"secondary",onClick:r.onClearSearchAndFilters},"Clear search and filters"));const C=e?i.isSelected:void 0;return h===I.A.Folders?a?t.createElement(it,{section:Za(a),selection:C,selectionToggle:f,onTagSelected:r.onAddTag,renderStandaloneBody:!0,tags:l.tag,key:g,onClickItem:r.onSearchItemClicked}):t.createElement(Oa,{key:g,selection:C,selectionToggle:f,tags:l.tag,onTagSelected:r.onAddTag,hidePseudoFolders:s,onClickItem:r.onSearchItemClicked}):t.createElement("div",{style:{height:"100%",width:"100%"}},t.createElement(w.Z,null,({width:F,height:W})=>{const J={response:b,selection:C,selectionToggle:f,clearSelection:S,width:F,height:W,onTagSelected:r.onAddTag,keyboardEvents:n,onDatasourceChange:l.datasource?r.onDatasourceChange:void 0,onClickItem:r.onSearchItemClicked};return F<800?t.createElement(ut,{...J}):t.createElement(tt.Q,{...J})}))};return a&&!N.v.featureToggles.nestedFolders&&!l.loading&&!l.result?.totalRows&&!r.hasSearchFilters()?t.createElement(He.Z,{title:"This folder doesn't have any dashboards yet",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:`dashboard/new?folderUid=${a.uid}`,proTip:"Add/move dashboards to your folder at ->",proTipLink:"dashboards",proTipLinkTitle:"Manage dashboards",proTipTarget:""}):t.createElement(t.Fragment,null,Boolean(i.items.size>0)?t.createElement(ka,{items:i.items,onChange:p,clearSelection:S}):t.createElement(ye,{onLayoutChange:r.onLayoutChange,showStarredFilter:s,onStarredFilterChange:s?r.onStarredFilterChange:void 0,onSortChange:r.onSortChange,onTagFilterChange:r.onTagFilterChange,getTagOptions:r.getTagOptions,getSortOptions:(0,L.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,L.getGrafanaSearcher)().sortPlaceholder,onDatasourceChange:r.onDatasourceChange,onPanelTypeChange:r.onPanelTypeChange,state:l,includePanels:l.includePanels,onSetIncludePanels:r.onSetIncludePanels}),y())},Va=e=>({searchInput:u.css`
    margin-bottom: 6px;
    min-height: ${e.spacing(4)};
  `,unsupported:u.css`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:u.css`
    padding: ${e.v1.spacing.md};
    background: ${e.v1.colors.bg2};
    font-style: italic;
    margin-top: ${e.v1.spacing.md};
  `});function Za(e){return{uid:e.uid,kind:"folder",title:e.title}}var Fe=c(41818);const Ga=({folder:e,canCreateFolders:a=!1,canCreateDashboards:s=!1})=>{const[n,o]=(0,t.useState)(!1),r=N.v.featureToggles.nestedFolders&&(e?.canSave??!1),l=(0,t.useMemo)(()=>new Map([["folder",new Set(e?.uid?[e.uid]:[])]]),[e]),i=h=>{let m=`dashboard/${h}`;return h==="new_folder"&&(m="dashboards/folder/new/"),e?.uid&&(m+=`?folderUid=${e.uid}`),m},d=()=>t.createElement(ae.v,null,s&&t.createElement(ae.v.Item,{url:i("new"),label:$e(),onClick:()=>(0,Fe.ff)("grafana_menu_item_clicked",{url:i("new"),from:"/dashboards"})}),a&&(N.v.featureToggles.nestedFolders||!e?.uid)&&t.createElement(ae.v.Item,{url:i("new_folder"),label:Ne(),onClick:()=>(0,Fe.ff)("grafana_menu_item_clicked",{url:i("new_folder"),from:"/dashboards"})}),s&&t.createElement(ae.v.Item,{url:i("import"),label:Ae(),onClick:()=>(0,Fe.ff)("grafana_menu_item_clicked",{url:i("import"),from:"/dashboards"})}));return t.createElement(t.Fragment,null,t.createElement("div",null,t.createElement(te.Lh,null,r&&t.createElement(M.zx,{onClick:()=>o(!0),icon:"exchange-alt",variant:"secondary"},"Move"),t.createElement(et.L,{overlay:d,placement:"bottom-start"},t.createElement(M.zx,{variant:"primary"},ke(),t.createElement(R.J,{name:"angle-down"}))))),r&&n&&t.createElement(dt,{onMoveItems:()=>{},results:l,onDismiss:()=>o(!1)}))},mt=t.memo(({folder:e})=>{const a=(0,E.wW)(Qa),s=ne(),n=s.useState(),{onKeyDown:o,keyboardEvents:r}=(0,ce.A)(),l=e?.uid,i=e?.canSave,{isEditor:d}=j.Vt,h=e?i:j.Vt.hasEditPermissionInFolders,m=j.Vt.hasAccess(x.AccessControlAction.FoldersCreate,d),g=h||!!i,v=l?j.Vt.hasAccessInMetadata(x.AccessControlAction.DashboardsCreate,e,g):j.Vt.hasAccess(x.AccessControlAction.DashboardsCreate,g),S=e===void 0&&m||v;return(0,t.useEffect)(()=>s.initStateFromUrl(e?.uid),[e?.uid,s]),t.createElement(t.Fragment,null,t.createElement("div",{className:(0,u.cx)(a.actionBar,"page-action-bar")},t.createElement("div",{className:(0,u.cx)(a.inputWrapper,"gf-form gf-form--grow m-r-2")},t.createElement(k.H,{value:n.query??"",onChange:f=>s.onQueryChange(f),onKeyDown:o,autoFocus:!0,spellCheck:!1,placeholder:Ie(n.includePanels),escapeRegex:!1,className:a.searchInput})),S&&t.createElement(Ga,{folder:e,canCreateFolders:m,canCreateDashboards:v})),t.createElement(ht,{showManage:Boolean(d||h||i),folderDTO:e,hidePseudoFolders:!0,keyboardEvents:r}))});mt.displayName="ManageDashboardsNew";const Ha=mt,Qa=e=>({actionBar:u.css`
    ${e.breakpoints.down("sm")} {
      flex-wrap: wrap;
    }
  `,inputWrapper:u.css`
    ${e.breakpoints.down("sm")} {
      margin-right: 0 !important;
    }
  `,searchInput:u.css`
    margin-bottom: 6px;
    min-height: ${e.spacing(4)};
  `,unsupported:u.css`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:u.css`
    padding: ${e.v1.spacing.md};
    background: ${e.v1.colors.bg2};
    font-style: italic;
    margin-top: ${e.v1.spacing.md};
  `}),Te=(0,t.memo)(e=>N.v.featureToggles.nestedFolders?t.createElement(ra,{...e}):t.createElement(gt,{...e}));Te.displayName="DashboardListPageFeatureToggle";const gt=(0,t.memo)(({match:e,location:a})=>{const{loading:s,value:n}=(0,B.Z)(()=>{const o=e.params.uid,r=a.pathname;return!o||!r.startsWith("/dashboards")?Promise.resolve({}):la(o).then(({folder:l,folderNav:i})=>{const d=V.u.stripBaseFromUrl(l.url);return d!==a.pathname&&$.E1.replace(d),{folder:l,pageNav:i}})},[e.params.uid]);return t.createElement(D.T,{navId:"dashboards/browse",pageNav:n?.pageNav},t.createElement(D.T.Contents,{isLoading:s,className:u.css`
          display: flex;
          flex-direction: column;
          height: 100%;
        `},t.createElement(Ha,{folder:n?.folder})))});gt.displayName="DashboardListPage";const ja=Te},72809:(he,z,c)=>{c.d(z,{Jy:()=>V,Nw:()=>$,OY:()=>B,Qw:()=>t,TP:()=>N});var u=c(41818);const t=(w,E)=>{(0,u.ff)(`${w}_viewed`,D(E))},B=(w,E)=>{(0,u.ff)(`${w}_result_clicked`,D(E))},V=(w,E)=>{(0,u.ff)(`${w}_query_submitted`,D(E))},N=(w,{error:E,...k})=>{(0,u.ff)(`${w}_query_failed`,{...D(k),error:E})},$=(w,E,k)=>{(0,u.ff)(`grafana_panel_inspect_${w}_${E}_clicked`,k)},D=w=>({layout:w.layout,starredFilter:w.starred??!1,sort:w.sortValue??"",tagCount:w.tagCount??0,queryLength:w.query?.length??0,includePanels:w.includePanels??!1})}}]);

//# sourceMappingURL=DashboardListPage.df13e204013144dc20ab.js.map