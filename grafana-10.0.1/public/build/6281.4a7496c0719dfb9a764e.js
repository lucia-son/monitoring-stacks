"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6281],{38535:(re,W,o)=>{o.d(W,{b:()=>B});var u=o(66111),e=o(91017),R=o(32434);class B{constructor(C){this._subject=new e.x,this._state=C}useState(){return A(this)}get state(){return this._state}setState(C){this._state={...this._state,...C},this._subject.next(this._state)}subscribeToState(C){return this._subject.subscribe(C)}}function A(V){const C=(0,R.N)();return(0,u.useEffect)(()=>{const $=V.subscribeToState({next:C});return()=>$.unsubscribe()},[V,C]),V.state}},44927:(re,W,o)=>{o.d(W,{E:()=>e,z:()=>u});const u=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),e=async(R,B,A,V)=>{if(B.length===0)return"Could not find any metric queries";if(R&&R.length)return"Transformations are not supported in alert queries";let C=0,$=0;for(const j of B){const v=j.datasource||V,P=await A.get(v);P.meta.alerting?P.targetContainsTemplate&&P.targetContainsTemplate(j)&&$++:C++}return C===B.length?"The datasource does not support alerting queries":$===B.length?"Template variables are not supported in alert queries":""}},25487:(re,W,o)=>{o.r(W),o.d(W,{DashboardPage:()=>it,UnthemedDashboardPage:()=>ot,default:()=>eo,mapStateToProps:()=>dn});var u=o(9892),e=o(66111),R=o(92138),B=o(85191),A=o(67948),V=o(59957),C=o(2703),$=o(77346),j=o(72196),v=o(68183),P=o(41818),S=o(37932),D=o(35645),I=o(39904),E=o(72648),Q=o(659),J=o(8412),ce=o(98148),de=o(34177),se=o(60499),z=o(27876);function X(n){switch(n.kiosk){case"tv":return z.KioskMode.TV;case"1":case!0:return z.KioskMode.Full;default:return null}}var h=o(86245),f=o(63755),O=o(30992),L=o(63163);function N(n){const t=n.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+t),[t]),s=t.length>0?`g/${t}/`:"g/",r=_(t),i=()=>a.value?a.value.fields[0].values.map(d=>{let m=d;const p=m.indexOf(".")<0,g=!p&&m.endsWith(".json"),y=`${s}${m}`;return React.createElement(Card,{key:m,href:p||g?y:void 0},React.createElement(Card.Heading,null,m),React.createElement(Card.Figure,null,React.createElement(Icon,{name:p?"folder":g?"gf-grid":"file-alt",size:"sm"})))}):a.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),l=lt();return React.createElement(Page,{navModel:l,pageNav:r},i())}function _(n){const t=n.split("/");let a=[],s="g",r;for(let i=0;i<t.length;i++)s+=`/${t[i]}`,a.push({text:t[i],url:s,parentItem:r}),r=a[a.length-1];return r}function lt(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const no=null;var pn=o(7832),ee=o(45984),ct=o(85803),mn=o(92624),hn=o(39514),gn=o(31460),fn=o(77839),oe=o(82897),Ve=o(56895),dt=o(5191),vn=o(18271),ue=o(82002),Te=o(59679),En=o(93006),pe=o(35029),xe=o(46967),F=o(31403),yn=o(86648),bn=o(74391),Pn=o(2313);const ut=({panel:n,folderUid:t,isUnsavedPrompt:a,onDismiss:s,onConfirm:r,onDiscard:i})=>{const[l,c]=(0,e.useState)(""),d=(0,Te.Z)(async()=>{const w=await(0,yn.E8)(n.libraryPanel.uid);return w.length>0?w.map(M=>M.title):[]},[n.libraryPanel.uid]),[m,p]=(0,e.useState)([]);(0,En.Z)(()=>d.value?p(d.value.filter(w=>w.toLowerCase().includes(l.toLowerCase()))):p([]),300,[d.value,l]);const{saveLibraryPanel:g}=(0,Pn.E)(),y=(0,E.wW)(bn.J),b=(0,e.useCallback)(()=>{i()},[i]),T=a?"Unsaved library panel changes":"Save library panel";return e.createElement(pe.u,{title:T,icon:"save",onDismiss:s,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:y.textInfo},"This update will affect ",e.createElement("strong",null,n.libraryPanel.meta?.connectedDashboards," ",n.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(xe.I,{className:y.dashboardSearch,prefix:e.createElement(I.J,{name:"search"}),placeholder:"Search affected dashboards",value:l,onChange:w=>c(w.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:y.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,m.map((w,M)=>e.createElement("tr",{key:`dashrow-${M}`},e.createElement("td",null,w))))),e.createElement(pe.u.ButtonRow,null,e.createElement(F.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),a&&e.createElement(F.zx,{variant:"destructive",onClick:b},"Discard"),e.createElement(F.zx,{onClick:()=>{g(n,t).then(()=>{r()})}},"Update all"))))};var Cn=o(82302),We=o(58379),ke=o(2476),De=o(32294),pt=o(46732),te=o(36281);function Sn(n,t){return async a=>{const s=t.initEditPanel(n);a((0,te.Hl)({panel:s,sourcePanel:n}))}}function mt(){return async(n,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,n((0,te.yi)(!0))}}function Tn(n,t){return a=>{if(n.libraryPanel?.uid===void 0||!t)return;const s=n.getSaveModel();for(const r of t.panels){if(xn(n,r))continue;r.restoreModel({...s,...(0,oe.pick)(r,"gridPos","id")});const i=r.plugin?.meta.id!==n.plugin?.meta.id;r.plugin=n.plugin,r.configRev++,i&&(r.generateNewKey(),a((0,pt.bc)({key:r.key,plugin:r.plugin}))),setTimeout(()=>{r.getQueryRunner().useLastResultFrom(n.getQueryRunner())},20)}n.repeat&&setTimeout(()=>t.processRepeats(),20)}}function xn(n,t){return!!(t.libraryPanel?.uid!==n.libraryPanel.uid||t.id&&t.id===n.id||t.repeatPanelId)}function Dn(){return async(n,t)=>{const a=t().dashboard.getModel(),{getPanel:s,getSourcePanel:r,shouldDiscardChanges:i}=t().panelEditor,l=s();a&&a.exitPanelEditor();const c=r();if(wn(l)&&!i){const d=l.getSaveModel(),m=c.type!==l.type;n(Tn(l,a)),c.restoreModel(d),c.configRev++,m&&(c.plugin=l.plugin,c.generateNewKey(),await n((0,pt.bc)({key:c.key,plugin:l.plugin}))),setTimeout(()=>{c.getQueryRunner().useLastResultFrom(l.getQueryRunner()),c.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(c.configRev=0)},20)}c.isNew&&(i?a&&(0,ke.WJ)(a,c,!0):delete c.isNew),n((0,De.qj)(l.key)),n((0,te.my)())}}function wn(n){return n.hasChanged||n.hasSavedPanelEditChange||n.isAngularPlugin()}function He(n){return(t,a)=>{const s={...a().panelEditor.ui,...n};t((0,te.K9)(s));try{We.Z.setObject(te.jy,s)}catch(r){console.error(r)}}}var On=o(84135);const In=({dashboard:n,onSaveSuccess:t,onDiscard:a,onDismiss:s})=>e.createElement(pe.u,{isOpen:!0,title:"Unsaved changes",onDismiss:s,icon:"exclamation-triangle",className:u.css`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(pe.u.ButtonRow,null,e.createElement(F.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),e.createElement(F.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(On.i,{dashboard:n,onSaveSuccess:t}))),ht=e.memo(({dashboard:n})=>{const[t,a]=(0,e.useState)({original:null}),s=(0,z.useDispatch)(),{original:r,originalPath:i}=t,{showModal:l,hideModal:c}=(0,e.useContext)(dt.kr);(0,e.useEffect)(()=>{const m=setTimeout(()=>{const g=S.E1.getLocation().pathname,y=n.getSaveModelClone();a({originalPath:g,original:y})},1e3),p=vn.h.subscribe(ee.Jd,()=>{const g=n.getSaveModelClone();a({originalPath:i,original:g})});return()=>{clearTimeout(m),p.unsubscribe()}},[n,i]),(0,e.useEffect)(()=>{const m=p=>{gt(n,r)||vt(n,r)&&(p.preventDefault(),p.returnValue="")};return window.addEventListener("beforeunload",m),()=>window.removeEventListener("beforeunload",m)},[n,r]);const d=m=>{const p=n.panelInEdit,g=new URLSearchParams(m.search);return p&&p.libraryPanel&&p.hasChanged&&!g.has("editPanel")?(l(ut,{isUnsavedPrompt:!0,panel:n.panelInEdit,folderUid:n.meta.folderUid??"",onConfirm:()=>{c(),we(m)},onDiscard:()=>{s(mt()),we(m),c()},onDismiss:c}),!1):i===m.pathname||!r?(p&&!g.has("editPanel")&&s(Dn()),!0):gt(n,r)||!vt(n,r)?!0:(l(In,{dashboard:n,onSaveSuccess:()=>{c(),we(m)},onDiscard:()=>{a({...t,original:null}),c(),we(m)},onDismiss:c}),!1)};return e.createElement(Ve.NL,{when:!0,message:d})});ht.displayName="DashboardPrompt";function we(n){n&&setTimeout(()=>S.E1.push(n),10)}function gt(n,t){if(!t||!ue.Vt.isSignedIn||!n)return!0;const{canSave:a,fromScript:s,fromFile:r}=n.meta;return!ue.Vt.isEditor&&!a?!0:!a||s||r}function ft(n){const t=new Cn.f(n);t.expandRows();const a=t.getSaveModelClone();return a.time=0,a.refresh="",a.schemaVersion=0,a.timezone=0,a.panels=[],(0,oe.each)(a.getVariables(),s=>{s.current=null,s.options=null,s.filters=null}),a}function vt(n,t){if(n.hasUnsavedChanges())return!0;const a=ft(n.getSaveModelClone()),s=ft(t),r=(0,oe.find)(a.nav,{type:"timepicker"}),i=(0,oe.find)(s.nav,{type:"timepicker"});r&&i&&(r.now=i.now);const l=JSON.stringify(a,null),c=JSON.stringify(s,null);return l!==c}var Rn=o(82557),Z=o(39653),Oe=o(73952),Ie=o(89050),Et=o(206),Re=o(26418),yt=o(30979),Nn=o(26338),Ke=o(72142),fe=o(79841),Mn=o(67487),ie=o(45253),me=o(24799),bt=o(8581),je=o(94599),An=o(9405),G=o(52081),he=o(8944),$n=o(3574),Ln=o.n($n),Fn=o(77258),zn=o(38535),Un=o(52686),ve=o(19349),Bn=o(86899),Pt=o(87464),Ct=o(78197),Ee=(n=>(n[n.Support=0]="Support",n[n.Data=1]="Data",n))(Ee||{}),Ne=(n=>(n[n.PanelSnapshot=0]="PanelSnapshot",n[n.GithubComment=1]="GithubComment",n))(Ne||{});class Vn extends zn.b{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,r=new Blob([a],{type:"text/plain"}),i=`debug-${s}-${(0,Fn.dq)(new Date)}.json.txt`;Ln()(r,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,Pt.$M)({meta:{},dashboard:a}),o.g.open(D.v.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:s}=this.state,r=await(0,Ct.$R)(t,a,(0,ve.$t)().timeRange()),i=JSON.stringify(r,null,2),l=(0,Ct.S$)(t,i),c=(0,C.zc)((0,C.Cf)("bytes")(i?.length??0));let d;if(!t.isAngularPlugin())try{const m=new Bn.f(r);d=(0,Un.Yz)(m).state.body}catch(m){console.log("Error creating scene:",m)}this.setState({snapshot:r,snapshotText:i,markdownText:l,snapshotSize:c,snapshotUpdate:s+1,scene:d})}}function Wn({panel:n,plugin:t,onClose:a}){const s=(0,E.wW)(kn),r=(0,e.useMemo)(()=>new Vn(n),[n]),{currentTab:i,loading:l,error:c,options:d,showMessage:m,snapshotSize:p,markdownText:g,snapshotText:y,randomize:b,panelTitle:T,scene:w}=r.useState();if((0,e.useEffect)(()=>{r.buildDebugDashboard()},[r,t,b]),!t)return null;const M=[{label:"Snapshot",value:Ee.Support},{label:"Data",value:Ee.Data}],k=D.v.supportBundlesEnabled&&ue.Vt.hasAccess(z.AccessControlAction.ActionSupportBundlesCreate,ue.Vt.isGrafanaAdmin);return e.createElement(yt.d,{title:"Get help with this panel",size:"lg",onClose:a,scrollableContent:!0,subtitle:e.createElement(Re.Stack,{direction:"column",gap:1},e.createElement(Re.Stack,{direction:"row",gap:1},e.createElement(Nn.a,{featureState:Et.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(I.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),k&&e.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",e.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:e.createElement(Ke.J,null,M.map((x,K)=>e.createElement(fe.O,{key:`${x.value}-${K}`,label:x.label,active:x.value===i,onChangeTab:()=>r.onCurrentTabChange(x.value)})))},l&&e.createElement(Mn.$,null),c&&e.createElement(ie.b,{title:c.title},c.message),i===Ee.Data&&e.createElement("div",{className:s.code},e.createElement("div",{className:s.opts},e.createElement(me.g,{label:"Template",className:s.field},e.createElement(bt.Ph,{options:d,value:m,onChange:r.onShowMessageChange})),m===Ne.GithubComment?e.createElement(je.m,{icon:"copy",getText:r.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(F.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Download (",p,")")),e.createElement(Ie.Z,{disableWidth:!0},({height:x})=>e.createElement(An.p,{width:"100%",height:x,language:m===Ne.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:m===Ne.GithubComment?g:y,readOnly:!1,onBlur:r.onSetSnapshotText}))),i===Ee.Support&&e.createElement(e.Fragment,null,e.createElement(me.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(G.Lh,null,e.createElement(he.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:Boolean(b.labels),onChange:()=>r.onToggleRandomize("labels")}),e.createElement(he.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:Boolean(b.names),onChange:()=>r.onToggleRandomize("names")}),e.createElement(he.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:Boolean(b.values),onChange:()=>r.onToggleRandomize("values")}))),e.createElement(me.g,{label:"Support snapshot",description:`Panel: ${T}`},e.createElement(Re.Stack,null,e.createElement(F.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Dashboard (",p,")"),e.createElement(je.m,{icon:"github",getText:r.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(F.zx,{onClick:r.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(Ie.Z,{disableWidth:!0},({height:x})=>e.createElement("div",{style:{height:x,overflow:"auto"}},w&&e.createElement(w.Component,{model:w})))))}const kn=n=>({code:u.css`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:u.css`
    width: 100%;
  `,opts:u.css`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var Hn=o(52666);const Qe=(n,t,a)=>{const s=(0,e.useRef)(),[r,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let l=-1,c=0;return s.current=n.getQueryRunner().getData(t).subscribe({next:d=>{if(a){if(l===d.structureRev){const m=Date.now();if(m-c<1e4)return;c=m}l=d.structureRev??-1}i(d)}}),()=>{s.current&&s.current.unsubscribe()}},[n,t.withFieldConfig,t.withTransforms]),{data:r,error:r&&r.error,isLoading:r?r.state===Hn.Gu.Loading:!0,hasSeries:r?!!r.series:!1}};var Kn=o(20308),ne=o(35287),jn=o(21957),Qn=o(46835),Zn=o(18893);const Gn=({data:n,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?e.createElement(ne.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(t.components.MetadataInspector,{datasource:t,data:n.series});var Jn=o(52121),Yn=o(72062);const Xn=({panel:n,plugin:t,dashboard:a,tabs:s,data:r,isDataLoading:i,dataOptions:l,metadataDatasource:c,defaultTab:d,onDataOptionsChange:m,onClose:p})=>{const[g,y]=(0,e.useState)(d??Z.q.Data);if(!t)return null;let b=r?.errors;!b?.length&&r?.error&&(b=[r.error]);let T=g;s.find(k=>k.value===g)||(T=Z.q.JSON);const w=(0,Kn.J)().replace(n.title,n.scopedVars,"text")||"Panel",M=(0,ne.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:w});return e.createElement(yt.d,{title:M,subtitle:r&&qn(r),onClose:p,scrollableContent:!0,tabs:e.createElement(Ke.J,null,s.map((k,x)=>e.createElement(fe.O,{key:`${k.value}-${x}`,label:k.label,active:k.value===T,onChangeTab:()=>y(k.value||Z.q.Data)})))},T===Z.q.Data&&e.createElement(jn.E,{panel:n,data:r&&r.series,isLoading:i,options:l,onOptionsChange:m,timeZone:a.timezone,app:Et.zj.Dashboard}),r&&T===Z.q.Meta&&e.createElement(Gn,{data:r,metadataDatasource:c}),T===Z.q.JSON&&e.createElement(Zn.W,{panel:n,dashboard:a,data:r,onClose:p}),T===Z.q.Error&&e.createElement(Qn.l,{errors:b}),r&&T===Z.q.Stats&&e.createElement(Jn.f,{data:r,timeZone:a.getTimezone()}),r&&T===Z.q.Query&&e.createElement(Yn.D,{panel:n,data:r.series,onRefreshQuery:()=>n.refresh()}))};function qn(n){const{request:t}=n;if(!t||(0,oe.isEmpty)(t))return"";const a=t.targets.length,s=t.endTime?t.endTime-t.startTime:0,r=(0,C.zc)((0,C.Cf)("ms")(s));return e.createElement(ne.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:r})}var _n=o(42638),St=o(86647),Ze=o(13505);const ea=n=>(0,_n.Z)(async()=>{const a=n?.request?.targets||[];if(n&&n.series&&a.length){for(const s of n.series)if(s.meta&&s.meta.custom){const r=await(0,St.F)().get(a[0].datasource);if(r&&r.components?.MetadataInspector)return r}}},[n]).value,ta=(n,t,a,s,r)=>(0,e.useMemo)(()=>{const i=[];return(0,Ze.sY)(a)&&(i.push({label:(0,ne.t)("dashboard.inspect.data-tab","Data"),value:Z.q.Data}),i.push({label:(0,ne.t)("dashboard.inspect.stats-tab","Stats"),value:Z.q.Stats})),r&&i.push({label:(0,ne.t)("dashboard.inspect.meta-tab","Meta Data"),value:Z.q.Meta}),i.push({label:(0,ne.t)("dashboard.inspect.json-tab","JSON"),value:Z.q.JSON}),s&&s.message&&i.push({label:(0,ne.t)("dashboard.inspect.error-tab","Error"),value:Z.q.Error}),t.meta.canEdit&&(0,Ze.sY)(a)&&i.push({label:(0,ne.t)("dashboard.inspect.query-tab","Query"),value:Z.q.Query}),i},[a,r,t,s]),na=({panel:n,dashboard:t,plugin:a})=>{const[s,r]=(0,e.useState)({withTransforms:!1,withFieldConfig:!0}),i=(0,Ve.TH)(),{data:l,isLoading:c,error:d}=Qe(n,s,!0),m=ea(l),p=ta(n,t,a,d,m),g=new URLSearchParams(i.search).get("inspectTab"),y=()=>{S.E1.partial({inspect:null,inspectTab:null})};return a?g===Z.q.Help?e.createElement(Wn,{panel:n,plugin:a,onClose:y}):e.createElement(Xn,{dashboard:t,panel:n,plugin:a,defaultTab:g,tabs:p,data:l,isDataLoading:c,dataOptions:s,onDataOptionsChange:r,metadataDatasource:m,onClose:y}):null},aa=(n,t)=>{const a=(0,Oe.i)(n,t.panel);return a?{plugin:a.plugin}:{plugin:null}},ra=(0,A.connect)(aa)(na);var Tt=o(53376),Me=o(2594),Ae=o(64319),sa=o(8125),oa=o(7804),ia=o(95379),xt=o(59363),la=o(77582),ye=o(61860),ca=o(22323),da=o(82253),Ge=o(10672);const ua=n=>{const t=(0,e.useMemo)(()=>ca.z.get(n.variable.type).picker,[n.variable]);return n.variable?e.createElement("div",{className:"gf-form"},e.createElement(pa,{variable:n.variable}),n.variable.hide!==Ge.bU.hideVariable&&t&&e.createElement(t,{variable:n.variable,readOnly:n.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function pa({variable:n}){const t=(0,e.useMemo)(()=>n.label||n.name,[n]);if(n.hide!==Ge.bU.dontHide)return null;const a=da.IG+n.id;return n.description?e.createElement(ye.u,{content:n.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)}const Dt=({variables:n,readOnly:t})=>{const[a,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(n.filter(r=>r.hide!==Ge.bU.hideVariable))},[n]),a.length===0?null:e.createElement(e.Fragment,null,a.map(r=>e.createElement("div",{key:r.id,className:"submenu-item gf-form-inline","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(ua,{variable:r,readOnly:t}))))};var ma=o(54294),ha=o(81283),be=o(6297),Je=o(87095),ga=o(76407),fa=o(37877),va=o(63205),wt=o(14747),Pe=o(68226),Ot=o(11484);function Ea(n,t){We.Z.set(`panel-edit-section-${n}`,t?"true":"false")}function ya(n,t){return We.Z.getBool(`panel-edit-section-${n}`,t)}const It=(n,t)=>({angularPanelComponent:(0,Oe.i)(n,t.panel)?.angularComponent}),Rt={changePanelPlugin:De.Kc},ao=(0,A.connect)(It,Rt);class ba extends e.PureComponent{constructor(t){super(t)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(t){(this.props.plugin!==t.plugin||this.props.angularPanelComponent!==t.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:t,angularPanelComponent:a,changePanelPlugin:s}=this.props;if(!this.element||!a||this.angularOptions)return;const r=a.getScope();if(!r.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=r.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=m=>{s({panel:t,pluginId:m.id})};let l="";for(let m=0;m<i.editorTabs.length;m++){const p=i.editorTabs[m];p.isOpen=ya(p.title,m===0),l+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${m})" aria-label="${p.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${m}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${p.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${m}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${m}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const c=(0,Ot.w)(),d={ctrl:i,toggleOptionGroup:m=>{const p=i.editorTabs[m];p.isOpen=!p.isOpen,Ea(p.title,Boolean(p.isOpen))}};this.angularOptions=c.load(this.element,d,l),this.angularOptions.digest()}render(){return e.createElement("div",{ref:t=>this.element=t})}}const Pa=(0,A.connect)(It,Rt)(ba);function Ca({plugin:n}){const t=(0,E.wW)(Sa);return e.createElement("div",{className:t.wrapper},e.createElement(ie.b,{title:"Angular panel plugin",severity:"warning"},e.createElement("div",{className:"markdown-html"},e.createElement("p",null,"The selected panel plugin is using deprecated plugin APIs."),e.createElement("ul",null,e.createElement("li",null,e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer"},"Read more on Angular deprecation")),e.createElement("li",null,e.createElement("a",{href:`plugins/${encodeURIComponent(n.meta.id)}`,className:"external-link"},"View plugin details"))))))}function Sa(n){return{wrapper:(0,u.css)({padding:n.spacing(1)})}}var Ye=o(91183),Nt=o(50035),$e=o(3947),Mt=o(6058),At=o(15670),Le=o(64703),Ta=o(55271),xa=o.n(Ta),Da=o(64353),wa=o(51275),Fe=o(8180);const Oa=({property:n,context:t,registry:a,onChange:s,onRemove:r,isSystemOverride:i,searchQuery:l})=>{const c=(0,E.wW)(Ia),d=a?.getIfExists(n.id),m=(0,e.useId)();if(!d)return null;const p=Array.isArray(n.value)||n.id===$e.qb.Thresholds||n.id===$e.qb.Links||n.id===$e.qb.Mappings,g=d.category?.filter(T=>T!==d.name);let y;const b=(T=!0,w=!1)=>(M=!1)=>e.createElement(G.Lh,{justify:"space-between"},e.createElement(Da._,{category:g,description:T?d.description:void 0,htmlFor:m},e.createElement(xa(),{textToHighlight:d.name,searchWords:[l],highlightClassName:"search-fragment-highlight"}),!M&&w&&d.getItemsCount&&e.createElement(wa.A,{value:d.getItemsCount(n.value)})),!i&&e.createElement("div",null,e.createElement(Fe.h,{name:"times",onClick:r})));return p?y=e.createElement(Ye.u,{id:d.name,renderTitle:b(!1,!0),className:u.css`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:n.value!==void 0},e.createElement(d.override,{value:n.value,onChange:T=>{s(T)},item:d,context:t})):y=e.createElement("div",null,e.createElement(me.g,{label:b()(),description:d.description},e.createElement(d.override,{value:n.value,onChange:T=>{s(T)},item:d,context:t,id:m}))),e.createElement("div",{className:(0,u.cx)(p&&c.collapsibleOverrideEditor,!p&&"dynamicConfigValueEditor--nonCollapsible")},y)},Ia=n=>({collapsibleOverrideEditor:u.css`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${n.spacing(1)};
      }
    `});var le=o(91752),Y=o(66352);const $t=({isExpanded:n,registry:t,matcherUi:a,overrideName:s,override:r,onOverrideRemove:i})=>{const l=(0,E.wW)(Ra),d=r.properties.map(p=>t.getIfExists(p.id)).filter(p=>!!p).map(p=>p?.name).join(", "),m=a.optionsToLabel(r.matcher.options);return e.createElement("div",null,e.createElement(G.Lh,{justify:"space-between"},e.createElement("div",null,s),e.createElement(Fe.h,{name:"trash-alt",onClick:i,title:"Remove override"})),!n&&e.createElement("div",{className:l.overrideDetails},e.createElement("div",{className:l.options,title:m},m," ",e.createElement(I.J,{name:"angle-right"})," ",d)))};$t.displayName="OverrideTitle";const Ra=n=>({matcherUi:u.css`
      padding: ${n.spacing(1)};
    `,propertyPickerWrapper:u.css`
      margin-top: ${n.spacing(2)};
    `,overrideDetails:u.css`
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightRegular};
    `,options:u.css`
      overflow: hidden;
      padding-right: ${n.spacing(4)};
    `,unknownLabel:u.css`
      margin-bottom: 0;
    `});function Na(n,t){const a=[],s=n.panel.fieldConfig,r=n.plugin.fieldConfigRegistry,i=n.data?.series??[];if(r.isEmpty())return[];const l=(p,g)=>{let y=(0,oe.cloneDeep)(s.overrides);y[p]=g,n.onFieldConfigsChange({...s,overrides:y})},c=p=>{let g=(0,oe.cloneDeep)(s.overrides);g.splice(p,1),n.onFieldConfigsChange({...s,overrides:g})},d=p=>{const g=Nt.Ls.get(p.value);g&&n.onFieldConfigsChange({...s,overrides:[...s.overrides,{matcher:{id:g.id,options:g.defaultOptions},properties:[]}]})},m={data:i,getSuggestions:p=>(0,Le.PW)(i,p),isOverride:!0};for(let p=0;p<s.overrides.length;p++){const g=s.overrides[p],y=`Override ${p+1}`,b=Mt.i.get(g.matcher.id),T=Ma(r),w=(0,$e.v3)(g),M=g.properties.length===0?1:0,k=new le.j({title:y,id:y,forceOpen:M,renderTitle:function(q){return e.createElement($t,{override:g,isExpanded:q,registry:r,overrideName:y,matcherUi:b,onOverrideRemove:()=>c(p)})}}),x=H=>{g.matcher.options=H,l(p,g)},K=(H,q)=>{const Se=r.get(q.value),Be={id:Se.id,value:Se.defaultValue};g.properties?H.properties.push(Be):H.properties=[Be],l(p,H)};k.addItem(new Y.a({title:b.name,render:function(){return e.createElement(b.component,{id:`${b.matcher.id}-${p}`,matcher:b.matcher,data:n.data?.series??[],options:g.matcher.options,onChange:x})}}));for(let H=0;H<g.properties.length;H++){const q=g.properties[H],Se=r.getIfExists(q.id);if(!Se)continue;const Be=un=>{g.properties[H].value=un,l(p,g)},to=()=>{g.properties.splice(H,1),l(p,g)};k.addItem(new Y.a({title:Se.name,skipField:!0,render:function(){return e.createElement(Oa,{key:`${q.id}/${H}`,isSystemOverride:w,onChange:Be,onRemove:to,property:q,registry:r,context:m,searchQuery:t})}}))}!w&&g.matcher.options&&k.addItem(new Y.a({title:"----------",skipField:!0,render:function(){return e.createElement(At.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:T,onChange:q=>K(g,q)})}})),a.push(k)}return a.push(new le.j({title:"add button",id:"add button",customRender:function(){return e.createElement(Aa,{key:"Add override"},e.createElement(At.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:Mt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function Ma(n){return n.list().filter(t=>!t.hideFromOverrides).map(t=>{let a=t.name;return t.category&&(a=[...t.category,t.name].join(" > ")),{label:a,value:t.id,description:t.description}})}function Aa({children:n}){const t=(0,E.wW)($a);return e.createElement("div",{className:t},n)}function $a(n){return(0,u.css)({borderTop:`1px solid ${n.colors.border.weak}`,padding:`${n.spacing(2)}`,display:"flex"})}const La=({panel:n,formatDate:t})=>{const a=(0,E.wW)(Fa),s=n.libraryPanel?.meta;return s?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${s.connectedDashboards} `,s.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",t?.(s.updated,"L")??s.updated," by",s.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:s.updatedBy.avatarUrl,alt:`Avatar for ${s.updatedBy.name}`}),s.updatedBy.name)):null},Fa=n=>({info:u.css`
      line-height: 1;
    `,libraryPanelInfo:u.css`
      color: ${n.colors.text.secondary};
      font-size: ${n.typography.bodySmall.fontSize};
    `,userAvatar:u.css`
      border-radius: 50%;
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${n.spacing(1)};
      padding-right: ${n.spacing(1)};
    `});function za(n){const{panel:t,onPanelConfigChange:a,dashboard:s}=n,r=new le.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,be.V)(t)&&r.addItem(new Y.a({title:"Name",value:t.libraryPanel.name,popularRank:1,render:function(){return e.createElement(xe.I,{id:"LibraryPanelFrameName",defaultValue:t.libraryPanel.name,onBlur:l=>a("libraryPanel",{...t.libraryPanel,name:l.currentTarget.value})})}})).addItem(new Y.a({title:"Information",render:function(){return e.createElement(La,{panel:t,formatDate:s.formatDate})}})),r}var Ua=o(97379),Ba=o(68037),Va=o(21599);function Wa(n){const{panel:t,onPanelConfigChange:a}=n;return new le.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}).addItem(new Y.a({title:"Title",value:t.title,popularRank:1,render:function(){return e.createElement(xe.I,{id:"PanelFrameTitle",defaultValue:t.title,onBlur:i=>a("title",i.currentTarget.value)})}})).addItem(new Y.a({title:"Description",description:t.description,value:t.description,render:function(){return e.createElement(Ua.K,{id:"description-text-area",defaultValue:t.description,onBlur:i=>a("description",i.currentTarget.value)})}})).addItem(new Y.a({title:"Transparent background",render:function(){return e.createElement(he.r,{value:t.transparent,id:"transparent-background",onChange:i=>a("transparent",i.currentTarget.checked)})}})).addCategory(new le.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:t.links?.length}).addItem(new Y.a({title:"Panel links",render:function(){return e.createElement(Ba.d,{links:t.links,onChange:i=>a("links",i),getSuggestions:Le.PR,data:[]})}}))).addCategory(new le.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new Y.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(Va.X,{id:"repeat-by-variable-select",repeat:t.repeat,onChange:i=>{a("repeat",i)}})}})).addItem(new Y.a({title:"Repeat direction",showIf:()=>!!t.repeat,render:function(){const i=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Me.S,{options:i,value:t.repeatDirection||"h",onChange:l=>a("repeatDirection",l)})}})).addItem(new Y.a({title:"Max per row",showIf:()=>Boolean(t.repeat&&t.repeatDirection==="h"),render:function(){const i=[2,3,4,6,8,12].map(l=>({label:l.toString(),value:l}));return e.createElement(bt.Ph,{options:i,value:t.maxPerRow,onChange:l=>a("maxPerRow",l.value)})}})))}var ka=o(57054);class Ha{constructor(t,a){this.categories=t,this.overrides=a}search(t){const a=new RegExp(t,"i"),r=this.collectHits(this.categories,a,[]).sort(Lt).map(c=>c.item),l=this.collectHits(this.overrides,a,[]).sort(Lt).map(c=>c.item);return{optionHits:r,overrideHits:this.buildOverrideHitCategories(l),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(t,a,s){for(const r of t){const i=a.test(r.props.title);for(const l of r.items){if(a.test(l.props.title)){s.push({item:l,rank:1});continue}if(l.props.description&&a.test(l.props.description)){s.push({item:l,rank:2});continue}i&&s.push({item:l,rank:3})}r.categories.length>0&&this.collectHits(r.categories,a,s)}return s}getAllOptionsCount(t){let a=0;for(const s of t)a+=s.items.length,s.categories.length>0&&(a+=this.getAllOptionsCount(s.categories));return a}buildOverrideHitCategories(t){const a={};for(const s of t){let r=a[s.parent.props.title];r||(r=a[s.parent.props.title]=new le.j(s.parent.props),r.addItem(s.parent.items[0])),r.items[0].props.title!==s.props.title&&r.addItem(s)}return Object.values(a)}}function Lt(n,t){return n.rank-t.rank}function Ka(n){const t=[];for(const a of n)for(const s of a.items)s.props.title==="Unit"&&(s.props.popularRank=2),s.props.title==="Min"&&(s.props.popularRank=3),s.props.title==="Max"&&(s.props.popularRank=4),s.props.title==="Display name"&&(s.props.popularRank=5),s.props.popularRank&&t.push(s);return t.sort((a,s)=>a.props.popularRank-s.props.popularRank)}const ja=n=>{const{plugin:t,dashboard:a,panel:s}=n,[r,i]=(0,e.useState)(""),[l,c]=(0,e.useState)(ae.All),d=(0,E.wW)(Ga),[m,p,g]=(0,e.useMemo)(()=>[Wa(n),(0,ka.AL)(n),za(n)],[s.configRev,n.data,n.instanceState,r]),y=(0,e.useMemo)(()=>Na(n,r),[s.configRev,n.data,n.instanceState,r]),b=[],T=r.length>0,w=(0,e.useMemo)(Qa,[]),M=(0,be.V)(s)?[g,m,...p]:[m,...p];if(T)b.push(Za(M,y,r)),n.plugin.angularPanelCtrl&&b.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(l){case ae.All:(0,be.V)(s)&&b.push(g.render()),b.push(m.render()),n.plugin.angularPanelCtrl&&b.push(e.createElement(Pa,{plugin:t,dashboard:a,panel:s,key:"AngularOptions"}));for(const x of p)b.push(x.render());for(const x of y)b.push(x.render());break;case ae.Overrides:for(const x of y)b.push(x.render());break;case ae.Recent:b.push(e.createElement(Ye.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},Ka(M).map(x=>x.render())));break}const k=!T&&!t.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},s.isAngularPlugin()&&e.createElement(Ca,{plugin:t}),e.createElement("div",{className:d.formRow},e.createElement(wt.H,{width:0,value:r,onChange:i,placeholder:"Search options"})),k&&e.createElement("div",{className:d.formRow},e.createElement(Me.S,{options:w,value:l,fullWidth:!0,onChange:c}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(Pe.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},b))))};function Qa(){return[{label:ae.All,value:ae.All},{label:ae.Overrides,value:ae.Overrides}]}var ae=(n=>(n.All="All",n.Overrides="Overrides",n.Recent="Recent",n))(ae||{});function Za(n,t,a){const s=new Ha(n,t),{optionHits:r,totalCount:i,overrideHits:l}=s.search(a);return e.createElement("div",{key:"search results"},e.createElement(Ye.u,{id:"Found options",title:`Matched ${r.length}/${i} options`,key:"Normal options",forceOpen:1},r.map(c=>c.render(a))),l.map(c=>c.render(a)))}const Ga=n=>({wrapper:u.css`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${n.colors.warning.text};
      background: transparent;
    }
  `,searchBox:u.css`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:u.css`
    margin-bottom: ${n.spacing(1)};
  `,formBox:u.css`
    padding: ${n.spacing(1)};
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top-left-radius: ${n.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:u.css`
    margin-left: ${n.spacing(1)};
  `,searchHits:u.css`
    padding: ${n.spacing(1,1,0,1)};
  `,scrollWrapper:u.css`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:u.css`
    font-size: ${n.typography.size.sm};
    color: ${n.colors.text.secondary};
    padding: ${n.spacing(1)};
    text-align: center;
  `,mainBox:u.css`
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `});var Ja=o(26202),Ya=o(35974);const Ft=n=>t=>t.plugins.panels[n]||(0,Ya.X)(`Panel plugin not found (${n})`,!0),Xe=({panel:n})=>{const t=(0,z.useDispatch)(),a=(0,z.useSelector)(Ft(n.type)),s=(0,z.useSelector)(c=>c.panelEditor.ui.isPanelOptionsVisible),r=(0,z.useSelector)(c=>c.panelEditor.isVizPickerOpen),i=()=>{t((0,te.g_)(!r))},l=()=>{t(He({isPanelOptionsVisible:!s}))};return a?e.createElement("div",{className:zt.wrapper},e.createElement(Ja.h,null,e.createElement(Ae.h,{className:zt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:r,onClick:i,"data-testid":v.wl.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(Ae.h,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:l,variant:"canvas","data-testid":v.wl.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"}))):null};Xe.displayName="VisualizationTab";const zt={wrapper:u.css`
    display: flex;
    flex-direction: column;
  `,vizButton:u.css`
    text-align: left;
  `};var Xa=o(23934),qa=o(84952),_a=o(9398),er=o(53708),tr=o(76647),Ut=o(98102);const nr=({onConfirm:n,onDismiss:t,panel:a})=>{const s=(0,be.V)(a),r=`${s?"Changing":"Replace with"} library panel`,i=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Ut.s,{onConfirm:n,onDismiss:t,confirmText:s?"Change":"Replace",title:r,body:i,dismissText:"Cancel",isOpen:!0})};var ar=o(18027);const rr=({panel:n,searchQuery:t})=>{const[a,s]=(0,e.useState)(!1),[r,i]=(0,e.useState)(void 0),[l,c]=(0,e.useState)([]),d=(0,e.useCallback)(T=>{c(T.map(w=>w.id))},[c]),m=(0,_a.h4)().getCurrent(),p=(0,z.useDispatch)(),g=async()=>{r&&(i(void 0),p((0,De.ih)(n,r)))},y=()=>s(!0),b=()=>i(void 0);return e.createElement(G.wc,{spacing:"md"},!n.libraryPanel&&e.createElement(G.wc,{align:"center"},e.createElement(F.zx,{icon:"plus",onClick:y,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(er.j,{onChange:d}),e.createElement("div",{className:sr.libraryPanelsView},e.createElement(ar.u,{currentPanelId:n.libraryPanel?.uid,searchString:t,panelFilter:l,onClickCard:i,showSecondaryActions:!0})),a&&e.createElement(tr.c,{panel:n,onDismiss:()=>s(!1),initialFolderUid:m?.meta.folderUid,isOpen:a}),r&&e.createElement(nr,{panel:n,onDismiss:b,onConfirm:g}))},sr={libraryPanelsView:u.css`
    width: 100%;
  `};var qe=o(82229),or=o(38490);const ir=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick"];async function lr(n,t){const a=new qe.mi(n,t);for(const r of ir){const l=(await(0,or.Ub)(r)).getSuggestionsSupplier();l&&l.getSuggestionsForData(a)}const s=a.getList();if(a.dataSummary.fieldCount===0)for(const r of Object.values(D.v.panels))!r.skipDataQuery||r.hideFromList||s.push({name:r.name,pluginId:r.id,description:r.info.description,cardOptions:{imgSrc:r.info.logos.small}});return s.sort((r,i)=>(i.score??qe._.OK)-(r.score??qe._.OK))}var Bt=o(98141);function cr({data:n,suggestion:t,onChange:a,width:s}){const r=(0,E.wW)(dr),{innerStyles:i,outerStyles:l,renderWidth:c,renderHeight:d}=ur(s),m=t.cardOptions??{},p={"aria-label":t.name,className:r.vizBox,"data-testid":v.wl.components.VisualizationPreview.card(t.name),style:l,onClick:()=>{a({pluginId:t.pluginId,options:t.options,fieldConfig:t.fieldConfig})}};if(m.imgSrc)return e.createElement(ye.u,{content:t.description??t.name},e.createElement("button",{...p,className:(0,u.cx)(r.vizBox,r.imgBox)},e.createElement("div",{className:r.name},t.name),e.createElement("img",{className:r.img,src:m.imgSrc,alt:t.name})));let g=t;return t.cardOptions?.previewModifier&&(g=(0,oe.cloneDeep)(t),t.cardOptions.previewModifier(g)),e.createElement("button",{...p},e.createElement(ye.u,{content:t.name},e.createElement("div",{style:i,className:r.renderContainer},e.createElement(Bt.$,{title:"",data:n,pluginId:t.pluginId,width:c,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:r.hoverPane}))))}const dr=n=>({hoverPane:(0,u.css)({position:"absolute",top:0,right:0,left:0,borderRadius:n.spacing(2),bottom:0}),vizBox:u.css`
      position: relative;
      background: none;
      border-radius: ${n.shape.borderRadius(1)};
      cursor: pointer;
      border: 1px solid ${n.colors.border.medium};

      transition: ${n.transitions.create(["background"],{duration:n.transitions.duration.short})};

      &:hover {
        background: ${n.colors.background.secondary};
      }
    `,imgBox:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${n.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:u.css`
      padding-bottom: ${n.spacing(.5)};
      margin-top: ${n.spacing(-1)};
      font-size: ${n.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:u.css`
      max-width: ${n.spacing(8)};
      max-height: ${n.spacing(8)};
    `,renderContainer:u.css`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function ur(n){const a=n,s=n*(1/1.6),r=350,i=r*(1/1.6),l=6,c=(a-l*2)/r,d=(s-l*2)/i;return{renderHeight:i,renderWidth:r,outerStyles:{width:a,height:s},innerStyles:{width:r,height:i,transform:`scale(${c}, ${d})`}}}function pr({onChange:n,data:t,panel:a,searchQuery:s}){const r=(0,E.wW)(hr),{value:i}=(0,Te.Z)(()=>lr(t,a),[t,a]),l=mr(s,i);return e.createElement(Ie.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:c})=>{if(!c)return null;const d=Math.floor(c/170),m=8*(d-1),p=(c-m)/d;return e.createElement("div",null,e.createElement("div",{className:r.filterRow},e.createElement("div",{className:r.infoText},"Based on current data")),e.createElement("div",{className:r.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${p-1}px)`}},l.map((g,y)=>e.createElement(cr,{key:y,data:t,suggestion:g,onChange:n,width:p})),s&&l.length===0&&e.createElement("div",{className:r.infoText},"No results matched your query")))})}function mr(n,t){if(!n||!t)return t||[];const a=new RegExp(n,"i");return t.filter(s=>a.test(s.name)||a.test(s.pluginId))}const hr=n=>({heading:(0,u.css)({...n.typography.h5,margin:n.spacing(0,.5,1)}),filterRow:(0,u.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,u.css)({fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,fontStyle:"italic"}),grid:(0,u.css)({display:"grid",gridGap:n.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:n.spacing(1),justifyContent:"space-evenly"})});var gr=o(69097),Vt=o(13440),fr=o(89710);const Wt=({isCurrent:n,plugin:t,onClick:a,disabled:s})=>e.createElement(fr.X,{title:t.name,plugin:t,description:t.info.description,onClick:a,isCurrent:n,disabled:s,showBadge:!0});Wt.displayName="VizTypePickerPlugin";function vr({searchQuery:n,onChange:t,current:a,data:s}){const r=(0,E.wW)(Er),i=(0,e.useMemo)(()=>(0,Vt.x)(),[]),l=(0,e.useMemo)(()=>(0,Vt.r)(i,n,a),[a,i,n]);return l.length===0?e.createElement(gr.K,null,"Could not find anything matching your query"):e.createElement("div",{className:r.grid},l.map((c,d)=>e.createElement(Wt,{disabled:!1,key:c.id,isCurrent:c.id===a.id,plugin:c,onClick:m=>t({pluginId:c.id,withModKey:Boolean(m.metaKey||m.ctrlKey||m.altKey)})})))}const Er=n=>({grid:u.css`
      max-width: 100%;
      display: grid;
      grid-gap: ${n.spacing(.5)};
    `,heading:(0,u.css)({...n.typography.h5,margin:n.spacing(0,.5,1)})});var U=o(16200);const kt=({panel:n,data:t})=>{const a=(0,z.useSelector)(Ft(n.type)),[s,r]=(0,e.useState)(""),[i,l]=(0,Xa.Z)(qa.FL,U.Ok.Visualizations),c=(0,z.useDispatch)(),d=(0,E.wW)(yr),m=(0,e.useRef)(null),p=(0,e.useCallback)(b=>{c((0,De.Kc)({panel:n,...b})),b.withModKey||c((0,te.g_)(!1))},[c,n]),g=()=>{c((0,te.g_)(!1))};if(!a)return null;const y=[{label:"Visualizations",value:U.Ok.Visualizations},{label:"Suggestions",value:U.Ok.Suggestions},{label:"Library panels",value:U.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:d.openWrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.searchRow},e.createElement(wt.H,{value:s,onChange:r,ref:m,autoFocus:!0,placeholder:"Search for..."}),e.createElement(F.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:d.closeButton,"aria-label":v.wl.components.PanelEditor.toggleVizPicker,onClick:g})),e.createElement(me.g,{className:d.customFieldMargin},e.createElement(Me.S,{options:y,value:i,onChange:l,fullWidth:!0}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(Pe.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.scrollContent},i===U.Ok.Visualizations&&e.createElement(vr,{current:a.meta,onChange:p,searchQuery:s,data:t,onClose:()=>{}}),i===U.Ok.Suggestions&&e.createElement(pr,{current:a.meta,onChange:p,searchQuery:s,panel:n,data:t,onClose:()=>{}}),i===U.Ok.LibraryPanels&&e.createElement(rr,{searchQuery:s,panel:n,key:"Panel Library"})))))};kt.displayName="VisualizationSelectPane";const yr=n=>({icon:u.css`
      color: ${n.v1.palette.gray33};
    `,wrapper:u.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:u.css`
      text-align: left;
    `,scrollWrapper:u.css`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:u.css`
      padding: ${n.spacing(1)};
    `,openWrapper:u.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.colors.border.weak};
    `,searchRow:u.css`
      display: flex;
      margin-bottom: ${n.spacing(1)};
    `,closeButton:u.css`
      margin-left: ${n.spacing(1)};
    `,customFieldMargin:u.css`
      margin-bottom: ${n.spacing(1)};
    `,formBox:u.css`
      padding: ${n.spacing(1)};
      padding-bottom: 0;
    `}),br=({plugin:n,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r,dashboard:i,instanceState:l})=>{const c=(0,E.wW)(Pr),d=(0,z.useSelector)(p=>p.panelEditor.isVizPickerOpen),{data:m}=Qe(t,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:c.wrapper,"aria-label":v.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:c.vizButtonWrapper},e.createElement(Xe,{panel:t})),e.createElement("div",{className:c.optionsWrapper},e.createElement(ja,{panel:t,dashboard:i,plugin:n,instanceState:l,data:m,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r}))),d&&e.createElement(kt,{panel:t,data:m}))},Pr=n=>({wrapper:u.css`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:u.css`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:u.css`
      padding: 0 ${n.spacing(2,2)} 0;
    `,legacyOptions:u.css`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${n.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${n.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var Ht=o(82378),Cr=o(38208),Sr=o(53821);function Tr({width:n,height:t,panel:a,dashboard:s}){const{data:r}=Qe(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,l]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,e.useEffect)(()=>{const d=(0,ve.$t)(),m=a.events.subscribe(Ht.U5,()=>{const p=(0,ke.W1)(a,d.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:p,width:n})});return()=>{m.unsubscribe()}},[a,s,n]),!r)return null;const c=r?.errors?r.errors.length>1?"Multiple errors found. Click for more details":r.errors[0].message:r?.error?.message;return e.createElement(Cr.fm,{width:n,height:t,padding:"none"},(d,m)=>e.createElement(e.Fragment,null,e.createElement(Sr.Z,{panel:a,error:c}),e.createElement(Bt.$,{title:"Raw data",pluginId:"table",width:d,height:m,data:r,options:i,onOptionsChange:l})))}var Kt=o(32434),_e=o(40419),xr=o(94893),Dr=o(50444),wr=o(69142);function jt({message:n}){const t=(0,e.useCallback)(()=>{S.E1.partial({tab:U.Ip.Query})},[]);return e.createElement(G.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(G.wc,{spacing:"md"},e.createElement("h2",null,n),e.createElement("div",null,e.createElement(F.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:t},"Go back to Queries"))))}var et=o(54899),Or=o(71657),Qt=o(67162);class Ir extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:t,panelId:a,onRefresh:s}=this.props;await(0,et.i)().post("/api/annotations/mass-delete",{dashboardId:t.id,panelId:a}),this.setState({stateHistoryItems:[]}),s()}}componentDidMount(){const{dashboard:t,panelId:a}=this.props;(0,et.i)().get(`/api/annotations?dashboardId=${t.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${t.id}-${a}`).then(s=>{const r=s.map(i=>({stateModel:Qt.Z.getStateDisplayModel(i.newState),time:t.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:Qt.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:r})})}render(){const{stateHistoryItems:t}=this.state;return e.createElement("div",null,t.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(Or.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(F.zx,{className:u.css`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},t.length>0?t.map((a,s)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${s}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(I.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const Rr=Ir;var Zt=o(61744),tt=o(16065);class Nr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=t=>{this.formattedJson=t},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(t=>({...t,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:t}=this.state,a=e.createElement(e.Fragment,null,e.createElement(I.J,{name:"minus-circle"})," Collapse All"),s=e.createElement(e.Fragment,null,e.createElement(I.J,{name:"plus-circle"})," Expand All");return t?a:s}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:t,panel:a}=this.props,s=t.getSaveModelClone();s.panels=s.panels.map(l=>l.id===a.id?a.getSaveModel():l);const r={dashboard:s,panelId:a.id};this.setState({isLoading:!0});const i=await(0,et.i)().post("/api/alerts/test",r);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:t,isLoading:a}=this.state,s=(0,F.gN)(this.props.theme);if(a===!0)return e.createElement(Zt.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(G.Lh,{spacing:"md"},e.createElement("button",{type:"button",className:s,onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(je.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(tt.g,{json:t,open:r,onDidRender:this.setFormattedJson}))}}const Mr=(0,E.HE)(Nr);var Ar=o(44927);class $r extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=t=>{const a=this.state[t];this.setState({...this.state,[t]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:t,dashboard:a}=this.props,s=()=>this.onToggleModal("showTestRule");return e.createElement(pe.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:s,onClickBackdrop:s},e.createElement(Mr,{panel:t,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:t}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Ut.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete t.alert,t.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:t,dashboard:a}=this.props,s=()=>this.onToggleModal("showStateHistory");return e.createElement(pe.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:s,onClickBackdrop:s},e.createElement(Rr,{dashboard:a,panelId:t.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){D.v.angularSupportEnabled?(await Promise.all([o.e(6093),o.e(5718)]).then(o.bind(o,30789)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(t){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:t,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const c=a.getScope();if(!c.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=c.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const s=(0,Ot.w)(),r="<alert-tab />",i={ctrl:this.panelCtrl};this.component=s.load(this.element,i,r);const l=await(0,Ar.E)(t.transformations,t.targets,(0,St.F)(),t.datasource);l&&this.setState({validationMessage:l})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new Dr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:t,transformations:a}=this.props.panel,{validationMessage:s}=this.state,r=a&&a.length>0;if(!t&&s)return e.createElement(jt,{message:s});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(Pe.$,{autoHeightMin:"100%"},e.createElement(G.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.AlertTab.content},t&&r&&e.createElement(ie.b,{severity:z.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:l=>this.element=l}),t&&e.createElement(G.Lh,null,e.createElement(F.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(F.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(F.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!t&&!s&&e.createElement(wr.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Lr=(n,t)=>({angularPanelComponent:(0,Oe.i)(n,t.panel)?.angularComponent}),Fr={},zr=(0,A.connect)(Lr,Fr)($r);var Ur=o(49187),Br=o(54408),Vr=o(41904),Wr=o(21767);const Gt=({dashboard:n,panel:t,className:a})=>{const s=(0,z.useSelector)(d=>d.templating),r=(0,Ve.TH)(),{loading:i,value:l}=(0,Te.Z)(()=>(0,Wr.aR)(t,n),[t,n,s]);if(i)return e.createElement(F.zx,{disabled:!0},"Create alert rule from this panel");if(!l)return e.createElement(ie.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const c=Ur.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:r.pathname+r.search});return e.createElement(F.Qj,{icon:"bell",onClick:()=>(0,Br.PN)(Vr.z7.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button"},"Create alert rule from this panel")};var kr=o(8347),Jt=o(72004),nt=o(37190),ge=o(45849),Yt=o(46818),Hr=o(61627),Xt=o(69945);function qt({dashboard:n,panel:t,poll:a=!1}){const s=(0,z.useDispatch)(),r=(0,Xt._)(p=>p.promRules[ge.GC])??Yt.oq,i=(0,Xt._)(p=>p.rulerRules[ge.GC])??Yt.oq;(0,e.useEffect)(()=>{const p=()=>{s((0,Jt.y6)({rulesSourceName:ge.GC,filter:{dashboardUID:n.uid,panelId:t.id}})),s((0,Jt.UR)({rulesSourceName:ge.GC,filter:{dashboardUID:n.uid,panelId:t.id}}))};if(p(),a){const g=setInterval(p,nt.p4);return()=>{clearInterval(g)}}return()=>{}},[s,a,t.id,n.uid]);const l=r.loading||i.loading,c=[r.error,i.error].filter(p=>!!p),d=(0,Hr.Zo)(ge.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(p=>p.groups).flatMap(p=>p.rules).filter(p=>p.annotations[nt.q6.dashboardUID]===n.uid&&p.annotations[nt.q6.panelID]===String(t.id)),[d,n,t]),errors:c,loading:l}}var _t=o(97953);const Kr=({dashboard:n,panel:t})=>{const a=(0,E.wW)(jr),{errors:s,loading:r,rules:i}=qt({dashboard:n,panel:t,poll:!0}),l=(0,_t.Bz)("grafana"),c=ue.Vt.hasPermission(l.create),d=s.length?e.createElement(ie.b,{title:"Errors loading rules",severity:"error"},s.map((m,p)=>e.createElement("div",{key:p},"Failed to load Grafana rules state: ",m.message||"Unknown error."))):null;return r&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(Zt.u,{text:"Loading rules..."})):i.length?e.createElement(Pe.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(kr.i,{rules:i}),!!n.meta.canSave&&c&&e.createElement(Gt,{className:a.newButton,panel:t,dashboard:n}))):e.createElement("div",{"aria-label":v.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!n.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!n.meta.canSave&&c&&e.createElement(Gt,{panel:t,dashboard:n})),!n.uid&&!!n.meta.canSave&&e.createElement(ie.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},jr=n=>({newButton:u.css`
    margin-top: ${n.spacing(3)};
  `,innerWrapper:u.css`
    padding: ${n.spacing(2)};
  `,noRulesWrapper:u.css`
    margin: ${n.spacing(2)};
    background-color: ${n.colors.background.secondary};
    padding: ${n.spacing(3)};
  `}),Qr=D.v.unifiedAlertingEnabled?Kr:zr,Zr=({panel:n,dashboard:t,...a})=>{const{rules:s,loading:r}=qt({panel:n,dashboard:t});return e.createElement(fe.O,{...a,counter:r?null:s.length})};var en=o(36826),at=o(2653),ze=o(65180),Ue=o(72948),Gr=o(59796);const Jr={[ze.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[ze.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[ze.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},Yr=n=>Jr[n];var tn=o(81731),nn=o(95831),Xr=o(90748),qr=o(19117),Ce=o(1029),_r=o(67254),es=o(39859),rt=o(13946);const ts=({debugMode:n,index:t,data:a,uiConfig:s,configs:r,onChange:i})=>{const l=(0,E.wW)(ns),[c,d]=(0,e.useState)([]),[m,p]=(0,e.useState)([]),g=(0,e.useMemo)(()=>r[t],[r,t]);(0,e.useEffect)(()=>{const b=r[t].transformation,T=b.filter?.options?(0,Nt.b9)(b.filter):void 0,w=r.slice(0,t).map(K=>K.transformation),M=r.slice(t,t+1).map(K=>K.transformation),k=(0,rt.H)(w,a).subscribe(K=>{T&&(K=a.filter(H=>T(H))),d(K)}),x=(0,rt.H)(w,a).pipe((0,es.z)(K=>(0,rt.H)(M,K))).subscribe(p);return function(){k.unsubscribe(),x.unsubscribe()}},[t,a,r]);const y=(0,e.useMemo)(()=>e.createElement(s.editor,{options:{...s.transformation.defaultOptions,...g.transformation.options},input:c,onChange:b=>{i(t,{...g.transformation,options:b})}}),[s.editor,s.transformation.defaultOptions,g.transformation,c,i,t]);return e.createElement("div",{className:l.editor,"aria-label":v.wl.components.TransformTab.transformationEditor(s.name)},y,n&&e.createElement("div",{className:l.debugWrapper,"aria-label":v.wl.components.TransformTab.transformationEditorDebugger(s.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation input data"),e.createElement("div",{className:l.debugJson},e.createElement(tt.g,{json:c}))),e.createElement("div",{className:l.debugSeparator},e.createElement(I.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation output data"),e.createElement("div",{className:l.debugJson},m&&e.createElement(tt.g,{json:m})))))},ns=n=>{const t=n.isLight?n.v1.palette.gray85:n.v1.palette.gray15;return{title:u.css`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:u.css`
      font-weight: ${n.typography.fontWeightMedium};
      color: ${n.colors.primary.text};
    `,iconRow:u.css`
      display: flex;
    `,icon:u.css`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${n.colors.text.secondary};
      margin-left: ${n.spacing(1)};
      &:hover {
        color: ${n.colors.text};
      }
    `,editor:u.css``,debugWrapper:u.css`
      display: flex;
      flex-direction: row;
    `,debugSeparator:u.css`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${n.spacing(.5)};
      color: ${n.colors.primary.text};
    `,debugTitle:u.css`
      padding: ${n.spacing(1)} ${n.spacing(.25)};
      font-family: ${n.typography.fontFamilyMonospace};
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text};
      border-bottom: 1px solid ${t};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:u.css`
      margin-top: ${n.spacing(1)};
      padding: 0 ${n.spacing(1,1,1)};
      border: 1px solid ${t};
      background: ${n.isLight?n.v1.palette.white:n.v1.palette.gray05};
      border-radius: ${n.shape.borderRadius(1)};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:u.css`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${n.spacing(.5)};
    `}};var as=o(92465);const rs=({index:n,data:t,config:a,onChange:s})=>{const r=(0,E.wW)(ss),i=(0,e.useMemo)(()=>({data:t}),[t]);return e.createElement("div",{className:r.wrapper},e.createElement(me.g,{label:"Apply transformation to"},e.createElement(as.M,{value:a.filter,context:i,item:{},onChange:l=>s(n,{...a,filter:l})})))},ss=n=>{const t=n.shape.borderRadius();return{wrapper:u.css`
      padding: ${n.spacing(2)};
      border: 2px solid ${n.colors.background.secondary};
      border-top: none;
      border-radius: 0 0 ${t} ${t};
      position: relative;
      top: -4px;
    `}},os=({onRemove:n,index:t,id:a,data:s,configs:r,uiConfig:i,onChange:l})=>{const[c,d]=(0,nn.Z)(!1),[m,p]=(0,nn.Z)(!1),g=!!r[t].transformation.disabled,y=r[t].transformation.filter!=null,b=y||s.length>1,T=(0,e.useCallback)(x=>{const K=r[x].transformation;l(x,{...K,disabled:K.disabled?void 0:!0})},[l,r]),w=(0,e.useCallback)(()=>{let x={...r[t].transformation};x.filter?delete x.filter:x.filter={id:Xr.E4.byRefId,options:""},l(t,x)},[l,t,r]),M=(0,e.useCallback)((x,K,H)=>q=>{(0,P.ff)("panel_editor_tabs_transformations_toggle",{action:H?"off":"on",toggleId:K,transformationId:r[t].transformation.id}),x(q)},[r,t]),k=({isOpen:x})=>e.createElement(G.Lh,{align:"center",width:"auto"},i.state&&e.createElement(tn.u,{state:i.state}),e.createElement(Ce.V,{title:"Show transform help",icon:"info-circle",onClick:M(p,"help",m),active:m}),b&&e.createElement(Ce.V,{title:"Filter",icon:"filter",onClick:M(w,"filter",y),active:y}),e.createElement(Ce.V,{title:"Debug",disabled:!x,icon:"bug",onClick:M(d,"debug",c),active:c}),e.createElement(Ce.V,{title:"Disable transformation",icon:g?"eye-slash":"eye",onClick:M(()=>T(t),"disabled",g),active:g}),e.createElement(Ce.y,{title:"Remove",icon:"trash-alt",onClick:()=>n(t)}));return e.createElement(_r.t,{id:a,index:t,title:i.name,draggable:!0,actions:k,disabled:g},m&&e.createElement(qr.h,{markdown:is(i)}),y&&e.createElement(rs,{index:t,config:r[t].transformation,data:s,onChange:l}),e.createElement(ts,{debugMode:c,index:t,data:s,configs:r,uiConfig:i,onChange:l}))};function is(n){return`
${n.help??n.description}

Go the <a href="https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana" target="_blank" rel="noreferrer">
transformation documentation
</a> for more.
`}const ls=({data:n,onChange:t,onRemove:a,configs:s})=>e.createElement(e.Fragment,null,s.map((r,i)=>{const l=at.Z.getIfExists(r.transformation.id);return l?e.createElement(os,{index:i,id:`${r.id}`,key:`${r.id}`,data:n,configs:s,uiConfig:l,onRemove:a,onChange:t}):null})),cs="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";class ds extends e.PureComponent{constructor(t){super(t),this.onSearchChange=r=>{this.setState({search:r.target.value})},this.onSearchKeyDown=r=>{if(r.key==="Enter"){const{search:i}=this.state;if(i){const l=i.toLowerCase(),c=at.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(l)>=0);c.length>0&&this.onTransformationAdd({value:c[0].id})}}else r.keyCode===27&&(this.setState({search:"",showPicker:!1}),r.stopPropagation())},this.getTransformationNextId=r=>{const{transformations:i}=this.state;let l=0;const c=i.filter(d=>d.id.startsWith(r)).map(d=>d.id);return c.length!==0&&(l=Math.max(...c.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${r}-${l}`},this.onTransformationAdd=r=>{(0,P.ff)("panel_editor_tabs_transformations_management",{action:"add",transformationId:r.value});const{transformations:i}=this.state,l=this.getTransformationNextId(r.value);this.setState({search:"",showPicker:!1}),this.onChange([...i,{id:l,transformation:{id:r.value,options:{}}}])},this.onTransformationChange=(r,i)=>{const{transformations:l}=this.state,c=Array.from(l);(0,P.ff)("panel_editor_tabs_transformations_management",{action:"change",transformationId:c[r].transformation.id}),c[r].transformation=i,this.onChange(c)},this.onTransformationRemove=r=>{const{transformations:i}=this.state,l=Array.from(i);(0,P.ff)("panel_editor_tabs_transformations_management",{action:"remove",transformationId:l[r].transformation.id}),l.splice(r,1),this.onChange(l)},this.onDragEnd=r=>{const{transformations:i}=this.state;if(!r||!r.destination)return;const l=r.source.index,c=r.destination.index;if(l===c)return;const d=Array.from(i),[m]=d.splice(l,1);d.splice(c,0,m),this.onChange(d)},this.renderTransformationEditors=()=>{const{data:r,transformations:i}=this.state;return e.createElement(en.Z5,{onDragEnd:this.onDragEnd},e.createElement(en.bK,{droppableId:"transformations-list",direction:"vertical"},l=>e.createElement("div",{ref:l.innerRef,...l.droppableProps},e.createElement(ls,{configs:i,data:r,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),l.placeholder)))};const a=t.panel.transformations||[],s=this.buildTransformationIds(a);this.state={transformations:a.map((r,i)=>({transformation:r,id:s[i]})),data:[],search:""}}buildTransformationIds(t){const a={},s=[];for(let r=0;r<t.length;r++){const i=t[r];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,s.push(`${t[r].id}-${a[t[r].id]}`)}return s}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.setState({data:t.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}onChange(t){this.setState({transformations:t}),this.props.panel.setTransformations(t.map(a=>a.transformation))}renderTransformsPicker(){const{transformations:t,search:a}=this.state;let s=null,r=at.Z.list().sort((c,d)=>c.name>d.name?1:d.name>c.name?-1:0);if(a){const c=a.toLowerCase(),d=r.filter(m=>(m.name+m.description).toLowerCase().indexOf(c)>=0);s=e.createElement(e.Fragment,null,d.length," / ",r.length," \xA0\xA0",e.createElement(Fe.h,{name:"times",onClick:()=>{this.setState({search:""})}})),r=d}const i=!t?.length,l=i||this.state.showPicker;return!s&&l&&!i&&(s=e.createElement(Fe.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})}})),e.createElement(e.Fragment,null,i&&e.createElement(G.W2,{grow:1},e.createElement(Gr.G,{storageKey:cs,defaultValue:!1},(c,d)=>c?null:e.createElement(ie.b,{title:"Transformations",severity:"info",onRemove:()=>{d(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:Yr(ze.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),l?e.createElement(G.wc,null,e.createElement(xe.I,{"aria-label":v.wl.components.Transforms.searchInput,value:a??"",autoFocus:!i,placeholder:"Add transformation",onChange:this.onSearchChange,onKeyDown:this.onSearchKeyDown,suffix:s}),r.map(c=>e.createElement(us,{key:c.name,transform:c,onClick:()=>{this.onTransformationAdd({value:c.id})}}))):e.createElement(F.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})}},"Add transformation"))}render(){const{panel:{alert:t}}=this.props,{transformations:a}=this.state,s=a.length>0;return!s&&t?e.createElement(jt,{message:"Transformations can't be used on a panel with existing alerts"}):e.createElement(Pe.$,{autoHeightMin:"100%"},e.createElement(G.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.TransformTab.content},s&&t?e.createElement(ie.b,{severity:z.AppNotificationSeverity.Error,title:"Transformations can't be used on a panel with alerts"}):null,s&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}function us({transform:n,onClick:t}){const a=(0,E.wW)(ps);return e.createElement(Ue.Z,{className:a.card,"aria-label":v.wl.components.TransformTab.newTransform(n.name),onClick:t},e.createElement(Ue.Z.Heading,null,n.name),e.createElement(Ue.Z.Description,null,n.description),n.state&&e.createElement(Ue.Z.Tags,null,e.createElement(tn.u,{state:n.state})))}const ps=n=>({card:u.css`
      margin: 0;
      padding: ${n.spacing(1)};
    `}),ms=(0,E.Zz)(ds);var hs=o(73446),an=o(91162),gs=o(91579);class fs extends e.PureComponent{constructor(t){super(t),this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{S.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},s=(0,an.ak)().getInstanceSettings(a);return{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:s?.isDefault,type:s?.type,uid:s?.uid},queryCachingTTL:s?.cachingConfig?.enabled?t.queryCachingTTL:void 0,queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){const a=(0,an.ak)().getInstanceSettings(null);t.datasource=(0,hs.iU)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return e.createElement(gs.D,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const rn=e.memo(({panel:n,dashboard:t,tabs:a,onChangeTab:s})=>{const r=(0,Kt.N)(),i=(0,E.wW)(Es),l=(0,e.useCallback)(d=>{d.active||(0,P.ff)("panel_editor_tabs_changed",{tab_id:d.id}),s(d)},[s]);(0,e.useEffect)(()=>{const d=new Tt.w0;return d.add(n.events.subscribe(ee.pO,r)),d.add(n.events.subscribe(ee.Xw,r)),()=>d.unsubscribe()},[n,t,r]);const c=a.find(d=>d.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(Ke.J,{className:i.tabBar,hideBorder:!0},a.map(d=>d.id===U.Ip.Alert?vs(d,n,t,l):e.createElement(fe.O,{key:d.id,label:d.text,active:d.active,onChangeTab:()=>l(d),icon:(0,_e.toIconName)(d.icon),counter:sn(n,d)}))),e.createElement(xr.I,{className:i.tabContent},c.id===U.Ip.Query&&e.createElement(fs,{panel:n,queries:n.targets}),c.id===U.Ip.Alert&&e.createElement(Qr,{panel:n,dashboard:t}),c.id===U.Ip.Transform&&e.createElement(ms,{panel:n})))});rn.displayName="PanelEditorTabs";function sn(n,t){switch(t.id){case U.Ip.Query:return n.targets.length;case U.Ip.Alert:return n.alert?1:0;case U.Ip.Transform:return(n.getTransformations()??[]).length}return null}function vs(n,t,a,s){return!D.v.alertingEnabled&&!D.v.unifiedAlertingEnabled?null:D.v.unifiedAlertingEnabled?e.createElement(Zr,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>s(n),icon:(0,_e.toIconName)(n.icon),panel:t,dashboard:a}):D.v.alertingEnabled?e.createElement(fe.O,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>s(n),icon:(0,_e.toIconName)(n.icon),counter:sn(t,n)}):null}const Es=n=>({wrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:u.css`
      padding-left: ${n.spacing(2)};
    `,tabContent:u.css`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${n.shape.borderRadius(1.5)};
    `});var ys=o(58635),bs=o(47694);const Ps=(0,ys.Z)((n,t)=>{const a=[];if(!t)return a;let s=U.Ip.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(s=U.Ip.Query,a.push({id:U.Ip.Query,text:"Query",icon:"database",active:!1}),a.push({id:U.Ip.Transform,text:"Transform",icon:"process",active:!1}));const{alertingEnabled:r,unifiedAlertingEnabled:i}=(0,bs.iE)(),l=ue.Vt.hasPermission((0,_t.Bz)(ge.GC).read),c=r||i&&l,d=t.meta.id==="graph",m=t.meta.id==="timeseries";(c&&d||m)&&a.push({id:U.Ip.Alert,text:"Alert",icon:"bell",active:!1});const p=a.find(g=>g.id===(n||s))??a[0];return p.active=!0,a}),Cs=(n,t)=>{const a=n.panelEditor.getPanel(),s=(0,Oe.i)(n,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:n.panelEditor.initDone,uiState:n.panelEditor.ui,tableViewEnabled:n.panelEditor.tableViewEnabled,variables:(0,Je.gt)(t.dashboard.uid,n)}},Ss={initPanelEditor:Sn,discardPanelChanges:mt,updatePanelEditorUIState:He,updateTimeZoneForSession:ma.YT,toggleTableView:te.OT,notifyApp:Q.$l},Ts=(0,A.connect)(Cs,Ss);class xs extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{S.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{la.h$.publish(new ee.Dn({component:va.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,be.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{S.E1.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{S.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Tt.w0,this.eventSubs.add(t.events.subscribe(ee.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:s,panel:r,uiState:i,tableViewEnabled:l,theme:c}=this.props;return e.createElement("div",{className:t.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(t),e.createElement("div",{className:t.panelWrapper},e.createElement(Ie.Z,null,({width:d,height:m})=>{if(d<3||m<3)return null;if(a&&(m-=c.spacing.gridSize*2),l)return e.createElement(Tr,{width:d,height:m,panel:r,dashboard:s});const p=(0,Ze.jF)(i.mode,d,m,r);return e.createElement("div",{className:t.centeringContainer,style:{width:d,height:m}},e.createElement("div",{style:p,"data-panelid":r.id},e.createElement(ga.l,{key:r.key,stateKey:r.key,dashboard:s,panel:r,isEditing:!0,isViewing:!1,lazy:!1,width:p.width,height:p.height})))})))}renderPanelAndEditor(t,a){const{panel:s,dashboard:r,plugin:i,tab:l}=this.props,c=Ps(l,i),d=c.length===0,m=this.renderPanel(a,d);return c.length===0?e.createElement("div",{className:a.onlyPanel},m):e.createElement(xt.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:p=>{p&&He({topPaneSize:p/window.innerHeight})}},m,e.createElement("div",{className:a.tabsWrapper,"aria-label":v.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(rn,{key:s.key,panel:s,dashboard:r,tabs:c,onChangeTab:this.onChangeTab})))}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?e.createElement("div",{className:t.variablesWrapper},e.createElement(Dt,{variables:a})):null}renderPanelToolbar(t){const{dashboard:a,uiState:s,variables:r,updateTimeZoneForSession:i,panel:l,tableViewEnabled:c}=this.props;return e.createElement("div",{className:t.panelToolbar},e.createElement(G.Lh,{justify:r.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(t),e.createElement(Re.Stack,{gap:1},e.createElement(he.x,{label:"Table view",showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"aria-label":v.wl.components.PanelEditor.toggleTableView}),e.createElement(Me.S,{value:s.mode,options:U.d7,onChange:this.onDisplayModeChange}),e.createElement(fa.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!s.isPanelOptionsVisible&&e.createElement(Xe,{panel:l}))))}renderEditorActions(){const t="sm";let a=[e.createElement(F.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:t,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(F.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(F.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:t,variant:"secondary"},"Save"),e.createElement(F.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":v.wl.components.PanelEditor.applyButton,key:"apply",size:t},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(dt.JY,{key:"unlink-controller"},({showModal:s,hideModal:r})=>e.createElement(Ae.h,{onClick:()=>{s(ha.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:r,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:s,instanceState:r}=this.props;return t?e.createElement(br,{plugin:t,dashboard:a,panel:s,instanceState:r,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}renderToolbar(){return e.createElement(ia.A,{actions:e.createElement(sa.R,{alignment:"right"},this.renderEditorActions())})}render(){const{initDone:t,uiState:a,theme:s,sectionNav:r,pageNav:i,className:l,updatePanelEditorUIState:c}=this.props,d=ws(s,this.props);return t?e.createElement(J.T,{navModel:r,pageNav:i,"aria-label":v.wl.components.PanelEditor.General.content,layout:$.Q.Custom,toolbar:this.renderToolbar(),className:l},e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(xt.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:m=>{m&&c({rightPaneSize:m/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(ut,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const Ds=(0,E.HE)(Ts(xs)),ws=(0,oa.B)((n,t)=>{const{uiState:a}=t,s=n.spacing(2);return{wrapper:(0,u.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:n.spacing(2)}),verticalSplitPanesWrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:s};
    `,variablesWrapper:u.css`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${n.spacing(1,2)};
    `,panelWrapper:u.css`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${s};
    `,tabsWrapper:u.css`
      height: 100%;
      width: 100%;
    `,panelToolbar:u.css`
      display: flex;
      padding: 0 0 ${s} ${s};
      justify-content: space-between;
      flex-wrap: wrap;
    `,angularWarning:u.css`
      display: flex;
      height: theme.spacing(4);
      align-items: center;
    `,toolbarLeft:u.css`
      padding-left: ${n.spacing(1)};
    `,centeringContainer:u.css`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:u.css`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var Os=o(11543),Is=o(81764),Rs=o(8861),Ns=o(87865);const Ms=({annotation:n,events:t,onEnabledChanged:a})=>{const[s,r]=(0,e.useState)(!1),i=(0,E.wW)(As),l=()=>(0,Ns.kt)().cancel(n);return(0,e.useEffect)(()=>{const c=t.getStream(ee.z).subscribe({next:m=>{m.payload===n&&r(!0)}}),d=t.getStream(ee.RB).subscribe({next:m=>{m.payload===n&&r(!1)}});return()=>{c.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:n.name,className:i.annotation},e.createElement(Os.Z,null,e.createElement(Is._,{label:n.name,disabled:s,"data-testid":v.wl.pages.Dashboard.SubMenu.Annotations.annotationLabel(n.name)},e.createElement(he.x,{label:n.name,value:n.enable,onChange:()=>a(n),disabled:s,"data-testid":v.wl.pages.Dashboard.SubMenu.Annotations.annotationToggle(n.name)})),e.createElement("div",{className:i.indicator},e.createElement(Rs.T,{loading:s,onCancel:l}))))};function As(n){return{annotation:u.css`
      display: inline-block;
      margin-right: ${n.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${n.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:u.css`
      align-self: center;
      padding: 0 ${n.spacing(.5)};
    `}}const $s=({annotations:n,onAnnotationChanged:t,events:a})=>{const[s,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(n.filter(i=>i.hide!==!0))},[n]),s.length===0?null:e.createElement("div",{"data-testid":v.wl.pages.Dashboard.SubMenu.Annotations.annotationsWrapper},s.map(i=>e.createElement(Ms,{events:a,annotation:i,onEnabledChanged:t,key:i.name})))};var Ls=o(49380),st=o(95304),Fs=o(18428),zs=o(29930);const Us=n=>{const{link:t,linkInfo:a}=n,s=(0,e.useRef)(null),[r,i]=(0,e.useState)("invisible"),[l,c]=(0,e.useState)(0),d=Bs(n,l),m=(0,E.wW)(Hs);return(0,e.useLayoutEffect)(()=>{i(ks(s.current))},[d]),t.asDropdown?e.createElement(on,{link:t,key:"dashlinks-dropdown","data-testid":v.wl.components.DashboardLinks.dropDown},e.createElement(e.Fragment,null,e.createElement(Ae.h,{onClick:()=>c(Date.now()),className:(0,u.cx)("gf-form-label gf-form-label--dashlink",m.button),"data-placement":"bottom","data-toggle":"dropdown","aria-expanded":!!l,"aria-controls":"dropdown-list","aria-haspopup":"menu"},e.createElement(I.J,{"aria-hidden":!0,name:"bars",className:m.iconMargin}),e.createElement("span",null,a.title)),e.createElement("ul",{id:"dropdown-list",className:`dropdown-menu ${m.dropdown} ${r}`,role:"menu",ref:s},d.length>0&&d.map((p,g)=>e.createElement("li",{role:"none",key:`dashlinks-dropdown-item-${p.uid}-${g}`},e.createElement("a",{role:"menuitem",href:p.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${p.title} dashboard`},p.title)))))):e.createElement(e.Fragment,null,d.length>0&&d.map((p,g)=>e.createElement(on,{link:t,key:`dashlinks-list-item-${p.uid}-${g}`,"data-testid":v.wl.components.DashboardLinks.container},e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:p.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${p.title} dashboard`},e.createElement(I.J,{"aria-hidden":!0,name:"apps",style:{marginRight:"4px"}}),e.createElement("span",null,p.title)))))},on=n=>{const{link:t,children:a,...s}=n;return e.createElement("div",{...s,className:"gf-form"},t.tooltip&&e.createElement(ye.u,{content:t.tooltip},a),!t.tooltip&&e.createElement(e.Fragment,null,a))},Bs=({link:n,dashboardUID:t},a)=>{const{tags:s}=n,r=(0,Te.Z)(()=>Vs(s),[s,a]);return r.value?Ws(t,n,r.value):[]};async function Vs(n,t={getBackendSrv:zs.i}){return await t.getBackendSrv().search({tag:n,limit:100})}function Ws(n,t,a,s={getLinkSrv:Le.Bq,sanitize:st.Nw,sanitizeUrl:st.Nm}){return a.filter(r=>r.uid!==n).map(r=>{const i=r.uid,l=s.sanitize(r.title),c=s.getLinkSrv().getLinkUrl({...t,url:r.url}),d=s.sanitizeUrl(c);return{uid:i,title:l,url:d}})}function ks(n){if(!n)return"invisible";const t=n.parentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return a.width===0?"invisible":t.left+a.width+10>window.innerWidth?"pull-left":"pull-right"}function Hs(n){return{iconMargin:(0,u.css)({marginRight:n.spacing(.5)}),dropdown:(0,u.css)({maxWidth:"max(30vw, 300px)",maxHeight:"70vh",overflowY:"auto",a:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),button:(0,u.css)({color:n.colors.text.primary})}}const Ks=({dashboard:n,links:t})=>{const a=(0,Kt.N)();return(0,Ls.Z)(()=>{const s=n.events.subscribe(Ht.md,a);return()=>s.unsubscribe()}),t.length?e.createElement(e.Fragment,null,t.map((s,r)=>{const i=(0,Le.Bq)().getAnchorInfo(s),l=`${s.title}-$${r}`;if(s.type==="dashboards")return e.createElement(Us,{key:l,link:s,linkInfo:i,dashboardUID:n.uid});const c=Fs.xy[s.icon],d=e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:(0,st.Nm)(i.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link},c&&e.createElement(I.J,{"aria-hidden":!0,name:c,style:{marginRight:"4px"}}),e.createElement("span",null,i.title));return e.createElement("div",{key:l,className:"gf-form","data-testid":v.wl.components.DashboardLinks.container},s.tooltip?e.createElement(ye.u,{content:i.tooltip},d):d)})):null};class js extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===t.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()}}render(){const{dashboard:t,variables:a,links:s,annotations:r}=this.props;if(!t.isSubMenuVisible())return null;const i=t.meta.isSnapshot??!1;return e.createElement("div",{className:"submenu-controls"},e.createElement("form",{"aria-label":"Template variables",className:Zs},e.createElement(Dt,{variables:a,readOnly:i})),e.createElement($s,{annotations:r,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),e.createElement("div",{className:"gf-form gf-form--grow"}),t&&e.createElement(Ks,{dashboard:t,links:s}))}}const Qs=(n,t)=>{const{uid:a}=t.dashboard,s=(0,Je.AE)(a,n);return{variables:(0,Je.IV)(a,s.variables)}},Zs=u.css`
  display: flex;
  flex-wrap: wrap;
  display: contents;
`,ln=(0,A.connect)(Qs)(js);ln.displayName="SubMenu";var cn=o(33088),Gs=o(6911),Js=o(86977);const dn=n=>({initPhase:n.dashboard.initPhase,initError:n.dashboard.initError,dashboard:n.dashboard.getModel(),navIndex:n.navIndex}),Ys={initDashboard:Pt.mV,cleanUpDashboardAndVariables:Js.lw,notifyApp:Q.$l,cancelVariables:ct.wX,templateVarsChangedInUrl:ct.xs},Xs=(0,A.connect)(dn,Ys);class ot extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.onFileDrop=(t,a,s)=>{const r={type:"grafana",uid:"grafana"};f.eM(t).subscribe(i=>{const l=[];i.dataFrames.forEach(c=>{const d=(0,V.Y)(c);l.push(d)}),this.props.dashboard?.addPanel({type:"table",gridPos:{x:0,y:0,w:12,h:8},title:i.file.name,datasource:r,targets:[{queryType:pn.hR.Snapshot,snapshot:l,file:{name:i.file.name,size:i.file.size},datasource:r}]})}),a.forEach(i=>{const l=i.errors.map(c=>{switch(c.code){case R.jK.FileTooLarge:const d=(0,C.Cf)("decbytes")(f.dg);return`File size must be less than ${(0,C.zc)(d)}.`;case R.jK.FileInvalidType:return`File type must be one of the following types ${f._H(f.DK)}.`;default:return c.message}});this.props.notifyApp((0,se.t_)(`Failed to load ${i.file.name}`,void 0,void 0,e.createElement("ul",null,l.map(c=>e.createElement("li",{key:c},c)))))}),(0,P.ff)("dashboards_dropped_files",{number_of_files:a.length+t.length,accepted_files:t.map(i=>({type:i.type,size:i.size})),rejected_files:a.map(i=>({type:i.file.type,size:i.file.size}))})},this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,ve.$t)().timeRange()),Gs.A.setLiveTimeRange(t)},this.onAddPanel=()=>{const{dashboard:t}=this.props;t&&(t.panels.length>0&&t.panels[0].type==="add-panel"||(t.addPanel({type:"add-panel",gridPos:(0,ke.lg)(t),title:"Panel Title"}),this.setState({updateScrollTop:0})))},this.setScrollRef=t=>{this.setState({scrollElement:t})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:s}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:s,match:r,templateVarsChangedInUrl:i}=this.props,l=this.props.history.location.state?.routeReloadCounter;if(s){if(t.match.params.uid!==r.params.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(t.location.search!==this.props.location.search){const c=t.queryParams,d=this.props.queryParams;(d?.from!==c?.from||d?.to!==c?.to)&&((0,ve.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&d?.refresh&&(0,ve.$t)().setAutoRefresh(d.refresh);const m=(0,mn.xT)(this.props.queryParams,t.queryParams);m&&i(s.uid,m)}this.state.editPanel&&!a.editPanel&&(O.H.setEditingState(!0),this.props.dashboard?.events.publish(new ee.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(O.H.setEditingState(!1),this.props.dashboard?.events.publish(new ee.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,se.t_)("Permission to edit panel denied")),S.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,se.t_)("Panel not found")),S.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(t,a){const{dashboard:s,queryParams:r}=t,i=r.editPanel,l=r.viewPanel;if(!s)return a;const c={...a};if(!a.editPanel&&i){const d=s.getPanelByUrlId(i);d?s.canEditPanel(d)?(c.editPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const d=s.getPanelByUrlId(l);d?(s.initViewPanel(d),c.viewPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!l&&(s.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),qs(t,c)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,s=a.inspect;if(!t||!s)return null;const r=t.getPanelById(parseInt(s,10));return r||null}render(){const{dashboard:t,initError:a,queryParams:s}=this.props,{editPanel:r,viewPanel:i,updateScrollTop:l,pageNav:c,sectionNav:d}=this.state,m=X(this.props.queryParams);if(!t||!c||!d)return e.createElement(fn.B,{initPhase:this.props.initPhase});const p=this.getInspectPanel(),g=!r&&!m&&!this.props.queryParams.editview,y=m!==z.KioskMode.Full&&!s.editview&&e.createElement("header",{"data-testid":v.wl.pages.Dashboard.DashNav.navV2},e.createElement(hn.t,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:m,hideTimePicker:t.timepicker.hidden})),b=(0,u.cx)({"panel-in-fullscreen":Boolean(i),"page-hidden":Boolean(s.editview||r)});return t.meta.dashboardNotFound?e.createElement(J.T,{navId:"dashboards/browse",layout:$.Q.Canvas,pageNav:{text:"Not found"}},e.createElement(ce.j,{entity:"Dashboard"})):e.createElement(e.Fragment,null,e.createElement(J.T,{navModel:d,pageNav:c,layout:$.Q.Canvas,toolbar:y,className:b,scrollRef:this.setScrollRef,scrollTop:l},e.createElement(ht,{dashboard:t}),a&&e.createElement(gn.u,null),g&&e.createElement("section",{"aria-label":v.wl.pages.Dashboard.SubMenu.submenu},e.createElement(ln,{dashboard:t,annotations:t.annotations.list,links:t.links})),D.v.featureToggles.editPanelCSVDragAndDrop?e.createElement(B.ZP,{onDrop:this.onFileDrop,accept:f.DK,maxSize:f.dg,noClick:!0},({getRootProps:T,isDragActive:w})=>{const M=_s(this.props.theme,w);return e.createElement("div",{...T({className:M.dropZone})},e.createElement("div",{className:M.dropOverlay},e.createElement("div",{className:M.dropHint},e.createElement(I.J,{name:"upload",size:"xxxl"}),e.createElement("h3",null,"Create tables from spreadsheets"))),e.createElement(cn.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:r}))}):e.createElement(cn.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:r}),p&&e.createElement(ra,{dashboard:t,panel:p})),r&&e.createElement(Ds,{dashboard:t,sourcePanel:r,tab:this.props.queryParams.tab,sectionNav:d,pageNav:c}),s.editview&&e.createElement(Rn.D,{dashboard:t,editview:s.editview,pageNav:c,sectionNav:d}))}}ot.contextType=de.h;function qs(n,t){const{dashboard:a,navIndex:s}=n;if(!a)return t;let r=t.pageNav,i=t.sectionNav;(!r||a.title!==r.text)&&(r={text:a.title,url:j.u.getUrlForPartial(n.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderTitle:l,folderUid:c}=a.meta;if(l&&c&&r&&r.parentItem?.text!==l)if(D.v.featureToggles.nestedFolders){const d=c?(0,h.ht)(s,`folder-dashboards-${c}`).main:void 0;r={...r,parentItem:d}}else r={...r,parentItem:{text:l,url:`/dashboards/f/${a.meta.folderUid}`}};if(n.route.routeName===z.DashboardRoutes.Path){i=lt();const d=_(n.match.params.slug);d?.parentItem&&(d.parentItem=d.parentItem)}else i=(0,h.ht)(n.navIndex,"dashboards/browse");return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===i?t:{...t,pageNav:r,sectionNav:i}}function _s(n,t){return{dropZone:u.css`
      height: 100%;
    `,dropOverlay:u.css`
      background-color: ${t?n.colors.action.hover:"inherit"};
      border: ${t?`2px dashed ${n.colors.border.medium}`:0};
      position: absolute;
      display: ${t?"flex":"none"};
      z-index: ${n.zIndex.modal};
      top: 0px;
      left: 0px;
      height: 100%;
      width: 100%;
      align-items: center;
      justify-content: center;
    `,dropHint:u.css`
      align-items: center;
      display: flex;
      flex-direction: column;
    `}}const it=(0,E.HE)(ot);it.displayName="DashboardPage";const eo=Xs(it)},81704:(re,W,o)=>{o.r(W),o.d(W,{default:()=>j});var u=o(66111),e=o(86647),R=o(35645),B=o(37932),A=o(8412),V=o(27876),C=o(87464),$=o(58790);function j(v){const[P,S]=(0,u.useState)(null),{datasourceUid:D}=v.match.params,I=(0,V.useDispatch)();return(0,u.useEffect)(()=>{const E=(0,e.F)().getInstanceSettings(D);if(!E){S("Data source not found");return}if(R.v.featureToggles.emptyDashboardPage)I((0,$.Rd)(D));else{const Q=(0,C.ZQ)(),{dashboard:J}=Q;J.panels[0]={...J.panels[0],datasource:{uid:E.uid,type:E.type}},(0,C.$M)(Q)}B.E1.replace("/dashboard/new")},[D,I]),P?u.createElement(A.T,{navId:"dashboards"},u.createElement(A.T.Contents,null,u.createElement("div",null,'Data source with UID "',D,'" not found.'))):null}},56440:(re,W,o)=>{o.d(W,{W:()=>v});var u=o(9892),e=o(66111),R=o(77346),B=o(37932),A=o(57369),V=o(72648),C=o(64319),$=o(95379),j=o(8412);class v extends A.wx{}v.Component=P;function P({model:D}){const{title:I,body:E,actions:Q=[],uid:J,controls:ce}=D.useState(),de=(0,V.wW)(S),se=(Q??[]).map(X=>e.createElement(X.Component,{key:X.state.key,model:X}));J?.length&&se.push(e.createElement(C.h,{icon:"apps",onClick:()=>B.E1.push(`/d/${J}`),tooltip:"View as Dashboard",key:"scene-to-dashboard-switch"}));const z=e.createElement($.A,{actions:se});return e.createElement(j.T,{navId:"scenes",pageNav:{text:I},layout:R.Q.Canvas,toolbar:z},ce&&e.createElement("div",{className:de.controls},ce.map(X=>e.createElement(X.Component,{key:X.state.key,model:X}))),e.createElement("div",{className:de.body},e.createElement(E.Component,{model:E})))}function S(D){return{body:(0,u.css)({flexGrow:1,display:"flex",gap:"8px"}),controls:(0,u.css)({display:"flex",paddingBottom:D.spacing(2),flexWrap:"wrap",alignItems:"center",gap:D.spacing(1)})}}},52686:(re,W,o)=>{o.d(W,{Yz:()=>D,bC:()=>ce});var u=o(57369),e=o(38535),R=o(87449),B=o(86899),A=o(21471),V=o(56440);function C(h){return`panel-${h}`}function $(h){const f=[];return h.forEachChild(O=>{f.push($(O))}),f.push(h.activate()),()=>{for(const O of f)O()}}class j extends u.wx{constructor(f){super(f),this.addActivationHandler(()=>(this._subscribeToSource(),()=>{this._querySub&&this._querySub.unsubscribe(),this._sourceDataDeactivationHandler&&this._sourceDataDeactivationHandler()}))}_subscribeToSource(){const{query:f}=this.state;if(this._querySub&&this._querySub.unsubscribe(),!f.panelId)return;const O=C(f.panelId),L=v(this.getRoot(),_=>_.state.key===O);if(!L){console.log("Shared dashboard query refers to a panel that does not exist in the scene");return}let N=L.state.$data;if(!N){console.log("No source data found for shared dashboard query");return}if(this._sourceDataDeactivationHandler=N.activate(),N instanceof u.bM&&!f.withTransforms){if(!N.state.$data)throw new Error("No source inner query runner found in data transformer");N=N.state.$data}this._querySub=N.subscribeToState(_=>this.setState({data:_.data})),this.setState({data:N.state.data})}}function v(h,f){if(f(h))return h;let O=null;return h.forEachChild(L=>{let N=v(L,f);N&&(O=N)}),O}class P extends e.b{constructor(){super(...arguments),this.cache={}}async load(f){const O=this.cache[f];if(O){this.setState({dashboard:O});return}this.setState({isLoading:!0});try{const L=await R.pD.loadDashboard("db","",f);if(L.dashboard)this.initDashboard(L);else throw new Error("Dashboard not found")}catch(L){this.setState({isLoading:!1,loadError:String(L)})}}initDashboard(f){const O=new B.f(f.dashboard,f.meta,{autoMigrateOldPanels:!0}),L=D(O);(0,u.oo)().initSync(L),this.cache[f.dashboard.uid]=L,this.setState({dashboard:L,isLoading:!1})}clearState(){this.setState({dashboard:void 0,loadError:void 0,isLoading:!1})}}function S(h){const f=[];let O=null,L=[];for(const N of h)if(N.type==="row")O?O.id!==N.id&&(f.push(new u.I_({title:O.title,y:O.gridPos.y,children:L})),O=N,L=[]):Boolean(N.collapsed)?f.push(new u.I_({title:N.title,isCollapsed:!0,y:N.gridPos.y,children:N.panels?N.panels.map(E):[]})):O=N;else{const _=E(N);O?L.push(_):f.push(_)}return O&&f.push(new u.I_({title:O.title,y:O.gridPos.y,children:L})),f}function D(h){let f;if(h.templating?.list?.length){const O=h.templating.list.map(L=>{try{return I(L)}catch(N){return console.error(N),null}}).filter(L=>Boolean(L));f=new u.hT({variables:O})}return new V.W({title:h.title,uid:h.uid,body:new u.Qh({children:S(h.panels)}),$timeRange:new u.gg(h.time),actions:[new u.n7({}),new u.vf({refresh:h.refresh,intervals:h.timepicker.refresh_intervals})],$variables:f,...f&&{controls:[new u.dn({})]}})}function I(h){const f={name:h.name,label:h.label};if(de(h))return new u.eO({...f,value:h.current.value,text:h.current.text,description:h.description,query:h.query,isMulti:h.multi,allValue:h.allValue||void 0,includeAll:h.includeAll,defaultToAll:Boolean(h.includeAll),skipUrlSync:h.skipUrlSync,hide:h.hide});if(se(h))return new u.$1({...f,value:h.current.value,text:h.current.text,description:h.description,query:h.query,datasource:h.datasource,sort:h.sort,refresh:h.refresh,regex:h.regex,allValue:h.allValue||void 0,includeAll:h.includeAll,defaultToAll:Boolean(h.includeAll),isMulti:h.multi,skipUrlSync:h.skipUrlSync,hide:h.hide});if(z(h))return new u.l3({...f,value:h.current.value,text:h.current.text,description:h.description,regex:h.regex,pluginId:h.query,allValue:h.allValue||void 0,includeAll:h.includeAll,defaultToAll:Boolean(h.includeAll),skipUrlSync:h.skipUrlSync,isMulti:h.multi,hide:h.hide});if(X(h))return new u.M6({...f,description:h.description,value:h.query,skipUrlSync:h.skipUrlSync,hide:h.hide});throw new Error(`Scenes: Unsupported variable type ${h.type}`)}function E(h){return new u.bO({x:h.gridPos.x,y:h.gridPos.y,width:h.gridPos.w,height:h.gridPos.h,isDraggable:!0,isResizable:!0,body:new u.Z({key:C(h.id),title:h.title,pluginId:h.type,options:h.options??{},fieldConfig:h.fieldConfig,pluginVersion:h.pluginVersion,displayMode:h.transparent?"transparent":void 0,hoverHeader:!h.title&&!h.timeFrom&&!h.timeShift,$data:Q(h)})})}function Q(h){if(!h.targets?.length)return;let f;return h.datasource?.uid===A.o?f=new j({query:h.targets[0]}):f=new u.uq({queries:h.targets,maxDataPoints:h.maxDataPoints??void 0}),h.transformations?.length&&(f=new u.bM({$data:f,transformations:h.transformations})),f}let J=null;function ce(){return J||(J=new P({})),J}const de=h=>h.type==="custom",se=h=>h.type==="query",z=h=>h.type==="datasource",X=h=>h.type==="constant"},63163:(re,W,o)=>{o.d(W,{$:()=>j,J:()=>C});var u=o(59957),e=o(6194),R=o(54899),B=o(35645),A=o(29930);class V{constructor(){}async get(P){const S=`api/storage/read/${P}`.replace("//","/");return(0,R.i)().get(S)}async list(P){let S="api/storage/list/";P&&(S+=P+"/");const D=await(0,R.i)().get(S);if(D?.data){const I=(0,u.vP)(D);for(const E of I.fields)E.display=(0,e.U_)({field:E,theme:B.v.theme2});return I}}async createFolder(P){const S=await(0,R.i)().post("/api/storage/createFolder",JSON.stringify({path:P}));return S.success?{}:{error:S.message??"unknown error"}}async deleteFolder(P){const S=await(0,R.i)().post("/api/storage/deleteFolder",JSON.stringify(P));return S.success?{}:{error:S.message??"unknown error"}}async deleteFile(P){const S=await(0,R.i)().post(`/api/storage/delete/${P.path}`);return S.success?{}:{error:S.message??"unknown error"}}async delete(P){return P.isFolder?this.deleteFolder({path:P.path,force:!0}):this.deleteFile({path:P.path})}async upload(P,S,D){const I=new FormData;I.append("folder",P),I.append("file",S),I.append("overwriteExistingFile",String(D));const E=await fetch("/api/storage/upload",{method:"POST",body:I});let Q=await E.json();return Q||(Q={}),Q.status=E.status,Q.statusText=E.statusText,E.status!==200&&!Q.err&&(Q.err=!0),Q}async write(P,S){return A.ae.post(`/api/storage/write/${P}`,S)}async getConfig(){return(0,R.i)().get("/api/storage/config")}async getOptions(P){return(0,R.i)().get(`/api/storage/options/${P}`)}}function C(v,P){const D=v.toLowerCase().trim();return P.map(E=>E.trim().toLowerCase()).includes(D)}let $;function j(){return $||($=new V),$}},92465:(re,W,o)=>{o.d(W,{M:()=>B});var u=o(66111),e=o(90748),R=o(43657);const B=({value:A,context:V,onChange:C})=>{const $=(0,u.useCallback)(j=>{C(j?.length?{id:e.E4.byRefId,options:j}:void 0)},[C]);return u.createElement(R.O,{value:A?.options,onChange:$,data:V.data,placeholder:"Change filter"})}},42638:(re,W,o)=>{var u;u={value:!0};var e=o(9683),R=o(66111),B=e.__importDefault(o(55986));function A(V,C){C===void 0&&(C=[]);var $=B.default(V,C,{loading:!0}),j=$[0],v=$[1];return R.useEffect(function(){v()},[v]),j}W.Z=A}}]);

//# sourceMappingURL=6281.4a7496c0719dfb9a764e.js.map