"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{77830:(U,T,a)=>{a.d(T,{f:()=>f});var t=a(66111),A=a(13821),c=a(77582),u=a(27876),P=a(17069),g=a(11630);const f=({teamId:i,roleOptions:r,disabled:n,onApplyRoles:o,pendingRoles:l,apply:d=!1,maxWidth:h})=>{const[{loading:M,value:p=[]},O]=(0,A.Z)(async()=>{try{if(d&&Boolean(l?.length))return l;if(c.Vt.hasPermission(u.AccessControlAction.ActionTeamsRolesList))return await(0,g._C)(i)}catch(v){console.error("Error loading options",v)}return[]},[i,l]);(0,t.useEffect)(()=>{O()},[i,O,l]);const _=async v=>{d?o&&o(v):(await(0,g.u7)(v,i),await O())},y=c.Vt.hasPermission(u.AccessControlAction.ActionTeamsRolesAdd)&&c.Vt.hasPermission(u.AccessControlAction.ActionTeamsRolesRemove);return t.createElement(P.I,{apply:d,onRolesChange:_,roleOptions:r,appliedRoles:p,isLoading:M,disabled:n,basicRoleDisabled:!0,canUpdateRoles:y,maxWidth:h})}},73635:(U,T,a)=>{a.d(T,{$:()=>f});var t=a(24420),A=a.n(t),c=a(66111),u=a(67948),P=a(27876),g=a(70431);const f=(i,r,n)=>o=>{const l=(0,u.connect)(i,r)(o),d=h=>{const M=(0,P.useDispatch)();return(0,c.useEffect)(()=>function(){M((0,g.e)({cleanupAction:n}))},[M]),c.createElement(l,{...h})};return d.displayName=`ConnectWithCleanUp(${l.displayName})`,A()(d,o),d}},17721:(U,T,a)=>{a.r(T),a.d(T,{TeamList:()=>y,default:()=>s});var t=a(66111),A=a(14747),c=a(31403),u=a(52081),P=a(78889),g=a(69142),f=a(8412),i=a(11630),r=a(47694),n=a(82002),o=a(27876),l=a(73635),d=a(13626),h=a(77830);const M=({team:e,roleOptions:m,isTeamAdmin:E,displayRolePicker:D,onDelete:I})=>{const C=`org/teams/edit/${e.id}`,R=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsDelete,e,E),L=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsRead,e,E),x=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsRolesList,e,!1);return t.createElement("tr",{key:e.id},t.createElement("td",{className:"width-4 text-center link-td"},L?t.createElement("a",{href:C},t.createElement("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"Team avatar"})):t.createElement("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"Team avatar"})),t.createElement("td",{className:"link-td"},L?t.createElement("a",{href:C},e.name):t.createElement("div",{style:{padding:"0px 8px"}},e.name)),t.createElement("td",{className:"link-td"},L?t.createElement("a",{href:C,"aria-label":e.email||"Empty email cell"},e.email):t.createElement("div",{style:{padding:"0px 8px"},"aria-label":e.email||"Empty email cell"},e.email)),t.createElement("td",{className:"link-td"},L?t.createElement("a",{href:C},e.memberCount):t.createElement("div",{style:{padding:"0px 8px"}},e.memberCount)),D&&t.createElement("td",null,x&&t.createElement(h.f,{teamId:e.id,roleOptions:m})),t.createElement("td",{className:"text-right"},t.createElement(d.m,{"aria-label":`Delete team ${e.name}`,size:"sm",disabled:!R,onConfirm:()=>I(e.id)})))};var p=a(13949),O=a(97189),_=a(3813);const y=({teams:e,page:m,query:E,noTeams:D,totalPages:I,hasFetched:C,loadTeams:R,deleteTeam:L,changeQuery:x,changePage:S,signedInUser:Q,editorsCanAdmin:V})=>{const[j,G]=(0,t.useState)([]);(0,t.useEffect)(()=>{R(!0)},[R]),(0,t.useEffect)(()=>{n.Vt.licensedAccessControlEnabled()&&n.Vt.hasPermission(o.AccessControlAction.ActionRolesList)&&(0,i.ul)().then(B=>G(B))},[]);const b=v(V),N=W();return t.createElement(f.T,{navId:"teams"},t.createElement(f.T.Contents,{isLoading:!C},D?t.createElement(g.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!n.Vt.hasPermission(o.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement("div",{className:"gf-form gf-form--grow"},t.createElement(A.H,{placeholder:"Search teams",value:E,onChange:x})),t.createElement(c.Qj,{href:b?"org/teams/new":"#",disabled:!b},"New Team")),t.createElement("div",{className:"admin-list-table"},t.createElement(u.wc,{spacing:"md"},t.createElement("table",{className:"filter-table filter-table--hover form-inline"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null),t.createElement("th",null,"Name"),t.createElement("th",null,"Email"),t.createElement("th",null,"Members"),N&&t.createElement("th",null,"Roles"),t.createElement("th",{style:{width:"1%"}}))),t.createElement("tbody",null,e.map(B=>t.createElement(M,{key:B.id,team:B,roleOptions:j,displayRolePicker:N,isTeamAdmin:(0,_.kC)({permission:B.permission,editorsCanAdmin:V,signedInUser:Q}),onDelete:L})))),t.createElement(u.Lh,{justify:"flex-end"},t.createElement(P.t,{hideWhenSinglePage:!0,currentPage:m,numberOfPages:I,onNavigate:S})))))))};function v(e){const m=n.Vt.hasRole("Admin")||e&&n.Vt.hasRole("Editor");return n.Vt.hasAccess(o.AccessControlAction.ActionTeamsCreate,m)}function W(){return n.Vt.licensedAccessControlEnabled()&&n.Vt.hasPermission(o.AccessControlAction.ActionTeamsRolesList)&&n.Vt.hasPermission(o.AccessControlAction.ActionRolesList)}function K(e){return{teams:e.teams.teams,page:e.teams.page,query:e.teams.query,perPage:e.teams.perPage,noTeams:e.teams.noTeams,totalPages:e.teams.totalPages,hasFetched:e.teams.hasFetched,editorsCanAdmin:r.vc.editorsCanAdmin,signedInUser:n.Vt.user}}const $={loadTeams:p.jI,deleteTeam:p.fC,changePage:p.oO,changeQuery:p.R5},s=(0,l.$)(K,$,e=>e.teams=O.p3)(y)},13949:(U,T,a)=>{a.d(T,{A_:()=>W,Lt:()=>O,P5:()=>K,QX:()=>l,R5:()=>h,ei:()=>p,fC:()=>d,fs:()=>y,jI:()=>n,j_:()=>v,oO:()=>M,zT:()=>_,zZ:()=>$});var t=a(82897),A=a.n(t),c=a(54899),u=a(659),P=a(77582),g=a(95156),f=a(27876),i=a(87941),r=a(97189);function n(s=!1){return async(e,m)=>{const{query:E,page:D,perPage:I}=m().teams;if(!P.Vt.hasPermission(f.AccessControlAction.ActionTeamsRead)){e((0,r.PL)({teams:[],totalCount:0,page:1,perPage:I,noTeams:!0}));return}const C=await(0,c.i)().get("/api/teams/search",(0,g.y)({query:E,page:D,perpage:I}));let R=!1;s&&(R=C.teams.length===0),e((0,r.PL)({noTeams:R,...C}))}}const o=(0,t.debounce)(s=>s(n()),500);function l(s){return async e=>{const m=await(0,c.i)().get(`/api/teams/${s}`,(0,g.y)());e((0,r.y$)(m)),e((0,u.RL)((0,i.B)(m)))}}function d(s){return async e=>{await(0,c.i)().delete(`/api/teams/${s}`),await P.Vt.fetchUserPermissions(),e(n())}}function h(s){return async e=>{e((0,r.aj)(s)),o(e)}}function M(s){return async e=>{e((0,r.PJ)(s)),e(n())}}function p(){return async(s,e)=>{const m=e().team.team,E=await(0,c.i)().get(`/api/teams/${m.id}/members`);s((0,r.n2)(E))}}function O(s){return async(e,m)=>{const E=m().team.team;await(0,c.i)().post(`/api/teams/${E.id}/members`,{userId:s}),e(p())}}function _(s){return async(e,m)=>{const E=m().team.team;await(0,c.i)().delete(`/api/teams/${E.id}/members/${s}`),e(p())}}function y(s,e){return async(m,E)=>{const D=E().team.team;await(0,c.i)().put(`/api/teams/${D.id}`,{name:s,email:e}),m(l(D.id))}}function v(){return async(s,e)=>{const m=e().team.team,E=await(0,c.i)().get(`/api/teams/${m.id}/groups`);s((0,r.iI)(E))}}function W(s){return async(e,m)=>{const E=m().team.team;await(0,c.i)().post(`/api/teams/${E.id}/groups`,{groupId:s}),e(v())}}function K(s){return async(e,m)=>{const E=m().team.team;await(0,c.i)().delete(`/api/teams/${E.id}/groups?groupId=${encodeURIComponent(s)}`),e(v())}}function $(s){return async e=>{await(0,c.i)().put(`/api/teams/${s.teamId}/members/${s.userId}`,{permission:s.permission}),e(p())}}},87941:(U,T,a)=>{a.d(T,{B:()=>i,o:()=>r});var t=a(66121),A=a(73194),c=a(47694),u=a(82002),P=a(77293),g=a(27876);const f={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:g.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function i(n){const o={img:n.avatarUrl,id:"team-"+n.id,subTitle:"Manage members and settings",url:"",text:n.name,breadcrumbs:[{title:"Teams",url:"org/teams"}],children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${n.id}`,text:"Settings",url:`org/teams/edit/${n.id}/settings`}]};(n===f||u.Vt.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsPermissionsRead,n))&&o.children.unshift({active:!1,icon:"users-alt",id:`team-members-${n.id}`,text:"Members",url:`org/teams/edit/${n.id}/members`});const l={active:!1,icon:"sync",id:`team-groupsync-${n.id}`,text:"External group sync",url:`org/teams/edit/${n.id}/groupsync`},d=n===f;return(0,P.d5)()&&(l.tabSuffix=()=>(0,A.Z)({experimentId:d?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,t.v)("teamsync")?(d||u.Vt.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsPermissionsRead,n))&&o.children.push(l):c.ZP.featureToggles.featureHighlights&&o.children.push({...l,tabSuffix:()=>(0,A.Z)({experimentId:d?"":"feature-highlights-team-sync-badge"})}),o}function r(n){const o=i(f);let l;for(const d of o.children)if(d.id.indexOf(n)>0){d.active=!0,l=d;break}return{main:o,node:l}}},3813:(U,T,a)=>{a.d(T,{JB:()=>c,VP:()=>u,YY:()=>P,kC:()=>f,vt:()=>g,xc:()=>A});var t=a(27876);const A=i=>i.searchMemberQuery,c=i=>i.groups,u=(i,r)=>i.team.id===parseInt(r,10)?i.team:null,P=i=>{const r=RegExp(i.searchMemberQuery,"i");return i.members.filter(n=>r.test(n.login)||r.test(n.email)||r.test(n.name))},g=i=>{const{members:r,signedInUser:n,editorsCanAdmin:o}=i,l=r.find(h=>h.userId===n.id),d=l?l.permission:t.TeamPermissionLevel.Member;return f({permission:d,signedInUser:n,editorsCanAdmin:o})},f=i=>{const{permission:r,signedInUser:n,editorsCanAdmin:o}=i,l=n.isGrafanaAdmin||n.orgRole===t.OrgRole.Admin,d=r===t.TeamPermissionLevel.Admin;return l||d||!o}}}]);

//# sourceMappingURL=TeamList.3be4bb98d187a49fdc5f.js.map