"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4712],{91159:(q,A,n)=>{n.d(A,{n:()=>R});var E=n(66111),k=n(31439);const W=E.lazy(()=>Promise.all([n.e(4254),n.e(4666),n.e(7142)]).then(n.bind(n,47864))),B=C=>E.createElement(E.Suspense,{fallback:null},E.createElement(W,{...C})),e=C=>{const T=(0,E.useRef)(null),{onRunQuery:O,onChange:P,...M}=C,g=w=>{T.current=w,P(w),O()},x=w=>{P(w)};return E.createElement(B,{onRunQuery:g,onBlur:x,...M})};class R extends E.PureComponent{constructor(T){super(T),this._isMounted=!1,this.onChangeQuery=(O,P)=>{const{query:M,onChange:g,onRunQuery:x}=this.props;if(g){const w={...M,expr:O};g(w),P&&x&&x()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(T){const{range:O,datasource:{languageProvider:P}}=this.props;(0,k.rf)(O,T.range)&&P.fetchLabels()}render(){const{ExtraFieldElement:T,query:O,datasource:P,history:M,onRunQuery:g,onQueryType:x}=this.props,w=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return E.createElement(E.Fragment,null,E.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},E.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},E.createElement(e,{datasource:P,history:M??[],onChange:this.onChangeQuery,onRunQuery:g,initialValue:O.expr??"",placeholder:w,onQueryType:x}))),T)}}},31439:(q,A,n)=>{n.d(A,{Hk:()=>O,U9:()=>R,_z:()=>P,aC:()=>M,iS:()=>C,rf:()=>W,tU:()=>T});function E(g){return k(g/1e3)}function k(g){return Math.floor(g/60)}function W(g,x){if(g&&x){const w=E(g.from.valueOf())===E(x.from.valueOf()),z=E(g.to.valueOf())===E(x.to.valueOf());return!(w&&z)}return!1}const B=/[*+?()|\\.\[\]{}^$]/g;function e(g){return g.replace(B,"\\$&")}function R(g){return g.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function C(g){return g.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function T(g){return R(e(g))}function O(g,x){return P(x)?T(g):R(g)}function P(g){return!!(g&&(g.includes("=~")||g.includes("!~")))}function M(g){const x=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],w=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${x.join("|")})$`);return!!g.match(w)}},34712:(q,A,n)=>{n.r(A),n.d(A,{plugin:()=>pa});var E=n(89424),k=n(23588),W=n(82378),B=n(82897),e=n(66111),R=n(41818);const C=['{job="default/prometheus"}'],T=["job","app","k8s_app"],O=5,P=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class M extends e.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],l=T.find(r=>s.includes(r));if(l){const r=await t.getLabelValues(l),i=(0,B.shuffle)(r).slice(0,O).map(c=>`{${l}="${c}"}`);this.setState({userExamples:i})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,R.ff)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,l=r=>{s(r),(0,R.ff)("grafana_loki_cheatsheet_example_clicked",{})};return e.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:r=>l({refId:"A",expr:t})},e.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return e.createElement("div",null,e.createElement("h2",null,"Loki Cheat Sheet"),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),e.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(l=>this.renderExpression(l))):e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(C[0]))),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),e.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),e.createElement("div",{className:"cheat-sheet-item__label"},e.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),P.map(l=>e.createElement("div",{className:"cheat-sheet-item",key:l.expression},e.createElement("div",{className:"cheat-sheet-item__title"},l.title),this.renderExpression(l.expression),e.createElement("div",{className:"cheat-sheet-item__label"},l.label))))}}var g=n(206),x=n(82965),w=n(52666),z=n(68183),F=n(26418),Ue=n(98102),I=n(31403),$e=n(92611),Ve=n(61458),H=n(58079),ye=n(89290),f=n(9892),K=n(72648),be=n(35029),Le=n(61744),Ae=n(59796),We=n(32436),ze=n(27303),le=n(64353),ne=n(85951),je=n(46967),Ke=n(52081),re=n(31439);const oe=1e3,ie=1e4,Ge=4,ce="{}";function G(a){const t=[];for(const s of a)if(s.selected&&s.values&&s.values.length>0){const l=s.values.filter(r=>r.selected).map(r=>r.name);l.length>1?t.push(`${s.name}=~"${l.map(re.tU).join("|")}"`):l.length===1&&t.push(`${s.name}="${(0,re.U9)(l[0])}"`)}return["{",t.join(","),"}"].join("")}function He(a,t,s){return a.map(l=>{const r=t[l.name];if(r){let i;if(l.name===s&&l.values)i=l.values;else{const c=new Set(l.values?.filter(o=>o.selected).map(o=>o.name)||[]);i=r.map(o=>({name:o,selected:c.has(o)}))}return{...l,loading:!1,values:i,facets:i.length}}return{...l,loading:!1,hidden:!r,values:void 0,facets:0}})}const Ze=a=>({wrapper:f.css`
    background-color: ${a.colors.background.secondary};
    padding: ${a.spacing(2)};
    width: 100%;
  `,list:f.css`
    margin-top: ${a.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:f.css`
    & + & {
      margin: ${a.spacing(2,0)};
    }
    position: relative;
  `,selector:f.css`
    font-family: ${a.typography.fontFamilyMonospace};
    margin-bottom: ${a.spacing(1)};
  `,status:f.css`
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
  `,statusShowing:f.css`
    opacity: 1;
  `,error:f.css`
    color: ${a.colors.error.main};
  `,valueList:f.css`
    margin-right: ${a.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:f.css`
    border-left: 1px solid ${a.colors.border.medium};
    margin: ${a.spacing(1,0)};
    padding: ${a.spacing(1,0,1,1)};
  `,valueListArea:f.css`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${a.spacing(1)};
  `,valueTitle:f.css`
    margin-left: -${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
  `,validationStatus:f.css`
    padding: ${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Ye extends e.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,R.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=G(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,R.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${G(this.state.labels)}[$__interval])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(l=>({...l,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,l)=>{const r=this.state.labels.find(o=>o.name===t);if(!r)return;const i=!r.selected;let c={selected:i};if(r.values&&!i){const o=r.values.map(d=>({...d,selected:!1}));c={...c,facets:0,values:o}}this.setState({searchTerm:""}),this.updateLabelState(t,c,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,l)=>{const r=this.state.labels.find(c=>c.name===t);if(!r||!r.values)return;this.setState({searchTerm:""});const i=r.values.map(c=>({...c,selected:c.name===s?!c.selected:c.selected}));this.updateLabelState(t,{values:i},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=G(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=G(this.state.labels);if(s===ce){const l=this.state.labels.map(r=>({...r,facets:0,values:void 0,hidden:!1}));this.setState({labels:l},()=>{this.state.labels.forEach(r=>r.selected&&this.fetchValues(r.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,l="",r){this.setState(i=>{const c=i.labels.map(d=>d.name===t?{...d,...s}:d),o=l?"":i.error;return{labels:c,status:l,error:o,validationStatus:""}},r)}componentDidMount(){const{languageProvider:t,autoSelect:s=Ge,lastUsedLabels:l}=this.props;if(t){const r=l;t.start().then(()=>{let i=t.getLabelKeys();if(i.length>oe){const o=`Too many labels found (showing only ${oe} of ${i.length})`;i=i.slice(0,oe),this.setState({error:o})}const c=i.map((o,d,p)=>({name:o,selected:p.length<=s&&r.length===0||r.includes(o),loading:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(o=>{o.selected&&this.fetchValues(o.name,ce)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(r=>r.name===t);if(!s)return;const l=this.state.labels.filter(r=>r.selected).map(r=>r.name);this.props.storeLastUsedLabels(l),s.selected?s.values||this.fetchValues(t,G(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:l}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let r=await l.getLabelValues(t);if(s!==G(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(r.length>ie){const c=`Too many values for ${t} (showing only ${ie} of ${r.length})`;r=r.slice(0,ie),this.setState({error:c})}const i=r.map(c=>({name:c}));this.updateLabelState(t,{values:i,loading:!1})}catch(r){console.error(r)}}async fetchSeries(t,s){const{languageProvider:l}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const r=await l.fetchSeriesLabels(t,!0);if(t!==G(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(r).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const i=He(this.state.labels,r,s);this.setState({labels:i,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(r){console.error(r)}}async validateSelector(t){const{languageProvider:s}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const l=await s.fetchSeries(t);this.setState({validationStatus:`Selector is valid (${l.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:l,status:r,error:i,validationStatus:c}=this.state;if(s.length===0)return e.createElement(Le.u,{text:"Loading labels..."});const o=Ze(t),d=G(this.state.labels),p=d===ce;let h=s.filter(u=>u.selected&&u.values);return l?h=h.map(u=>{const b=u.values.filter(N=>{if(N.selected)return N.highlightParts=void 0,!0;const L=(0,ze.C)(N.name.toLowerCase(),l.toLowerCase());return L.found?(N.highlightParts=L.ranges,N.order=L.distance,!0):!1});return{...u,values:(0,B.sortBy)(b,N=>N.selected?-1/0:N.order)}}):h=this.state.labels.filter(u=>u.selected&&u.values).map(u=>({...u,values:u?.values?u.values.map(b=>({...b,highlightParts:void 0})):[]})),e.createElement("div",{className:o.wrapper},e.createElement("div",{className:o.section},e.createElement(le._,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),e.createElement("div",{className:o.list},s.map(u=>e.createElement(ne._,{key:u.name,name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets,onClick:this.onClickLabel})))),e.createElement("div",{className:o.section},e.createElement(le._,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),e.createElement("div",null,e.createElement(je.I,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:l,placeholder:"Enter a label value"})),e.createElement("div",{className:o.valueListArea},h.map(u=>e.createElement("div",{role:"list",key:u.name,className:o.valueListWrapper},e.createElement("div",{className:o.valueTitle,"aria-label":`Values for ${u.name}`},e.createElement(ne._,{name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets||u.values?.length,onClick:this.onClickLabel})),e.createElement(We.t7,{height:200,itemCount:u.values?.length||0,itemSize:28,itemKey:b=>u.values[b].name,width:200,className:o.valueList},({index:b,style:N})=>{const L=u.values?.[b];return L?e.createElement("div",{style:N},e.createElement(ne._,{name:u.name,value:L?.name,active:L?.selected,highlightParts:L?.highlightParts,onClick:this.onClickValue,searchTerm:l})):null}))))),e.createElement("div",{className:o.section},e.createElement(le._,null,"3. Resulting selector"),e.createElement("div",{"aria-label":"selector",className:o.selector},d),c&&e.createElement("div",{className:o.validationStatus},c),e.createElement("div",{className:(0,f.cx)(o.status,(r||i)&&o.statusShowing)},e.createElement("span",{className:i?o.error:""},i||r)),e.createElement(Ke.Lh,null,e.createElement(I.zx,{"aria-label":"Use selector as logs button",disabled:p,onClick:this.onClickRunLogsQuery},"Show logs"),e.createElement(I.zx,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:p,onClick:this.onClickRunMetricsQuery},"Show logs rate"),e.createElement(I.zx,{"aria-label":"Validate submit button",variant:"secondary",disabled:p,onClick:this.onClickValidate},"Validate selector"),e.createElement(I.zx,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const Xe=(0,K.HE)(Ye),Je=a=>{const{isOpen:t,onClose:s,datasource:l,app:r}=a,[i,c]=(0,e.useState)(!1),[o,d]=(0,e.useState)(!1),p="grafana.datasources.loki.browser.labels",h=(0,K.wW)(qe);(0,e.useEffect)(()=>{t&&l.languageProvider.fetchLabels().then(L=>{c(!0),d(L.length>0)})},[l,t]);const u=L=>{const{query:y,onChange:m,onRunQuery:v}=a,Q={...y,expr:L};m(Q),v()},b=L=>{u(L),s()},N=()=>{(0,R.ff)("grafana_loki_label_browser_closed",{app:r,closeType:"modalClose"}),s()};return e.createElement(be.u,{isOpen:t,title:"Label browser",onDismiss:N,className:h.modal},!i&&e.createElement(Le.u,{text:"Loading labels..."}),i&&!o&&e.createElement("p",null,"No labels found."),i&&o&&e.createElement(Ae.G,{storageKey:p,defaultValue:[]},(L,y,m)=>e.createElement(Xe,{languageProvider:l.languageProvider,onChange:b,lastUsedLabels:L,storeLastUsedLabels:y,deleteLastUsedLabels:m,app:r})))},qe=a=>({modal:f.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var _e=n(62992),U=n(39682),Z=n(21745),et=n(75849),Y=n(13572),tt=n(81764),X=n(8581),J=n(91720),at=n(8373);function st({item:a,items:t,defaultOp:s,onChange:l,onDelete:r,onGetLabelNames:i,onGetLabelValues:c,invalidLabel:o,invalidValue:d}){const[p,h]=(0,e.useState)({}),[u,b]=(0,e.useState)(!1),[N,L]=(0,e.useState)(!1),y="You have conflicting label filters",m=(S=a.op)=>xe.find($=>$.label===S)?.isMultiValue,v=S=>S?S.indexOf("|")>0?S.split("|"):[S]:[],Q=()=>{const S=p.labelValues?[...p.labelValues]:[],$=v(a?.value).map(Y.E);return(0,B.uniqBy)([...$,...S],"value")},j=(0,at.Zc)(a,t);return e.createElement("div",{"data-testid":"prometheus-dimensions-filter-item"},e.createElement(tt._,{error:y,invalid:j?!0:void 0},e.createElement(F.InputGroup,null,e.createElement(X.Ph,{placeholder:"Select label","aria-label":z.wl.components.QueryBuilder.labelSelect,inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:a.label?(0,Y.E)(a.label):null,allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelNames:!0});const S=await i(a);b(!0),h({labelNames:S,isLoadingLabelNames:void 0})},onCloseMenu:()=>{b(!1)},isOpen:u,isLoading:p.isLoadingLabelNames,options:p.labelNames,onChange:S=>{S.label&&l({...a,op:a.op??s,label:S.label})},invalid:j||o}),e.createElement(X.Ph,{"aria-label":z.wl.components.QueryBuilder.matchOperatorSelect,value:(0,Y.E)(a.op??s),options:xe,width:"auto",onChange:S=>{S.value!=null&&l({...a,op:S.value,value:m(S.value)?a.value:v(a?.value)[0]})},invalid:j}),e.createElement(X.Ph,{placeholder:"Select value","aria-label":z.wl.components.QueryBuilder.valueSelect,inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:m()?v(a?.value).map(Y.E):v(a?.value).map(Y.E)[0],allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelValues:!0});const S=await c(a);h({...p,labelValues:S,isLoadingLabelValues:void 0}),L(!0)},onCloseMenu:()=>{L(!1)},isOpen:N,isMulti:m(),isLoading:p.isLoadingLabelValues,options:Q(),onChange:S=>{if(S.value)l({...a,value:S.value,op:a.op??s});else{const $=S.map(D=>D.label).join("|");l({...a,value:$,op:a.op??s})}},invalid:j||d}),e.createElement(F.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:r}))))}const xe=[J.AI.equals,J.AI.doesNotEqual,J.AI.matchesRegex,J.AI.doesNotMatchRegex],lt="Select at least 1 label filter (label and value)";function nt({labelsFilters:a,onChange:t,onGetLabelNames:s,onGetLabelValues:l,labelFilterRequired:r}){const i="=",[c,o]=(0,e.useState)([{op:i}]);(0,e.useEffect)(()=>{a.length>0?o(a):o([{op:i}])},[a]);const d=h=>{o(h);const u=h.filter(b=>b.label!=null&&b.value!=null);(0,B.isEqual)(u,a)||t(u)},p=c.some(h=>h.label&&h.value);return e.createElement(F.EditorFieldGroup,null,e.createElement(F.EditorField,{label:"Label filters",error:lt,invalid:r&&!p},e.createElement(F.EditorList,{items:c,onChange:d,renderItem:(h,u,b)=>e.createElement(st,{item:h,items:c,defaultOp:i,onChange:u,onDelete:b,onGetLabelNames:s,onGetLabelValues:l,invalidLabel:r&&!h.label,invalidValue:r&&!h.value})})))}var Se=n(58439),rt=n(41285),Ce=n(19023),ot=n(73250),it=n(75765),ee=n(45204),te=n(19370);const Me="Fetch all log lines matching label filters.",Ne=e.memo(({query:a})=>{const t=(0,Z._)(a||"").query,s={grammar:te.xY,name:"lokiql"};return e.createElement(F.Stack,{gap:0,direction:"column"},e.createElement(Se.B,{stepNumber:1,title:e.createElement(ee.U,{query:`${U.y.renderLabels(t.labels)}`,lang:s})},Me),e.createElement(Ce.V,{stepNumber:2,queryModeller:U.y,query:t,lang:s}))});Ne.displayName="LokiQueryBuilderExplained";var ae=n(68668),ct=n(8180),ut=n(75215);const Qe=e.memo(({nestedQuery:a,index:t,datasource:s,onChange:l,onRemove:r,onRunQuery:i,showExplain:c})=>{const o=(0,K.wW)(mt);return e.createElement("div",{className:o.card},e.createElement("div",{className:o.header},e.createElement("div",{className:o.name},"Operator"),e.createElement(X.Ph,{"aria-label":"Select operator",width:"auto",options:dt,value:(0,Y.E)(a.operator),onChange:d=>{l(t,{...a,operator:d.value})}}),e.createElement("div",{className:o.name},"Vector matches"),e.createElement("div",{className:o.vectorMatchWrapper},e.createElement(X.Ph,{width:"auto",value:a.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:d=>{l(t,{...a,vectorMatchesType:d.value})}}),e.createElement(ae.H,{className:o.vectorMatchInput,minWidth:20,defaultValue:a.vectorMatches,onCommitChange:d=>{l(t,{...a,vectorMatches:d.currentTarget.value,vectorMatchesType:a.vectorMatchesType||"on"})}})),e.createElement(F.FlexItem,{grow:1}),e.createElement(ct.h,{ariaLabel:"Remove nested query",name:"times",size:"sm",onClick:()=>r(t)})),e.createElement("div",{className:o.body},e.createElement(F.EditorRows,null,e.createElement(ue,{showExplain:c,query:a.query,datasource:s,onRunQuery:i,onChange:d=>{l(t,{...a,query:d})}}))))}),dt=ut.i.map(a=>({label:a.sign,value:a.sign}));Qe.displayName="NestedQuery";const mt=a=>({card:(0,f.css)({label:"card",display:"flex",flexDirection:"column",gap:a.spacing(.5)}),header:(0,f.css)({label:"header",padding:a.spacing(.5,.5,.5,1),gap:a.spacing(1),display:"flex",alignItems:"center"}),name:(0,f.css)({label:"name",whiteSpace:"nowrap"}),body:(0,f.css)({label:"body",paddingLeft:a.spacing(2)}),vectorMatchInput:(0,f.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,f.css)({label:"vectorMatchWrapper",display:"flex"})});function pt({query:a,datasource:t,onChange:s,onRunQuery:l,showExplain:r}){const i=a.binaryQueries??[],c=(d,p)=>{const h=[...i];h.splice(d,1,p),s({...a,binaryQueries:h})},o=d=>{const p=[...i.slice(0,d),...i.slice(d+1)];s({...a,binaryQueries:p})};return e.createElement(F.Stack,{direction:"column",gap:1},i.map((d,p)=>e.createElement(Qe,{key:p.toString(),nestedQuery:d,index:p,onChange:c,datasource:t,onRemove:o,onRunQuery:l,showExplain:r})))}const ue=e.memo(({datasource:a,query:t,onChange:s,onRunQuery:l,showExplain:r})=>{const[i,c]=(0,e.useState)(),[o,d]=(0,e.useState)(void 0),p=y=>{s({...t,labels:y})},h=async y=>{const m=await y;return[...a.getVariables(),...m].map(v=>({label:v,value:v}))},u=async y=>{const m=t.labels.filter($=>$!==y);if(m.length===0)return await a.languageProvider.fetchLabels();const v=U.y.renderLabels(m),Q=await a.languageProvider.fetchSeriesLabels(v),j=m.map($=>$.label);return Object.keys(Q).filter($=>!j.includes($)).sort()},b=async y=>{if(!y.label)return[];let m;const v=t.labels.filter(Q=>Q!==y);if(v.length===0)m=await a.languageProvider.fetchLabelValues(y.label);else{const Q=U.y.renderLabels(v);m=(await a.languageProvider.fetchSeriesLabels(Q))[a.interpolateString(y.label)]}return m?m.map(Q=>(0,re.Hk)(Q,y.op)):[]},N=(0,e.useMemo)(()=>{const{labels:y,operations:m}=t;return!y.length&&m.length?!(m.length===1&&m[0].id===J.B5.LineContains&&m[0].params[0]===""):!1},[t]);(0,e.useEffect)(()=>{(async()=>{const m={expr:U.y.renderQuery(t),refId:"data-samples"},Q={series:await a.getDataSamples(m),state:w.Gu.Done,timeRange:(0,et.JK)()};c(Q)})().catch(console.error)},[a,t]);const L={grammar:te.ZP,name:"logql"};return e.createElement("div",{"data-testid":ge.editor},e.createElement(F.EditorRow,null,e.createElement(nt,{onGetLabelNames:y=>h(u(y)),onGetLabelValues:y=>h(b(y)),labelsFilters:t.labels,onChange:p,labelFilterRequired:N})),r&&e.createElement(Se.B,{stepNumber:1,title:e.createElement(ee.U,{query:`${U.y.renderLabels(t.labels)}`,lang:L})},Me),e.createElement(ot.B,null,e.createElement(rt.P,{queryModeller:U.y,query:t,onChange:s,onRunQuery:l,datasource:a,highlightedOp:o}),e.createElement(it.L,{datasource:a,query:t,onChange:s,data:i,queryModeller:U.y,buildVisualQueryFromString:Z._})),r&&e.createElement(Ce.V,{stepNumber:2,queryModeller:U.y,query:t,lang:L,onMouseEnter:y=>{d(y)},onMouseLeave:()=>{d(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&e.createElement(pt,{query:t,datasource:a,onChange:s,onRunQuery:l,showExplain:r}))});ue.displayName="LokiQueryBuilder";function gt({query:a}){return e.createElement(F.EditorRow,null,e.createElement(F.EditorFieldGroup,null,e.createElement(ee.U,{query:a,lang:{grammar:te.xY,name:"lokiql"}})))}function ht(a){const{query:t,onChange:s,onRunQuery:l,datasource:r,showExplain:i}=a,[c,o]=(0,e.useReducer)(Fe.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,e.useEffect)(()=>{o(Et(t.expr))},[t.expr]);const d=p=>{const h=U.y.renderQuery(p);o(vt({visQuery:p,expr:h})),s({...a.query,expr:h})};return c.visQuery?e.createElement(e.Fragment,null,e.createElement(ue,{query:c.visQuery,datasource:r,onChange:d,onRunQuery:l,showExplain:i,"data-testid":ge.editor}),t.expr!==""&&e.createElement(gt,{query:t.expr})):null}const ft={expr:""},Fe=(0,_e.oM)({name:"loki-builder-container",initialState:ft,reducers:{visualQueryChange:(a,t)=>{a.expr=t.payload.expr,a.visQuery=t.payload.visQuery},exprChanged:(a,t)=>{if(!a.visQuery||a.expr!==t.payload){a.expr=t.payload;const s=(0,Z._)(t.payload);a.visQuery=s.query}}}}),{visualQueryChange:vt,exprChanged:Et}=Fe.actions;var yt=n(76282),de=n(35645),bt=n(2594),Lt=n(38435),_=n(47138),xt=n(24666),me=n(89545);const Re=e.memo(({app:a,query:t,onChange:s,onRunQuery:l,maxLines:r,datasource:i,queryStats:c})=>{const[o,d]=(0,e.useState)(!0),p=m=>{s({...t,queryType:m}),l()},h=m=>{(0,R.ff)("grafana_loki_resolution_clicked",{app:a,resolution:m.value}),s({...t,resolution:m.value}),l()},u=m=>{const v=m.currentTarget.value;if(!(0,yt.jO)(v)){d(!1);return}d(!0),s({...t,splitDuration:v}),l()},b=m=>{s({...t,legendFormat:m.currentTarget.value}),l()};function N(m){const v=(0,_.Wz)(m.currentTarget.value);t.maxLines!==v&&(s({...t,maxLines:v}),l())}let L=t.queryType??(t.instant?me.EM.Instant:me.EM.Range),y=(0,xt.rE)(t.expr);return e.createElement(F.EditorRow,null,e.createElement(Lt.d,{title:"Options",collapsedInfo:St(t,L,y,r),queryStats:c},e.createElement(F.EditorField,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},e.createElement(ae.H,{placeholder:"{{label}}",id:"loki-query-editor-legend-format",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:b})),e.createElement(F.EditorField,{label:"Type"},e.createElement(bt.S,{options:_.uG,value:L,onChange:p})),y&&e.createElement(F.EditorField,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},e.createElement(ae.H,{className:"width-4",placeholder:r.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:N})),e.createElement(F.EditorField,{label:"Resolution",tooltip:"Sets the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better."},e.createElement(X.Ph,{isSearchable:!1,onChange:h,options:_.oZ,value:t.resolution||1,"aria-label":"Select resolution"})),de.v.featureToggles.lokiQuerySplittingConfig&&de.v.featureToggles.lokiQuerySplitting&&e.createElement(F.EditorField,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled."},e.createElement(ae.H,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:u,invalid:!o}))))});function St(a,t,s,l){const r=_.uG.find(o=>o.value===t),i=_.oZ.find(o=>o.value===(a.resolution??1)),c=[];return a.legendFormat&&c.push(`Legend: ${a.legendFormat}`),a.resolution&&c.push(`Resolution: ${i?.label}`),c.push(`Type: ${r?.label}`),s&&c.push(`Line limit: ${a.maxLines??l}`),c}Re.displayName="LokiQueryBuilderOptions";var Te=n(91159),Ct=n(67483);async function De(a,t){if(!t)return null;const s=await a.getQueryStats(t);return s?Object.values(s).every(l=>l===0)?null:s:null}function Oe(a,t){return(0,Ct.v9)(a)?a.isSame(t):a===t}function Mt(a,t,s,l){return a!==t?!0:!(Oe(s.raw.from,l?.raw.from)&&Oe(s.raw.to,l?.raw.to))}function Nt({query:a,datasource:t,range:s,onRunQuery:l,onChange:r,data:i,app:c,showExplain:o,history:d,setQueryStats:p}){const h=(0,K.wW)(Qt);return e.createElement("div",{className:h.wrapper},e.createElement(Te.n,{datasource:t,query:a,range:s,onRunQuery:l,onChange:r,history:d,data:i,app:c,"data-testid":ge.editor,onQueryType:async u=>{const b=await De(t,u);p(b)}}),o&&e.createElement(Ne,{query:a.expr}))}const Qt=a=>({wrapper:f.css`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `});var Ft=n(2352),Rt=n(99822),pe=n(72948);const Tt=a=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:l,hasPreviousQuery:r,selectedPatternName:i,setSelectedPatternName:c}=a,o=(0,K.wW)(Dt),d={grammar:te.ZP,name:"logql"};return e.createElement(pe.Z,{className:o.card},e.createElement(pe.Z.Heading,null,t.name),e.createElement("div",{className:o.rawQueryContainer},e.createElement(ee.U,{query:U.y.renderQuery({labels:[],operations:t.operations}),lang:d,className:o.rawQuery})),e.createElement(pe.Z.Actions,null,i!==t.name?e.createElement(I.zx,{size:"sm",onClick:()=>{r?c(t.name):s(t)}},"Use this query"):e.createElement(e.Fragment,null,e.createElement("div",{className:o.spacing},`If you would like to use this query, ${l?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),e.createElement(I.zx,{size:"sm",fill:"outline",onClick:()=>c(null)},"Back"),e.createElement(I.zx,{size:"sm",onClick:()=>{s(t)}},"Replace query"),l&&e.createElement(I.zx,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},Dt=a=>({card:f.css`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:f.css`
      flex-grow: 1;
    `,rawQuery:f.css`
      background-color: ${a.colors.background.primary};
      padding: ${a.spacing(1)};
      margin-top: ${a.spacing(1)};
    `,spacing:f.css`
      margin-bottom: ${a.spacing(1)};
    `}),Ot=a=>{const{isOpen:t,onClose:s,onChange:l,onAddQuery:r,query:i,queries:c,app:o}=a,[d,p]=(0,e.useState)([]),[h,u]=(0,e.useState)(null),b=(0,K.wW)(Pt),N=!!r,L=(0,e.useMemo)(()=>(0,Z._)(i.expr).query.operations.length>0,[i.expr]),y=(m,v=!1)=>{const Q=(0,Z._)(v?"":i.expr);(0,R.ff)("grafana_loki_query_patterns_selected",{version:"v2",app:o??"",editorMode:i.editorMode,selectedPattern:m.name,preSelectedOperationsCount:Q.query.operations.length,preSelectedLabelsCount:Q.query.labels.length,createNewQuery:N&&v}),Q.query.operations=m.operations,N&&v?r({...i,refId:(0,Rt.Hs)(c??[i]),expr:U.y.renderQuery(Q.query)}):l({...i,expr:U.y.renderQuery(Q.query)}),u(null),s()};return e.createElement(be.u,{isOpen:t,title:"Kick start your query",onDismiss:s,className:b.modal},e.createElement("div",{className:b.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(J.Hv).map(m=>e.createElement(Ft.U,{key:m,label:`${(0,B.capitalize)(m)} query starters`,isOpen:d.includes(m),collapsible:!0,onToggle:()=>p(v=>v.includes(m)?v.filter(Q=>Q!==m):[...v,m])},e.createElement("div",{className:b.cardsContainer},U.y.getQueryPatterns().filter(v=>v.type===m).map(v=>e.createElement(Tt,{key:v.name,pattern:v,hasNewQueryOption:N,hasPreviousQuery:L,onPatternSelect:y,selectedPatternName:h,setSelectedPatternName:u}))))),e.createElement(I.zx,{variant:"secondary",onClick:s},"Close"))},Pt=a=>({cardsContainer:f.css`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:f.css`
      margin-bottom: ${a.spacing(1)};
    `,modal:f.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Pe=n(58379);const we="LokiQueryEditorModeDefault";function wt(a,t,s){a.expr===""&&Pe.Z.set(we,t),s({...a,editorMode:t})}function kt(a){if(a!=null&&a!=="")return H.c.Code;switch(Pe.Z.get(we)){case"code":return H.c.Code;case"builder":default:return H.c.Builder}}function Bt(a){let t=a;return a.editorMode||(t={...a,editorMode:kt(a.expr)}),a.expr==null&&(t={...t,expr:""}),a.queryType==null&&(t={...t,queryType:me.EM.Range}),t}const ge={editor:"loki-editor"},ke=e.memo(a=>{const{onChange:t,onRunQuery:s,onAddQuery:l,data:r,app:i,queries:c,datasource:o}=a,[d,p]=(0,e.useState)(!1),[h,u]=(0,e.useState)(!1),[b,N]=(0,e.useState)(!1),[L,y]=(0,e.useState)(!1),[m,v]=(0,e.useState)(null),{flag:Q,setFlag:j}=(0,ye.P5)(ye.iS),S=o.getTimeRange(),$=(0,x.Z)(S),D=Bt(a.query),Ie=(0,x.Z)(D.expr),fe=D.editorMode,ga=V=>{j(V.currentTarget.checked)},ha=(0,e.useCallback)(V=>{if((0,R.ff)("grafana_loki_editor_mode_clicked",{newEditor:V,previousEditor:D.editorMode??"",newQuery:!D.expr,app:i??""}),V===H.c.Builder&&(0,Z._)(D.expr||"").errors.length){p(!0);return}wt(D,V,t)},[t,D,i]);(0,e.useEffect)(()=>{N(!1)},[r]);const ve=V=>{(0,B.isEqual)(V,a.query)||N(!0),t(V)},fa=()=>{(0,R.ff)("grafana_loki_label_browser_opened",{app:i}),y(V=>!V)};return(0,e.useEffect)(()=>{Mt(D.expr,Ie,S,$)&&(async()=>{const va=await De(o,D.expr);v(va)})()},[o,S,$,D,Ie,v]),e.createElement(e.Fragment,null,e.createElement(Ue.s,{isOpen:d,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{t({...D,editorMode:H.c.Builder}),p(!1)},onDismiss:()=>p(!1)}),e.createElement(Ot,{isOpen:h,onClose:()=>u(!1),query:D,queries:c,app:i,onChange:t,onAddQuery:l}),e.createElement(Je,{isOpen:L,datasource:o,query:D,app:i,onClose:()=>y(!1),onChange:ve,onRunQuery:s}),e.createElement(F.EditorHeader,null,e.createElement(F.Stack,{gap:1},e.createElement(I.zx,{"aria-label":z.wl.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{u(Ee=>!Ee);const V=(0,Z._)(D.expr||"");(0,R.ff)("grafana_loki_query_patterns_opened",{version:"v2",app:i??"",editorMode:D.editorMode,preSelectedOperationsCount:V.query.operations.length,preSelectedLabelsCount:V.query.labels.length})}},"Kick start your query"),e.createElement(I.zx,{variant:"secondary",size:"sm",onClick:fa,"data-testid":"label-browser-button"},"Label browser")),e.createElement(Ve.n,{label:"Explain query",value:Q,onChange:ga}),e.createElement(F.FlexItem,{grow:1}),i!==g.zj.Explore&&i!==g.zj.Correlations&&e.createElement(I.zx,{variant:b?"primary":"secondary",size:"sm",onClick:s,icon:r?.state===w.Gu.Loading?"fa fa-spinner":void 0,disabled:r?.state===w.Gu.Loading},"Run queries"),e.createElement($e.k,{mode:fe,onChange:ha})),e.createElement(F.Space,{v:.5}),e.createElement(F.EditorRows,null,fe===H.c.Code&&e.createElement(Nt,{...a,query:D,onChange:ve,showExplain:Q,setQueryStats:v}),fe===H.c.Builder&&e.createElement(ht,{datasource:a.datasource,query:D,onChange:ve,onRunQuery:a.onRunQuery,showExplain:Q}),e.createElement(Re,{query:D,onChange:t,onRunQuery:s,app:i,maxLines:o.maxLines,datasource:o,queryStats:m})))});ke.displayName="LokiQueryEditor";function It(a){const{query:t,data:s,datasource:l,onChange:r,onRunQuery:i,history:c}=a;return e.createElement(Te.n,{datasource:l,query:t,onChange:r,onRunQuery:i,history:c,data:s,placeholder:"Enter a Loki query","data-testid":Ut.editor})}const Ut={editor:"loki-editor-cloud-alerting"};function $t(a){const{app:t}=a;switch(t){case g.zj.CloudAlerting:return e.createElement(It,{...a});default:return e.createElement(ke,{...a})}}const Vt=(0,e.memo)($t),Ea={editor:"loki-editor"};var At=n(12006),Wt=n(64260),zt=n(94976),jt=n(3281),Kt=n(9085),Gt=n.n(Kt),Ht=n(99098),he=n(14835),Zt=n(41611);const{FormField:Yt}=he.LegacyForms,Xt=a=>{const{derivedFields:t,className:s}=a,[l,r]=(0,e.useState)("");let i=[];return l&&t&&(i=qt(t,l)),e.createElement("div",{className:s},e.createElement(Yt,{labelWidth:12,label:"Debug log message",inputEl:e.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Gt()("gf-form-input gf-form-textarea",f.css`
                width: 100%;
              `),value:l,onChange:c=>r(c.currentTarget.value)})}),!!i.length&&e.createElement(Jt,{fields:i}))},Jt=({fields:a})=>e.createElement("table",{className:"filter-table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Value"),e.createElement("th",null,"Url"))),e.createElement("tbody",null,a.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=e.createElement("a",{href:t.href},s)),e.createElement("tr",{key:`${t.name}=${t.value}`},e.createElement("td",null,t.name),e.createElement("td",null,s),e.createElement("td",null,t.href?e.createElement("a",{href:t.href},t.href):""))})));function qt(a,t){return a.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const l=t.match(s.matcherRegex),r=l&&l[1];let i=null;return s.url&&r&&(i=(0,Zt.a_)({field:{name:"",type:Ht.fS.string,values:[r],config:{links:[{title:"",url:s.url}]}},rowIndex:0,range:{}})[0]),{name:s.name,value:r||"<no match>",href:i?i.href:void 0}}catch(l){return{name:s.name,error:l}}})}var _t=n(53117),ea=n(35919);const{Switch:ta,FormField:se}=he.LegacyForms,aa=a=>({row:f.css`
    display: flex;
    align-items: baseline;
  `,nameField:f.css`
    flex: 2;
  `,regexField:f.css`
    flex: 3;
  `,urlField:f.css`
    flex: 1;
    margin-right: ${a.spacing(.5)};
  `,urlDisplayLabelField:f.css`
    flex: 1;
  `}),sa=a=>{const{value:t,onChange:s,onDelete:l,suggestions:r,className:i}=a,c=(0,K.wW)(aa),[o,d]=(0,e.useState)(!!t.datasourceUid),p=(0,x.Z)(t.datasourceUid);(0,e.useEffect)(()=>{!p&&t.datasourceUid&&!o&&d(!0),p&&!t.datasourceUid&&o&&d(!1)},[p,t.datasourceUid,o]);const h=u=>b=>{s({...t,[u]:b.currentTarget.value})};return e.createElement("div",{className:i,"data-testid":"derived-field"},e.createElement("div",{className:"gf-form"},e.createElement(se,{labelWidth:10,className:c.nameField,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:h("name")}),e.createElement(se,{labelWidth:10,className:c.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:h("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),e.createElement(I.zx,{variant:"destructive",title:"Remove field",icon:"times",onClick:u=>{u.preventDefault(),l()}})),e.createElement("div",{className:"gf-form"},e.createElement(se,{labelWidth:10,label:o?"Query":"URL",inputEl:e.createElement(ea.v,{placeholder:o?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:u=>s({...t,url:u}),suggestions:r}),className:c.urlField}),e.createElement(se,{className:c.urlDisplayLabelField,labelWidth:10,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:h("urlDisplayLabel"),tooltip:"Use to override the button label when this derived field is found in a log."})),e.createElement("div",{className:c.row},e.createElement(ta,{label:"Internal link",checked:o,onChange:()=>{o&&s({...t,datasourceUid:void 0}),d(!o)}}),o&&e.createElement(_t.q,{tracing:!0,onChange:u=>s({...t,datasourceUid:u.uid}),current:t.datasourceUid})))},la=a=>({infoText:f.css`
    padding-bottom: ${a.spacing(2)};
    color: ${a.colors.text.secondary};
  `,derivedField:f.css`
    margin-bottom: ${a.spacing(1)};
  `}),na=({value:a=[],onChange:t})=>{const s=(0,K.l4)(),l=la(s),[r,i]=(0,e.useState)(!1);return e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-heading"},"Derived fields"),e.createElement("div",{className:l.infoText},"Derived fields can be used to extract new fields from a log message and create a link from its value."),e.createElement("div",{className:"gf-form-group"},a.map((c,o)=>e.createElement(sa,{className:l.derivedField,key:o,value:c,onChange:d=>{const p=[...a];p.splice(o,1,d),t(p)},onDelete:()=>{const d=[...a];d.splice(o,1),t(d)},suggestions:[{value:zt.W.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:jt.L8.Value}]})),e.createElement("div",null,e.createElement(I.zx,{variant:"secondary",className:f.css`
              margin-right: 10px;
            `,icon:"plus",onClick:c=>{c.preventDefault();const o=[...a,{name:"",matcherRegex:""}];t(o)}},"Add"),a.length>0&&e.createElement(I.zx,{variant:"secondary",type:"button",onClick:()=>i(!r)},r?"Hide example log message":"Show example log message"))),r&&e.createElement("div",{className:"gf-form-group"},e.createElement(Xt,{className:f.css`
              margin-bottom: 10px;
            `,derivedFields:a})))},{FormField:ra}=he.LegacyForms,oa=a=>{const{value:t,onChange:s}=a;return e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-heading"},"Queries"),e.createElement("div",{className:"gf-form-group"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form"},e.createElement(ra,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:e.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:l=>s(l.currentTarget.value),spellCheck:!1,placeholder:"1000"}),tooltip:e.createElement(e.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})))))},Be=a=>(t,s)=>({...t,jsonData:{...t.jsonData,[a]:s}}),ia=Be("maxLines"),ca=Be("derivedFields"),ua=a=>{const{options:t,onOptionsChange:s}=a;return e.createElement(e.Fragment,null,e.createElement(At.E,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:s,secureSocksDSProxyEnabled:de.v.secureSocksDSProxyEnabled}),e.createElement(Wt.O,{options:t,onOptionsChange:s}),e.createElement(oa,{value:t.jsonData.maxLines||"",onChange:l=>s(ia(t,l))}),e.createElement(na,{value:t.jsonData.derivedFields,onChange:l=>s(ca(t,l))}))};var da=n(31593),ma=n(32920);const pa=new E.hf(da.KV).setQueryEditor(Vt).setConfigEditor(ua).setQueryEditorHelp(M);(0,W.N$)().subscribe(k.Pl,ma.u)},58439:(q,A,n)=>{n.d(A,{B:()=>e});var E=n(9892),k=n(66111),W=n(2631),B=n(72648);function e({title:C,stepNumber:T,markdown:O,children:P}){const M=(0,B.wW)(R);return k.createElement("div",{className:M.box},T!==void 0&&k.createElement("div",{className:M.stepNumber},T),k.createElement("div",{className:M.boxInner},C&&k.createElement("div",{className:M.header},k.createElement("span",null,C)),k.createElement("div",{className:M.body},O&&k.createElement("div",{dangerouslySetInnerHTML:{__html:(0,W.a)(O)}}),P)))}const R=C=>({box:(0,E.css)({background:C.colors.background.secondary,padding:C.spacing(1),borderRadius:C.shape.borderRadius(),position:"relative"}),boxInner:(0,E.css)({marginLeft:C.spacing(4)}),stepNumber:(0,E.css)({fontWeight:C.typography.fontWeightMedium,background:C.colors.secondary.main,width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:C.typography.bodySmall.fontSize}),header:(0,E.css)({paddingBottom:C.spacing(.5),display:"flex",alignItems:"center",fontFamily:C.typography.fontFamilyMonospace}),body:(0,E.css)({color:C.colors.text.secondary,"p:last-child":{margin:0},a:{color:C.colors.text.link,textDecoration:"underline"}})})},19023:(q,A,n)=>{n.d(A,{V:()=>B});var E=n(66111),k=n(58439),W=n(45204);function B({query:e,queryModeller:R,stepNumber:C,lang:T,onMouseEnter:O,onMouseLeave:P}){return E.createElement(E.Fragment,null,e.operations.map((M,g)=>{const x=R.getOperationDef(M.id);if(!x)return`Operation ${M.id} not found`;const w=x.renderer(M,x,"<expr>"),z=x.explainHandler?x.explainHandler(M,x):x.documentation??"no docs";return E.createElement("div",{key:g,onMouseEnter:()=>O?.(M,g),onMouseLeave:()=>P?.(M,g)},E.createElement(k.B,{stepNumber:g+C,title:E.createElement(W.U,{query:w,lang:T}),markdown:z}))}))}},45204:(q,A,n)=>{n.d(A,{U:()=>R});var E=n(9892),k=n(57706),W=n.n(k),B=n(66111),e=n(72648);function R({query:T,lang:O,className:P}){const M=(0,e.l4)(),g=C(M),x=W().highlight(T,O.grammar,O.name);return B.createElement("div",{className:(0,E.cx)(g.editorField,"prism-syntax-highlight",P),"aria-label":"selector",dangerouslySetInnerHTML:{__html:x}})}const C=T=>({editorField:(0,E.css)({fontFamily:T.typography.fontFamilyMonospace,fontSize:T.typography.bodySmall.fontSize})})}}]);

//# sourceMappingURL=4712.01bf5dd3eda3853f7e1c.js.map