"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4601],{14601:(va,Le,m)=>{m.r(Le),m.d(Le,{plugin:()=>ya});var Qe=m(89424),Jt=m(23588),Zt=m(82378),h=m(9892),i=m(66111),fe=m(75849),Re=m(45253),U=m(72648),We=m(69659),he=m(77117),f=m(81764),b=m(46967);const Xt=t=>(e,s)=>{const n={};for(const a in t)n[a]=t[a](e[a],s);return n},ye=(t,e,s)=>(0,i.useCallback)(a=>{t(s(e,a))},[t,e,s]),ze=(0,i.createContext)(void 0),D=()=>{const t=(0,i.useContext)(ze);if(!t)throw new Error("Use DispatchContext first.");return t},He=t=>({name:t,pipelineAgg:""}),je=t=>`var${Math.max(0,...t.map(e=>parseInt(e.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,qe=t=>t.settings?.model==="ewma",ve=t=>t.settings?.model==="holt",ne=t=>t.settings?.model==="holt_winters",es=t=>["holt","ewma","holt_winters"].includes(t.settings?.model||""),R=t=>E[t.type].requiresField,K=t=>E[t.type].isPipelineAgg,ae=t=>E[t.type].supportsMultipleBucketPaths,ts=t=>E[t.type].supportsMissing,be=t=>E[t.type].hasSettings,ss=t=>E[t.type].hasMeta,Ue=t=>E[t.type].supportsInlineScript,ns=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],as=t=>ns.includes(t),E={count:{label:"Count",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[He(je([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,isSingleMetric:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,isSingleMetric:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,isSingleMetric:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},is={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Ge=(t,e)=>{const s=e.filter(n=>ae(n)?n.pipelineVariables?.some(a=>a.pipelineAgg===t.id):R(n)&&t.id===n.field);return[...s,...s.flatMap(n=>Ge(n,e))]},Ee=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],rs=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],ie={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"};function re(t="1"){return{type:"count",id:t}}function le(t="1"){return{type:"date_histogram",id:t,settings:{interval:"auto"}}}const Ye=(t,e)=>t.find(s=>s.id===e);function Se(t,e){return!!t?.metrics?.some(s=>s.type===e)}function ls(t){return t in is}function os(t){return!!E[t].supportsMultipleBucketPaths}var Fe=m(5048);const H=t=>R(t)?`${E[t.type].label} ${t.field}`:E[t.type].label,xe=t=>Object.entries(t).reduce((e,[s,n])=>{if(n==null)return{...e};if(Array.isArray(n)&&n.length===0)return{...e};if(typeof n=="string"&&n.length===0)return{...e};if(!Array.isArray(n)&&typeof n=="object"){const a=xe(n);return Object.keys(a).length===0?{...e}:{...e,[s]:a}}return{...e,[s]:n}},{}),Ke=t=>{const e=t.match(/^(\d+)/);return e?e[1]:void 0},J=t=>(typeof t.settings?.script=="object"?t.settings?.script?.inline:t.settings?.script)||"",Je=t=>!!(0,Fe.gte)(t,"7.16.0"),Ze="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.";var S=m(62992);const Xe=(0,S.PH)("@metrics/add"),et=(0,S.PH)("@metrics/remove"),tt=(0,S.PH)("@metrics/toggle_visibility"),Me=(0,S.PH)("@metrics/change_field"),Ie=(0,S.PH)("@metrics/change_type"),st=(0,S.PH)("@metrics/change_attr"),I=(0,S.PH)("@metrics/change_setting"),nt=(0,S.PH)("@metrics/change_meta"),Z=(0,S.PH)("init"),at=(0,S.PH)("change_query"),it=(0,S.PH)("change_alias_pattern"),cs=(t,e)=>at.match(e)?e.payload:Z.match(e)?t||"":t,us=(t,e)=>it.match(e)?e.payload:Z.match(e)?t||"":t;var we=m(56808);const rt=()=>({label:"",query:"*"}),F={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[rt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:"3"}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:we.RQ.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},lt=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],Ce=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],ds=[{label:"No limit",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"20",value:"20"}],ot=(0,S.PH)("@bucketAggs/add"),ct=(0,S.PH)("@bucketAggs/remove"),ut=(0,S.PH)("@bucketAggs/change_type"),dt=(0,S.PH)("@bucketAggs/change_field"),w=(0,S.PH)("@bucketAggs/change_setting"),gs=t=>(e,s)=>{if(ot.match(s)){const n={id:s.payload,type:"terms",settings:F.terms.defaultSettings},a=e[e.length-1];return a?.type==="date_histogram"?[...e.slice(0,e.length-1),n,a]:[...e,n]}return ct.match(s)?e.filter(n=>n.id!==s.payload):ut.match(s)?e.map(n=>n.id!==s.payload.id?n:{id:n.id,type:s.payload.newType,settings:F[s.payload.newType].defaultSettings}):dt.match(s)?e.map(n=>n.id!==s.payload.id?n:{...n,field:s.payload.newField}):Ie.match(s)?E[s.payload.type].isSingleMetric?[]:e.length===0?[{...le("2"),field:t}]:e:w.match(s)?e.map(n=>{if(n.id!==s.payload.bucketAgg.id)return n;const a=xe({...n.settings,[s.payload.settingName]:s.payload.newValue});return{...n,settings:{...a}}}):Z.match(s)?e?.length||0>0?e:[{...le("2"),field:t}]:e},ms=(t,e)=>{if(Xe.match(e))return[...t,re(e.payload)];if(et.match(e)){const s=t.find(r=>r.id===e.payload),n=[s,...Ge(s,t)],a=t.filter(r=>!n.some(l=>l.id===r.id));return a.length===0?[re("1")]:a}return Ie.match(e)?t.filter(s=>E[e.payload.type].isSingleMetric?s.id===e.payload.id:!0).map(s=>s.id!==e.payload.id?s:{id:s.id,type:e.payload.type,...E[e.payload.type].defaults}):Me.match(e)?t.map(s=>{if(s.id!==e.payload.id)return s;const n={...s,field:e.payload.field};return K(s)?{...n,pipelineAgg:e.payload.field}:n}):tt.match(e)?t.map(s=>s.id!==e.payload?s:{...s,hide:!s.hide}):I.match(e)?t.map(s=>{if(s.id!==e.payload.metric.id)return s;if(be(s)){const n=xe({...s.settings,[e.payload.settingName]:e.payload.newValue});return{...s,settings:{...n}}}return s}):nt.match(e)?t.map(s=>s.id!==e.payload.metric.id?s:ss(s)?{...s,meta:{...s.meta,[e.payload.meta]:e.payload.newValue}}:s):st.match(e)?t.map(s=>s.id!==e.payload.metric.id?s:{...s,[e.payload.attribute]:e.payload.newValue}):Z.match(e)?t?.length||0>0?t:[re("1")]:t},gt=(0,i.createContext)(void 0),mt=(0,i.createContext)(void 0),pt=(0,i.createContext)(void 0),ps=({children:t,onChange:e,onRunQuery:s,query:n,datasource:a,range:r})=>{const l=(0,i.useCallback)(p=>{e(p),s()},[e,s]),u=Xt({query:cs,alias:us,metrics:ms,bucketAggs:gs(a.timeField)}),c=ye(p=>l({...n,...p,timeField:a.timeField}),n,u),o=!n.metrics||!n.bucketAggs||n.query===void 0,[d,g]=(0,i.useState)(o);return(0,i.useEffect)(()=>{d&&(c(Z()),g(!1))},[d,c]),o?null:i.createElement(gt.Provider,{value:a},i.createElement(mt.Provider,{value:n},i.createElement(pt.Provider,{value:r},i.createElement(ze.Provider,{value:c},t))))},Pe=t=>()=>{const e=(0,i.useContext)(t);if(!e)throw new Error("use ElasticsearchProvider first.");return e},j=Pe(mt),ft=Pe(gt),fs=Pe(pt),ht=t=>t.id,hs=t=>parseInt(t,10),ys=()=>{const{metrics:t,bucketAggs:e}=j();return(0,i.useMemo)(()=>(Math.max(...[...t?.map(ht)||["0"],...e?.map(ht)||["0"]].map(hs))+1).toString(),[t,e])};var yt=m(39904);const vs=h.css`
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
  width: 1px;
`,oe=({iconName:t,onClick:e,className:s,label:n,...a})=>i.createElement("button",{className:(0,h.cx)("gf-form-label gf-form-label--btn query-part",s),onClick:e,...a},i.createElement("span",{className:vs},n),i.createElement(yt.J,{name:t,"aria-hidden":"true"}));var y=m(82897),bs=m(11543),ce=m(62157),vt=m(8180);const bt=({children:t,label:e,onRemoveClick:s,onHideClick:n,hidden:a=!1})=>{const r=(0,U.wW)(Es);return i.createElement(bs.Z,null,i.createElement(ce.m,null,i.createElement(he.W,{width:17,as:"div"},i.createElement("span",null,e),i.createElement("span",{className:r.iconWrapper},n&&i.createElement(vt.h,{name:a?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":a,"aria-label":"hide metric",className:r.icon,type:"button"}),i.createElement(vt.h,{name:"trash-alt",size:"sm",className:r.icon,onClick:s||y.noop,disabled:!s,"aria-label":"remove metric",type:"button"})))),t)},Es=t=>({iconWrapper:h.css`
      display: flex;
    `,icon:h.css`
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(.25)};
    `});var Et=m(70044),ue=m(68118),B=m(65583);const St=t=>F[t.type].requiresField,Ss=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Fs=t=>Ss.includes(t),xs=t=>{if(as(t))switch(t){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Fs(t))switch(t){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Ms=({text:t})=>({label:t,value:t}),de=t=>{const e=ft(),s=fs(),n=Array.isArray(t)?t:xs(t);let a;return async r=>(a||(a=await(0,B.n)(e.getFields(n,s))),a.filter(({text:l})=>r===void 0||l.includes(r)).map(Ms))},G=h.css`
  min-width: 150px;
`,Is=(t,e)=>({wrapper:h.css`
      max-width: 500px;
      display: flex;
      flex-direction: column;
    `,settingsWrapper:h.css`
      padding-top: ${t.spacing(.5)};
    `,icon:h.css`
      margin-right: ${t.spacing(.5)};
    `,button:h.css`
      justify-content: start;
      ${e&&h.css`
        color: ${t.colors.text.disabled};
      `}
    `}),Ft=({label:t,children:e,hidden:s=!1})=>{const[n,a]=(0,i.useState)(!1),r=(0,U.l4)(),l=Is(r,s);return i.createElement(ce.m,null,i.createElement("div",{className:(0,h.cx)(l.wrapper)},i.createElement("button",{className:(0,h.cx)("gf-form-label query-part",l.button,G),onClick:()=>a(!n),"aria-expanded":n,type:"button"},i.createElement(yt.J,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:l.icon}),t),n&&i.createElement("div",{className:l.settingsWrapper},e)))};var A=m(8581),ws=m(52566);const Cs=t=>({value:e})=>e===t,Ps=(t,e)=>e===void 0||t.some(Cs(e))?t:[...t,{value:e,label:e}],xt=({options:t,value:e,onChange:s})=>{const[n,a]=(0,i.useState)(Ps(t,e)),r=l=>a([...n,{value:l,label:l}]);return{onCreateOption:l=>{r(l),s({value:l})},onChange:s,allowCustomValue:!0,options:n,value:e}},_s=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"}],Ds=t=>({value:e})=>e===t,Ns=(t,e,s)=>!s.some(Ds(t))&&t.trim().length>0,Ts=(t,e)=>t.value?.startsWith(e)||!1,$s=({bucketAgg:t})=>{const e=D(),{current:s}=(0,i.useRef)((0,y.uniqueId)("es-date_histogram-")),n=({value:a})=>e(w({bucketAgg:t,settingName:"interval",newValue:a}));return i.createElement(i.Fragment,null,i.createElement(f._,{label:"Interval",...T},i.createElement(A.Ph,{inputId:(0,y.uniqueId)("es-date_histogram-interval"),isValidNewOption:Ns,filterOption:Ts,...xt({options:_s,value:t.settings?.interval||F.date_histogram.defaultSettings?.interval,onChange:n})})),i.createElement(f._,{label:"Min Doc Count",...T},i.createElement(b.I,{id:`${s}-min_doc_count`,onBlur:a=>e(w({bucketAgg:t,settingName:"min_doc_count",newValue:a.target.value})),defaultValue:t.settings?.min_doc_count||F.date_histogram.defaultSettings?.min_doc_count})),i.createElement(f._,{label:"Trim Edges",...T,tooltip:"Trim the edges on the timeseries datapoints"},i.createElement(b.I,{id:`${s}-trime_edges`,onBlur:a=>e(w({bucketAgg:t,settingName:"trimEdges",newValue:a.target.value})),defaultValue:t.settings?.trimEdges||F.date_histogram.defaultSettings?.trimEdges})),i.createElement(f._,{label:"Offset",...T,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day"},i.createElement(b.I,{id:`${s}-offset`,onBlur:a=>e(w({bucketAgg:t,settingName:"offset",newValue:a.target.value})),defaultValue:t.settings?.offset||F.date_histogram.defaultSettings?.offset})),i.createElement(f._,{label:"Timezone",...T},i.createElement(ws.O,{value:t.settings?.timeZone||F.date_histogram.defaultSettings?.timeZone,includeInternal:[we.RQ.utc],onChange:a=>{e(w({bucketAgg:t,settingName:"timeZone",newValue:a}))}})))},Mt=({index:t,onAdd:e,onRemove:s,elements:n})=>i.createElement("div",{className:h.css`
        display: flex;
      `},t===0&&i.createElement(oe,{iconName:"plus",onClick:e,label:"add"}),n.length>=2&&i.createElement(oe,{iconName:"minus",onClick:s,label:"remove"})),_e=(0,S.PH)("@bucketAggregations/filter/add"),It=(0,S.PH)("@bucketAggregations/filter/remove"),De=(0,S.PH)("@bucketAggregations/filter/change"),Vs=(t=[],e)=>_e.match(e)?[...t,rt()]:It.match(e)?t.slice(0,e.payload).concat(t.slice(e.payload+1)):De.match(e)?t.map((s,n)=>n!==e.payload.index?s:e.payload.filter):t,Os=({bucketAgg:t})=>{const{current:e}=(0,i.useRef)((0,y.uniqueId)("es-filters-")),s=D(),n=ye(a=>s(w({bucketAgg:t,settingName:"filters",newValue:a})),t.settings?.filters,Vs);return(0,i.useEffect)(()=>{t.settings?.filters?.length||n(_e())},[n,t.settings?.filters?.length]),i.createElement(i.Fragment,null,i.createElement("div",{className:h.css`
          display: flex;
          flex-direction: column;
        `},t.settings?.filters.map((a,r)=>i.createElement("div",{key:r,className:h.css`
              display: flex;
            `},i.createElement(f._,{label:"Query",labelWidth:8},i.createElement("div",{className:h.css`
                  width: 150px;
                `},i.createElement(We.q,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onBlur:()=>{},onChange:l=>n(De({index:r,filter:{...a,query:l}})),query:a.query}))),i.createElement(f._,{label:"Label",labelWidth:8},i.createElement(b.I,{width:16,id:`${e}-label-${r}`,placeholder:"Label",onBlur:l=>n(De({index:r,filter:{...a,label:l.target.value}})),defaultValue:a.label})),i.createElement(Mt,{index:r,elements:t.settings?.filters||[],onAdd:()=>n(_e()),onRemove:()=>n(It(r))})))))},ks=({bucketAgg:t})=>{const{metrics:e}=j(),s=Qs(e),{current:n}=(0,i.useRef)((0,y.uniqueId)("es-terms-")),a=D();return i.createElement(i.Fragment,null,i.createElement(f._,{label:"Order",...T},i.createElement(A.Ph,{inputId:`${n}-order`,onChange:r=>a(w({bucketAgg:t,settingName:"order",newValue:r.value})),options:Ce,value:t.settings?.order||F.terms.defaultSettings?.order})),i.createElement(f._,{label:"Size",...T},i.createElement(A.Ph,{inputId:`${n}-size`,...xt({options:ds,value:t.settings?.size||F.terms.defaultSettings?.size,onChange({value:r}){a(w({bucketAgg:t,settingName:"size",newValue:r}))}})})),i.createElement(f._,{label:"Min Doc Count",...T},i.createElement(b.I,{id:`${n}-min_doc_count`,onBlur:r=>a(w({bucketAgg:t,settingName:"min_doc_count",newValue:r.target.value})),defaultValue:t.settings?.min_doc_count||F.terms.defaultSettings?.min_doc_count})),i.createElement(f._,{label:"Order By",...T},i.createElement(A.Ph,{inputId:`${n}-order_by`,onChange:r=>a(w({bucketAgg:t,settingName:"orderBy",newValue:r.value})),options:s,value:t.settings?.orderBy||F.terms.defaultSettings?.orderBy})),i.createElement(f._,{label:"Missing",...T},i.createElement(b.I,{id:`${n}-missing`,onBlur:r=>a(w({bucketAgg:t,settingName:"missing",newValue:r.target.value})),defaultValue:t.settings?.missing||F.terms.defaultSettings?.missing})))};function Bs(t){return t.meta?Object.keys(t.meta).filter(s=>t.meta?.[s]).map(s=>{let n=s;return s==="std_deviation_bounds_lower"&&(n="std_lower"),s==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${H(t)} (${n})`,value:`${t.id}[${n}]`}}):[]}function As(t){return t.settings?.percents?t.settings.percents.map(e=>{const s=/^\d+\.\d+/.test(`${e}`)?e:`${e}.0`;return{label:`${H(t)} (${e})`,value:`${t.id}[${s}]`}}):[]}function Ls(t){return t.type!=="top_metrics"&&!K(t)}const Qs=(t=[])=>{const e=t.filter(Ls).flatMap(s=>s.type==="extended_stats"?Bs(s):s.type==="percentiles"?As(s):{label:H(s),value:s.id});return[...lt,...e]},wt=t=>e=>e.value===t,Rs=t=>{const{metrics:e}=j();switch(t.type){case"terms":{const s=t.settings?.order||"desc",n=t.settings?.size||"10",a=parseInt(t.settings?.min_doc_count||"0",10),r=t.settings?.orderBy||"_term";let l="";n!=="0"&&(l=`${Ce.find(wt(s))?.label} ${n}, `),a>0&&(l+=`Min Doc Count: ${a}, `),l+="Order by: ";const u=lt.find(wt(r));if(u)l+=u.label;else{const c=e?.find(o=>o.id===Ke(r));c?l+=H(c):l+="metric not found"}return n==="0"&&(l+=` (${s})`),l}case"histogram":{const s=t.settings?.interval||1e3,n=t.settings?.min_doc_count||1;return`Interval: ${s}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(t.settings?.filters||F.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${Math.max(Math.min(parseInt(t.settings?.precision||"5",10),12),1)}`;case"date_histogram":{const s=t.settings?.interval||"auto",n=t.settings?.min_doc_count||0,a=t.settings?.trimEdges||0;let r=`Interval: ${s}`;return n>0&&(r+=`, Min Doc Count: ${n}`),a>0&&(r+=`, Trim edges: ${a}`),r}default:return"Settings"}},T={labelWidth:16},Ws=({bucketAgg:t})=>{const{current:e}=(0,i.useRef)((0,y.uniqueId)("es-setting-")),s=D(),n=Rs(t);return i.createElement(Ft,{label:n},t.type==="terms"&&i.createElement(ks,{bucketAgg:t}),t.type==="date_histogram"&&i.createElement($s,{bucketAgg:t}),t.type==="filters"&&i.createElement(Os,{bucketAgg:t}),t.type==="geohash_grid"&&i.createElement(f._,{label:"Precision",...T},i.createElement(b.I,{id:`${e}-geohash_grid-precision`,onBlur:a=>s(w({bucketAgg:t,settingName:"precision",newValue:a.target.value})),defaultValue:t.settings?.precision||F[t.type].defaultSettings?.precision})),t.type==="histogram"&&i.createElement(i.Fragment,null,i.createElement(f._,{label:"Interval",...T},i.createElement(b.I,{id:`${e}-histogram-interval`,onBlur:a=>s(w({bucketAgg:t,settingName:"interval",newValue:a.target.value})),defaultValue:t.settings?.interval||F[t.type].defaultSettings?.interval})),i.createElement(f._,{label:"Min Doc Count",...T},i.createElement(b.I,{id:`${e}-histogram-min_doc_count`,onBlur:a=>s(w({bucketAgg:t,settingName:"min_doc_count",newValue:a.target.value})),defaultValue:t.settings?.min_doc_count||F[t.type].defaultSettings?.min_doc_count}))))},zs=Object.entries(F).map(([t,{label:e}])=>({label:e,value:t})),Hs=t=>({label:F[t.type].label,value:t.type}),js=({value:t})=>{const e=D(),s=de(t.type);return i.createElement(i.Fragment,null,i.createElement(ce.m,null,i.createElement(Et.X,{className:G,options:zs,onChange:n=>e(ut({id:t.id,newType:n.value})),value:Hs(t)}),St(t)&&i.createElement(ue.V,{className:G,loadOptions:s,onChange:n=>e(dt({id:t.id,newField:n.value})),placeholder:"Select Field",value:t.field})),i.createElement(Ws,{bucketAgg:t}))},qs=({nextId:t})=>{const e=D(),{bucketAggs:s}=j(),n=s?.length||0;return i.createElement(i.Fragment,null,s.map((a,r)=>i.createElement(bt,{key:`${a.type}-${a.id}`,label:r===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>e(ct(a.id)))},i.createElement(js,{value:a}),r===0&&i.createElement(oe,{iconName:"plus",onClick:()=>e(ot(t)),label:"add"}))))},Us=h.css`
  white-space: nowrap;
`,Ct=t=>({label:H(t),value:t}),Gs=t=>t.map(Ct),Pt=({options:t,onChange:e,className:s,value:n})=>{const a=t.find(r=>r.id===n);return i.createElement(Et.X,{className:(0,h.cx)(s,Us),options:Gs(t),onChange:e,placeholder:"Select Metric",value:a?Ct(a):void 0})};var X=m(8944);function N({label:t,settingName:e,metric:s,placeholder:n,tooltip:a}){const r=D(),[l]=(0,i.useState)((0,y.uniqueId)("es-field-id-"));let c=s.settings?.[e]||"";return e==="script"&&(c=J(s)),i.createElement(f._,{label:t,labelWidth:16,tooltip:a},i.createElement(b.I,{id:l,placeholder:n,onBlur:o=>r(I({metric:s,settingName:e,newValue:o.target.value})),defaultValue:c}))}const Ne=(0,S.PH)("@pipelineVariables/add"),_t=(0,S.PH)("@pipelineVariables/remove"),Dt=(0,S.PH)("@pipelineVariables/rename"),Nt=(0,S.PH)("@pipelineVariables/change_metric"),Ys=(t=[],e)=>Ne.match(e)?[...t,He(je(t))]:_t.match(e)?t.slice(0,e.payload).concat(t.slice(e.payload+1)):Dt.match(e)?t.map((s,n)=>n!==e.payload.index?s:{...s,name:e.payload.newName}):Nt.match(e)?t.map((s,n)=>n!==e.payload.index?s:{...s,pipelineAgg:e.payload.newMetric}):t,Ks=({value:t,previousMetrics:e})=>{const s=D(),n=ye(a=>s(st({metric:t,attribute:"pipelineVariables",newValue:a})),t.pipelineVariables,Ys);return(0,i.useEffect)(()=>{t.pipelineVariables?.length||n(Ne())},[n,t.pipelineVariables?.length]),i.createElement(i.Fragment,null,i.createElement("div",{className:h.css`
          display: flex;
        `},i.createElement(he.W,{width:16},"Variables"),i.createElement("div",{className:h.css`
            display: grid;
            grid-template-columns: 1fr auto;
            row-gap: 4px;
            margin-bottom: 4px;
          `},t.pipelineVariables.map((a,r)=>i.createElement(i.Fragment,{key:(0,y.uniqueId)("es-bs-")},i.createElement("div",{className:h.css`
                  display: grid;
                  column-gap: 4px;
                  grid-template-columns: auto auto;
                `},i.createElement(b.I,{"aria-label":"Variable name",defaultValue:a.name,placeholder:"Variable Name",onBlur:l=>n(Dt({newName:l.target.value,index:r}))}),i.createElement(Pt,{onChange:l=>n(Nt({newMetric:l.value.id,index:r})),options:e,value:a.pipelineAgg})),i.createElement(Mt,{index:r,elements:t.pipelineVariables||[],onAdd:()=>n(Ne()),onRemove:()=>n(_t(r))}))))),i.createElement(N,{label:"Script",metric:t,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"}))},Js=({metric:t})=>{const e=D(),{current:s}=(0,i.useRef)((0,y.uniqueId)("es-moving-avg-"));return i.createElement(i.Fragment,null,i.createElement(f._,{label:"Model",labelWidth:16},i.createElement(A.Ph,{inputId:`${s}-model`,onChange:n=>e(I({metric:t,settingName:"model",newValue:n.value})),options:rs,value:t.settings?.model})),i.createElement(N,{label:"Window",settingName:"window",metric:t,placeholder:"5"}),i.createElement(N,{label:"Predict",settingName:"predict",metric:t}),(qe(t)||ve(t)||ne(t))&&i.createElement(f._,{label:"Alpha",labelWidth:16},i.createElement(b.I,{id:`${s}-alpha`,onBlur:n=>e(I({metric:t,settingName:"settings",newValue:{...t.settings?.settings,alpha:n.target.value}})),defaultValue:t.settings?.settings?.alpha})),(ve(t)||ne(t))&&i.createElement(f._,{label:"Beta",labelWidth:16},i.createElement(b.I,{id:`${s}-beta`,onBlur:n=>e(I({metric:t,settingName:"settings",newValue:{...t.settings?.settings,beta:n.target.value}})),defaultValue:t.settings?.settings?.beta})),ne(t)&&i.createElement(i.Fragment,null,i.createElement(f._,{label:"Gamma",labelWidth:16},i.createElement(b.I,{id:`${s}-gamma`,onBlur:n=>e(I({metric:t,settingName:"settings",newValue:{...t.settings?.settings,gamma:n.target.value}})),defaultValue:t.settings?.settings?.gamma})),i.createElement(f._,{label:"Period",labelWidth:16},i.createElement(b.I,{id:`${s}-period`,onBlur:n=>e(I({metric:t,settingName:"settings",newValue:{...t.settings?.settings,period:n.target.value}})),defaultValue:t.settings?.settings?.period})),i.createElement(f._,{label:"Pad",labelWidth:16},i.createElement(X.x,{id:`${s}-pad`,onChange:n=>e(I({metric:t,settingName:"settings",newValue:{...t.settings?.settings,pad:n.target.checked}})),checked:!!t.settings?.settings?.pad}))),(qe(t)||ve(t)||ne(t))&&i.createElement(f._,{label:"Minimize",labelWidth:16},i.createElement(X.x,{id:`${s}-minimize`,onChange:n=>e(I({metric:t,settingName:"minimize",newValue:n.target.checked})),checked:!!t.settings?.minimize})))},Zs=t=>({value:t,label:t}),Xs=({metric:t})=>{const e=D(),s=de(["number","date"]),n=de(t.type);return i.createElement(i.Fragment,null,i.createElement(f._,{label:"Metrics",labelWidth:16},i.createElement(A.M8,{onChange:a=>e(I({metric:t,settingName:"metrics",newValue:a.map(r=>r.value)})),loadOptions:n,value:t.settings?.metrics?.map(Zs),closeMenuOnSelect:!1,defaultOptions:!0})),i.createElement(f._,{label:"Order",labelWidth:16},i.createElement(A.Ph,{onChange:a=>e(I({metric:t,settingName:"order",newValue:a.value})),options:Ce,value:t.settings?.order})),i.createElement(f._,{label:"Order By",labelWidth:16,className:h.css`
          & > div {
            width: 100%;
          }
        `},i.createElement(ue.V,{className:h.css`
            margin-right: 0;
          `,loadOptions:s,onChange:a=>e(I({metric:t,settingName:"orderBy",newValue:a.value})),placeholder:"Select Field",value:t.settings?.orderBy})))},en=t=>e=>e.value===t,tn=t=>{switch(t.type){case"cardinality":return`Precision threshold: ${t.settings?.precision_threshold||""}`;case"percentiles":return t.settings?.percents&&t.settings?.percents?.length>=1?`Values: ${t.settings?.percents}`:"Percents: Default";case"extended_stats":{const e=Object.entries(t.meta||{}).map(([s,n])=>n&&Ee.find(en(s))?.label).filter(Boolean);return`Stats: ${e.length>0?e.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${t.settings?.size||500}`;default:return"Options"}},ee={labelWidth:16},sn=({metric:t,previousMetrics:e})=>{const{current:s}=(0,i.useRef)((0,y.uniqueId)("es-setting-")),n=D(),a=tn(t),r=j(),l=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],u=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return i.createElement(Ft,{label:a,hidden:t.hide},t.type==="derivative"&&i.createElement(N,{label:"Unit",metric:t,settingName:"unit"}),t.type==="serial_diff"&&i.createElement(N,{label:"Lag",metric:t,settingName:"lag",placeholder:"1"}),t.type==="cumulative_sum"&&i.createElement(N,{label:"Format",metric:t,settingName:"format"}),t.type==="moving_avg"&&i.createElement(Js,{metric:t}),t.type==="moving_fn"&&i.createElement(i.Fragment,null,i.createElement(N,{label:"Window",metric:t,settingName:"window"}),i.createElement(N,{label:"Script",metric:t,settingName:"script"}),i.createElement(N,{label:"Shift",metric:t,settingName:"shift"})),t.type==="top_metrics"&&i.createElement(Xs,{metric:t}),t.type==="bucket_script"&&i.createElement(Ks,{value:t,previousMetrics:e}),(t.type==="raw_data"||t.type==="raw_document")&&i.createElement(f._,{label:"Size",...ee},i.createElement(b.I,{id:`ES-query-${r.refId}_metric-${t.id}-size`,onBlur:c=>n(I({metric:t,settingName:"size",newValue:c.target.value})),defaultValue:t.settings?.size??E.raw_data.defaults.settings?.size})),t.type==="logs"&&i.createElement(N,{label:"Limit",metric:t,settingName:"limit",placeholder:"500"}),t.type==="cardinality"&&i.createElement(N,{label:"Precision Threshold",metric:t,settingName:"precision_threshold"}),t.type==="extended_stats"&&i.createElement(i.Fragment,null,Ee.map(c=>i.createElement(nn,{key:c.value,stat:c,onChange:o=>n(nt({metric:t,meta:c.value,newValue:o})),value:t.meta?.[c.value]!==void 0?!!t.meta?.[c.value]:!!E.extended_stats.defaults.meta?.[c.value]})),i.createElement(N,{label:"Sigma",metric:t,settingName:"sigma",placeholder:"3"})),t.type==="percentiles"&&i.createElement(f._,{label:"Percentiles",...ee},i.createElement(b.I,{id:`${s}-percentiles-percents`,onBlur:c=>n(I({metric:t,settingName:"percents",newValue:c.target.value.split(",").filter(Boolean)})),defaultValue:t.settings?.percents||E.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})),t.type==="rate"&&i.createElement(i.Fragment,null,i.createElement(f._,{label:"Unit",...ee,"data-testid":"unit-select"},i.createElement(A.Ph,{id:`ES-query-${r.refId}_metric-${t.id}-unit`,onChange:c=>n(I({metric:t,settingName:"unit",newValue:c.value})),options:l,value:t.settings?.unit})),i.createElement(f._,{label:"Mode",...ee,"data-testid":"mode-select"},i.createElement(A.Ph,{id:`ES-query-${r.refId}_metric-${t.id}-mode`,onChange:c=>n(I({metric:t,settingName:"mode",newValue:c.value})),options:u,value:t.settings?.unit}))),Ue(t)&&i.createElement(N,{label:"Script",metric:t,settingName:"script",placeholder:"_value * 1"}),ts(t)&&i.createElement(N,{label:"Missing",metric:t,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`}))},nn=({stat:t,onChange:e,value:s})=>{const[n]=(0,i.useState)((0,y.uniqueId)("es-field-id-"));return i.createElement(f._,{label:t.label,...ee,key:t.value},i.createElement(X.x,{id:n,onChange:a=>e(a.target.checked),value:s}))},an=(t,e)=>({color:e&&h.css`
        &,
        &:hover,
        label,
        a {
          color: ${e?t.colors.text.disabled:t.colors.text.primary};
        }
      `}),rn=t=>({label:E[t.type].label,value:t.type}),ln=t=>!E[t.type].isPipelineAgg,on=(t,e)=>{const s=t.some(ln);return Object.entries(E).filter(([n,{versionRange:a="*"}])=>e!=null?(0,Fe.satisfies)(e,a):!0).filter(([n,a])=>s||!a.isPipelineAgg).map(([n,{label:a}])=>({label:a,value:n}))},cn=({value:t})=>{const e=an((0,U.l4)(),!!t.hide),s=ft(),n=j(),a=D(),r=de(t.type),l=async o=>{const d=await s.getDatabaseVersion();return on(o,d)},u=(0,i.useCallback)(async()=>{const o=await r();return Ue(t)?[{label:"None"},...o]:o},[r,t]),c=n.metrics.slice(0,n.metrics.findIndex(o=>o.id===t.id));return i.createElement(i.Fragment,null,i.createElement(ce.m,null,i.createElement(ue.V,{className:(0,h.cx)(e.color,G),loadOptions:()=>l(c),onChange:o=>a(Ie({id:t.id,type:o.value})),value:rn(t)}),R(t)&&!K(t)&&i.createElement(ue.V,{className:(0,h.cx)(e.color,G),loadOptions:u,onChange:o=>a(Me({id:t.id,field:o.value})),placeholder:"Select Field",value:t.field}),K(t)&&!ae(t)&&i.createElement(Pt,{className:(0,h.cx)(e.color,G),onChange:o=>a(Me({id:t.id,field:o.value?.id})),options:c,value:t.field})),be(t)&&i.createElement(sn,{metric:t,previousMetrics:c}))},un=({nextId:t})=>{const e=D(),{metrics:s}=j(),n=s?.length||0;return i.createElement(i.Fragment,null,s?.map((a,r)=>i.createElement(bt,{key:`${a.type}-${a.id}`,label:`Metric (${a.id})`,hidden:a.hide,onHideClick:()=>e(tt(a.id)),onRemoveClick:n>1&&(()=>e(et(a.id)))},i.createElement(cn,{value:a}),!E[a.type].isSingleMetric&&r===0&&i.createElement(oe,{iconName:"plus",onClick:()=>e(Xe(t)),label:"add"}))))};function dn(t){const[e,s]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let n=!1;return t.getDatabaseVersion().then(a=>{n||s(a)},a=>{console.log(a)}),()=>{n=!0}},[t]),e}const gn=({query:t,onChange:e,onRunQuery:s,datasource:n,range:a})=>{const r=dn(n),l=r!=null&&!Je(r);return i.createElement(ps,{datasource:n,onChange:e,onRunQuery:s,query:t,range:a||(0,fe.JK)()},l&&i.createElement(Re.b,{title:Ze}),i.createElement(mn,{value:t}))},Tt=t=>({root:h.css`
    display: flex;
  `,queryFieldWrapper:h.css`
    flex-grow: 1;
    margin: 0 ${t.spacing(.5)} ${t.spacing(.5)} 0;
  `}),$t=({value:t,onChange:e})=>{const s=(0,U.wW)(Tt);return i.createElement("div",{className:s.queryFieldWrapper},i.createElement(We.q,{query:t,onBlur:()=>{},onChange:e,placeholder:"Lucene Query",portalOrigin:"elasticsearch"}))},mn=({value:t})=>{const e=D(),s=ys(),n=(0,U.wW)(Tt),a=t?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",r=t.metrics?.every(l=>!E[l.type].isSingleMetric);return i.createElement(i.Fragment,null,i.createElement("div",{className:n.root},i.createElement(he.W,{width:17},"Query"),i.createElement($t,{onChange:l=>e(at(l)),value:t?.query}),i.createElement(f._,{label:"Alias",labelWidth:15,disabled:!a,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored."},i.createElement(b.I,{id:`ES-query-${t.refId}_alias`,placeholder:"Alias Pattern",onBlur:l=>e(it(l.currentTarget.value)),defaultValue:t.alias}))),i.createElement(un,{nextId:s}),r&&i.createElement(qs,{nextId:s}))};var pn=m(4761),fn=m(12006),Vt=m(47694),hn=m(94976),yn=m(3281),Ot=m(31403),vn=m(82965),bn=m(53117),En=m(14835),Sn=m(7804),Fn=m(35919);const{FormField:Te,Switch:xn}=En.LegacyForms,Mn=(0,Sn.B)(()=>({firstRow:h.css`
    display: flex;
  `,nameField:h.css`
    flex: 2;
  `,regexField:h.css`
    flex: 3;
  `,row:h.css`
    display: flex;
    align-items: baseline;
  `,urlField:h.css`
    flex: 1;
  `,urlDisplayLabelField:h.css`
    flex: 1;
  `})),In=t=>{const{value:e,onChange:s,onDelete:n,suggestions:a,className:r}=t,l=Mn(),[u,c]=wn(e.datasourceUid),o=d=>g=>{s({...e,[d]:g.currentTarget.value})};return i.createElement("div",{className:r},i.createElement("div",{className:l.firstRow+" gf-form"},i.createElement(Te,{className:l.nameField,labelWidth:6,inputWidth:null,label:"Field",type:"text",value:e.field,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",onChange:o("field")}),i.createElement(Ot.zx,{variant:"destructive",title:"Remove field",icon:"times",onClick:d=>{d.preventDefault(),n()}})),i.createElement("div",{className:"gf-form"},i.createElement(Te,{label:u?"Query":"URL",labelWidth:6,inputEl:i.createElement(Fn.v,{placeholder:u?"${__value.raw}":"http://example.com/${__value.raw}",value:e.url||"",onChange:d=>s({...e,url:d}),suggestions:a}),className:l.urlField}),i.createElement(Te,{className:l.urlDisplayLabelField,inputWidth:null,label:"URL Label",type:"text",value:e.urlDisplayLabel,onChange:o("urlDisplayLabel"),tooltip:"Use to override the button label."})),i.createElement("div",{className:l.row},i.createElement(xn,{labelClass:"width-6",label:"Internal link",checked:u,onChange:()=>{u&&s({...e,datasourceUid:void 0}),c(!u)}}),u&&i.createElement(bn.q,{tracing:!0,onChange:d=>{s({...e,datasourceUid:d.uid})},current:e.datasourceUid})))};function wn(t){const[e,s]=(0,i.useState)(!!t),n=(0,vn.Z)(t);return(0,i.useEffect)(()=>{!n&&t&&!e&&s(!0),n&&!t&&e&&s(!1)},[n,t,e]),[e,s]}const Cn=t=>({infoText:h.css`
      padding-bottom: ${t.spacing(2)};
      color: ${t.colors.text.secondary};
    `,dataLink:h.css`
      margin-bottom: ${t.spacing(1)};
    `}),Pn=t=>{const{value:e,onChange:s}=t,n=(0,U.wW)(Cn);return i.createElement(i.Fragment,null,i.createElement("h3",{className:"page-heading"},"Data links"),i.createElement("div",{className:n.infoText},"Add links to existing fields. Links will be shown in log row details next to the field value."),e&&e.length>0&&i.createElement("div",{className:"gf-form-group"},e.map((a,r)=>i.createElement(In,{className:n.dataLink,key:r,value:a,onChange:l=>{const u=[...e];u.splice(r,1,l),s(u)},onDelete:()=>{const l=[...e];l.splice(r,1),s(l)},suggestions:[{value:hn.W.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:yn.L8.Value}]}))),i.createElement(Ot.zx,{type:"button",variant:"secondary",className:h.css`
          margin-right: 10px;
        `,icon:"plus",onClick:a=>{a.preventDefault();const r=[...e||[],{field:"",url:""}];s(r)}},"Add"))};var kt=m(13393);const $e=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],_n=({value:t,onChange:e})=>i.createElement(i.Fragment,null,i.createElement(kt.C,{label:"Elasticsearch details"},i.createElement(f._,{label:"Index name",labelWidth:26},i.createElement(b.I,{id:"es_config_indexName",value:t.jsonData.index??(t.database||""),onChange:Dn(t,e),width:24,placeholder:"es-index-name",required:!0})),i.createElement(f._,{label:"Pattern",labelWidth:26},i.createElement(A.Ph,{inputId:"es_config_indexPattern",value:$e.find(s=>s.value===(t.jsonData.interval===void 0?"none":t.jsonData.interval)),options:$e,onChange:Nn(t,e),width:24})),i.createElement(f._,{label:"Time field name",labelWidth:26},i.createElement(b.I,{id:"es_config_timeField",value:t.jsonData.timeField||"",onChange:Ve("timeField",t,e),width:24,placeholder:"@timestamp",required:!0})),i.createElement(f._,{label:"Max concurrent Shard Requests",labelWidth:26},i.createElement(b.I,{id:"es_config_shardRequests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:Ve("maxConcurrentShardRequests",t,e),width:24})),i.createElement(f._,{label:"Min time interval",labelWidth:26,tooltip:i.createElement(i.Fragment,null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",i.createElement("code",null,"1m")," if your data is written every minute."),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!t.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(t.jsonData.timeInterval)},i.createElement(b.I,{id:"es_config_minTimeInterval",value:t.jsonData.timeInterval||"",onChange:Ve("timeInterval",t,e),width:24,placeholder:"10s"})),i.createElement(f._,{label:"X-Pack enabled",labelWidth:26},i.createElement(X.x,{id:"es_config_xpackEnabled",value:t.jsonData.xpack||!1,onChange:Bt("xpack",t,e)})),t.jsonData.xpack&&i.createElement(f._,{label:"Include Frozen Indices",labelWidth:26},i.createElement(X.x,{id:"es_config_frozenIndices",value:t.jsonData.includeFrozen??!1,onChange:Bt("includeFrozen",t,e)})))),Dn=(t,e)=>s=>{e({...t,database:"",jsonData:{...t.jsonData,index:s.currentTarget.value}})},Ve=(t,e,s)=>n=>{s({...e,jsonData:{...e.jsonData,[t]:n.currentTarget.value}})},Bt=(t,e,s)=>n=>{s({...e,jsonData:{...e.jsonData,[t]:n.currentTarget.checked}})},Nn=(t,e)=>s=>{const n=s.value==="none"?void 0:s.value,a=t.jsonData.index??t.database;if(!a||a.length===0||a.startsWith("[logstash-]")){let r="";if(n!==void 0){const l=$e.find(u=>u.value===n);l&&(r=l.example??"")}e({...t,database:"",jsonData:{...t.jsonData,index:r,interval:n}})}else e({...t,jsonData:{...t.jsonData,interval:n}})};function Tn(){return 5}const $n=t=>{const{value:e,onChange:s}=t,n=a=>r=>{s({...e,[a]:r.currentTarget.value})};return i.createElement(kt.C,{label:"Logs"},i.createElement(f._,{label:"Message field name",labelWidth:22},i.createElement(b.I,{id:"es_logs-config_logMessageField",value:e.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})),i.createElement(f._,{label:"Level field name",labelWidth:22},i.createElement(b.I,{id:"es_logs-config_logLevelField",value:e.logLevelField,onChange:n("logLevelField"),width:24})))},At=t=>({...t,jsonData:{...t.jsonData,timeField:t.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||Tn(),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||"",includeFrozen:t.jsonData.includeFrozen??!1}}),Vn=t=>!!t.jsonData.timeField&&!!t.jsonData.maxConcurrentShardRequests&&t.jsonData.logMessageField!==void 0&&t.jsonData.logLevelField!==void 0,On=t=>{const e=(0,i.useRef)(t.options.access==="direct"),{options:s,onOptionsChange:n}=t,a=At(s);return(0,i.useEffect)(()=>{Vn(s)||n(At(s))},[]),i.createElement(i.Fragment,null,a.access==="direct"&&i.createElement(Re.b,{title:"Error",severity:"error"},"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."),i.createElement(fn.E,{defaultUrl:"http://localhost:9200",dataSourceConfig:a,showAccessOptions:e.current,onChange:n,sigV4AuthToggleEnabled:Vt.vc.sigV4AuthEnabled,renderSigV4Editor:i.createElement(pn.IW,{...t}),secureSocksDSProxyEnabled:Vt.vc.secureSocksDSProxyEnabled}),i.createElement(_n,{value:a,onChange:n}),i.createElement($n,{value:a.jsonData,onChange:r=>n({...a,jsonData:r})}),i.createElement(Pn,{value:a.jsonData.dataLinks,onChange:r=>{n({...a,jsonData:{...a.jsonData,dataLinks:r}})}}))};var Oe=m(85850),kn=m(97212),Y=m(59980),ge=m(59724),q=m(9471),Lt=m(39859),Bn=m(89027),An=m(29933),Ln=m(31129),Qt=m(71735),V=m(13787),M=m(67483),Qn=m(47891),ke=m(206),Rn=m(22069),me=m(35645),Wn=m(54899),zn=m(86647),Hn=m(20053),jn=m(19349),qn=m(28674),Un=m(81042),Be=m(83881),W=m(99098),Gn=m(53678),Yn=m(49052),Rt=m(37219),Kn=m(40229);const Wt=`${ie.pre}([^@]+)${ie.post}`;class zt{constructor(e,s){this.targets=e,this.response=s,this.processResponseToSeries=()=>{const n=[];for(let a=0;a<this.response.responses.length;a++){const r=this.response.responses[a],l=this.targets[a];if(r.error)throw this.getErrorFromElasticResponse(this.response,r.error);if(r.hits&&r.hits.hits.length>0&&this.processHits(r.hits,n,l),r.aggregations){const u=r.aggregations,c=this.targets[a],o=[],d=new Rt.Z;d.refId=c.refId,this.processBuckets(u,c,o,d,{},0),this.trimDatapoints(o,c),this.nameSeries(o,c);for(let g=0;g<o.length;g++)n.push(o[g]);d.rows.length>0&&n.push(d)}}return{data:n}},this.targets=e,this.response=s}processMetrics(e,s,n,a){let r;for(let l=0;l<s.metrics.length;l++){const u=s.metrics[l];if(!u.hide)switch(u.type){case"count":{r={datapoints:[],metric:"count",props:a,refId:s.refId};for(let c=0;c<e.buckets.length;c++){const o=e.buckets[c],d=o.doc_count;r.datapoints.push([d,o.key])}n.push(r);break}case"percentiles":{if(e.buckets.length===0)break;const o=e.buckets[0][u.id].values;for(const d in o){r={datapoints:[],metric:"p"+d,props:a,field:u.field,refId:s.refId};for(let g=0;g<e.buckets.length;g++){const p=e.buckets[g],v=p[u.id].values;r.datapoints.push([v[d],p.key])}n.push(r)}break}case"extended_stats":{for(const c in u.meta)if(u.meta[c]){r={datapoints:[],metric:c,props:a,field:u.field,refId:s.refId};for(let o=0;o<e.buckets.length;o++){const d=e.buckets[o],g=d[u.id];g.std_deviation_bounds_upper=g.std_deviation_bounds.upper,g.std_deviation_bounds_lower=g.std_deviation_bounds.lower,r.datapoints.push([g[c],d.key])}n.push(r)}break}case"top_metrics":{if(u.settings?.metrics?.length)for(const c of u.settings?.metrics){r={datapoints:[],metric:u.type,props:a,refId:s.refId,field:c};for(let o=0;o<e.buckets.length;o++){const d=e.buckets[o],p=d[u.id].top.map(C=>C.metrics[c]?C.metrics[c]:null),v=[p[p.length-1],d.key];r.datapoints.push(v)}n.push(r)}break}default:{r={datapoints:[],metric:u.type,metricId:u.id,props:a,refId:s.refId},R(u)&&(r.field=u.field);for(let c=0;c<e.buckets.length;c++){const o=e.buckets[c],d=o[u.id];d!==void 0&&(d.normalized_value?r.datapoints.push([d.normalized_value,o.key]):r.datapoints.push([d.value,o.key]))}n.push(r);break}}}}processAggregationDocs(e,s,n,a,r){if(a.columns.length===0){for(const c of(0,y.keys)(r))a.addColumn({text:c,filterable:!0});a.addColumn({text:s.field,filterable:!0})}const l=(c,o,d)=>{a.addColumn({text:o}),c.push(d)},u=(0,y.isArray)(e.buckets)?e.buckets:[e.buckets];for(const c of u){const o=[];for(const d of(0,y.values)(r))o.push(d);o.push(c.key);for(const d of n.metrics||[])switch(d.type){case"count":{l(o,this.getMetricName(d.type),c.doc_count);break}case"extended_stats":{for(const g in d.meta){if(!d.meta[g])continue;const p=c[d.id];p.std_deviation_bounds_upper=p.std_deviation_bounds.upper,p.std_deviation_bounds_lower=p.std_deviation_bounds.lower,l(o,this.getMetricName(g),p[g])}break}case"percentiles":{const g=c[d.id].values;for(const p in g)l(o,`p${p} ${d.field}`,g[p]);break}case"top_metrics":{const g=this.getMetricName(d.type);if(d.settings?.metrics)for(const p of d.settings.metrics){const v=d.settings.metrics.length>1?`${g} ${p}`:g,C=c[d.id];l(o,v,C.top[0].metrics[p])}break}default:{let g=this.getMetricName(d.type);(0,y.filter)(n.metrics,{type:d.type}).length>1&&(R(d)&&(g+=" "+d.field),d.type==="bucket_script"&&(g=J(d))),l(o,g,c[d.id].value);break}}a.rows.push(o)}}processBuckets(e,s,n,a,r,l){let u,c,o,d;const g=s.bucketAggs.length-1;for(d in e)if(c=(0,y.find)(s.bucketAggs,{id:d}),o=e[d],!!c){if(c.type==="nested"){this.processBuckets(o,s,n,a,r,l+1);continue}if(l===g)c.type==="date_histogram"?this.processMetrics(o,s,n,r):this.processAggregationDocs(o,c,s,a,r);else for(const p in o.buckets)u=o.buckets[p],r=(0,y.clone)(r),u.key!==void 0?r[c.field]=u.key:r.filter=p,u.key_as_string&&(r[c.field]=u.key_as_string),this.processBuckets(u,s,n,a,r,l+1)}}getMetricName(e){const s=Object.entries(E).filter(([a])=>a===e).map(([a,r])=>r)[0];if(s)return s.label;const n=Ee.find(a=>a.value===e);return n?n.label:e}getSeriesName(e,s,n){let a=this.getMetricName(e.metric);if(s.alias){const u=/\{\{([\s\S]+?)\}\}/g;return s.alias.replace(u,(c,o,d)=>{const g=o||d;return g.indexOf("term ")===0?e.props[g.substring(5)]:e.props[g]!==void 0?e.props[g]:g==="metric"?a:g==="field"?e.field||"":c})}if(ls(e.metric))if(e.metric&&os(e.metric)){const u=(0,y.find)(s.metrics,{id:e.metricId});if(u&&u.settings.script){a=J(u);for(const c of u.pipelineVariables){const o=(0,y.find)(s.metrics,{id:c.pipelineAgg});o&&(a=a.replace("params."+c.name,H(o)))}}else a="Unset"}else{const u=(0,y.find)(s.metrics,{id:e.field});u?a+=" "+H(u):a="Unset"}else e.field&&(a+=" "+e.field);if((0,y.keys)(e.props).length===0)return a;let l="";for(const u in e.props)l+=e.props[u]+" ";return n?l.trim()+" "+a:l.trim()}nameSeries(e,s){const n=(0,y.uniq)((0,y.map)(e,"metric")).length,a=(s.metrics?.filter(r=>r.type==="top_metrics")).some(r=>(r?.settings?.metrics?.length||0)>1);for(let r=0;r<e.length;r++){const l=e[r];l.target=this.getSeriesName(l,s,n>1||a)}}processHits(e,s,n){const a=typeof e.total=="number"?e.total:e.total.value,r={target:n.refId,type:"docs",refId:n.refId,datapoints:[],total:a,filterable:!0};let l,u,c,o;for(o=0;o<e.hits.length;o++){if(u=e.hits[o],c={_id:u._id,_type:u._type,_index:u._index,sort:u.sort,highlight:u.highlight},u._source)for(l in u._source)c[l]=u._source[l];for(l in u.fields)c[l]=u.fields[l];r.datapoints.push(c)}s.push(r)}trimDatapoints(e,s){const n=(0,y.find)(s.bucketAggs,{type:"date_histogram"});if(n&&n.settings&&n.settings.trimEdges){const r=n.settings.trimEdges;for(const l in e){const u=e[l];u.datapoints.length>r*2&&(u.datapoints=u.datapoints.slice(r,u.datapoints.length-r))}}}getErrorFromElasticResponse(e,s){const n={};return n.data=JSON.stringify(s,null,4),s.root_cause&&s.root_cause.length>0&&s.root_cause[0].reason?n.message=s.root_cause[0].reason:n.message=s.reason||"Unknown elastic error response",e.$$config&&(n.config=e.$$config),n}getTimeSeries(){if(this.targets.some(s=>Se(s,"raw_data")))return this.processResponseToDataFrames(!1);const e=this.processResponseToSeries();return{...e,data:e.data.map(s=>(0,Be.g0)(s))}}getLogs(e,s){return this.processResponseToDataFrames(!0,e,s)}processResponseToDataFrames(e,s,n){const a=[];for(let r=0;r<this.response.responses.length;r++){const l=this.response.responses[r];if(l.error)throw this.getErrorFromElasticResponse(this.response,l.error);if(l.hits){const{propNames:u,docs:c}=Jn(l.hits.hits),o=c.length?Ht(u.map(Zn(c)),e,this.targets[0].timeField,s,n):Ht([],e);e&&jt(o,"logs");for(const g of c){if(n&&(g.level=g[n]),g.highlight){const p=new RegExp(Wt,"g"),v=new RegExp(Wt),C=Object.keys(g.highlight).flatMap(L=>g.highlight[L].flatMap(Q=>{const k=Q.match(p);return k?k.map(P=>{const _=P.match(v);return _&&_[1]||null}):[]})).filter(y.identity),O=o.meta?.searchWords?(0,y.uniq)([...o.meta.searchWords,...C]):[...C];o.meta=o.meta?{...o.meta,searchWords:O}:{searchWords:O}}o.add(g)}const d=this.targets[r];o.refId=d.refId,a.push(o)}if(l.aggregations){const u=l.aggregations,c=this.targets[r],o=[],d=new Rt.Z;if(this.processBuckets(u,c,o,d,{},0),this.trimDatapoints(o,c),this.nameSeries(o,c),d.rows.length>0){const g=(0,Be.g0)(d);g.refId=c.refId,a.push(g)}for(let g=0;g<o.length;g++){let p=(0,Be.g0)(o[g]);e&&jt(p,"graph"),p.refId=c.refId,a.push(p)}}}for(let r of a)for(let l of r.fields)l.type===W.fS.time&&typeof l.values[0]!="number"&&(l.values=(0,Yn.p8)(l,{destinationType:W.fS.time}).values);return{data:a}}}const Jn=t=>{const e=[];let s=[];for(const n of t){const a=n._source?(0,Kn.default)(n._source):{},r={_id:n._id,_type:n._type,_index:n._index,sort:n.sort,highlight:n.highlight,_source:{...a},...a};for(const l of Object.keys(r))s.indexOf(l)===-1&&s.push(l);e.push(r)}return s.sort(),{docs:e,propNames:s}},Ht=(t,e,s,n,a)=>{const r=new Gn.v({fields:[]});if(s&&r.addField({config:{filterable:!0},name:s,type:W.fS.time}),n){const u=r.addField({name:n,type:W.fS.string});r.setParser(u,c=>c||"")}if(a){const u=r.addField({name:"level",type:W.fS.string});r.setParser(u,c=>c||"")}const l=r.fields.map(u=>u.name);for(const[u,c]of t){if(l.includes(u)||!e&&u==="_source")continue;const o=r.addField({config:{filterable:!0},name:u,type:c});r.setParser(o,d=>d||"")}return r},jt=(t,e)=>{let s=t;s.meta?s.meta.preferredVisualisationType=e:s.meta={preferredVisualisationType:e}},Zn=t=>e=>[e,Xn(t.find(s=>s[e]!==void 0)?.[e])],Xn=t=>{switch(typeof t){case"number":return W.fS.number;case"string":return W.fS.string;default:return W.fS.other}},qt={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class ea{constructor(e,s){this.pattern=e,this.interval=s,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,M.zh)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(e,s){if(!this.interval)return this.pattern;const a=qt[this.interval],r=(0,M.CQ)(e||(0,M.CQ)(s).add(-7,a.amount)).utc().startOf(a.startOf),l=(0,M.CQ)(s||(0,M.CQ)(e).add(7,a.amount)).utc().startOf(a.startOf).valueOf(),u=[];for(;r.valueOf()<=l;)u.push(r.locale(this.dateLocale).format(this.pattern)),r.add(1,a.amount);return u}}var pe=m(89749);class ta extends Qe.iL{constructor(e,s){super(),this.datasource=e,Object.assign(this,s)}importFromAbstractQuery(e){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchQuery(e.labelMatchers),refId:e.refId}}getElasticsearchQuery(e){return e.map(s=>{switch(s.operator){case pe.K2.Equal:return s.name+':"'+s.value+'"';case pe.K2.NotEqual:return"-"+s.name+':"'+s.value+'"';case pe.K2.EqualRegEx:return s.name+":/"+s.value+"/";case pe.K2.NotEqualRegEx:return"-"+s.name+":/"+s.value+"/"}}).join(" AND ")}}class sa{constructor(e){this.timeField=e.timeField}getRangeFilter(){const e={};return e[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},e}buildTermsAgg(e,s,n){if(s.terms={field:e.field},!e.settings)return s;const a=e.settings?.size?parseInt(e.settings.size,10):500;if(s.terms.size=a===0?500:a,e.settings.orderBy!==void 0){s.terms.order={},e.settings.orderBy==="_term"?s.terms.order._key=e.settings.order:s.terms.order[e.settings.orderBy]=e.settings.order;const r=Ke(e.settings.orderBy);if(r){for(let l of n.metrics||[])if(l.id===r){l.type==="count"?s.terms.order={_count:e.settings.order}:R(l)&&(s.aggs={},s.aggs[l.id]={[l.type]:{field:l.field}});break}}}return e.settings.min_doc_count!==void 0&&(s.terms.min_doc_count=parseInt(e.settings.min_doc_count,10),isNaN(s.terms.min_doc_count)&&(s.terms.min_doc_count=e.settings.min_doc_count)),e.settings.missing&&(s.terms.missing=e.settings.missing),s}getDateHistogramAgg(e){const s={},n=e.settings||{};s.field=e.field||this.timeField,s.min_doc_count=n.min_doc_count||0,s.extended_bounds={min:"$timeFrom",max:"$timeTo"},s.format="epoch_millis",n.timeZone&&n.timeZone!==we.RQ.utc&&(s.time_zone=n.timeZone),n.offset!==""&&(s.offset=n.offset);const a=n.interval==="auto"?"${__interval_ms}ms":n.interval;return s.fixed_interval=a,s}getHistogramAgg(e){const s={},n=e.settings||{};return s.interval=n.interval,s.field=e.field,s.min_doc_count=n.min_doc_count||0,s}getFiltersAgg(e){const s={};for(let{query:n,label:a}of e.settings?.filters||[])s[a||n]={query_string:{query:n,analyze_wildcard:!0}};return s}documentQuery(e,s){return e.size=s,e.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],e.script_fields={},e}build(e){e.metrics=e.metrics||[re()],e.bucketAggs=e.bucketAggs||[le()],e.timeField=this.timeField;let s,n,a,r,l;const u={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(e.query&&e.query!==""&&(u.query.bool.filter=[...u.query.bool.filter,{query_string:{analyze_wildcard:!0,query:e.query}}]),e.bucketAggs.length===0&&(s=e.metrics[0],!s||!(s.type==="raw_document"||s.type==="raw_data")))throw{message:"Invalid query"};if(e.metrics?.[0]?.type==="raw_document"||e.metrics?.[0]?.type==="raw_data"){s=e.metrics[0];const c=s.settings?.size?parseInt(s.settings.size,10):500;return this.documentQuery(u,c||500)}for(l=u,n=0;n<e.bucketAggs.length;n++){const c=e.bucketAggs[n],o={};switch(c.type){case"date_histogram":{o.date_histogram=this.getDateHistogramAgg(c);break}case"histogram":{o.histogram=this.getHistogramAgg(c);break}case"filters":{o.filters={filters:this.getFiltersAgg(c)};break}case"terms":{this.buildTermsAgg(c,o,e);break}case"geohash_grid":{o.geohash_grid={field:c.field,precision:c.settings?.precision};break}case"nested":{o.nested={path:c.field};break}}l.aggs=l.aggs||{},l.aggs[c.id]=o,l=o}for(l.aggs={},n=0;n<e.metrics.length;n++){if(s=e.metrics[n],s.type==="count")continue;const c={};let o={};if(K(s))if(ae(s))if(s.pipelineVariables){for(o={buckets_path:{}},a=0;a<s.pipelineVariables.length;a++)if(r=s.pipelineVariables[a],r.name&&r.pipelineAgg&&/^\d*$/.test(r.pipelineAgg)){const d=Ye(e.metrics,r.pipelineAgg);d&&(d.type==="count"?o.buckets_path[r.name]="_count":o.buckets_path[r.name]=r.pipelineAgg)}}else continue;else if(s.field&&/^\d*$/.test(s.field)){const d=Ye(e.metrics,s.field);d&&(d.type==="count"?o={buckets_path:"_count"}:o={buckets_path:s.field})}else continue;else R(s)&&(o={field:s.field});if(be(s))switch(Object.entries(s.settings||{}).filter(([d,g])=>g!==null).forEach(([d,g])=>{o[d]=d==="script"?this.buildScript(J(s)):g}),s.type){case"moving_avg":o={...o,...o?.window!==void 0&&{window:this.toNumber(o.window)},...o?.predict!==void 0&&{predict:this.toNumber(o.predict)},...es(s)&&{settings:{...o.settings,...Object.fromEntries(Object.entries(o.settings||{}).filter(([d])=>["alpha","beta","gamma","period"].includes(d)).filter(([d,g])=>g!==void 0).map(([d,g])=>[d,this.toNumber(g)]))}}};break;case"serial_diff":o={...o,...o.lag!==void 0&&{lag:this.toNumber(o.lag)}};break;case"top_metrics":o={metrics:s.settings?.metrics?.map(d=>({field:d})),size:1},s.settings?.orderBy&&(o.sort=[{[s.settings?.orderBy]:s.settings?.order}]);break}c[s.type]=o,l.aggs[s.id]=c}return u}buildScript(e){return e}toNumber(e){const s=parseFloat(`${e}`);return isNaN(s)?e:s}getTermsQuery(e){const s={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};e.query&&s.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}});let n=500;e.size&&(n=e.size),s.aggs={1:{terms:{field:e.field,size:n,order:{}}}};const{orderBy:a="key",order:r=a==="doc_count"?"desc":"asc"}=e;if(["asc","desc"].indexOf(r)<0)throw{message:`Invalid query sort order ${r}`};switch(a){case"key":case"term":const l="_key";s.aggs[1].terms.order[l]=r;break;case"doc_count":s.aggs[1].terms.order._count=r;break;default:throw{message:`Invalid query sort type ${a}`}}return s}getLogsQuery(e,s){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return e.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}}),n=this.documentQuery(n,s),{...n,aggs:this.build(e).aggs,highlight:{fields:{"*":{}},pre_tags:[ie.pre],post_tags:[ie.post],fragment_size:2147483647}}}}var te=m(26418);function na(t){const e=t.annotation,s=t.onAnnotationChange;return i.createElement(i.Fragment,null,i.createElement("div",{className:"gf-form-group"},i.createElement($t,{value:e.target?.query,onChange:n=>{const r={...e.target??{refId:"annotation_query"},query:n};s({...e,target:r})}})),i.createElement("div",{className:"gf-form-group"},i.createElement("h6",null,"Field mappings"),i.createElement(te.EditorRow,null,i.createElement(te.EditorField,{label:"Time"},i.createElement(b.I,{type:"text",placeholder:"@timestamp",value:e.timeField,onChange:n=>{s({...e,timeField:n.currentTarget.value})}})),i.createElement(te.EditorField,{label:"Time End"},i.createElement(b.I,{type:"text",value:e.timeEndField,onChange:n=>{s({...e,timeEndField:n.currentTarget.value})}})),i.createElement(te.EditorField,{label:"Text"},i.createElement(b.I,{type:"text",value:e.textField,onChange:n=>{s({...e,textField:n.currentTarget.value})}})),i.createElement(te.EditorField,{label:"Tags"},i.createElement(b.I,{type:"text",placeholder:"tags",value:e.tagsField,onChange:n=>{s({...e,tagsField:n.currentTarget.value})}})))))}var Ae=m(41818),aa=m(92624),ia=m(31886);const ra=({payload:{dashboardId:t,orgId:e,grafanaVersion:s,queries:n}})=>{try{const a=n[ia.id].filter(v=>!v.hide);if(!a?.length)return;const r=a.filter(oa),l=a.filter(v=>!!v.query),u=a.filter(v=>se(v)==="logs"),c=a.filter(v=>se(v)==="metric"),o=a.filter(v=>se(v)==="raw_data"),d=a.filter(v=>se(v)==="raw_document"),g=a.filter(la),p={grafana_version:s,dashboard_id:t,org_id:e,queries_count:a.length,logs_queries_count:u.length,metric_queries_count:c.length,raw_data_queries_count:o.length,raw_document_queries_count:d.length,queries_with_template_variables_count:r.length,queries_with_changed_line_limit_count:g.length,queries_with_lucene_query_count:l.length};(0,Ae.ff)("grafana_elasticsearch_dashboard_loaded",p)}catch(a){console.error("error in elasticsearch tracking handler",a)}},se=t=>!t.metrics||!t.metrics.length?void 0:["logs","raw_data","raw_document"].includes(t.metrics[0].type)?t.metrics[0].type:"metric",Ut=t=>{if(t.metrics?.[0]?.type!=="logs")return;const e=t.metrics?.[0].settings?.limit;return e?parseInt(e,10):void 0},la=t=>{const e=Ut(t);return e!==void 0&&e!==500},oa=t=>aa.J7.test(t.query??""),ca=t=>!!t.startsWith(Yt);function Gt(t,e,s){const{targets:n,app:a}=e;if(!(a===ke.zj.Dashboard||a===ke.zj.PanelViewer))for(const r of n){if(ca(r.refId))return;(0,Ae.ff)("grafana_elasticsearch_query_executed",{app:a,grafana_version:me.v.buildInfo.version,with_lucene_query:!!r.query,query_type:se(r),line_limit:Ut(r),alias:r.alias,has_error:t.error!==void 0,has_data:t.data.some(l=>l.length>0),simultaneously_sent_query_count:n.length,time_range_from:e?.range?.from?.toISOString(),time_range_to:e?.range?.to?.toISOString(),time_taken:Date.now()-s.getTime()})}}function ua(t){(0,Ae.ff)("grafana_elasticsearch_annotation_query_executed",{grafana_version:me.v.buildInfo.version,has_target_query:!!t.target?.query,has_query:!!t.query,has_time_field:!!t.timeField,has_time_end_field:!!t.timeEndField,has_tags_field:!!t.tagsField,has_text_field:!!t.textField,has_index:!!t.index})}const Yt="log-volume-",da=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class ga extends Rn.CK{constructor(e,s=(0,qn.J)()){super(e),this.templateSrv=s,this.getLogRowContext=async(a,r)=>{const{enableElasticsearchBackendQuerying:l}=me.v.featureToggles;if(l){const u=this.makeLogContextDataRequest(a,r);return(0,B.n)(this.query(u).pipe((0,ge.K)(c=>{throw{message:"Error during context query. Please check JS console logs.",status:c.status,statusText:c.statusText}})))}else{const c=a.dataFrame.fields.find(x=>x.name==="sort")?.values[a.rowIndex]||[a.timeEpochMs],o=r?.direction===V.M4.Forward?"asc":"desc",d=r?.direction===V.M4.Forward?this.getQueryHeader("query_then_fetch",(0,M.CQ)(a.timeEpochMs)):this.getQueryHeader("query_then_fetch",void 0,(0,M.CQ)(a.timeEpochMs)),g=r?.limit??10,p=JSON.stringify({size:g,query:{bool:{filter:[{range:{[this.timeField]:{[r?.direction===V.M4.Forward?"gte":"lte"]:a.timeEpochMs,format:"epoch_millis"}}}]}},sort:[{[this.timeField]:o},{_doc:o}],search_after:c}),v=[d,p].join(`
`)+`
`,C=this.getMultiSearchUrl(),O=await(0,B.n)(this.post(C,v)),L=[{refId:`${a.dataFrame.refId}`,metrics:[{type:"logs",id:"1"}]}],k=new zt(L,fa(O,o)).getLogs(this.logMessageField,this.logLevelField),P=(0,y.first)(k.data);if(!P)return{data:[]};const _=P.fields.find(x=>x.name===this.timeField),z=P.fields.find(x=>x.name===this.logMessageField);return _&&z?{data:[{...P,fields:[...P.fields,{..._,name:"ts"},{...z,name:"line"}]}]}:k}},this.makeLogContextDataRequest=(a,r)=>{const l=r?.direction||V.M4.Backward,u={type:"logs",id:"1",settings:{limit:r?.limit?r?.limit.toString():"10",sortDirection:l===V.M4.Backward?"desc":"asc",searchAfter:a.dataFrame.fields.find(v=>v.name==="sort")?.values[a.rowIndex]??[a.timeEpochMs]}},c={refId:`log-context-${a.dataFrame.refId}-${l}`,metrics:[u],query:""},o=ha(a.timeEpochMs,l,this.intervalPattern),d={from:o.from,to:o.to,raw:o},g=Qn.calculateInterval(d,1);return{requestId:`log-context-request-${a.dataFrame.refId}-${r?.direction}`,targets:[c],interval:g.interval,intervalMs:g.intervalMs,range:d,scopedVars:{},timezone:"UTC",app:ke.zj.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.url=e.url,this.name=e.name,this.isProxyAccess=e.access==="proxy";const n=e.jsonData||{};this.index=n.index??e.database??"",this.timeField=n.timeField,this.xpack=Boolean(n.xpack),this.indexPattern=new ea(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new sa({timeField:this.timeField}),this.logMessageField=n.logMessageField||"",this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:na},this.logMessageField===""&&(this.logMessageField=void 0),this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new ta(this),this.timeSrv=(0,jn.$t)()}request(e,s,n,a){if(!this.isProxyAccess){const l=new Error("Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode.");return(0,Oe._)(()=>l)}const r={url:this.url+"/"+s,method:e,data:n,headers:a};return(this.basicAuth||this.withCredentials)&&(r.withCredentials=!0),this.basicAuth&&(r.headers={Authorization:this.basicAuth}),(0,Wn.i)().fetch(r).pipe((0,q.U)(l=>(l.data.$$config=l.config,l.data)),(0,ge.K)(l=>{if(l.data){const u=l.data.error?.reason??l.data.message??"Unknown error";return(0,Oe._)({message:"Elasticsearch error: "+u,error:l.data.error})}return(0,Oe._)(l)}))}async importFromAbstractQueries(e){return e.map(s=>this.languageProvider.importFromAbstractQuery(s))}get(e,s=(0,fe.JK)()){let n=this.indexPattern.getIndexList(s.from,s.to);Array.isArray(n)||(n=[this.indexPattern.getIndexForToday()]);const a=n.map(r=>r+e);return this.requestAllIndices(a)}requestAllIndices(e){const n=e.length;return(0,kn.R)({initialState:0,condition:a=>a<Math.min(n,7),iterate:a=>a+1}).pipe((0,Lt.z)(a=>this.request("GET",e[n-a-1]).pipe((0,ge.K)(r=>(0,Y.of)({err:r})))),(0,Bn.n)(a=>a?.err?.status===404),(0,An.T)(()=>"Could not find an available index for this time range."),(0,Ln.P)(),(0,q.U)(a=>{if(a.err)throw a.err;return a}))}post(e,s){return this.request("POST",e,s,{"Content-Type":"application/x-ndjson"})}annotationQuery(e){const s=e.annotation,n=s.timeField||"@timestamp",a=s.timeEndField||null,r=s.query??s.target?.query,l=s.tagsField||"tags",u=s.textField||null,c=[],o={};if(o[n]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:o}),a){const O={};O[a]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:O})}const d=this.interpolateLuceneQuery(r),g={bool:{filter:[{bool:{should:c,minimum_should_match:1}}]}};d&&g.bool.filter.push({query_string:{query:d}});const p={query:g,size:1e4},v={search_type:"query_then_fetch",ignore_unavailable:!0};s.index?v.index=s.index:v.index=this.indexPattern.getIndexList(e.range.from,e.range.to);const C=JSON.stringify(v)+`
`+JSON.stringify(p)+`
`;return ua(s),(0,B.n)(this.post("_msearch",C).pipe((0,q.U)(O=>{const L=[],Q=O.responses[0].hits.hits,k=(P,_)=>{if(!_)return;const z=_.split(".");let x=P;for(let $=0;$<z.length;$++)if(x=x[z[$]],!x)return console.log("could not find field in annotation: ",_),"";return x};for(let P=0;P<Q.length;P++){const _=Q[P]._source;let z=k(_,n);if(typeof Q[P].fields<"u"){const $=Q[P].fields;((0,y.isString)($[n])||(0,y.isNumber)($[n]))&&(z=$[n])}const x={annotation:s,time:(0,M.zh)(z).valueOf(),text:k(_,u),tags:k(_,l)};if(a){const $=k(_,a);$&&(x.timeEnd=(0,M.zh)($).valueOf())}if(s.titleField){const $=k(_,s.titleField);$&&(x.text=$+`
`+x.text)}typeof x.tags=="string"&&(x.tags=x.tags.split(",")),L.push(x)}return L})))}interpolateLuceneQuery(e,s){return this.templateSrv.replace(e,s,"lucene")}interpolateVariablesInQueries(e,s){return e.map(n=>this.applyTemplateVariables(n,s))}async testDatasource(){const e=await this.getDatabaseVersion(!1),n=(e!=null?Je(e):!0)?"":`WARNING: ${Ze} `;return(0,B.n)(this.getFields(["date"]).pipe((0,Lt.z)(a=>(0,y.find)(a,{text:this.timeField})?(0,Y.of)({status:"success",message:`${n}Index OK. Time field name OK`}):(0,Y.of)({status:"error",message:"No date field named "+this.timeField+" found"})),(0,ge.K)(a=>(console.error(a),a.message?(0,Y.of)({status:"error",message:a.message}):(0,Y.of)({status:"error",message:a.status})))))}getQueryHeader(e,s,n){const a={search_type:e,ignore_unavailable:!0,index:this.indexPattern.getIndexList(s,n)};return JSON.stringify(a)}getQueryDisplayText(e){const s=e.metrics,n=e.bucketAggs;let a="";return e.query&&(a+="Query: "+e.query+", "),a+="Metrics: ",a+=s?.reduce((r,l)=>{let c=E[l.type].label+"(";return R(l)&&(c+=l.field),ae(l)&&(c+=J(l).replace(new RegExp("params.","g"),"")),c+="), ",`${r} ${c}`},""),a+=n?.reduce((r,l,u)=>{const c=F[l.type];let o="";return u===0&&(o+=" Group by: "),o+=c.label+"(",St(l)&&(o+=l.field),`${r} ${o}), `},""),e.alias&&(a+="Alias: "+e.alias),a}showContextToggle(){return!0}getDataProvider(e,s){if(this.getSupportedSupplementaryQueryTypes().includes(e))switch(e){case V.v8.LogsVolume:return this.getLogsVolumeDataProvider(s);default:return}}getSupportedSupplementaryQueryTypes(){return[V.v8.LogsVolume]}getSupplementaryQuery(e,s){if(!this.getSupportedSupplementaryQueryTypes().includes(e.type))return;let n=!1;switch(e.type){case V.v8.LogsVolume:if(n=s.metrics?.length===1&&s.metrics[0].type==="logs",!n)return;const a=[],r=this.timeField??"@timestamp";return this.logLevelField&&a.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:V.in.unknown},field:this.logLevelField}),a.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:r}),{refId:`${Yt}${s.refId}`,query:s.query,metrics:[{type:"count",id:"1"}],timeField:r,bucketAggs:a};default:return}}getLogsVolumeDataProvider(e){const s=(0,y.cloneDeep)(e),n=s.targets.map(a=>this.getSupplementaryQuery({type:V.v8.LogsVolume},a)).filter(a=>!!a);if(n.length)return(0,Hn.Bz)(this,{...s,targets:n},{range:e.range,targets:e.targets,extractLevel:a=>(0,Un.jx)(a.name||"")})}query(e){const{enableElasticsearchBackendQuerying:s}=me.v.featureToggles;if(s){const d=new Date;return super.query(e).pipe((0,Qt.b)(g=>Gt(g,e,d)),(0,q.U)(g=>(g.data.forEach(p=>{Kt(p,this.dataLinks)}),g)))}let n="";const a=this.interpolateVariablesInQueries((0,y.cloneDeep)(e.targets),e.scopedVars),r=[];let l=a.some(d=>Se(d,"logs"));const u=[];for(const d of a){if(d.hide)continue;let g;if(Se(d,"logs")){d.bucketAggs=[le()];const O=d.metrics?.find(Q=>Q.type==="logs"),L=O.settings?.limit?parseInt(O.settings?.limit,10):500;u.push(L),d.metrics=[],g=this.queryBuilder.getLogsQuery(d,L)}else u.push(),d.alias&&(d.alias=this.interpolateLuceneQuery(d.alias,e.scopedVars)),g=this.queryBuilder.build(d);const p=JSON.stringify(g),v="query_then_fetch",C=this.getQueryHeader(v,e.range.from,e.range.to);n+=C+`
`,n+=p+`
`,r.push(d)}if(r.length===0)return(0,Y.of)({data:[]});n=n.replace(/"\$timeFrom"/g,e.range.from.valueOf().toString()),n=n.replace(/"\$timeTo"/g,e.range.to.valueOf().toString()),n=this.templateSrv.replace(n,e.scopedVars);const c=this.getMultiSearchUrl(),o=new Date;return this.post(c,n).pipe((0,q.U)(d=>{const g=new zt(r,d);if(l){const p=g.getLogs(this.logMessageField,this.logLevelField);return p.data.forEach((v,C)=>{ma(v,this.dataLinks,u[C])}),p}return g.getTimeSeries()}),(0,Qt.b)(d=>Gt(d,e,o)))}filterQuery(e){return!e.hide}isMetadataField(e){return da.includes(e)}getFields(e,s){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.get("/_mapping",s).pipe((0,q.U)(a=>{const r=(o,d)=>this.isMetadataField(d)?!1:!e||e.length===0?!0:e.includes(o.type)||e.includes(n[o.type]),l=[],u={};function c(o){for(const d in o){const g=o[d];if((0,y.isObject)(g.properties)&&(l.push(d),c(g.properties)),(0,y.isObject)(g.fields)&&(l.push(d),c(g.fields)),(0,y.isString)(g.type)){const p=l.concat(d).join(".");r(g,d)&&(u[p]={text:p,type:g.type})}}l.pop()}for(const o in a){const d=a[o];if(d&&d.mappings){const p=d.mappings.properties;c(p)}}return(0,y.map)(u,o=>o)}))}getTerms(e,s=(0,fe.JK)()){const n="query_then_fetch",a=this.getQueryHeader(n,s.from,s.to);let r=JSON.stringify(this.queryBuilder.getTermsQuery(e));r=r.replace(/\$timeFrom/g,s.from.valueOf().toString()),r=r.replace(/\$timeTo/g,s.to.valueOf().toString()),r=a+`
`+r+`
`;const l=this.getMultiSearchUrl();return this.post(l,r).pipe((0,q.U)(u=>{if(!u.responses[0].aggregations)return[];const c=u.responses[0].aggregations[1].buckets;return(0,y.map)(c,o=>({text:o.key_as_string||o.key,value:o.key}))}))}getMultiSearchUrl(){const e=new URLSearchParams;return this.maxConcurrentShardRequests&&e.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.xpack&&this.includeFrozen&&e.append("ignore_throttled","false"),("_msearch?"+e.toString()).replace(/\?$/,"")}metricFindQuery(e,s){const n=s?.range,a=JSON.parse(e);if(e){if(a.find==="fields")return a.type=this.interpolateLuceneQuery(a.type),(0,B.n)(this.getFields(a.type,n));if(a.find==="terms")return a.field=this.interpolateLuceneQuery(a.field),a.query=this.interpolateLuceneQuery(a.query),(0,B.n)(this.getTerms(a,n))}return Promise.resolve([])}getTagKeys(){return(0,B.n)(this.getFields())}getTagValues(e){const s=this.timeSrv.timeRange();return(0,B.n)(this.getTerms({field:e.key},s))}targetContainsTemplate(e){if(this.templateSrv.containsTemplate(e.query)||this.templateSrv.containsTemplate(e.alias))return!0;for(const s of e.bucketAggs)if(this.templateSrv.containsTemplate(s.field)||this.objectContainsTemplate(s.settings))return!0;for(const s of e.metrics)if(this.templateSrv.containsTemplate(s.field)||this.objectContainsTemplate(s.settings)||this.objectContainsTemplate(s.meta))return!0;return!1}isPrimitive(e){return!!(e==null||["string","number","boolean"].some(s=>s==="boolean"))}objectContainsTemplate(e){if(!e)return!1;for(const s of Object.keys(e))if(this.isPrimitive(e[s])){if(this.templateSrv.containsTemplate(e[s]))return!0}else if(Array.isArray(e[s])){for(const n of e[s])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(e[s]))return!0;return!1}modifyQuery(e,s){if(!s.options)return e;let n=e.query??"";switch(s.type){case"ADD_FILTER":{n.length>0&&(n+=" AND "),n+=`${s.options.key}:"${s.options.value}"`;break}case"ADD_FILTER_OUT":{n.length>0&&(n+=" AND "),n+=`-${s.options.key}:"${s.options.value}"`;break}}return{...e,query:n}}addAdHocFilters(e){const s=this.templateSrv.getAdhocFilters(this.name);if(s.length===0)return e;const n=s.map(r=>{const{key:l,operator:u,value:c}=r;if(!(!l||!c))switch(u){case"=":return`${l}:"${c}"`;case"!=":return`-${l}:"${c}"`;case"=~":return`${l}:/${c}/`;case"!~":return`-${l}:/${c}/`;case">":return`${l}:>${c}`;case"<":return`${l}:<${c}`}});return[e,...n].filter(r=>r).join(" AND ")}applyTemplateVariables(e,s){const n=l=>l.type==="filters"?{...l,settings:{...l.settings,filters:l.settings?.filters?.map(u=>({...u,query:this.interpolateLuceneQuery(u.query,s)||"*"}))}}:l,a={...e,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(e.query||"",s)),bucketAggs:e.bucketAggs?.map(n)};return JSON.parse(this.templateSrv.replace(JSON.stringify(a),s))}getDatabaseVersionUncached(){return(0,B.n)(this.request("GET","/")).then(e=>{const s=e?.version?.number;if(typeof s!="string")return null;try{return new Fe.SemVer(s)}catch(n){return console.error(n),null}},e=>(console.error(e),null))}async getDatabaseVersion(e=!0){if(e){const n=this.databaseVersion;if(n!=null)return n}const s=await this.getDatabaseVersionUncached();return this.databaseVersion=s,s}}function ma(t,e,s){s&&(t.meta={...t.meta,limit:s}),Kt(t,e)}function Kt(t,e){if(e.length)for(const s of t.fields){const n=e.filter(a=>new RegExp(a.field).test(s.name));n.length!==0&&(s.config=s.config||{},s.config.links=[...(s.config.links,n.map(pa))])}}function pa(t){const e=(0,zn.F)();if(t.datasourceUid){const s=e.getInstanceSettings(t.datasourceUid);return{title:t.urlDisplayLabel||"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid,datasourceName:s?.name??"Data source not found"}}}else return{title:t.urlDisplayLabel||"",url:t.url}}function fa(t,e){if(e==="desc")return t;const s=t.responses[0];return{...t,responses:[{...s,hits:{...s.hits,hits:s.hits.hits.reverse()}}]}}function ha(t,e,s){if(s){const a=qt[s];return e===V.M4.Forward?{from:(0,M.CQ)(t).utc(),to:(0,M.CQ)(t).add(7,a.amount).utc().startOf(a.startOf)}:{from:(0,M.CQ)(t).subtract(7,a.amount).utc().startOf(a.startOf),to:(0,M.CQ)(t).utc()}}else return e===V.M4.Forward?{from:(0,M.CQ)(t).utc(),to:(0,M.CQ)(t).add(7,"hours").utc()}:{from:(0,M.CQ)(t).subtract(7,"hours").utc(),to:(0,M.CQ)(t).utc()}}const ya=new Qe.hf(ga).setQueryEditor(gn).setConfigEditor(On);(0,Zt.N$)().subscribe(Jt.Pl,ra)}}]);

//# sourceMappingURL=4601.b4f7a3448f55d020bcd9.js.map