"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8039],{71221:(J,I,n)=>{n.r(I),n.d(I,{UsersListPageContent:()=>j,UsersListPageUnconnected:()=>F,default:()=>Ee});var e=n(66111),v=n(67948),D=n(2631),M=n(68183),A=n(52081),x=n(78889),L=n(8412),o=n(77582),h=n(94599),P=n(31403),C=n(90336);const N={revokeInvite:C.GY},U=(0,v.connect)(null,N);class R extends e.PureComponent{render(){const{invitee:a,revokeInvite:r}=this.props;return e.createElement("tr",null,e.createElement("td",null,a.email),e.createElement("td",null,a.name),e.createElement("td",{className:"text-right"},e.createElement(h.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>a.url},"Copy Invite"),"\xA0"),e.createElement("td",null,e.createElement(P.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>r(a.code),"aria-label":"Revoke Invite"})))}}const B=U(R);class i extends e.PureComponent{render(){const{invitees:a}=this.props;return e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null),e.createElement("th",{style:{width:"34px"}}))),e.createElement("tbody",{"data-testid":"InviteesTable-body"},a.map((r,c)=>e.createElement(B,{key:`${r.id}-${c}`,invitee:r}))))}}var f=n(90158),S=n(75804);const{selectAll:b,selectById:s,selectTotal:m}=S.wl,d=(t,a)=>a,g=(0,f.P1)([b,d],(t,a)=>{const r=new RegExp(a,"i");return t.filter(l=>r.test(l.name)||r.test(l.email))});var Y=n(14747),X=n(2594),Z=n(47694),w=n(27876),k=n(82897),Q=n(54899),q=n(95156),E=n(12142);function y(){return async(t,a)=>{try{const{perPage:r,page:c,searchQuery:l}=a().users,u=await(0,Q.i)().get("/api/org/users/search",(0,q.y)({perpage:r,page:c,query:l}));t((0,E.eT)(u))}catch{(0,E.k7)()}}}const _=(0,k.debounce)(t=>t(y()),300);function ee(t){return async a=>{await(0,Q.i)().patch(`/api/org/users/${t.userId}`,{role:t.role}),a(y())}}function te(t){return async a=>{await(0,Q.i)().delete(`/api/org/users/${t}`),a(y())}}function ne(t){return async a=>{a((0,E.tZ)()),a((0,E.PJ)(t)),a(y())}}function ae(t){return async a=>{a((0,E.tZ)()),a((0,E.w4)(t)),_(a)}}const se=t=>{const a=new RegExp(t.searchQuery,"i");return t.users.filter(r=>a.test(r.login)||a.test(r.email)||a.test(r.name))},W=t=>t.searchQuery;function re(t){return{searchQuery:W(t.users),pendingInvitesCount:m(t.invites),externalUserMngLinkName:t.users.externalUserMngLinkName,externalUserMngLinkUrl:t.users.externalUserMngLinkUrl,canInvite:t.users.canInvite}}const le={changeSearchQuery:ae},oe=(0,v.connect)(re,le)(({canInvite:t,externalUserMngLinkName:a,externalUserMngLinkUrl:r,searchQuery:c,pendingInvitesCount:l,changeSearchQuery:u,onShowInvites:T,showInvites:O})=>{const K=[{label:"Users",value:"users"},{label:`Pending Invites (${l})`,value:"invites"}],$=o.Vt.hasAccess(w.AccessControlAction.OrgUsersAdd,t)&&!(Z.ZP.disableLoginForm&&Z.ZP.externalUserMngInfo);return e.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},e.createElement("div",{className:"gf-form gf-form--grow"},e.createElement(Y.H,{value:c,onChange:u,placeholder:"Search user by login, email or name"})),l>0&&e.createElement("div",{style:{marginLeft:"1rem"}},e.createElement(X.S,{value:O?"invites":"users",options:K,onChange:T})),$&&e.createElement(P.Qj,{href:"org/users/invite"},"Invite"),r&&e.createElement(P.Qj,{href:r,target:"_blank",rel:"noopener"},a))});var ce=n(68903);function ie(t){const a=W(t.users);return{users:se(t.users),searchQuery:W(t.users),page:t.users.page,totalPages:t.users.totalPages,perPage:t.users.perPage,invitees:g(t.invites,a),externalUserMngInfo:t.users.externalUserMngInfo,isLoading:t.users.isLoading}}const me={loadUsers:y,fetchInvitees:C.nW,changePage:ne,updateUser:ee,removeUser:te},de=(0,v.connect)(ie,me),ge=M.wl.pages.UserListPage.UsersListPage,F=({users:t,page:a,totalPages:r,invitees:c,externalUserMngInfo:l,isLoading:u,loadUsers:T,fetchInvitees:O,changePage:K,updateUser:H,removeUser:$})=>{const[V,ue]=(0,e.useState)(!1),G=l?(0,D.a)(l):"";(0,e.useEffect)(()=>{T(),O()},[O,T]);const ve=(p,z)=>{H({...z,role:p})},he=()=>{ue(!V)},Pe=()=>V?e.createElement(i,{invitees:c}):e.createElement(A.wc,{spacing:"md","data-testid":ge.container},e.createElement(ce.P,{users:t,orgId:o.Vt.user.orgId,onRoleChange:(p,z)=>ve(p,z),onRemoveUser:p=>$(p.userId)}),e.createElement(A.Lh,{justify:"flex-end"},e.createElement(x.t,{onNavigate:K,currentPage:a,numberOfPages:r,hideWhenSinglePage:!0})));return e.createElement(L.T.Contents,{isLoading:!u},e.createElement(oe,{onShowInvites:he,showInvites:V}),G&&e.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:G}}),u&&Pe())},j=de(F);function Ee(){return e.createElement(L.T,{navId:"users"},e.createElement(j,null))}},68903:(J,I,n)=>{n.d(I,{P:()=>C});var e=n(66111),v=n(31403),D=n(98102),M=n(66226),A=n(11630),x=n(21731),L=n(47694),o=n(77582),h=n(27876),P=n(65135);const C=({users:N,orgId:U,onRoleChange:R,onRemoveUser:B})=>{const[i,f]=(0,e.useState)(null),[S,b]=(0,e.useState)([]);return(0,e.useEffect)(()=>{async function s(){try{if(o.Vt.hasPermission(h.AccessControlAction.ActionRolesList)){let m=await(0,A.ul)(U);b(m)}}catch{console.error("Error loading options")}}o.Vt.licensedAccessControlEnabled()&&s()},[U]),e.createElement(e.Fragment,null,e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Login"),e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null,"Seen"),e.createElement("th",null,"Role"),e.createElement("th",{style:{width:"34px"}}),e.createElement("th",null,"Origin"),e.createElement("th",null))),e.createElement("tbody",null,N.map((s,m)=>{let d=!o.Vt.hasPermissionInMetadata(h.AccessControlAction.OrgUsersWrite,s);return L.ZP.featureToggles.onlyExternalOrgRoleSync&&(d=s?.isExternallySynced||d),e.createElement("tr",{key:`${s.userId}-${m}`},e.createElement("td",{className:"width-2 text-center"},e.createElement("img",{className:"filter-table__avatar",src:s.avatarUrl,alt:"User avatar"})),e.createElement("td",{className:"max-width-6"},e.createElement("span",{className:"ellipsis",title:s.login},s.login)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:s.email},s.email)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:s.name},s.name)),e.createElement("td",{className:"width-1"},s.lastSeenAtAge),e.createElement("td",{className:"width-8"},o.Vt.licensedAccessControlEnabled()?e.createElement(M.R,{userId:s.userId,orgId:U,roleOptions:S,basicRole:s.role,onBasicRoleChange:g=>R(g,s),basicRoleDisabled:d}):e.createElement(P.A,{"aria-label":"Role",value:s.role,disabled:d,onChange:g=>R(g,s)})),e.createElement("td",{className:"width-1 text-center"},s.isDisabled&&e.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")),e.createElement("td",{className:"width-1"},Array.isArray(s.authLabels)&&s.authLabels.length>0&&e.createElement(x.e,{label:s.authLabels[0],removeIcon:!1,count:0})),o.Vt.hasPermissionInMetadata(h.AccessControlAction.OrgUsersRemove,s)&&e.createElement("td",{className:"text-right"},e.createElement(v.zx,{size:"sm",variant:"destructive",onClick:()=>{f(s)},icon:"times","aria-label":"Delete user"})))}))),Boolean(i)&&e.createElement(D.s,{body:`Are you sure you want to delete user ${i?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{f(null)},isOpen:!0,onConfirm:()=>{i&&(B(i),f(null))}}))}}}]);

//# sourceMappingURL=UsersListPage.7f76c579a47975b02d25.js.map